/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "D:\\phpStudy\\WWW\\TP0011\\xstarp\\xstarp\\docs\\dist";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ function(module, exports, __webpack_require__) {

	eval("/**\r\n * Created by fizz on 2017/1/19.\r\n * package all the components.\r\n * @output prod entry.\r\n */\r\n\r\n__webpack_require__(1);\r\n__webpack_require__(2);\r\n__webpack_require__(3);\r\n__webpack_require__(4);\r\n__webpack_require__(5);\r\n\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMveHN0YXJwLmpzPzk1NDIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBmaXp6IG9uIDIwMTcvMS8xOS5cclxuICogcGFja2FnZSBhbGwgdGhlIGNvbXBvbmVudHMuXHJcbiAqIEBvdXRwdXQgcHJvZCBlbnRyeS5cclxuICovXHJcblxyXG5yZXF1aXJlKCcuL2ZpenouanMnKTtcclxucmVxdWlyZSgnLi9qY2MuanMnKTtcclxucmVxdWlyZSgnLi9kdWFuc2lqaWEuanMnKTtcclxucmVxdWlyZSgnLi9tbWYuanMnKTtcclxucmVxdWlyZSgnLi96cS5qcycpO1xyXG5cclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMveHN0YXJwLmpzXG4vLyBtb2R1bGUgaWQgPSAwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 1 */
/***/ function(module, exports) {

	eval("/**\r\n * Created by jesse on 2017/2/23.\r\n */\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZml6ei5qcz8zNTdhIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQSIsImZpbGUiOiIxLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENyZWF0ZWQgYnkgamVzc2Ugb24gMjAxNy8yLzIzLlxyXG4gKi9cclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMvZml6ei5qc1xuLy8gbW9kdWxlIGlkID0gMVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 2 */
/***/ function(module, exports) {

	eval("/**\r\n * Created by jesse on 2017/2/23.\r\n */\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvamNjLmpzP2ZhMDUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBIiwiZmlsZSI6IjIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBqZXNzZSBvbiAyMDE3LzIvMjMuXHJcbiAqL1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9qY2MuanNcbi8vIG1vZHVsZSBpZCA9IDJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 3 */
/***/ function(module, exports) {

	eval("/**\r\n * Created by jesse on 2017/2/23.\r\n */\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZHVhbnNpamlhLmpzPzY0MmUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBIiwiZmlsZSI6IjMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBqZXNzZSBvbiAyMDE3LzIvMjMuXHJcbiAqL1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9kdWFuc2lqaWEuanNcbi8vIG1vZHVsZSBpZCA9IDNcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 4 */
/***/ function(module, exports) {

	eval("/**\r\n * Created by jesse on 2017/2/23.\r\n */\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvbW1mLmpzPzIyOTQiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBIiwiZmlsZSI6IjQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBqZXNzZSBvbiAyMDE3LzIvMjMuXHJcbiAqL1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9tbWYuanNcbi8vIG1vZHVsZSBpZCA9IDRcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 5 */
/***/ function(module, exports, __webpack_require__) {

	eval("/**\r\n * Created by jesse on 2017/2/23.\r\n */\r\n\r\n\r\n__webpack_require__(6)//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvenEuanM/ODNkMyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7OztBQUdBIiwiZmlsZSI6IjUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBqZXNzZSBvbiAyMDE3LzIvMjMuXHJcbiAqL1xyXG5cclxuXHJcbnJlcXVpcmUoJy4vY29tcG9uZW50cy91cGxvYWQvaW5kZXguanMnKVxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vc3JjL3pxLmpzXG4vLyBtb2R1bGUgaWQgPSA1XG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=");

/***/ },
/* 6 */
/***/ function(module, exports, __webpack_require__) {

	eval("/**\r\n * Created by jesse on 2017/2/22.\r\n */\r\n\r\n__webpack_require__(7);\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy91cGxvYWQvaW5kZXguanM/ZTVkZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBRUEiLCJmaWxlIjoiNi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGplc3NlIG9uIDIwMTcvMi8yMi5cclxuICovXHJcblxyXG5yZXF1aXJlKCcuL3VwbG9hZCcpO1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9jb21wb25lbnRzL3VwbG9hZC9pbmRleC5qc1xuLy8gbW9kdWxlIGlkID0gNlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwic291cmNlUm9vdCI6IiJ9");

/***/ },
/* 7 */
/***/ function(module, exports, __webpack_require__) {

	eval("\r\nvar WebUploader = __webpack_require__(8);\r\n\r\n// 当domReady的时候开始初始化\r\n(function($) {\r\n    var $wrap = $('.x-uploader'),\r\n\r\n    // 图片容器   多文件的时候\r\n        $queue = $( '<ul class=\"x-filelist\"></ul>' )\r\n            .appendTo( $wrap.find( '.x-queueList' ) ),\r\n    // 状态栏，包括进度和控制按钮\r\n        $statusBar = $wrap.find( '.x-statusBar' ),\r\n\r\n    // 文件总体选择信息。\r\n        $info = $statusBar.find( '.x-info' ),\r\n\r\n    // 上传按钮\r\n        $upload = $wrap.find( '.x-uploadBtn' ),\r\n\r\n    // 没选择文件之前的内容。\r\n        $placeHolder = $wrap.find( '.x-placeholder' ),\r\n\r\n        $progress = $statusBar.find( '.progress' ).hide(),\r\n\r\n\r\n    // 添加的文件数量\r\n        fileCount = 0,\r\n\r\n    // 添加的文件总大小\r\n        fileSize = 0,\r\n\r\n    // 优化retina, 在retina下这个值是2\r\n        ratio = window.devicePixelRatio || 1,\r\n\r\n    // 缩略图大小\r\n        thumbnailWidth = 110 * ratio,\r\n        thumbnailHeight = 110 * ratio,\r\n\r\n    // 可能有pedding, ready, uploading, confirm, done.\r\n        state = 'pedding',\r\n\r\n    // 所有文件的进度信息，key为file id\r\n        percentages = {},\r\n    // 判断浏览器是否支持图片的base64\r\n\r\n    // WebUploader实例\r\n        uploader;\r\n\r\n    //图片上传和文件上传区分 参数\r\n    var opt_file = {\r\n        dom:'',\r\n        fileButton: {\r\n            id: '.x-filePicker',\r\n            label: '批量上传'\r\n        },\r\n        addButton:{\r\n            id: '.x-filePicker-add',\r\n            label: '继续添加'\r\n        },\r\n        dnd: '.x-dndArea',\r\n        paste: '.x-uploader',\r\n        swf: '../../dist/Uploader.swf',\r\n        chunked: false,\r\n        chunkSize: 512 * 1024,\r\n        server: '?m=Admin&c=Upload&a=upload',\r\n        compress:false,\r\n        // 禁掉全局的拖拽功能。这样不会出现图片拖进页面的时候，把图片打开。\r\n        disableGlobalDnd: true,\r\n        fileNumLimit: 300,\r\n        fileSizeLimit: 200 * 1024 * 1024,    // 200 M\r\n        fileSingleSizeLimit: 50 * 1024 * 1024    // 50 M\r\n    };\r\n\r\n\r\n    // 实例化\r\n    window.xUpload = function (opt) {\r\n        return new upload(opt);\r\n    };\r\n\r\n    var defaultOption = opt_file;\r\n    var upload=function(opt,dom){\r\n        this.opt = $.extend(true,{},defaultOption,opt);\r\n        if(this.isFlash){\r\n            this.init(this.opt);\r\n        }\r\n        return this;\r\n    };\r\n\r\n    upload.prototype ={\r\n        isSupportBase64:( function() {\r\n            var data = new Image();\r\n            var support = true;\r\n            data.onload = data.onerror = function() {\r\n                if( this.width != 1 || this.height != 1 ) {\r\n                    support = false;\r\n                }\r\n            };\r\n            data.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\r\n            return support;\r\n        } )(),\r\n        //检测是否已经安装flash，检测flash的版本\r\n        flashVersion : ( function() {\r\n            var version;\r\n            try {\r\n                version = navigator.plugins[ 'Shockwave Flash' ];\r\n                version = version.description;\r\n            } catch ( ex ) {\r\n                try {\r\n                    version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\r\n                        .GetVariable('$version');\r\n                } catch ( ex2 ) {\r\n                    version = '0.0';\r\n                }\r\n            }\r\n            version = version.match( /\\d+/g );\r\n            return parseFloat( version[ 0 ] + '.' + version[ 1 ], 10 );\r\n        } )(),\r\n\r\n        supportTransition : (function(){\r\n            var s = document.createElement('p').style,\r\n                r = 'transition' in s ||\r\n                    'WebkitTransition' in s ||\r\n                    'MozTransition' in s ||\r\n                    'msTransition' in s ||\r\n                    'OTransition' in s;\r\n            s = null;\r\n            return r;\r\n        })(),\r\n        isFlash:function(){\r\n            if ( !WebUploader.Uploader.support('flash') && WebUploader.browser.ie ) {\r\n\r\n                // flash 安装了但是版本过低。\r\n                if (this.flashVersion) {\r\n                    (function(container) {\r\n                        window['expressinstallcallback'] = function( state ) {\r\n                            switch(state) {\r\n                                case 'Download.Cancelled':\r\n                                    alert('您取消了更新！');\r\n                                    break;\r\n\r\n                                case 'Download.Failed':\r\n                                    alert('安装失败');\r\n                                    break;\r\n\r\n                                default:\r\n                                    alert('安装已成功，请刷新！');\r\n                                    break;\r\n                            }\r\n                            delete window['expressinstallcallback'];\r\n                        };\r\n\r\n                        var swf = './expressInstall.swf';\r\n                        // insert flash object\r\n                        var html = '<object type=\"application/' +\r\n                            'x-shockwave-flash\" data=\"' +  swf + '\" ';\r\n\r\n                        if (WebUploader.browser.ie) {\r\n                            html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\r\n                        }\r\n\r\n                        html += 'width=\"100%\" height=\"100%\" style=\"outline:0\">'  +\r\n                            '<param name=\"movie\" value=\"' + swf + '\" />' +\r\n                            '<param name=\"wmode\" value=\"transparent\" />' +\r\n                            '<param name=\"allowscriptaccess\" value=\"always\" />' +\r\n                            '</object>';\r\n\r\n                        container.html(html);\r\n\r\n                    })($wrap);\r\n\r\n                    // 压根就没有安转。\r\n                } else {\r\n                    $wrap.html('<a href=\"http://www.adobe.com/go/getflashplayer\" target=\"_blank\" border=\"0\"><img alt=\"get flash player\" src=\"http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg\" /></a>');\r\n                }\r\n\r\n                return;\r\n            } else if (!WebUploader.Uploader.support()) {\r\n                alert( 'Web Uploader 不支持您的浏览器！');\r\n                return;\r\n            }\r\n        },\r\n        init:function(opt){\r\n\r\n            var fileType = opt.fileType;\r\n            var addButton = opt.addButton;\r\n\r\n            opt.pick = opt.fileButton;\r\n            var _that = this;\r\n            if(fileType == 1){\r\n                opt['accept'] = {\r\n                    title: 'Images',\r\n                    extensions: 'gif,jpg,jpeg,bmp,png',\r\n                    mimeTypes:'image/gif,image/jpg,image/jpeg,image/bmp,image/png'\r\n                };\r\n                opt['fileButton']['multiple'] = false;\r\n            }\r\n            uploader = WebUploader.create(opt);\r\n            // 添加“添加文件”的按钮，\r\n            uploader.addButton(addButton);\r\n\r\n\r\n            uploader.on('ready', function() {\r\n                window.uploader = uploader;\r\n            });\r\n\r\n            uploader.onUploadProgress = function( file, percentage ) {\r\n                //进度条回调\r\n                if(fileType==2) {\r\n                    var $li = $('#' + file.id),\r\n                        $percent = $li.find('.progress span');\r\n\r\n                    $percent.css('width', percentage * 100 + '%');\r\n                    percentages[file.id][1] = percentage;\r\n                    updateTotalProgress();\r\n                }else if(fileType == 1){\r\n\r\n                    $statusBar.show();\r\n                    this.options.progress(Math.round( percentage * 100 ) + '%');\r\n                }\r\n\r\n            };\r\n\r\n            uploader.onUploadSuccess = function(file){\r\n                //上传成功后调用\r\n                if(fileType ==1){\r\n                    $wrap.find('.x-info').text('头像上传成功，总大小：'+getSize(file.size));\r\n                }\r\n            };\r\n\r\n            uploader.onUploadAccept = function(object,ret){\r\n                this.options.success(object,ret);\r\n            };\r\n\r\n            uploader.onFileQueued = function( file ) {\r\n                //添加到队列\r\n                if(fileType == 2){\r\n                    fileCount++;\r\n                    fileSize += file.size;\r\n\r\n                    if ( fileCount === 1 ) {\r\n                        $placeHolder.addClass( 'element-invisible' );\r\n                        $statusBar.show();\r\n                        //$statusBar.css({'display':'block'})\r\n                    }\r\n                    addFile( file );\r\n                    setState( 'ready' );\r\n                    updateTotalProgress();\r\n                }else if(fileType ==1){\r\n                    //单张图片\r\n\r\n                    addFileImg(file);\r\n                    if ( state === 'ready' ) {\r\n\r\n                        uploader.upload(file);\r\n\r\n                    } else if ( state === 'paused' ) {\r\n                        uploader.upload(file);\r\n                    } else if ( state === 'uploading' ) {\r\n                        uploader.stop(file);\r\n                    }\r\n                }\r\n            };\r\n            uploader.onUploadError = function(file,reason){\r\n                if(reason =='http'){\r\n                    console.log(\"服务器错误\");\r\n                }\r\n                return;\r\n            };\r\n            uploader.onFileDequeued = function( file ) {\r\n                //文件从队列中移除\r\n                if(fileType==2){\r\n                    fileCount--;\r\n                    fileSize -= file.size;\r\n\r\n                    if ( !fileCount ) {\r\n                        setState( 'pedding' );\r\n                    }\r\n\r\n                    removeFile( file );\r\n                    updateTotalProgress();\r\n                }\r\n\r\n\r\n            };\r\n            uploader.onUploadFinished = function(){\r\n                if(fileType == 2){\r\n                    setState( 'confirm' );\r\n                }\r\n            };\r\n            uploader.onStartUpload = function(file){\r\n                setState( 'uploading' );\r\n\r\n            };\r\n            uploader.onStopUpload = function(){\r\n                console.log(\"暂停\");\r\n                setState( 'paused' );\r\n            };\r\n\r\n            uploader.onError = function( code ) {\r\n                //错误信息\r\n                switch (code) {\r\n                    case 'Q_TYPE_DENIED' :\r\n                        alert('不符合的文件类型');\r\n                        break;\r\n                    case 'Q_EXCEED_SIZE_LIMIT':\r\n                        alert('文件总大小超出，请重新设置');\r\n                        break;\r\n                    case 'Q_EXCEED_NUM_LIMIT':\r\n                        alert('文件数量过多，请分批上传');\r\n                        break;\r\n                }\r\n            };\r\n\r\n\r\n\r\n            $upload.on('click', function() {\r\n                //点击上传按钮\r\n                console.log(\"开始上传\");\r\n                if ( $(this).hasClass( 'disabled' ) ) {\r\n                    return false;\r\n                }\r\n\r\n                if ( state === 'ready' ) {\r\n                    uploader.upload();\r\n                } else if ( state === 'paused' ) {\r\n                    uploader.upload();\r\n                } else if ( state === 'uploading' ) {\r\n                    uploader.stop();\r\n                }\r\n            });\r\n\r\n            $wrap.on( 'click', '.retry', function() {\r\n\r\n                uploader.retry();\r\n            } );\r\n\r\n\r\n\r\n            $upload.addClass( 'state-' + state );\r\n            function addFile( file ) {\r\n                //html文件列表\r\n\r\n                var $li = $( '<li id=\"' + file.id + '\">' +\r\n                        '<p class=\"title\">' + file.name + '</p>' +\r\n                        '<p class=\"imgWrap\"></p>'+\r\n                        '<p class=\"progress\"><span></span></p>' +\r\n                        '</li>' ),\r\n\r\n                    $btns = $('<div class=\"file-panel\">' +\r\n                        '<span class=\"cancel\">删除</span>' +\r\n                        '<span class=\"rotateRight\">向右旋转</span>' +\r\n                        '<span class=\"rotateLeft\">向左旋转</span></div>').appendTo( $li ),\r\n                    $prgress = $li.find('p.progress span'),\r\n                    $wrap = $li.find( 'p.imgWrap' ),\r\n                    $info = $('<p class=\"error\"></p>'),\r\n                    text = '',\r\n                    showError = function( code ) {\r\n                        switch( code ) {\r\n                            case 'exceed_size':\r\n                                text = '文件大小超出';\r\n                                break;\r\n\r\n                            case 'interrupt':\r\n                                text = '上传暂停';\r\n                                break;\r\n\r\n                            default:\r\n                                text = '上传失败，请重试';\r\n                                break;\r\n                        }\r\n                        console.log(text);\r\n                        $info.text( text ).appendTo( $li );\r\n                    };\r\n\r\n\r\n                if ( file.getStatus() === 'invalid' ) {\r\n                    showError( file.statusText );\r\n                    console.log(file.getStatus());\r\n                } else {\r\n                    // @todo lazyload\r\n                    $wrap.text( '预览中' );\r\n                    uploader.makeThumb( file, function( error, src ) {\r\n                        var img;\r\n                        if ( error ) {\r\n                            $wrap.text( '不能预览' );\r\n                            return;\r\n                        }\r\n                        if( _that.isSupportBase64 ) {\r\n                            img = $('<img src=\"'+src+'\">');\r\n                            $wrap.empty().append( img );\r\n                        } else {\r\n                            console.log(\"预览出错\");\r\n                        }\r\n                    }, thumbnailWidth, thumbnailHeight );\r\n\r\n                    percentages[ file.id ] = [ file.size, 0 ];\r\n                    file.rotation = 0;\r\n                }\r\n\r\n                file.on('statuschange', function( cur, prev ) {\r\n                    //状态改变\r\n                    if ( prev === 'progress' ) {\r\n                        $prgress.hide().width(0);\r\n                    } else if ( prev === 'queued' ) {\r\n                        $li.off( 'mouseenter mouseleave' );\r\n                        $btns.remove();\r\n                    }\r\n\r\n                    // 成功\r\n                    if ( cur === 'error' || cur === 'invalid' ) {\r\n                        console.log( file.statusText );\r\n                        showError( file.statusText );\r\n                        percentages[ file.id ][ 1 ] = 1;\r\n                    } else if ( cur === 'interrupt' ) {\r\n                        showError( 'interrupt' );\r\n                    } else if ( cur === 'queued' ) {\r\n                        $info.remove();\r\n                        $prgress.css('display', 'block');\r\n                        percentages[ file.id ][ 1 ] = 0;\r\n                    } else if ( cur === 'progress' ) {\r\n                        $info.remove();\r\n                        $prgress.css('display', 'block');\r\n                    } else if ( cur === 'complete' ) {\r\n                        $prgress.hide().width(0);\r\n                        $li.append( '<span class=\"success\"></span>' );\r\n                    }\r\n\r\n                    $li.removeClass( 'state-' + prev ).addClass( 'state-' + cur );\r\n                });\r\n\r\n                $li.on( 'mouseenter', function() {\r\n                    $btns.stop().animate({height: 30});\r\n                });\r\n\r\n                $li.on( 'mouseleave', function() {\r\n                    $btns.stop().animate({height: 0});\r\n                });\r\n\r\n                $btns.on( 'click', 'span', function() {\r\n                    var index = $(this).index(),\r\n                        deg;\r\n                    switch ( index ) {\r\n                        case 0:\r\n                            uploader.removeFile( file );\r\n                            return;\r\n\r\n                        case 1:\r\n                            file.rotation += 90;\r\n                            break;\r\n\r\n                        case 2:\r\n                            file.rotation -= 90;\r\n                            break;\r\n                    }\r\n\r\n                    if ( supportTransition ) {\r\n                        deg = 'rotate(' + file.rotation + 'deg)';\r\n                        $wrap.css({\r\n                            '-webkit-transform': deg,\r\n                            '-mos-transform': deg,\r\n                            '-o-transform': deg,\r\n                            'transform': deg\r\n                        });\r\n                    } else {\r\n                        $wrap.css( 'filter', 'progid:DXImageTransform.Microsoft.BasicImage(rotation='+ (~~((file.rotation/90)%4 + 4)%4) +')');\r\n                    }\r\n\r\n\r\n                });\r\n\r\n                $li.appendTo($queue);\r\n\r\n\r\n\r\n\r\n            }\r\n\r\n            // 负责view的销毁\r\n            function removeFile( file ) {\r\n                var $li = $('#'+file.id);\r\n\r\n                delete percentages[ file.id ];\r\n                updateTotalProgress();\r\n                $li.off().find('.file-panel').off().end().remove();\r\n            }\r\n\r\n            function updateTotalProgress() {\r\n                var loaded = 0,\r\n                    total = 0,\r\n                    spans = $progress.children(),\r\n                    percent;\r\n\r\n                $.each( percentages, function( k, v ) {\r\n                    total += v[ 0 ];\r\n                    loaded += v[ 0 ] * v[ 1 ];\r\n                } );\r\n\r\n                percent = total ? loaded / total : 0;\r\n\r\n                opt.progress(Math.round( percent * 100 ) + '%');\r\n                spans.eq( 0 ).text( Math.round( percent * 100 ) + '%' );\r\n                spans.eq( 1 ).css( 'width', Math.round( percent * 100 ) + '%' );\r\n                if(fileType == 2){\r\n                    updateStatus();\r\n                }\r\n\r\n            }\r\n\r\n            function updateStatus() {\r\n                var text = '', stats;\r\n\r\n                if ( state === 'ready' ) {\r\n                    text = '选中' + fileCount + '个文件，共' +\r\n                        WebUploader.formatSize( fileSize ) + '。';\r\n                } else if ( state === 'confirm' ) {\r\n                    stats = uploader.getStats();\r\n                    if ( stats.uploadFailNum ) {\r\n                        text = '已成功上传' + stats.successNum+ '个文件，'+\r\n                            stats.uploadFailNum + '个文件上传失败，<a class=\"retry\" href=\"#\">重新上传</a>失败文件';\r\n                    }\r\n\r\n                } else {\r\n                    stats = uploader.getStats();\r\n                    text = '共' + fileCount + '张（' +\r\n                        WebUploader.formatSize( fileSize )  +\r\n                        '），已上传' + stats.successNum + '张';\r\n\r\n                    if ( stats.uploadFailNum ) {\r\n                        text += '，失败' + stats.uploadFailNum + '张';\r\n                    }\r\n                }\r\n\r\n                $info.html( text );\r\n            }\r\n\r\n            function setState( val ) {\r\n                var file, stats;\r\n\r\n                if ( val === state ) {\r\n                    return;\r\n                }\r\n\r\n                $upload.removeClass( 'state-' + state );\r\n                $upload.addClass( 'state-' + val );\r\n                state = val;\r\n\r\n                switch ( state ) {\r\n                    case 'pedding':\r\n                        $placeHolder.removeClass( 'element-invisible' );\r\n                        $queue.hide();\r\n                        $statusBar.addClass( 'element-invisible' );\r\n                        uploader.refresh();\r\n                        break;\r\n\r\n                    case 'ready':\r\n                        $placeHolder.addClass( 'element-invisible' );\r\n                        $( addButton.id ).removeClass( 'element-invisible');\r\n                        $queue.show();\r\n                        $statusBar.removeClass('element-invisible');\r\n                        uploader.refresh();\r\n                        break;\r\n\r\n                    case 'uploading':\r\n                        $( addButton.id ).addClass( 'element-invisible' );\r\n                        $progress.show();\r\n                        $upload.text( '暂停上传' );\r\n                        break;\r\n\r\n                    case 'paused':\r\n                        $progress.show();\r\n                        $upload.text( '继续上传' );\r\n                        break;\r\n\r\n                    case 'confirm':\r\n                        $progress.hide();\r\n                        $( addButton.id ).removeClass( 'element-invisible' );\r\n                        $upload.text( '开始上传' );\r\n\r\n                        stats = uploader.getStats();\r\n                        if ( stats.successNum && !stats.uploadFailNum ) {\r\n                            setState( 'finish' );\r\n                            return;\r\n                        }\r\n                        break;\r\n                    case 'finish':\r\n                        stats = uploader.getStats();\r\n                        if ( stats.successNum ) {\r\n                            console.log( '上传成功' );\r\n                        } else {\r\n                            // 没有成功的图片，重设\r\n                            state = 'done';\r\n                            location.reload();\r\n                        }\r\n                        break;\r\n                }\r\n                if(fileType == 2){\r\n                    updateStatus();\r\n                }\r\n            }\r\n            function getSize(size){\r\n                var str;\r\n                if(size/1024>1){\r\n                    size = size/1024;\r\n                    str = 'KB';\r\n                }\r\n\r\n                if(size/1024>1){\r\n                    size = size/1024;\r\n                    str = 'MB';\r\n                }\r\n                if(size/1024 >1){\r\n                    size = size/1024;\r\n                    str = 'GB';\r\n                }\r\n                size =   size.toFixed(2);\r\n                str = size + str;\r\n                return str;\r\n            }\r\n\r\n            function addFileImg(file){\r\n                var html = '<div class=\"imgFile\">' +\r\n                    '<img src=\"\">' +\r\n                    '</div>';\r\n                var img;\r\n                var   $info = $('<p class=\"error\"></p>');\r\n                var   text = '';\r\n                var  showError = function( code ) {\r\n                    switch( code ) {\r\n                        case 'exceed_size':\r\n                            text = '文件大小超出';\r\n                            break;\r\n\r\n                        case 'interrupt':\r\n                            text = '上传暂停';\r\n                            break;\r\n\r\n                        default:\r\n\r\n                            text = '上传失败，请重试 '+'<a class=\"retry\" href=\"#\">重新上传</a>';\r\n                            break;\r\n                    }\r\n\r\n\r\n\r\n                    $info.html( text ).appendTo( $wrap );\r\n\r\n                };\r\n\r\n                if ( file.getStatus() === 'invalid' ) {\r\n                    showError( file.statusText );\r\n                } else {\r\n                    uploader.makeThumb(file, function (error, src) {\r\n\r\n                        if (error) {\r\n                            //$wrap.text( '不能预览' );\r\n                            //return;\r\n                        }\r\n                        if (_that.isSupportBase64) {\r\n                            img = $('<img src=\"' + src + '\"><span class=\"x-fileName\">' + file.name + '</span>');\r\n                            $wrap.find(\".x-imgFile\").append(img);\r\n                        } else {\r\n                            console.log(\"预览出错\");\r\n                        }\r\n                    }, thumbnailWidth, thumbnailHeight);\r\n                }\r\n\r\n\r\n\r\n                file.on('statuschange', function( cur, prev ) {\r\n                    //状态改变\r\n                    // 成功\r\n                    if ( cur === 'error' || cur === 'invalid' ) {\r\n                        console.log( file.statusText );\r\n                        showError( file.statusText );\r\n                    } else if ( cur === 'interrupt' ) {\r\n                        showError( 'interrupt' );\r\n                    } else if ( cur === 'queued' ) {\r\n                        $info.remove();\r\n                    } else if ( cur === 'progress' ) {\r\n                        $info.remove();\r\n                    } else if ( cur === 'complete' ) {\r\n\r\n                    }\r\n\r\n                });\r\n\r\n\r\n\r\n                setState( 'ready' );\r\n\r\n                $(\".x-statusBar .x-upload-btns\").remove();\r\n                //$wrap.append($progress);\r\n                //$(\".x-queueList\").remove();\r\n            }\r\n\r\n            updateTotalProgress();\r\n        }\r\n    };\r\n    //uploader = WebUploader.create(opt_img);\r\n\r\n\r\n    // 当有文件添加进来时执行，负责view的创建\r\n\r\n\r\n\r\n})( $ );\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy91cGxvYWQvdXBsb2FkLmpzPzgxYTgiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLHdCQUF3QjtBQUN4Qjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUEscUJBQXFCOztBQUVyQjtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBOztBQUVBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsa0JBQWtCO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUEscUJBQXFCO0FBQ3JCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhOztBQUViOztBQUVBO0FBQ0EsYUFBYTs7OztBQUliO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBLHFCQUFxQjs7QUFFckI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQSwwQ0FBMEMsV0FBVztBQUNyRCxpQkFBaUI7O0FBRWpCO0FBQ0EsMENBQTBDLFVBQVU7QUFDcEQsaUJBQWlCOztBQUVqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekIscUJBQXFCO0FBQ3JCO0FBQ0E7OztBQUdBLGlCQUFpQjs7QUFFakI7Ozs7O0FBS0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCOztBQUVqQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7Ozs7QUFJQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxxQkFBcUI7O0FBRXJCOztBQUVBLGlCQUFpQjs7OztBQUlqQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7Ozs7QUFJQSxDQUFDIiwiZmlsZSI6IjcuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxudmFyIFdlYlVwbG9hZGVyID0gcmVxdWlyZSgnLi93ZWJ1cGxvYWRlci5qcycpO1xyXG5cclxuLy8g5b2TZG9tUmVhZHnnmoTml7blgJnlvIDlp4vliJ3lp4vljJZcclxuKGZ1bmN0aW9uKCQpIHtcclxuICAgIHZhciAkd3JhcCA9ICQoJy54LXVwbG9hZGVyJyksXHJcblxyXG4gICAgLy8g5Zu+54mH5a655ZmoICAg5aSa5paH5Lu255qE5pe25YCZXHJcbiAgICAgICAgJHF1ZXVlID0gJCggJzx1bCBjbGFzcz1cIngtZmlsZWxpc3RcIj48L3VsPicgKVxyXG4gICAgICAgICAgICAuYXBwZW5kVG8oICR3cmFwLmZpbmQoICcueC1xdWV1ZUxpc3QnICkgKSxcclxuICAgIC8vIOeKtuaAgeagj++8jOWMheaLrOi/m+W6puWSjOaOp+WItuaMiemSrlxyXG4gICAgICAgICRzdGF0dXNCYXIgPSAkd3JhcC5maW5kKCAnLngtc3RhdHVzQmFyJyApLFxyXG5cclxuICAgIC8vIOaWh+S7tuaAu+S9k+mAieaLqeS/oeaBr+OAglxyXG4gICAgICAgICRpbmZvID0gJHN0YXR1c0Jhci5maW5kKCAnLngtaW5mbycgKSxcclxuXHJcbiAgICAvLyDkuIrkvKDmjInpkq5cclxuICAgICAgICAkdXBsb2FkID0gJHdyYXAuZmluZCggJy54LXVwbG9hZEJ0bicgKSxcclxuXHJcbiAgICAvLyDmsqHpgInmi6nmlofku7bkuYvliY3nmoTlhoXlrrnjgIJcclxuICAgICAgICAkcGxhY2VIb2xkZXIgPSAkd3JhcC5maW5kKCAnLngtcGxhY2Vob2xkZXInICksXHJcblxyXG4gICAgICAgICRwcm9ncmVzcyA9ICRzdGF0dXNCYXIuZmluZCggJy5wcm9ncmVzcycgKS5oaWRlKCksXHJcblxyXG5cclxuICAgIC8vIOa3u+WKoOeahOaWh+S7tuaVsOmHj1xyXG4gICAgICAgIGZpbGVDb3VudCA9IDAsXHJcblxyXG4gICAgLy8g5re75Yqg55qE5paH5Lu25oC75aSn5bCPXHJcbiAgICAgICAgZmlsZVNpemUgPSAwLFxyXG5cclxuICAgIC8vIOS8mOWMlnJldGluYSwg5ZyocmV0aW5h5LiL6L+Z5Liq5YC85pivMlxyXG4gICAgICAgIHJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMSxcclxuXHJcbiAgICAvLyDnvKnnlaXlm77lpKflsI9cclxuICAgICAgICB0aHVtYm5haWxXaWR0aCA9IDExMCAqIHJhdGlvLFxyXG4gICAgICAgIHRodW1ibmFpbEhlaWdodCA9IDExMCAqIHJhdGlvLFxyXG5cclxuICAgIC8vIOWPr+iDveaciXBlZGRpbmcsIHJlYWR5LCB1cGxvYWRpbmcsIGNvbmZpcm0sIGRvbmUuXHJcbiAgICAgICAgc3RhdGUgPSAncGVkZGluZycsXHJcblxyXG4gICAgLy8g5omA5pyJ5paH5Lu255qE6L+b5bqm5L+h5oGv77yMa2V55Li6ZmlsZSBpZFxyXG4gICAgICAgIHBlcmNlbnRhZ2VzID0ge30sXHJcbiAgICAvLyDliKTmlq3mtY/op4jlmajmmK/lkKbmlK/mjIHlm77niYfnmoRiYXNlNjRcclxuXHJcbiAgICAvLyBXZWJVcGxvYWRlcuWunuS+i1xyXG4gICAgICAgIHVwbG9hZGVyO1xyXG5cclxuICAgIC8v5Zu+54mH5LiK5Lyg5ZKM5paH5Lu25LiK5Lyg5Yy65YiGIOWPguaVsFxyXG4gICAgdmFyIG9wdF9maWxlID0ge1xyXG4gICAgICAgIGRvbTonJyxcclxuICAgICAgICBmaWxlQnV0dG9uOiB7XHJcbiAgICAgICAgICAgIGlkOiAnLngtZmlsZVBpY2tlcicsXHJcbiAgICAgICAgICAgIGxhYmVsOiAn5om56YeP5LiK5LygJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYWRkQnV0dG9uOntcclxuICAgICAgICAgICAgaWQ6ICcueC1maWxlUGlja2VyLWFkZCcsXHJcbiAgICAgICAgICAgIGxhYmVsOiAn57un57ut5re75YqgJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZG5kOiAnLngtZG5kQXJlYScsXHJcbiAgICAgICAgcGFzdGU6ICcueC11cGxvYWRlcicsXHJcbiAgICAgICAgc3dmOiAnLi4vLi4vZGlzdC9VcGxvYWRlci5zd2YnLFxyXG4gICAgICAgIGNodW5rZWQ6IGZhbHNlLFxyXG4gICAgICAgIGNodW5rU2l6ZTogNTEyICogMTAyNCxcclxuICAgICAgICBzZXJ2ZXI6ICc/bT1BZG1pbiZjPVVwbG9hZCZhPXVwbG9hZCcsXHJcbiAgICAgICAgY29tcHJlc3M6ZmFsc2UsXHJcbiAgICAgICAgLy8g56aB5o6J5YWo5bGA55qE5ouW5ou95Yqf6IO944CC6L+Z5qC35LiN5Lya5Ye6546w5Zu+54mH5ouW6L+b6aG16Z2i55qE5pe25YCZ77yM5oqK5Zu+54mH5omT5byA44CCXHJcbiAgICAgICAgZGlzYWJsZUdsb2JhbERuZDogdHJ1ZSxcclxuICAgICAgICBmaWxlTnVtTGltaXQ6IDMwMCxcclxuICAgICAgICBmaWxlU2l6ZUxpbWl0OiAyMDAgKiAxMDI0ICogMTAyNCwgICAgLy8gMjAwIE1cclxuICAgICAgICBmaWxlU2luZ2xlU2l6ZUxpbWl0OiA1MCAqIDEwMjQgKiAxMDI0ICAgIC8vIDUwIE1cclxuICAgIH07XHJcblxyXG5cclxuICAgIC8vIOWunuS+i+WMllxyXG4gICAgd2luZG93LnhVcGxvYWQgPSBmdW5jdGlvbiAob3B0KSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyB1cGxvYWQob3B0KTtcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGRlZmF1bHRPcHRpb24gPSBvcHRfZmlsZTtcclxuICAgIHZhciB1cGxvYWQ9ZnVuY3Rpb24ob3B0LGRvbSl7XHJcbiAgICAgICAgdGhpcy5vcHQgPSAkLmV4dGVuZCh0cnVlLHt9LGRlZmF1bHRPcHRpb24sb3B0KTtcclxuICAgICAgICBpZih0aGlzLmlzRmxhc2gpe1xyXG4gICAgICAgICAgICB0aGlzLmluaXQodGhpcy5vcHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcblxyXG4gICAgdXBsb2FkLnByb3RvdHlwZSA9e1xyXG4gICAgICAgIGlzU3VwcG9ydEJhc2U2NDooIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgICAgICAgICB2YXIgc3VwcG9ydCA9IHRydWU7XHJcbiAgICAgICAgICAgIGRhdGEub25sb2FkID0gZGF0YS5vbmVycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBpZiggdGhpcy53aWR0aCAhPSAxIHx8IHRoaXMuaGVpZ2h0ICE9IDEgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBkYXRhLnNyYyA9IFwiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFJQUFBQUFBQVAvLy95d0FBQUFBQVFBQkFBQUNBVXdBT3c9PVwiO1xyXG4gICAgICAgICAgICByZXR1cm4gc3VwcG9ydDtcclxuICAgICAgICB9ICkoKSxcclxuICAgICAgICAvL+ajgOa1i+aYr+WQpuW3sue7j+WuieijhWZsYXNo77yM5qOA5rWLZmxhc2jnmoTniYjmnKxcclxuICAgICAgICBmbGFzaFZlcnNpb24gOiAoIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgdmVyc2lvbjtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHZlcnNpb24gPSBuYXZpZ2F0b3IucGx1Z2luc1sgJ1Nob2Nrd2F2ZSBGbGFzaCcgXTtcclxuICAgICAgICAgICAgICAgIHZlcnNpb24gPSB2ZXJzaW9uLmRlc2NyaXB0aW9uO1xyXG4gICAgICAgICAgICB9IGNhdGNoICggZXggKSB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZlcnNpb24gPSBuZXcgQWN0aXZlWE9iamVjdCgnU2hvY2t3YXZlRmxhc2guU2hvY2t3YXZlRmxhc2gnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuR2V0VmFyaWFibGUoJyR2ZXJzaW9uJyk7XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoICggZXgyICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZlcnNpb24gPSAnMC4wJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2ZXJzaW9uID0gdmVyc2lvbi5tYXRjaCggL1xcZCsvZyApO1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdCggdmVyc2lvblsgMCBdICsgJy4nICsgdmVyc2lvblsgMSBdLCAxMCApO1xyXG4gICAgICAgIH0gKSgpLFxyXG5cclxuICAgICAgICBzdXBwb3J0VHJhbnNpdGlvbiA6IChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKS5zdHlsZSxcclxuICAgICAgICAgICAgICAgIHIgPSAndHJhbnNpdGlvbicgaW4gcyB8fFxyXG4gICAgICAgICAgICAgICAgICAgICdXZWJraXRUcmFuc2l0aW9uJyBpbiBzIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgJ01velRyYW5zaXRpb24nIGluIHMgfHxcclxuICAgICAgICAgICAgICAgICAgICAnbXNUcmFuc2l0aW9uJyBpbiBzIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgJ09UcmFuc2l0aW9uJyBpbiBzO1xyXG4gICAgICAgICAgICBzID0gbnVsbDtcclxuICAgICAgICAgICAgcmV0dXJuIHI7XHJcbiAgICAgICAgfSkoKSxcclxuICAgICAgICBpc0ZsYXNoOmZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIGlmICggIVdlYlVwbG9hZGVyLlVwbG9hZGVyLnN1cHBvcnQoJ2ZsYXNoJykgJiYgV2ViVXBsb2FkZXIuYnJvd3Nlci5pZSApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBmbGFzaCDlronoo4XkuobkvYbmmK/niYjmnKzov4fkvY7jgIJcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmZsYXNoVmVyc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIChmdW5jdGlvbihjb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93WydleHByZXNzaW5zdGFsbGNhbGxiYWNrJ10gPSBmdW5jdGlvbiggc3RhdGUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2goc3RhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdEb3dubG9hZC5DYW5jZWxsZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgn5oKo5Y+W5raI5LqG5pu05paw77yBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdEb3dubG9hZC5GYWlsZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgn5a6J6KOF5aSx6LSlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgn5a6J6KOF5bey5oiQ5Yqf77yM6K+35Yi35paw77yBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHdpbmRvd1snZXhwcmVzc2luc3RhbGxjYWxsYmFjayddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN3ZiA9ICcuL2V4cHJlc3NJbnN0YWxsLnN3Zic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluc2VydCBmbGFzaCBvYmplY3RcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPG9iamVjdCB0eXBlPVwiYXBwbGljYXRpb24vJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAneC1zaG9ja3dhdmUtZmxhc2hcIiBkYXRhPVwiJyArICBzd2YgKyAnXCIgJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChXZWJVcGxvYWRlci5icm93c2VyLmllKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sICs9ICdjbGFzc2lkPVwiY2xzaWQ6ZDI3Y2RiNmUtYWU2ZC0xMWNmLTk2YjgtNDQ0NTUzNTQwMDAwXCIgJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnd2lkdGg9XCIxMDAlXCIgaGVpZ2h0PVwiMTAwJVwiIHN0eWxlPVwib3V0bGluZTowXCI+JyAgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxwYXJhbSBuYW1lPVwibW92aWVcIiB2YWx1ZT1cIicgKyBzd2YgKyAnXCIgLz4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8cGFyYW0gbmFtZT1cIndtb2RlXCIgdmFsdWU9XCJ0cmFuc3BhcmVudFwiIC8+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHBhcmFtIG5hbWU9XCJhbGxvd3NjcmlwdGFjY2Vzc1wiIHZhbHVlPVwiYWx3YXlzXCIgLz4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L29iamVjdD4nO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmh0bWwoaHRtbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0pKCR3cmFwKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5Y6L5qC55bCx5rKh5pyJ5a6J6L2s44CCXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICR3cmFwLmh0bWwoJzxhIGhyZWY9XCJodHRwOi8vd3d3LmFkb2JlLmNvbS9nby9nZXRmbGFzaHBsYXllclwiIHRhcmdldD1cIl9ibGFua1wiIGJvcmRlcj1cIjBcIj48aW1nIGFsdD1cImdldCBmbGFzaCBwbGF5ZXJcIiBzcmM9XCJodHRwOi8vd3d3LmFkb2JlLmNvbS9tYWNyb21lZGlhL3N0eWxlX2d1aWRlL2ltYWdlcy8xNjB4NDFfR2V0X0ZsYXNoX1BsYXllci5qcGdcIiAvPjwvYT4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIVdlYlVwbG9hZGVyLlVwbG9hZGVyLnN1cHBvcnQoKSkge1xyXG4gICAgICAgICAgICAgICAgYWxlcnQoICdXZWIgVXBsb2FkZXIg5LiN5pSv5oyB5oKo55qE5rWP6KeI5Zmo77yBJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGluaXQ6ZnVuY3Rpb24ob3B0KXtcclxuXHJcbiAgICAgICAgICAgIHZhciBmaWxlVHlwZSA9IG9wdC5maWxlVHlwZTtcclxuICAgICAgICAgICAgdmFyIGFkZEJ1dHRvbiA9IG9wdC5hZGRCdXR0b247XHJcblxyXG4gICAgICAgICAgICBvcHQucGljayA9IG9wdC5maWxlQnV0dG9uO1xyXG4gICAgICAgICAgICB2YXIgX3RoYXQgPSB0aGlzO1xyXG4gICAgICAgICAgICBpZihmaWxlVHlwZSA9PSAxKXtcclxuICAgICAgICAgICAgICAgIG9wdFsnYWNjZXB0J10gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdJbWFnZXMnLFxyXG4gICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvbnM6ICdnaWYsanBnLGpwZWcsYm1wLHBuZycsXHJcbiAgICAgICAgICAgICAgICAgICAgbWltZVR5cGVzOidpbWFnZS9naWYsaW1hZ2UvanBnLGltYWdlL2pwZWcsaW1hZ2UvYm1wLGltYWdlL3BuZydcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBvcHRbJ2ZpbGVCdXR0b24nXVsnbXVsdGlwbGUnXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHVwbG9hZGVyID0gV2ViVXBsb2FkZXIuY3JlYXRlKG9wdCk7XHJcbiAgICAgICAgICAgIC8vIOa3u+WKoOKAnOa3u+WKoOaWh+S7tuKAneeahOaMiemSru+8jFxyXG4gICAgICAgICAgICB1cGxvYWRlci5hZGRCdXR0b24oYWRkQnV0dG9uKTtcclxuXHJcblxyXG4gICAgICAgICAgICB1cGxvYWRlci5vbigncmVhZHknLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy51cGxvYWRlciA9IHVwbG9hZGVyO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHVwbG9hZGVyLm9uVXBsb2FkUHJvZ3Jlc3MgPSBmdW5jdGlvbiggZmlsZSwgcGVyY2VudGFnZSApIHtcclxuICAgICAgICAgICAgICAgIC8v6L+b5bqm5p2h5Zue6LCDXHJcbiAgICAgICAgICAgICAgICBpZihmaWxlVHlwZT09Mikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciAkbGkgPSAkKCcjJyArIGZpbGUuaWQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcGVyY2VudCA9ICRsaS5maW5kKCcucHJvZ3Jlc3Mgc3BhbicpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkcGVyY2VudC5jc3MoJ3dpZHRoJywgcGVyY2VudGFnZSAqIDEwMCArICclJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZXNbZmlsZS5pZF1bMV0gPSBwZXJjZW50YWdlO1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRvdGFsUHJvZ3Jlc3MoKTtcclxuICAgICAgICAgICAgICAgIH1lbHNlIGlmKGZpbGVUeXBlID09IDEpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc3RhdHVzQmFyLnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMucHJvZ3Jlc3MoTWF0aC5yb3VuZCggcGVyY2VudGFnZSAqIDEwMCApICsgJyUnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB1cGxvYWRlci5vblVwbG9hZFN1Y2Nlc3MgPSBmdW5jdGlvbihmaWxlKXtcclxuICAgICAgICAgICAgICAgIC8v5LiK5Lyg5oiQ5Yqf5ZCO6LCD55SoXHJcbiAgICAgICAgICAgICAgICBpZihmaWxlVHlwZSA9PTEpe1xyXG4gICAgICAgICAgICAgICAgICAgICR3cmFwLmZpbmQoJy54LWluZm8nKS50ZXh0KCflpLTlg4/kuIrkvKDmiJDlip/vvIzmgLvlpKflsI/vvJonK2dldFNpemUoZmlsZS5zaXplKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB1cGxvYWRlci5vblVwbG9hZEFjY2VwdCA9IGZ1bmN0aW9uKG9iamVjdCxyZXQpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLnN1Y2Nlc3Mob2JqZWN0LHJldCk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB1cGxvYWRlci5vbkZpbGVRdWV1ZWQgPSBmdW5jdGlvbiggZmlsZSApIHtcclxuICAgICAgICAgICAgICAgIC8v5re75Yqg5Yiw6Zif5YiXXHJcbiAgICAgICAgICAgICAgICBpZihmaWxlVHlwZSA9PSAyKXtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlQ291bnQrKztcclxuICAgICAgICAgICAgICAgICAgICBmaWxlU2l6ZSArPSBmaWxlLnNpemU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggZmlsZUNvdW50ID09PSAxICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcGxhY2VIb2xkZXIuYWRkQ2xhc3MoICdlbGVtZW50LWludmlzaWJsZScgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXR1c0Jhci5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vJHN0YXR1c0Jhci5jc3MoeydkaXNwbGF5JzonYmxvY2snfSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYWRkRmlsZSggZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFN0YXRlKCAncmVhZHknICk7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlVG90YWxQcm9ncmVzcygpO1xyXG4gICAgICAgICAgICAgICAgfWVsc2UgaWYoZmlsZVR5cGUgPT0xKXtcclxuICAgICAgICAgICAgICAgICAgICAvL+WNleW8oOWbvueJh1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBhZGRGaWxlSW1nKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICggc3RhdGUgPT09ICdyZWFkeScgKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRlci51cGxvYWQoZmlsZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIHN0YXRlID09PSAncGF1c2VkJyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkZXIudXBsb2FkKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIHN0YXRlID09PSAndXBsb2FkaW5nJyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkZXIuc3RvcChmaWxlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHVwbG9hZGVyLm9uVXBsb2FkRXJyb3IgPSBmdW5jdGlvbihmaWxlLHJlYXNvbil7XHJcbiAgICAgICAgICAgICAgICBpZihyZWFzb24gPT0naHR0cCcpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5pyN5Yqh5Zmo6ZSZ6K+vXCIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB1cGxvYWRlci5vbkZpbGVEZXF1ZXVlZCA9IGZ1bmN0aW9uKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgLy/mlofku7bku47pmJ/liJfkuK3np7vpmaRcclxuICAgICAgICAgICAgICAgIGlmKGZpbGVUeXBlPT0yKXtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlQ291bnQtLTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlU2l6ZSAtPSBmaWxlLnNpemU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggIWZpbGVDb3VudCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0U3RhdGUoICdwZWRkaW5nJyApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRmlsZSggZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRvdGFsUHJvZ3Jlc3MoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB1cGxvYWRlci5vblVwbG9hZEZpbmlzaGVkID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIGlmKGZpbGVUeXBlID09IDIpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNldFN0YXRlKCAnY29uZmlybScgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdXBsb2FkZXIub25TdGFydFVwbG9hZCA9IGZ1bmN0aW9uKGZpbGUpe1xyXG4gICAgICAgICAgICAgICAgc2V0U3RhdGUoICd1cGxvYWRpbmcnICk7XHJcblxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB1cGxvYWRlci5vblN0b3BVcGxvYWQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLmmoLlgZxcIik7XHJcbiAgICAgICAgICAgICAgICBzZXRTdGF0ZSggJ3BhdXNlZCcgKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHVwbG9hZGVyLm9uRXJyb3IgPSBmdW5jdGlvbiggY29kZSApIHtcclxuICAgICAgICAgICAgICAgIC8v6ZSZ6K+v5L+h5oGvXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGNvZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdRX1RZUEVfREVOSUVEJyA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCfkuI3nrKblkIjnmoTmlofku7bnsbvlnosnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnUV9FWENFRURfU0laRV9MSU1JVCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCfmlofku7bmgLvlpKflsI/otoXlh7rvvIzor7fph43mlrDorr7nva4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnUV9FWENFRURfTlVNX0xJTUlUJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ+aWh+S7tuaVsOmHj+i/h+Wkmu+8jOivt+WIhuaJueS4iuS8oCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgJHVwbG9hZC5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIC8v54K55Ye75LiK5Lyg5oyJ6ZKuXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIuW8gOWni+S4iuS8oFwiKTtcclxuICAgICAgICAgICAgICAgIGlmICggJCh0aGlzKS5oYXNDbGFzcyggJ2Rpc2FibGVkJyApICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIHN0YXRlID09PSAncmVhZHknICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVyLnVwbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggc3RhdGUgPT09ICdwYXVzZWQnICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVyLnVwbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggc3RhdGUgPT09ICd1cGxvYWRpbmcnICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVyLnN0b3AoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkd3JhcC5vbiggJ2NsaWNrJywgJy5yZXRyeScsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgICAgIHVwbG9hZGVyLnJldHJ5KCk7XHJcbiAgICAgICAgICAgIH0gKTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgJHVwbG9hZC5hZGRDbGFzcyggJ3N0YXRlLScgKyBzdGF0ZSApO1xyXG4gICAgICAgICAgICBmdW5jdGlvbiBhZGRGaWxlKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgLy9odG1s5paH5Lu25YiX6KGoXHJcblxyXG4gICAgICAgICAgICAgICAgdmFyICRsaSA9ICQoICc8bGkgaWQ9XCInICsgZmlsZS5pZCArICdcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJzxwIGNsYXNzPVwidGl0bGVcIj4nICsgZmlsZS5uYW1lICsgJzwvcD4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJzxwIGNsYXNzPVwiaW1nV3JhcFwiPjwvcD4nK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPHAgY2xhc3M9XCJwcm9ncmVzc1wiPjxzcGFuPjwvc3Bhbj48L3A+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICc8L2xpPicgKSxcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJGJ0bnMgPSAkKCc8ZGl2IGNsYXNzPVwiZmlsZS1wYW5lbFwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJjYW5jZWxcIj7liKDpmaQ8L3NwYW4+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz1cInJvdGF0ZVJpZ2h0XCI+5ZCR5Y+z5peL6L2sPC9zcGFuPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3M9XCJyb3RhdGVMZWZ0XCI+5ZCR5bem5peL6L2sPC9zcGFuPjwvZGl2PicpLmFwcGVuZFRvKCAkbGkgKSxcclxuICAgICAgICAgICAgICAgICAgICAkcHJncmVzcyA9ICRsaS5maW5kKCdwLnByb2dyZXNzIHNwYW4nKSxcclxuICAgICAgICAgICAgICAgICAgICAkd3JhcCA9ICRsaS5maW5kKCAncC5pbWdXcmFwJyApLFxyXG4gICAgICAgICAgICAgICAgICAgICRpbmZvID0gJCgnPHAgY2xhc3M9XCJlcnJvclwiPjwvcD4nKSxcclxuICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gJycsXHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd0Vycm9yID0gZnVuY3Rpb24oIGNvZGUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCggY29kZSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2V4Y2VlZF9zaXplJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gJ+aWh+S7tuWkp+Wwj+i2heWHuic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnaW50ZXJydXB0JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gJ+S4iuS8oOaaguWBnCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gJ+S4iuS8oOWksei0pe+8jOivt+mHjeivlSc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRpbmZvLnRleHQoIHRleHQgKS5hcHBlbmRUbyggJGxpICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCBmaWxlLmdldFN0YXR1cygpID09PSAnaW52YWxpZCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hvd0Vycm9yKCBmaWxlLnN0YXR1c1RleHQgKTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhmaWxlLmdldFN0YXR1cygpKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQHRvZG8gbGF6eWxvYWRcclxuICAgICAgICAgICAgICAgICAgICAkd3JhcC50ZXh0KCAn6aKE6KeI5LitJyApO1xyXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVyLm1ha2VUaHVtYiggZmlsZSwgZnVuY3Rpb24oIGVycm9yLCBzcmMgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbWc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZXJyb3IgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd3JhcC50ZXh0KCAn5LiN6IO96aKE6KeIJyApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCBfdGhhdC5pc1N1cHBvcnRCYXNlNjQgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSAkKCc8aW1nIHNyYz1cIicrc3JjKydcIj4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR3cmFwLmVtcHR5KCkuYXBwZW5kKCBpbWcgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi6aKE6KeI5Ye66ZSZXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgdGh1bWJuYWlsV2lkdGgsIHRodW1ibmFpbEhlaWdodCApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlc1sgZmlsZS5pZCBdID0gWyBmaWxlLnNpemUsIDAgXTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlLnJvdGF0aW9uID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmaWxlLm9uKCdzdGF0dXNjaGFuZ2UnLCBmdW5jdGlvbiggY3VyLCBwcmV2ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v54q25oCB5pS55Y+YXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBwcmV2ID09PSAncHJvZ3Jlc3MnICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcHJncmVzcy5oaWRlKCkud2lkdGgoMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggcHJldiA9PT0gJ3F1ZXVlZCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRsaS5vZmYoICdtb3VzZWVudGVyIG1vdXNlbGVhdmUnICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRidG5zLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5oiQ5YqfXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBjdXIgPT09ICdlcnJvcicgfHwgY3VyID09PSAnaW52YWxpZCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBmaWxlLnN0YXR1c1RleHQgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0Vycm9yKCBmaWxlLnN0YXR1c1RleHQgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZXNbIGZpbGUuaWQgXVsgMSBdID0gMTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBjdXIgPT09ICdpbnRlcnJ1cHQnICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93RXJyb3IoICdpbnRlcnJ1cHQnICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggY3VyID09PSAncXVldWVkJyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGluZm8ucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRwcmdyZXNzLmNzcygnZGlzcGxheScsICdibG9jaycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlc1sgZmlsZS5pZCBdWyAxIF0gPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIGN1ciA9PT0gJ3Byb2dyZXNzJyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGluZm8ucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRwcmdyZXNzLmNzcygnZGlzcGxheScsICdibG9jaycpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIGN1ciA9PT0gJ2NvbXBsZXRlJyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHByZ3Jlc3MuaGlkZSgpLndpZHRoKDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbGkuYXBwZW5kKCAnPHNwYW4gY2xhc3M9XCJzdWNjZXNzXCI+PC9zcGFuPicgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRsaS5yZW1vdmVDbGFzcyggJ3N0YXRlLScgKyBwcmV2ICkuYWRkQ2xhc3MoICdzdGF0ZS0nICsgY3VyICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkbGkub24oICdtb3VzZWVudGVyJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGJ0bnMuc3RvcCgpLmFuaW1hdGUoe2hlaWdodDogMzB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICRsaS5vbiggJ21vdXNlbGVhdmUnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkYnRucy5zdG9wKCkuYW5pbWF0ZSh7aGVpZ2h0OiAwfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAkYnRucy5vbiggJ2NsaWNrJywgJ3NwYW4nLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAkKHRoaXMpLmluZGV4KCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZztcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCBpbmRleCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkZXIucmVtb3ZlRmlsZSggZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5yb3RhdGlvbiArPSA5MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5yb3RhdGlvbiAtPSA5MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBzdXBwb3J0VHJhbnNpdGlvbiApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVnID0gJ3JvdGF0ZSgnICsgZmlsZS5yb3RhdGlvbiArICdkZWcpJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHdyYXAuY3NzKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICctd2Via2l0LXRyYW5zZm9ybSc6IGRlZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICctbW9zLXRyYW5zZm9ybSc6IGRlZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICctby10cmFuc2Zvcm0nOiBkZWcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogZGVnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR3cmFwLmNzcyggJ2ZpbHRlcicsICdwcm9naWQ6RFhJbWFnZVRyYW5zZm9ybS5NaWNyb3NvZnQuQmFzaWNJbWFnZShyb3RhdGlvbj0nKyAofn4oKGZpbGUucm90YXRpb24vOTApJTQgKyA0KSU0KSArJyknKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICRsaS5hcHBlbmRUbygkcXVldWUpO1xyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8g6LSf6LSjdmlld+eahOmUgOavgVxyXG4gICAgICAgICAgICBmdW5jdGlvbiByZW1vdmVGaWxlKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgdmFyICRsaSA9ICQoJyMnK2ZpbGUuaWQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBwZXJjZW50YWdlc1sgZmlsZS5pZCBdO1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlVG90YWxQcm9ncmVzcygpO1xyXG4gICAgICAgICAgICAgICAgJGxpLm9mZigpLmZpbmQoJy5maWxlLXBhbmVsJykub2ZmKCkuZW5kKCkucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVRvdGFsUHJvZ3Jlc3MoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbG9hZGVkID0gMCxcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbCA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgc3BhbnMgPSAkcHJvZ3Jlc3MuY2hpbGRyZW4oKSxcclxuICAgICAgICAgICAgICAgICAgICBwZXJjZW50O1xyXG5cclxuICAgICAgICAgICAgICAgICQuZWFjaCggcGVyY2VudGFnZXMsIGZ1bmN0aW9uKCBrLCB2ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsICs9IHZbIDAgXTtcclxuICAgICAgICAgICAgICAgICAgICBsb2FkZWQgKz0gdlsgMCBdICogdlsgMSBdO1xyXG4gICAgICAgICAgICAgICAgfSApO1xyXG5cclxuICAgICAgICAgICAgICAgIHBlcmNlbnQgPSB0b3RhbCA/IGxvYWRlZCAvIHRvdGFsIDogMDtcclxuXHJcbiAgICAgICAgICAgICAgICBvcHQucHJvZ3Jlc3MoTWF0aC5yb3VuZCggcGVyY2VudCAqIDEwMCApICsgJyUnKTtcclxuICAgICAgICAgICAgICAgIHNwYW5zLmVxKCAwICkudGV4dCggTWF0aC5yb3VuZCggcGVyY2VudCAqIDEwMCApICsgJyUnICk7XHJcbiAgICAgICAgICAgICAgICBzcGFucy5lcSggMSApLmNzcyggJ3dpZHRoJywgTWF0aC5yb3VuZCggcGVyY2VudCAqIDEwMCApICsgJyUnICk7XHJcbiAgICAgICAgICAgICAgICBpZihmaWxlVHlwZSA9PSAyKXtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdGF0dXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVN0YXR1cygpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gJycsIHN0YXRzO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICggc3RhdGUgPT09ICdyZWFkeScgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICfpgInkuK0nICsgZmlsZUNvdW50ICsgJ+S4quaWh+S7tu+8jOWFsScgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBXZWJVcGxvYWRlci5mb3JtYXRTaXplKCBmaWxlU2l6ZSApICsgJ+OAgic7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBzdGF0ZSA9PT0gJ2NvbmZpcm0nICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXRzID0gdXBsb2FkZXIuZ2V0U3RhdHMoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YXRzLnVwbG9hZEZhaWxOdW0gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSAn5bey5oiQ5Yqf5LiK5LygJyArIHN0YXRzLnN1Y2Nlc3NOdW0rICfkuKrmlofku7bvvIwnK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHMudXBsb2FkRmFpbE51bSArICfkuKrmlofku7bkuIrkvKDlpLHotKXvvIw8YSBjbGFzcz1cInJldHJ5XCIgaHJlZj1cIiNcIj7ph43mlrDkuIrkvKA8L2E+5aSx6LSl5paH5Lu2JztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0cyA9IHVwbG9hZGVyLmdldFN0YXRzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICflhbEnICsgZmlsZUNvdW50ICsgJ+W8oO+8iCcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBXZWJVcGxvYWRlci5mb3JtYXRTaXplKCBmaWxlU2l6ZSApICArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICfvvInvvIzlt7LkuIrkvKAnICsgc3RhdHMuc3VjY2Vzc051bSArICflvKAnO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YXRzLnVwbG9hZEZhaWxOdW0gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgKz0gJ++8jOWksei0pScgKyBzdGF0cy51cGxvYWRGYWlsTnVtICsgJ+W8oCc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICRpbmZvLmh0bWwoIHRleHQgKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0U3RhdGUoIHZhbCApIHtcclxuICAgICAgICAgICAgICAgIHZhciBmaWxlLCBzdGF0cztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIHZhbCA9PT0gc3RhdGUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICR1cGxvYWQucmVtb3ZlQ2xhc3MoICdzdGF0ZS0nICsgc3RhdGUgKTtcclxuICAgICAgICAgICAgICAgICR1cGxvYWQuYWRkQ2xhc3MoICdzdGF0ZS0nICsgdmFsICk7XHJcbiAgICAgICAgICAgICAgICBzdGF0ZSA9IHZhbDtcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKCBzdGF0ZSApIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdwZWRkaW5nJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHBsYWNlSG9sZGVyLnJlbW92ZUNsYXNzKCAnZWxlbWVudC1pbnZpc2libGUnICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRxdWV1ZS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0dXNCYXIuYWRkQ2xhc3MoICdlbGVtZW50LWludmlzaWJsZScgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkZXIucmVmcmVzaCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncmVhZHknOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcGxhY2VIb2xkZXIuYWRkQ2xhc3MoICdlbGVtZW50LWludmlzaWJsZScgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCggYWRkQnV0dG9uLmlkICkucmVtb3ZlQ2xhc3MoICdlbGVtZW50LWludmlzaWJsZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcXVldWUuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdHVzQmFyLnJlbW92ZUNsYXNzKCdlbGVtZW50LWludmlzaWJsZScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRlci5yZWZyZXNoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICd1cGxvYWRpbmcnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCBhZGRCdXR0b24uaWQgKS5hZGRDbGFzcyggJ2VsZW1lbnQtaW52aXNpYmxlJyApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcHJvZ3Jlc3Muc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdXBsb2FkLnRleHQoICfmmoLlgZzkuIrkvKAnICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdwYXVzZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcHJvZ3Jlc3Muc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdXBsb2FkLnRleHQoICfnu6fnu63kuIrkvKAnICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdjb25maXJtJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHByb2dyZXNzLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCggYWRkQnV0dG9uLmlkICkucmVtb3ZlQ2xhc3MoICdlbGVtZW50LWludmlzaWJsZScgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHVwbG9hZC50ZXh0KCAn5byA5aeL5LiK5LygJyApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHMgPSB1cGxvYWRlci5nZXRTdGF0cygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YXRzLnN1Y2Nlc3NOdW0gJiYgIXN0YXRzLnVwbG9hZEZhaWxOdW0gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTdGF0ZSggJ2ZpbmlzaCcgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdmaW5pc2gnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0cyA9IHVwbG9hZGVyLmdldFN0YXRzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3RhdHMuc3VjY2Vzc051bSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAn5LiK5Lyg5oiQ5YqfJyApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5rKh5pyJ5oiQ5Yqf55qE5Zu+54mH77yM6YeN6K6+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9ICdkb25lJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoZmlsZVR5cGUgPT0gMil7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3RhdHVzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U2l6ZShzaXplKXtcclxuICAgICAgICAgICAgICAgIHZhciBzdHI7XHJcbiAgICAgICAgICAgICAgICBpZihzaXplLzEwMjQ+MSl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IHNpemUvMTAyNDtcclxuICAgICAgICAgICAgICAgICAgICBzdHIgPSAnS0InO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmKHNpemUvMTAyND4xKXtcclxuICAgICAgICAgICAgICAgICAgICBzaXplID0gc2l6ZS8xMDI0O1xyXG4gICAgICAgICAgICAgICAgICAgIHN0ciA9ICdNQic7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZihzaXplLzEwMjQgPjEpe1xyXG4gICAgICAgICAgICAgICAgICAgIHNpemUgPSBzaXplLzEwMjQ7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyID0gJ0dCJztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNpemUgPSAgIHNpemUudG9GaXhlZCgyKTtcclxuICAgICAgICAgICAgICAgIHN0ciA9IHNpemUgKyBzdHI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RyO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBhZGRGaWxlSW1nKGZpbGUpe1xyXG4gICAgICAgICAgICAgICAgdmFyIGh0bWwgPSAnPGRpdiBjbGFzcz1cImltZ0ZpbGVcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPGltZyBzcmM9XCJcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JztcclxuICAgICAgICAgICAgICAgIHZhciBpbWc7XHJcbiAgICAgICAgICAgICAgICB2YXIgICAkaW5mbyA9ICQoJzxwIGNsYXNzPVwiZXJyb3JcIj48L3A+Jyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgICB0ZXh0ID0gJyc7XHJcbiAgICAgICAgICAgICAgICB2YXIgIHNob3dFcnJvciA9IGZ1bmN0aW9uKCBjb2RlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCggY29kZSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZXhjZWVkX3NpemUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICfmlofku7blpKflsI/otoXlh7onO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdpbnRlcnJ1cHQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICfkuIrkvKDmmoLlgZwnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSAn5LiK5Lyg5aSx6LSl77yM6K+36YeN6K+VICcrJzxhIGNsYXNzPVwicmV0cnlcIiBocmVmPVwiI1wiPumHjeaWsOS4iuS8oDwvYT4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRpbmZvLmh0bWwoIHRleHQgKS5hcHBlbmRUbyggJHdyYXAgKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICggZmlsZS5nZXRTdGF0dXMoKSA9PT0gJ2ludmFsaWQnICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dFcnJvciggZmlsZS5zdGF0dXNUZXh0ICk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGVyLm1ha2VUaHVtYihmaWxlLCBmdW5jdGlvbiAoZXJyb3IsIHNyYykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyR3cmFwLnRleHQoICfkuI3og73pooTop4gnICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3JldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoYXQuaXNTdXBwb3J0QmFzZTY0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWcgPSAkKCc8aW1nIHNyYz1cIicgKyBzcmMgKyAnXCI+PHNwYW4gY2xhc3M9XCJ4LWZpbGVOYW1lXCI+JyArIGZpbGUubmFtZSArICc8L3NwYW4+Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd3JhcC5maW5kKFwiLngtaW1nRmlsZVwiKS5hcHBlbmQoaW1nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi6aKE6KeI5Ye66ZSZXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgdGh1bWJuYWlsV2lkdGgsIHRodW1ibmFpbEhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBmaWxlLm9uKCdzdGF0dXNjaGFuZ2UnLCBmdW5jdGlvbiggY3VyLCBwcmV2ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v54q25oCB5pS55Y+YXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5oiQ5YqfXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBjdXIgPT09ICdlcnJvcicgfHwgY3VyID09PSAnaW52YWxpZCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBmaWxlLnN0YXR1c1RleHQgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0Vycm9yKCBmaWxlLnN0YXR1c1RleHQgKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBjdXIgPT09ICdpbnRlcnJ1cHQnICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93RXJyb3IoICdpbnRlcnJ1cHQnICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggY3VyID09PSAncXVldWVkJyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGluZm8ucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggY3VyID09PSAncHJvZ3Jlc3MnICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkaW5mby5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBjdXIgPT09ICdjb21wbGV0ZScgKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHNldFN0YXRlKCAncmVhZHknICk7XHJcblxyXG4gICAgICAgICAgICAgICAgJChcIi54LXN0YXR1c0JhciAueC11cGxvYWQtYnRuc1wiKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIC8vJHdyYXAuYXBwZW5kKCRwcm9ncmVzcyk7XHJcbiAgICAgICAgICAgICAgICAvLyQoXCIueC1xdWV1ZUxpc3RcIikucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHVwZGF0ZVRvdGFsUHJvZ3Jlc3MoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy91cGxvYWRlciA9IFdlYlVwbG9hZGVyLmNyZWF0ZShvcHRfaW1nKTtcclxuXHJcblxyXG4gICAgLy8g5b2T5pyJ5paH5Lu25re75Yqg6L+b5p2l5pe25omn6KGM77yM6LSf6LSjdmlld+eahOWIm+W7ulxyXG5cclxuXHJcblxyXG59KSggJCApO1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9jb21wb25lbnRzL3VwbG9hZC91cGxvYWQuanNcbi8vIG1vZHVsZSBpZCA9IDdcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 8 */
/***/ function(module, exports, __webpack_require__) {

	eval("var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*! WebUploader 0.1.6 */\r\n\r\n\r\n/**\r\n * @fileOverview 让内部各个部件的代码可以用[amd](https://github.com/amdjs/amdjs-api/wiki/AMD)模块定义方式组织起来。\r\n *\r\n * AMD API 内部的简单不完全实现，请忽略。只有当WebUploader被合并成一个文件的时候才会引入。\r\n */\r\n(function( root, factory ) {\r\n    var modules = {},\r\n\r\n        // 内部require, 简单不完全实现。\r\n        // https://github.com/amdjs/amdjs-api/wiki/require\r\n        _require = function( deps, callback ) {\r\n            var args, len, i;\r\n\r\n            // 如果deps不是数组，则直接返回指定module\r\n            if ( typeof deps === 'string' ) {\r\n                return getModule( deps );\r\n            } else {\r\n                args = [];\r\n                for( len = deps.length, i = 0; i < len; i++ ) {\r\n                    args.push( getModule( deps[ i ] ) );\r\n                }\r\n\r\n                return callback.apply( null, args );\r\n            }\r\n        },\r\n\r\n        // 内部define，暂时不支持不指定id.\r\n        _define = function( id, deps, factory ) {\r\n            if ( arguments.length === 2 ) {\r\n                factory = deps;\r\n                deps = null;\r\n            }\r\n\r\n            _require( deps || [], function() {\r\n                setModule( id, factory, arguments );\r\n            });\r\n        },\r\n\r\n        // 设置module, 兼容CommonJs写法。\r\n        setModule = function( id, factory, args ) {\r\n            var module = {\r\n                    exports: factory\r\n                },\r\n                returned;\r\n\r\n            if ( typeof factory === 'function' ) {\r\n                args.length || (args = [ _require, module.exports, module ]);\r\n                returned = factory.apply( null, args );\r\n                returned !== undefined && (module.exports = returned);\r\n            }\r\n\r\n            modules[ id ] = module.exports;\r\n        },\r\n\r\n        // 根据id获取module\r\n        getModule = function( id ) {\r\n            var module = modules[ id ] || root[ id ];\r\n\r\n            if ( !module ) {\r\n                throw new Error( '`' + id + '` is undefined' );\r\n            }\r\n\r\n            return module;\r\n        },\r\n\r\n        // 将所有modules，将路径ids装换成对象。\r\n        exportsTo = function( obj ) {\r\n            var key, host, parts, part, last, ucFirst;\r\n\r\n            // make the first character upper case.\r\n            ucFirst = function( str ) {\r\n                return str && (str.charAt( 0 ).toUpperCase() + str.substr( 1 ));\r\n            };\r\n\r\n            for ( key in modules ) {\r\n                host = obj;\r\n\r\n                if ( !modules.hasOwnProperty( key ) ) {\r\n                    continue;\r\n                }\r\n\r\n                parts = key.split('/');\r\n                last = ucFirst( parts.pop() );\r\n\r\n                while( (part = ucFirst( parts.shift() )) ) {\r\n                    host[ part ] = host[ part ] || {};\r\n                    host = host[ part ];\r\n                }\r\n\r\n                host[ last ] = modules[ key ];\r\n            }\r\n\r\n            return obj;\r\n        },\r\n\r\n        makeExport = function( dollar ) {\r\n            root.__dollar = dollar;\r\n\r\n            // exports every module.\r\n            return exportsTo( factory( root, _define, _require ) );\r\n        },\r\n\r\n        origin;\r\n\r\n    if ( typeof module === 'object' && typeof module.exports === 'object' ) {\r\n\r\n        // For CommonJS and CommonJS-like environments where a proper window is present,\r\n        module.exports = makeExport();\r\n    } else if ( true ) {\r\n\r\n        // Allow using this built library as an AMD module\r\n        // in another project. That other project will only\r\n        // see this AMD call, not the internal modules in\r\n        // the closure below.\r\n        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [ __webpack_require__(9) ], __WEBPACK_AMD_DEFINE_FACTORY__ = (makeExport), __WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ? (__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n    } else {\r\n\r\n        // Browser globals case. Just assign the\r\n        // result to a property on the global.\r\n        origin = root.WebUploader;\r\n        root.WebUploader = makeExport();\r\n        root.WebUploader.noConflict = function() {\r\n            root.WebUploader = origin;\r\n        };\r\n    }\r\n})( window, function( window, define, require ) {\r\n\r\n\r\n    /**\r\n     * @fileOverview jQuery or Zepto\r\n     * @require \"jquery\"\r\n     * @require \"zepto\"\r\n     */\r\n    define('dollar-third',[],function() {\r\n        var req = window.require;\r\n        var $ = window.__dollar || \r\n            window.jQuery || \r\n            window.Zepto || \r\n            req('jquery') || \r\n            req('zepto');\r\n    \r\n        if ( !$ ) {\r\n            throw new Error('jQuery or Zepto not found!');\r\n        }\r\n    \r\n        return $;\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview Dom 操作相关\r\n     */\r\n    define('dollar',[\r\n        'dollar-third'\r\n    ], function( _ ) {\r\n        return _;\r\n    });\r\n    /**\r\n     * @fileOverview 使用jQuery的Promise\r\n     */\r\n    define('promise-third',[\r\n        'dollar'\r\n    ], function( $ ) {\r\n        return {\r\n            Deferred: $.Deferred,\r\n            when: $.when,\r\n    \r\n            isPromise: function( anything ) {\r\n                return anything && typeof anything.then === 'function';\r\n            }\r\n        };\r\n    });\r\n    /**\r\n     * @fileOverview Promise/A+\r\n     */\r\n    define('promise',[\r\n        'promise-third'\r\n    ], function( _ ) {\r\n        return _;\r\n    });\r\n    /**\r\n     * @fileOverview 基础类方法。\r\n     */\r\n    \r\n    /**\r\n     * Web Uploader内部类的详细说明，以下提及的功能类，都可以在`WebUploader`这个变量中访问到。\r\n     *\r\n     * As you know, Web Uploader的每个文件都是用过[AMD](https://github.com/amdjs/amdjs-api/wiki/AMD)规范中的`define`组织起来的, 每个Module都会有个module id.\r\n     * 默认module id为该文件的路径，而此路径将会转化成名字空间存放在WebUploader中。如：\r\n     *\r\n     * * module `base`：WebUploader.Base\r\n     * * module `file`: WebUploader.File\r\n     * * module `lib/dnd`: WebUploader.Lib.Dnd\r\n     * * module `runtime/html5/dnd`: WebUploader.Runtime.Html5.Dnd\r\n     *\r\n     *\r\n     * 以下文档中对类的使用可能省略掉了`WebUploader`前缀。\r\n     * @module WebUploader\r\n     * @title WebUploader API文档\r\n     */\r\n    define('base',[\r\n        'dollar',\r\n        'promise'\r\n    ], function( $, promise ) {\r\n    \r\n        var noop = function() {},\r\n            call = Function.call;\r\n    \r\n        // http://jsperf.com/uncurrythis\r\n        // 反科里化\r\n        function uncurryThis( fn ) {\r\n            return function() {\r\n                return call.apply( fn, arguments );\r\n            };\r\n        }\r\n    \r\n        function bindFn( fn, context ) {\r\n            return function() {\r\n                return fn.apply( context, arguments );\r\n            };\r\n        }\r\n    \r\n        function createObject( proto ) {\r\n            var f;\r\n    \r\n            if ( Object.create ) {\r\n                return Object.create( proto );\r\n            } else {\r\n                f = function() {};\r\n                f.prototype = proto;\r\n                return new f();\r\n            }\r\n        }\r\n    \r\n    \r\n        /**\r\n         * 基础类，提供一些简单常用的方法。\r\n         * @class Base\r\n         */\r\n        return {\r\n    \r\n            /**\r\n             * @property {String} version 当前版本号。\r\n             */\r\n            version: '0.1.6',\r\n    \r\n            /**\r\n             * @property {jQuery|Zepto} $ 引用依赖的jQuery或者Zepto对象。\r\n             */\r\n            $: $,\r\n    \r\n            Deferred: promise.Deferred,\r\n    \r\n            isPromise: promise.isPromise,\r\n    \r\n            when: promise.when,\r\n    \r\n            /**\r\n             * @description  简单的浏览器检查结果。\r\n             *\r\n             * * `webkit`  webkit版本号，如果浏览器为非webkit内核，此属性为`undefined`。\r\n             * * `chrome`  chrome浏览器版本号，如果浏览器为chrome，此属性为`undefined`。\r\n             * * `ie`  ie浏览器版本号，如果浏览器为非ie，此属性为`undefined`。**暂不支持ie10+**\r\n             * * `firefox`  firefox浏览器版本号，如果浏览器为非firefox，此属性为`undefined`。\r\n             * * `safari`  safari浏览器版本号，如果浏览器为非safari，此属性为`undefined`。\r\n             * * `opera`  opera浏览器版本号，如果浏览器为非opera，此属性为`undefined`。\r\n             *\r\n             * @property {Object} [browser]\r\n             */\r\n            browser: (function( ua ) {\r\n                var ret = {},\r\n                    webkit = ua.match( /WebKit\\/([\\d.]+)/ ),\r\n                    chrome = ua.match( /Chrome\\/([\\d.]+)/ ) ||\r\n                        ua.match( /CriOS\\/([\\d.]+)/ ),\r\n    \r\n                    ie = ua.match( /MSIE\\s([\\d\\.]+)/ ) ||\r\n                        ua.match( /(?:trident)(?:.*rv:([\\w.]+))?/i ),\r\n                    firefox = ua.match( /Firefox\\/([\\d.]+)/ ),\r\n                    safari = ua.match( /Safari\\/([\\d.]+)/ ),\r\n                    opera = ua.match( /OPR\\/([\\d.]+)/ );\r\n    \r\n                webkit && (ret.webkit = parseFloat( webkit[ 1 ] ));\r\n                chrome && (ret.chrome = parseFloat( chrome[ 1 ] ));\r\n                ie && (ret.ie = parseFloat( ie[ 1 ] ));\r\n                firefox && (ret.firefox = parseFloat( firefox[ 1 ] ));\r\n                safari && (ret.safari = parseFloat( safari[ 1 ] ));\r\n                opera && (ret.opera = parseFloat( opera[ 1 ] ));\r\n    \r\n                return ret;\r\n            })( navigator.userAgent ),\r\n    \r\n            /**\r\n             * @description  操作系统检查结果。\r\n             *\r\n             * * `android`  如果在android浏览器环境下，此值为对应的android版本号，否则为`undefined`。\r\n             * * `ios` 如果在ios浏览器环境下，此值为对应的ios版本号，否则为`undefined`。\r\n             * @property {Object} [os]\r\n             */\r\n            os: (function( ua ) {\r\n                var ret = {},\r\n    \r\n                    // osx = !!ua.match( /\\(Macintosh\\; Intel / ),\r\n                    android = ua.match( /(?:Android);?[\\s\\/]+([\\d.]+)?/ ),\r\n                    ios = ua.match( /(?:iPad|iPod|iPhone).*OS\\s([\\d_]+)/ );\r\n    \r\n                // osx && (ret.osx = true);\r\n                android && (ret.android = parseFloat( android[ 1 ] ));\r\n                ios && (ret.ios = parseFloat( ios[ 1 ].replace( /_/g, '.' ) ));\r\n    \r\n                return ret;\r\n            })( navigator.userAgent ),\r\n    \r\n            /**\r\n             * 实现类与类之间的继承。\r\n             * @method inherits\r\n             * @grammar Base.inherits( super ) => child\r\n             * @grammar Base.inherits( super, protos ) => child\r\n             * @grammar Base.inherits( super, protos, statics ) => child\r\n             * @param  {Class} super 父类\r\n             * @param  {Object | Function} [protos] 子类或者对象。如果对象中包含constructor，子类将是用此属性值。\r\n             * @param  {Function} [protos.constructor] 子类构造器，不指定的话将创建个临时的直接执行父类构造器的方法。\r\n             * @param  {Object} [statics] 静态属性或方法。\r\n             * @return {Class} 返回子类。\r\n             * @example\r\n             * function Person() {\r\n             *     console.log( 'Super' );\r\n             * }\r\n             * Person.prototype.hello = function() {\r\n             *     console.log( 'hello' );\r\n             * };\r\n             *\r\n             * var Manager = Base.inherits( Person, {\r\n             *     world: function() {\r\n             *         console.log( 'World' );\r\n             *     }\r\n             * });\r\n             *\r\n             * // 因为没有指定构造器，父类的构造器将会执行。\r\n             * var instance = new Manager();    // => Super\r\n             *\r\n             * // 继承子父类的方法\r\n             * instance.hello();    // => hello\r\n             * instance.world();    // => World\r\n             *\r\n             * // 子类的__super__属性指向父类\r\n             * console.log( Manager.__super__ === Person );    // => true\r\n             */\r\n            inherits: function( Super, protos, staticProtos ) {\r\n                var child;\r\n    \r\n                if ( typeof protos === 'function' ) {\r\n                    child = protos;\r\n                    protos = null;\r\n                } else if ( protos && protos.hasOwnProperty('constructor') ) {\r\n                    child = protos.constructor;\r\n                } else {\r\n                    child = function() {\r\n                        return Super.apply( this, arguments );\r\n                    };\r\n                }\r\n    \r\n                // 复制静态方法\r\n                $.extend( true, child, Super, staticProtos || {} );\r\n    \r\n                /* jshint camelcase: false */\r\n    \r\n                // 让子类的__super__属性指向父类。\r\n                child.__super__ = Super.prototype;\r\n    \r\n                // 构建原型，添加原型方法或属性。\r\n                // 暂时用Object.create实现。\r\n                child.prototype = createObject( Super.prototype );\r\n                protos && $.extend( true, child.prototype, protos );\r\n    \r\n                return child;\r\n            },\r\n    \r\n            /**\r\n             * 一个不做任何事情的方法。可以用来赋值给默认的callback.\r\n             * @method noop\r\n             */\r\n            noop: noop,\r\n    \r\n            /**\r\n             * 返回一个新的方法，此方法将已指定的`context`来执行。\r\n             * @grammar Base.bindFn( fn, context ) => Function\r\n             * @method bindFn\r\n             * @example\r\n             * var doSomething = function() {\r\n             *         console.log( this.name );\r\n             *     },\r\n             *     obj = {\r\n             *         name: 'Object Name'\r\n             *     },\r\n             *     aliasFn = Base.bind( doSomething, obj );\r\n             *\r\n             *  aliasFn();    // => Object Name\r\n             *\r\n             */\r\n            bindFn: bindFn,\r\n    \r\n            /**\r\n             * 引用Console.log如果存在的话，否则引用一个[空函数noop](#WebUploader:Base.noop)。\r\n             * @grammar Base.log( args... ) => undefined\r\n             * @method log\r\n             */\r\n            log: (function() {\r\n                if ( window.console ) {\r\n                    return bindFn( console.log, console );\r\n                }\r\n                return noop;\r\n            })(),\r\n    \r\n            nextTick: (function() {\r\n    \r\n                return function( cb ) {\r\n                    setTimeout( cb, 1 );\r\n                };\r\n    \r\n                // @bug 当浏览器不在当前窗口时就停了。\r\n                // var next = window.requestAnimationFrame ||\r\n                //     window.webkitRequestAnimationFrame ||\r\n                //     window.mozRequestAnimationFrame ||\r\n                //     function( cb ) {\r\n                //         window.setTimeout( cb, 1000 / 60 );\r\n                //     };\r\n    \r\n                // // fix: Uncaught TypeError: Illegal invocation\r\n                // return bindFn( next, window );\r\n            })(),\r\n    \r\n            /**\r\n             * 被[uncurrythis](http://www.2ality.com/2011/11/uncurrying-this.html)的数组slice方法。\r\n             * 将用来将非数组对象转化成数组对象。\r\n             * @grammar Base.slice( target, start[, end] ) => Array\r\n             * @method slice\r\n             * @example\r\n             * function doSomthing() {\r\n             *     var args = Base.slice( arguments, 1 );\r\n             *     console.log( args );\r\n             * }\r\n             *\r\n             * doSomthing( 'ignored', 'arg2', 'arg3' );    // => Array [\"arg2\", \"arg3\"]\r\n             */\r\n            slice: uncurryThis( [].slice ),\r\n    \r\n            /**\r\n             * 生成唯一的ID\r\n             * @method guid\r\n             * @grammar Base.guid() => String\r\n             * @grammar Base.guid( prefx ) => String\r\n             */\r\n            guid: (function() {\r\n                var counter = 0;\r\n    \r\n                return function( prefix ) {\r\n                    var guid = (+new Date()).toString( 32 ),\r\n                        i = 0;\r\n    \r\n                    for ( ; i < 5; i++ ) {\r\n                        guid += Math.floor( Math.random() * 65535 ).toString( 32 );\r\n                    }\r\n    \r\n                    return (prefix || 'wu_') + guid + (counter++).toString( 32 );\r\n                };\r\n            })(),\r\n    \r\n            /**\r\n             * 格式化文件大小, 输出成带单位的字符串\r\n             * @method formatSize\r\n             * @grammar Base.formatSize( size ) => String\r\n             * @grammar Base.formatSize( size, pointLength ) => String\r\n             * @grammar Base.formatSize( size, pointLength, units ) => String\r\n             * @param {Number} size 文件大小\r\n             * @param {Number} [pointLength=2] 精确到的小数点数。\r\n             * @param {Array} [units=[ 'B', 'K', 'M', 'G', 'TB' ]] 单位数组。从字节，到千字节，一直往上指定。如果单位数组里面只指定了到了K(千字节)，同时文件大小大于M, 此方法的输出将还是显示成多少K.\r\n             * @example\r\n             * console.log( Base.formatSize( 100 ) );    // => 100B\r\n             * console.log( Base.formatSize( 1024 ) );    // => 1.00K\r\n             * console.log( Base.formatSize( 1024, 0 ) );    // => 1K\r\n             * console.log( Base.formatSize( 1024 * 1024 ) );    // => 1.00M\r\n             * console.log( Base.formatSize( 1024 * 1024 * 1024 ) );    // => 1.00G\r\n             * console.log( Base.formatSize( 1024 * 1024 * 1024, 0, ['B', 'KB', 'MB'] ) );    // => 1024MB\r\n             */\r\n            formatSize: function( size, pointLength, units ) {\r\n                var unit;\r\n    \r\n                units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\r\n    \r\n                while ( (unit = units.shift()) && size > 1024 ) {\r\n                    size = size / 1024;\r\n                }\r\n    \r\n                return (unit === 'B' ? size : size.toFixed( pointLength || 2 )) +\r\n                        unit;\r\n            }\r\n        };\r\n    });\r\n    /**\r\n     * 事件处理类，可以独立使用，也可以扩展给对象使用。\r\n     * @fileOverview Mediator\r\n     */\r\n    define('mediator',[\r\n        'base'\r\n    ], function( Base ) {\r\n        var $ = Base.$,\r\n            slice = [].slice,\r\n            separator = /\\s+/,\r\n            protos;\r\n    \r\n        // 根据条件过滤出事件handlers.\r\n        function findHandlers( arr, name, callback, context ) {\r\n            return $.grep( arr, function( handler ) {\r\n                return handler &&\r\n                        (!name || handler.e === name) &&\r\n                        (!callback || handler.cb === callback ||\r\n                        handler.cb._cb === callback) &&\r\n                        (!context || handler.ctx === context);\r\n            });\r\n        }\r\n    \r\n        function eachEvent( events, callback, iterator ) {\r\n            // 不支持对象，只支持多个event用空格隔开\r\n            $.each( (events || '').split( separator ), function( _, key ) {\r\n                iterator( key, callback );\r\n            });\r\n        }\r\n    \r\n        function triggerHanders( events, args ) {\r\n            var stoped = false,\r\n                i = -1,\r\n                len = events.length,\r\n                handler;\r\n    \r\n            while ( ++i < len ) {\r\n                handler = events[ i ];\r\n    \r\n                if ( handler.cb.apply( handler.ctx2, args ) === false ) {\r\n                    stoped = true;\r\n                    break;\r\n                }\r\n            }\r\n    \r\n            return !stoped;\r\n        }\r\n    \r\n        protos = {\r\n    \r\n            /**\r\n             * 绑定事件。\r\n             *\r\n             * `callback`方法在执行时，arguments将会来源于trigger的时候携带的参数。如\r\n             * ```javascript\r\n             * var obj = {};\r\n             *\r\n             * // 使得obj有事件行为\r\n             * Mediator.installTo( obj );\r\n             *\r\n             * obj.on( 'testa', function( arg1, arg2 ) {\r\n             *     console.log( arg1, arg2 ); // => 'arg1', 'arg2'\r\n             * });\r\n             *\r\n             * obj.trigger( 'testa', 'arg1', 'arg2' );\r\n             * ```\r\n             *\r\n             * 如果`callback`中，某一个方法`return false`了，则后续的其他`callback`都不会被执行到。\r\n             * 切会影响到`trigger`方法的返回值，为`false`。\r\n             *\r\n             * `on`还可以用来添加一个特殊事件`all`, 这样所有的事件触发都会响应到。同时此类`callback`中的arguments有一个不同处，\r\n             * 就是第一个参数为`type`，记录当前是什么事件在触发。此类`callback`的优先级比脚低，会再正常`callback`执行完后触发。\r\n             * ```javascript\r\n             * obj.on( 'all', function( type, arg1, arg2 ) {\r\n             *     console.log( type, arg1, arg2 ); // => 'testa', 'arg1', 'arg2'\r\n             * });\r\n             * ```\r\n             *\r\n             * @method on\r\n             * @grammar on( name, callback[, context] ) => self\r\n             * @param  {String}   name     事件名，支持多个事件用空格隔开\r\n             * @param  {Function} callback 事件处理器\r\n             * @param  {Object}   [context]  事件处理器的上下文。\r\n             * @return {self} 返回自身，方便链式\r\n             * @chainable\r\n             * @class Mediator\r\n             */\r\n            on: function( name, callback, context ) {\r\n                var me = this,\r\n                    set;\r\n    \r\n                if ( !callback ) {\r\n                    return this;\r\n                }\r\n    \r\n                set = this._events || (this._events = []);\r\n    \r\n                eachEvent( name, callback, function( name, callback ) {\r\n                    var handler = { e: name };\r\n    \r\n                    handler.cb = callback;\r\n                    handler.ctx = context;\r\n                    handler.ctx2 = context || me;\r\n                    handler.id = set.length;\r\n    \r\n                    set.push( handler );\r\n                });\r\n    \r\n                return this;\r\n            },\r\n    \r\n            /**\r\n             * 绑定事件，且当handler执行完后，自动解除绑定。\r\n             * @method once\r\n             * @grammar once( name, callback[, context] ) => self\r\n             * @param  {String}   name     事件名\r\n             * @param  {Function} callback 事件处理器\r\n             * @param  {Object}   [context]  事件处理器的上下文。\r\n             * @return {self} 返回自身，方便链式\r\n             * @chainable\r\n             */\r\n            once: function( name, callback, context ) {\r\n                var me = this;\r\n    \r\n                if ( !callback ) {\r\n                    return me;\r\n                }\r\n    \r\n                eachEvent( name, callback, function( name, callback ) {\r\n                    var once = function() {\r\n                            me.off( name, once );\r\n                            return callback.apply( context || me, arguments );\r\n                        };\r\n    \r\n                    once._cb = callback;\r\n                    me.on( name, once, context );\r\n                });\r\n    \r\n                return me;\r\n            },\r\n    \r\n            /**\r\n             * 解除事件绑定\r\n             * @method off\r\n             * @grammar off( [name[, callback[, context] ] ] ) => self\r\n             * @param  {String}   [name]     事件名\r\n             * @param  {Function} [callback] 事件处理器\r\n             * @param  {Object}   [context]  事件处理器的上下文。\r\n             * @return {self} 返回自身，方便链式\r\n             * @chainable\r\n             */\r\n            off: function( name, cb, ctx ) {\r\n                var events = this._events;\r\n    \r\n                if ( !events ) {\r\n                    return this;\r\n                }\r\n    \r\n                if ( !name && !cb && !ctx ) {\r\n                    this._events = [];\r\n                    return this;\r\n                }\r\n    \r\n                eachEvent( name, cb, function( name, cb ) {\r\n                    $.each( findHandlers( events, name, cb, ctx ), function() {\r\n                        delete events[ this.id ];\r\n                    });\r\n                });\r\n    \r\n                return this;\r\n            },\r\n    \r\n            /**\r\n             * 触发事件\r\n             * @method trigger\r\n             * @grammar trigger( name[, args...] ) => self\r\n             * @param  {String}   type     事件名\r\n             * @param  {*} [...] 任意参数\r\n             * @return {Boolean} 如果handler中return false了，则返回false, 否则返回true\r\n             */\r\n            trigger: function( type ) {\r\n                var args, events, allEvents;\r\n    \r\n                if ( !this._events || !type ) {\r\n                    return this;\r\n                }\r\n    \r\n                args = slice.call( arguments, 1 );\r\n                events = findHandlers( this._events, type );\r\n                allEvents = findHandlers( this._events, 'all' );\r\n    \r\n                return triggerHanders( events, args ) &&\r\n                        triggerHanders( allEvents, arguments );\r\n            }\r\n        };\r\n    \r\n        /**\r\n         * 中介者，它本身是个单例，但可以通过[installTo](#WebUploader:Mediator:installTo)方法，使任何对象具备事件行为。\r\n         * 主要目的是负责模块与模块之间的合作，降低耦合度。\r\n         *\r\n         * @class Mediator\r\n         */\r\n        return $.extend({\r\n    \r\n            /**\r\n             * 可以通过这个接口，使任何对象具备事件功能。\r\n             * @method installTo\r\n             * @param  {Object} obj 需要具备事件行为的对象。\r\n             * @return {Object} 返回obj.\r\n             */\r\n            installTo: function( obj ) {\r\n                return $.extend( obj, protos );\r\n            }\r\n    \r\n        }, protos );\r\n    });\r\n    /**\r\n     * @fileOverview Uploader上传类\r\n     */\r\n    define('uploader',[\r\n        'base',\r\n        'mediator'\r\n    ], function( Base, Mediator ) {\r\n    \r\n        var $ = Base.$;\r\n    \r\n        /**\r\n         * 上传入口类。\r\n         * @class Uploader\r\n         * @constructor\r\n         * @grammar new Uploader( opts ) => Uploader\r\n         * @example\r\n         * var uploader = WebUploader.Uploader({\r\n         *     swf: 'path_of_swf/Uploader.swf',\r\n         *\r\n         *     // 开起分片上传。\r\n         *     chunked: true\r\n         * });\r\n         */\r\n        function Uploader( opts ) {\r\n            this.options = $.extend( true, {}, Uploader.options, opts );\r\n            this._init( this.options );\r\n        }\r\n    \r\n        // default Options\r\n        // widgets中有相应扩展\r\n        Uploader.options = {};\r\n        Mediator.installTo( Uploader.prototype );\r\n    \r\n        // 批量添加纯命令式方法。\r\n        $.each({\r\n            upload: 'start-upload',\r\n            stop: 'stop-upload',\r\n            getFile: 'get-file',\r\n            getFiles: 'get-files',\r\n            addFile: 'add-file',\r\n            addFiles: 'add-file',\r\n            sort: 'sort-files',\r\n            removeFile: 'remove-file',\r\n            cancelFile: 'cancel-file',\r\n            skipFile: 'skip-file',\r\n            retry: 'retry',\r\n            isInProgress: 'is-in-progress',\r\n            makeThumb: 'make-thumb',\r\n            md5File: 'md5-file',\r\n            getDimension: 'get-dimension',\r\n            addButton: 'add-btn',\r\n            predictRuntimeType: 'predict-runtime-type',\r\n            refresh: 'refresh',\r\n            disable: 'disable',\r\n            enable: 'enable',\r\n            reset: 'reset'\r\n        }, function( fn, command ) {\r\n            Uploader.prototype[ fn ] = function() {\r\n                return this.request( command, arguments );\r\n            };\r\n        });\r\n    \r\n        $.extend( Uploader.prototype, {\r\n            state: 'pending',\r\n    \r\n            _init: function( opts ) {\r\n                var me = this;\r\n    \r\n                me.request( 'init', opts, function() {\r\n                    me.state = 'ready';\r\n                    me.trigger('ready');\r\n                });\r\n            },\r\n    \r\n            /**\r\n             * 获取或者设置Uploader配置项。\r\n             * @method option\r\n             * @grammar option( key ) => *\r\n             * @grammar option( key, val ) => self\r\n             * @example\r\n             *\r\n             * // 初始状态图片上传前不会压缩\r\n             * var uploader = new WebUploader.Uploader({\r\n             *     compress: null;\r\n             * });\r\n             *\r\n             * // 修改后图片上传前，尝试将图片压缩到1600 * 1600\r\n             * uploader.option( 'compress', {\r\n             *     width: 1600,\r\n             *     height: 1600\r\n             * });\r\n             */\r\n            option: function( key, val ) {\r\n                var opts = this.options;\r\n    \r\n                // setter\r\n                if ( arguments.length > 1 ) {\r\n    \r\n                    if ( $.isPlainObject( val ) &&\r\n                            $.isPlainObject( opts[ key ] ) ) {\r\n                        $.extend( opts[ key ], val );\r\n                    } else {\r\n                        opts[ key ] = val;\r\n                    }\r\n    \r\n                } else {    // getter\r\n                    return key ? opts[ key ] : opts;\r\n                }\r\n            },\r\n    \r\n            /**\r\n             * 获取文件统计信息。返回一个包含一下信息的对象。\r\n             * * `successNum` 上传成功的文件数\r\n             * * `progressNum` 上传中的文件数\r\n             * * `cancelNum` 被删除的文件数\r\n             * * `invalidNum` 无效的文件数\r\n             * * `uploadFailNum` 上传失败的文件数\r\n             * * `queueNum` 还在队列中的文件数\r\n             * * `interruptNum` 被暂停的文件数\r\n             * @method getStats\r\n             * @grammar getStats() => Object\r\n             */\r\n            getStats: function() {\r\n                // return this._mgr.getStats.apply( this._mgr, arguments );\r\n                var stats = this.request('get-stats');\r\n    \r\n                return stats ? {\r\n                    successNum: stats.numOfSuccess,\r\n                    progressNum: stats.numOfProgress,\r\n    \r\n                    // who care?\r\n                    // queueFailNum: 0,\r\n                    cancelNum: stats.numOfCancel,\r\n                    invalidNum: stats.numOfInvalid,\r\n                    uploadFailNum: stats.numOfUploadFailed,\r\n                    queueNum: stats.numOfQueue,\r\n                    interruptNum: stats.numofInterrupt\r\n                } : {};\r\n            },\r\n    \r\n            // 需要重写此方法来来支持opts.onEvent和instance.onEvent的处理器\r\n            trigger: function( type/*, args...*/ ) {\r\n                var args = [].slice.call( arguments, 1 ),\r\n                    opts = this.options,\r\n                    name = 'on' + type.substring( 0, 1 ).toUpperCase() +\r\n                        type.substring( 1 );\r\n    \r\n                if (\r\n                        // 调用通过on方法注册的handler.\r\n                        Mediator.trigger.apply( this, arguments ) === false ||\r\n    \r\n                        // 调用opts.onEvent\r\n                        $.isFunction( opts[ name ] ) &&\r\n                        opts[ name ].apply( this, args ) === false ||\r\n    \r\n                        // 调用this.onEvent\r\n                        $.isFunction( this[ name ] ) &&\r\n                        this[ name ].apply( this, args ) === false ||\r\n    \r\n                        // 广播所有uploader的事件。\r\n                        Mediator.trigger.apply( Mediator,\r\n                        [ this, type ].concat( args ) ) === false ) {\r\n    \r\n                    return false;\r\n                }\r\n    \r\n                return true;\r\n            },\r\n    \r\n            /**\r\n             * 销毁 webuploader 实例\r\n             * @method destroy\r\n             * @grammar destroy() => undefined\r\n             */\r\n            destroy: function() {\r\n                this.request( 'destroy', arguments );\r\n                this.off();\r\n            },\r\n    \r\n            // widgets/widget.js将补充此方法的详细文档。\r\n            request: Base.noop\r\n        });\r\n    \r\n        /**\r\n         * 创建Uploader实例，等同于new Uploader( opts );\r\n         * @method create\r\n         * @class Base\r\n         * @static\r\n         * @grammar Base.create( opts ) => Uploader\r\n         */\r\n        Base.create = Uploader.create = function( opts ) {\r\n            return new Uploader( opts );\r\n        };\r\n    \r\n        // 暴露Uploader，可以通过它来扩展业务逻辑。\r\n        Base.Uploader = Uploader;\r\n    \r\n        return Uploader;\r\n    });\r\n    /**\r\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\r\n     */\r\n    define('runtime/runtime',[\r\n        'base',\r\n        'mediator'\r\n    ], function( Base, Mediator ) {\r\n    \r\n        var $ = Base.$,\r\n            factories = {},\r\n    \r\n            // 获取对象的第一个key\r\n            getFirstKey = function( obj ) {\r\n                for ( var key in obj ) {\r\n                    if ( obj.hasOwnProperty( key ) ) {\r\n                        return key;\r\n                    }\r\n                }\r\n                return null;\r\n            };\r\n    \r\n        // 接口类。\r\n        function Runtime( options ) {\r\n            this.options = $.extend({\r\n                container: document.body\r\n            }, options );\r\n            this.uid = Base.guid('rt_');\r\n        }\r\n    \r\n        $.extend( Runtime.prototype, {\r\n    \r\n            getContainer: function() {\r\n                var opts = this.options,\r\n                    parent, container;\r\n    \r\n                if ( this._container ) {\r\n                    return this._container;\r\n                }\r\n    \r\n                parent = $( opts.container || document.body );\r\n                container = $( document.createElement('div') );\r\n    \r\n                container.attr( 'id', 'rt_' + this.uid );\r\n                container.css({\r\n                    position: 'absolute',\r\n                    top: '0px',\r\n                    left: '0px',\r\n                    width: '1px',\r\n                    height: '1px',\r\n                    overflow: 'hidden'\r\n                });\r\n    \r\n                parent.append( container );\r\n                parent.addClass('webuploader-container');\r\n                this._container = container;\r\n                this._parent = parent;\r\n                return container;\r\n            },\r\n    \r\n            init: Base.noop,\r\n            exec: Base.noop,\r\n    \r\n            destroy: function() {\r\n                this._container && this._container.remove();\r\n                this._parent && this._parent.removeClass('webuploader-container');\r\n                this.off();\r\n            }\r\n        });\r\n    \r\n        Runtime.orders = 'html5,flash';\r\n    \r\n    \r\n        /**\r\n         * 添加Runtime实现。\r\n         * @param {String} type    类型\r\n         * @param {Runtime} factory 具体Runtime实现。\r\n         */\r\n        Runtime.addRuntime = function( type, factory ) {\r\n            factories[ type ] = factory;\r\n        };\r\n    \r\n        Runtime.hasRuntime = function( type ) {\r\n            return !!(type ? factories[ type ] : getFirstKey( factories ));\r\n        };\r\n    \r\n        Runtime.create = function( opts, orders ) {\r\n            var type, runtime;\r\n    \r\n            orders = orders || Runtime.orders;\r\n            $.each( orders.split( /\\s*,\\s*/g ), function() {\r\n                if ( factories[ this ] ) {\r\n                    type = this;\r\n                    return false;\r\n                }\r\n            });\r\n    \r\n            type = type || getFirstKey( factories );\r\n    \r\n            if ( !type ) {\r\n                throw new Error('Runtime Error');\r\n            }\r\n    \r\n            runtime = new factories[ type ]( opts );\r\n            return runtime;\r\n        };\r\n    \r\n        Mediator.installTo( Runtime.prototype );\r\n        return Runtime;\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\r\n     */\r\n    define('runtime/client',[\r\n        'base',\r\n        'mediator',\r\n        'runtime/runtime'\r\n    ], function( Base, Mediator, Runtime ) {\r\n    \r\n        var cache;\r\n    \r\n        cache = (function() {\r\n            var obj = {};\r\n    \r\n            return {\r\n                add: function( runtime ) {\r\n                    obj[ runtime.uid ] = runtime;\r\n                },\r\n    \r\n                get: function( ruid, standalone ) {\r\n                    var i;\r\n    \r\n                    if ( ruid ) {\r\n                        return obj[ ruid ];\r\n                    }\r\n    \r\n                    for ( i in obj ) {\r\n                        // 有些类型不能重用，比如filepicker.\r\n                        if ( standalone && obj[ i ].__standalone ) {\r\n                            continue;\r\n                        }\r\n    \r\n                        return obj[ i ];\r\n                    }\r\n    \r\n                    return null;\r\n                },\r\n    \r\n                remove: function( runtime ) {\r\n                    delete obj[ runtime.uid ];\r\n                }\r\n            };\r\n        })();\r\n    \r\n        function RuntimeClient( component, standalone ) {\r\n            var deferred = Base.Deferred(),\r\n                runtime;\r\n    \r\n            this.uid = Base.guid('client_');\r\n    \r\n            // 允许runtime没有初始化之前，注册一些方法在初始化后执行。\r\n            this.runtimeReady = function( cb ) {\r\n                return deferred.done( cb );\r\n            };\r\n    \r\n            this.connectRuntime = function( opts, cb ) {\r\n    \r\n                // already connected.\r\n                if ( runtime ) {\r\n                    throw new Error('already connected!');\r\n                }\r\n    \r\n                deferred.done( cb );\r\n    \r\n                if ( typeof opts === 'string' && cache.get( opts ) ) {\r\n                    runtime = cache.get( opts );\r\n                }\r\n    \r\n                // 像filePicker只能独立存在，不能公用。\r\n                runtime = runtime || cache.get( null, standalone );\r\n    \r\n                // 需要创建\r\n                if ( !runtime ) {\r\n                    runtime = Runtime.create( opts, opts.runtimeOrder );\r\n                    runtime.__promise = deferred.promise();\r\n                    runtime.once( 'ready', deferred.resolve );\r\n                    runtime.init();\r\n                    cache.add( runtime );\r\n                    runtime.__client = 1;\r\n                } else {\r\n                    // 来自cache\r\n                    Base.$.extend( runtime.options, opts );\r\n                    runtime.__promise.then( deferred.resolve );\r\n                    runtime.__client++;\r\n                }\r\n    \r\n                standalone && (runtime.__standalone = standalone);\r\n                return runtime;\r\n            };\r\n    \r\n            this.getRuntime = function() {\r\n                return runtime;\r\n            };\r\n    \r\n            this.disconnectRuntime = function() {\r\n                if ( !runtime ) {\r\n                    return;\r\n                }\r\n    \r\n                runtime.__client--;\r\n    \r\n                if ( runtime.__client <= 0 ) {\r\n                    cache.remove( runtime );\r\n                    delete runtime.__promise;\r\n                    runtime.destroy();\r\n                }\r\n    \r\n                runtime = null;\r\n            };\r\n    \r\n            this.exec = function() {\r\n                if ( !runtime ) {\r\n                    return;\r\n                }\r\n    \r\n                var args = Base.slice( arguments );\r\n                component && args.unshift( component );\r\n    \r\n                return runtime.exec.apply( this, args );\r\n            };\r\n    \r\n            this.getRuid = function() {\r\n                return runtime && runtime.uid;\r\n            };\r\n    \r\n            this.destroy = (function( destroy ) {\r\n                return function() {\r\n                    destroy && destroy.apply( this, arguments );\r\n                    this.trigger('destroy');\r\n                    this.off();\r\n                    this.exec('destroy');\r\n                    this.disconnectRuntime();\r\n                };\r\n            })( this.destroy );\r\n        }\r\n    \r\n        Mediator.installTo( RuntimeClient.prototype );\r\n        return RuntimeClient;\r\n    });\r\n    /**\r\n     * @fileOverview 错误信息\r\n     */\r\n    define('lib/dnd',[\r\n        'base',\r\n        'mediator',\r\n        'runtime/client'\r\n    ], function( Base, Mediator, RuntimeClent ) {\r\n    \r\n        var $ = Base.$;\r\n    \r\n        function DragAndDrop( opts ) {\r\n            opts = this.options = $.extend({}, DragAndDrop.options, opts );\r\n    \r\n            opts.container = $( opts.container );\r\n    \r\n            if ( !opts.container.length ) {\r\n                return;\r\n            }\r\n    \r\n            RuntimeClent.call( this, 'DragAndDrop' );\r\n        }\r\n    \r\n        DragAndDrop.options = {\r\n            accept: null,\r\n            disableGlobalDnd: false\r\n        };\r\n    \r\n        Base.inherits( RuntimeClent, {\r\n            constructor: DragAndDrop,\r\n    \r\n            init: function() {\r\n                var me = this;\r\n    \r\n                me.connectRuntime( me.options, function() {\r\n                    me.exec('init');\r\n                    me.trigger('ready');\r\n                });\r\n            }\r\n        });\r\n    \r\n        Mediator.installTo( DragAndDrop.prototype );\r\n    \r\n        return DragAndDrop;\r\n    });\r\n    /**\r\n     * @fileOverview 组件基类。\r\n     */\r\n    define('widgets/widget',[\r\n        'base',\r\n        'uploader'\r\n    ], function( Base, Uploader ) {\r\n    \r\n        var $ = Base.$,\r\n            _init = Uploader.prototype._init,\r\n            _destroy = Uploader.prototype.destroy,\r\n            IGNORE = {},\r\n            widgetClass = [];\r\n    \r\n        function isArrayLike( obj ) {\r\n            if ( !obj ) {\r\n                return false;\r\n            }\r\n    \r\n            var length = obj.length,\r\n                type = $.type( obj );\r\n    \r\n            if ( obj.nodeType === 1 && length ) {\r\n                return true;\r\n            }\r\n    \r\n            return type === 'array' || type !== 'function' && type !== 'string' &&\r\n                    (length === 0 || typeof length === 'number' && length > 0 &&\r\n                    (length - 1) in obj);\r\n        }\r\n    \r\n        function Widget( uploader ) {\r\n            this.owner = uploader;\r\n            this.options = uploader.options;\r\n        }\r\n    \r\n        $.extend( Widget.prototype, {\r\n    \r\n            init: Base.noop,\r\n    \r\n            // 类Backbone的事件监听声明，监听uploader实例上的事件\r\n            // widget直接无法监听事件，事件只能通过uploader来传递\r\n            invoke: function( apiName, args ) {\r\n    \r\n                /*\r\n                    {\r\n                        'make-thumb': 'makeThumb'\r\n                    }\r\n                 */\r\n                var map = this.responseMap;\r\n    \r\n                // 如果无API响应声明则忽略\r\n                if ( !map || !(apiName in map) || !(map[ apiName ] in this) ||\r\n                        !$.isFunction( this[ map[ apiName ] ] ) ) {\r\n    \r\n                    return IGNORE;\r\n                }\r\n    \r\n                return this[ map[ apiName ] ].apply( this, args );\r\n    \r\n            },\r\n    \r\n            /**\r\n             * 发送命令。当传入`callback`或者`handler`中返回`promise`时。返回一个当所有`handler`中的promise都完成后完成的新`promise`。\r\n             * @method request\r\n             * @grammar request( command, args ) => * | Promise\r\n             * @grammar request( command, args, callback ) => Promise\r\n             * @for  Uploader\r\n             */\r\n            request: function() {\r\n                return this.owner.request.apply( this.owner, arguments );\r\n            }\r\n        });\r\n    \r\n        // 扩展Uploader.\r\n        $.extend( Uploader.prototype, {\r\n    \r\n            /**\r\n             * @property {String | Array} [disableWidgets=undefined]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 默认所有 Uploader.register 了的 widget 都会被加载，如果禁用某一部分，请通过此 option 指定黑名单。\r\n             */\r\n    \r\n            // 覆写_init用来初始化widgets\r\n            _init: function() {\r\n                var me = this,\r\n                    widgets = me._widgets = [],\r\n                    deactives = me.options.disableWidgets || '';\r\n    \r\n                $.each( widgetClass, function( _, klass ) {\r\n                    (!deactives || !~deactives.indexOf( klass._name )) &&\r\n                        widgets.push( new klass( me ) );\r\n                });\r\n    \r\n                return _init.apply( me, arguments );\r\n            },\r\n    \r\n            request: function( apiName, args, callback ) {\r\n                var i = 0,\r\n                    widgets = this._widgets,\r\n                    len = widgets && widgets.length,\r\n                    rlts = [],\r\n                    dfds = [],\r\n                    widget, rlt, promise, key;\r\n    \r\n                args = isArrayLike( args ) ? args : [ args ];\r\n    \r\n                for ( ; i < len; i++ ) {\r\n                    widget = widgets[ i ];\r\n                    rlt = widget.invoke( apiName, args );\r\n    \r\n                    if ( rlt !== IGNORE ) {\r\n    \r\n                        // Deferred对象\r\n                        if ( Base.isPromise( rlt ) ) {\r\n                            dfds.push( rlt );\r\n                        } else {\r\n                            rlts.push( rlt );\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                // 如果有callback，则用异步方式。\r\n                if ( callback || dfds.length ) {\r\n                    promise = Base.when.apply( Base, dfds );\r\n                    key = promise.pipe ? 'pipe' : 'then';\r\n    \r\n                    // 很重要不能删除。删除了会死循环。\r\n                    // 保证执行顺序。让callback总是在下一个 tick 中执行。\r\n                    return promise[ key ](function() {\r\n                                var deferred = Base.Deferred(),\r\n                                    args = arguments;\r\n    \r\n                                if ( args.length === 1 ) {\r\n                                    args = args[ 0 ];\r\n                                }\r\n    \r\n                                setTimeout(function() {\r\n                                    deferred.resolve( args );\r\n                                }, 1 );\r\n    \r\n                                return deferred.promise();\r\n                            })[ callback ? key : 'done' ]( callback || Base.noop );\r\n                } else {\r\n                    return rlts[ 0 ];\r\n                }\r\n            },\r\n    \r\n            destroy: function() {\r\n                _destroy.apply( this, arguments );\r\n                this._widgets = null;\r\n            }\r\n        });\r\n    \r\n        /**\r\n         * 添加组件\r\n         * @grammar Uploader.register(proto);\r\n         * @grammar Uploader.register(map, proto);\r\n         * @param  {object} responseMap API 名称与函数实现的映射\r\n         * @param  {object} proto 组件原型，构造函数通过 constructor 属性定义\r\n         * @method Uploader.register\r\n         * @for Uploader\r\n         * @example\r\n         * Uploader.register({\r\n         *     'make-thumb': 'makeThumb'\r\n         * }, {\r\n         *     init: function( options ) {},\r\n         *     makeThumb: function() {}\r\n         * });\r\n         *\r\n         * Uploader.register({\r\n         *     'make-thumb': function() {\r\n         *         \r\n         *     }\r\n         * });\r\n         */\r\n        Uploader.register = Widget.register = function( responseMap, widgetProto ) {\r\n            var map = { init: 'init', destroy: 'destroy', name: 'anonymous' },\r\n                klass;\r\n    \r\n            if ( arguments.length === 1 ) {\r\n                widgetProto = responseMap;\r\n    \r\n                // 自动生成 map 表。\r\n                $.each(widgetProto, function(key) {\r\n                    if ( key[0] === '_' || key === 'name' ) {\r\n                        key === 'name' && (map.name = widgetProto.name);\r\n                        return;\r\n                    }\r\n    \r\n                    map[key.replace(/[A-Z]/g, '-$&').toLowerCase()] = key;\r\n                });\r\n    \r\n            } else {\r\n                map = $.extend( map, responseMap );\r\n            }\r\n    \r\n            widgetProto.responseMap = map;\r\n            klass = Base.inherits( Widget, widgetProto );\r\n            klass._name = map.name;\r\n            widgetClass.push( klass );\r\n    \r\n            return klass;\r\n        };\r\n    \r\n        /**\r\n         * 删除插件，只有在注册时指定了名字的才能被删除。\r\n         * @grammar Uploader.unRegister(name);\r\n         * @param  {string} name 组件名字\r\n         * @method Uploader.unRegister\r\n         * @for Uploader\r\n         * @example\r\n         *\r\n         * Uploader.register({\r\n         *     name: 'custom',\r\n         *     \r\n         *     'make-thumb': function() {\r\n         *         \r\n         *     }\r\n         * });\r\n         *\r\n         * Uploader.unRegister('custom');\r\n         */\r\n        Uploader.unRegister = Widget.unRegister = function( name ) {\r\n            if ( !name || name === 'anonymous' ) {\r\n                return;\r\n            }\r\n            \r\n            // 删除指定的插件。\r\n            for ( var i = widgetClass.length; i--; ) {\r\n                if ( widgetClass[i]._name === name ) {\r\n                    widgetClass.splice(i, 1)\r\n                }\r\n            }\r\n        };\r\n    \r\n        return Widget;\r\n    });\r\n    /**\r\n     * @fileOverview DragAndDrop Widget。\r\n     */\r\n    define('widgets/filednd',[\r\n        'base',\r\n        'uploader',\r\n        'lib/dnd',\r\n        'widgets/widget'\r\n    ], function( Base, Uploader, Dnd ) {\r\n        var $ = Base.$;\r\n    \r\n        Uploader.options.dnd = '';\r\n    \r\n        /**\r\n         * @property {Selector} [dnd=undefined]  指定Drag And Drop拖拽的容器，如果不指定，则不启动。\r\n         * @namespace options\r\n         * @for Uploader\r\n         */\r\n        \r\n        /**\r\n         * @property {Selector} [disableGlobalDnd=false]  是否禁掉整个页面的拖拽功能，如果不禁用，图片拖进来的时候会默认被浏览器打开。\r\n         * @namespace options\r\n         * @for Uploader\r\n         */\r\n    \r\n        /**\r\n         * @event dndAccept\r\n         * @param {DataTransferItemList} items DataTransferItem\r\n         * @description 阻止此事件可以拒绝某些类型的文件拖入进来。目前只有 chrome 提供这样的 API，且只能通过 mime-type 验证。\r\n         * @for  Uploader\r\n         */\r\n        return Uploader.register({\r\n            name: 'dnd',\r\n            \r\n            init: function( opts ) {\r\n    \r\n                if ( !opts.dnd ||\r\n                        this.request('predict-runtime-type') !== 'html5' ) {\r\n                    return;\r\n                }\r\n    \r\n                var me = this,\r\n                    deferred = Base.Deferred(),\r\n                    options = $.extend({}, {\r\n                        disableGlobalDnd: opts.disableGlobalDnd,\r\n                        container: opts.dnd,\r\n                        accept: opts.accept\r\n                    }),\r\n                    dnd;\r\n    \r\n                this.dnd = dnd = new Dnd( options );\r\n    \r\n                dnd.once( 'ready', deferred.resolve );\r\n                dnd.on( 'drop', function( files ) {\r\n                    me.request( 'add-file', [ files ]);\r\n                });\r\n    \r\n                // 检测文件是否全部允许添加。\r\n                dnd.on( 'accept', function( items ) {\r\n                    return me.owner.trigger( 'dndAccept', items );\r\n                });\r\n    \r\n                dnd.init();\r\n    \r\n                return deferred.promise();\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.dnd && this.dnd.destroy();\r\n            }\r\n        });\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview 错误信息\r\n     */\r\n    define('lib/filepaste',[\r\n        'base',\r\n        'mediator',\r\n        'runtime/client'\r\n    ], function( Base, Mediator, RuntimeClent ) {\r\n    \r\n        var $ = Base.$;\r\n    \r\n        function FilePaste( opts ) {\r\n            opts = this.options = $.extend({}, opts );\r\n            opts.container = $( opts.container || document.body );\r\n            RuntimeClent.call( this, 'FilePaste' );\r\n        }\r\n    \r\n        Base.inherits( RuntimeClent, {\r\n            constructor: FilePaste,\r\n    \r\n            init: function() {\r\n                var me = this;\r\n    \r\n                me.connectRuntime( me.options, function() {\r\n                    me.exec('init');\r\n                    me.trigger('ready');\r\n                });\r\n            }\r\n        });\r\n    \r\n        Mediator.installTo( FilePaste.prototype );\r\n    \r\n        return FilePaste;\r\n    });\r\n    /**\r\n     * @fileOverview 组件基类。\r\n     */\r\n    define('widgets/filepaste',[\r\n        'base',\r\n        'uploader',\r\n        'lib/filepaste',\r\n        'widgets/widget'\r\n    ], function( Base, Uploader, FilePaste ) {\r\n        var $ = Base.$;\r\n    \r\n        /**\r\n         * @property {Selector} [paste=undefined]  指定监听paste事件的容器，如果不指定，不启用此功能。此功能为通过粘贴来添加截屏的图片。建议设置为`document.body`.\r\n         * @namespace options\r\n         * @for Uploader\r\n         */\r\n        return Uploader.register({\r\n            name: 'paste',\r\n            \r\n            init: function( opts ) {\r\n    \r\n                if ( !opts.paste ||\r\n                        this.request('predict-runtime-type') !== 'html5' ) {\r\n                    return;\r\n                }\r\n    \r\n                var me = this,\r\n                    deferred = Base.Deferred(),\r\n                    options = $.extend({}, {\r\n                        container: opts.paste,\r\n                        accept: opts.accept\r\n                    }),\r\n                    paste;\r\n    \r\n                this.paste = paste = new FilePaste( options );\r\n    \r\n                paste.once( 'ready', deferred.resolve );\r\n                paste.on( 'paste', function( files ) {\r\n                    me.owner.request( 'add-file', [ files ]);\r\n                });\r\n                paste.init();\r\n    \r\n                return deferred.promise();\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.paste && this.paste.destroy();\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview Blob\r\n     */\r\n    define('lib/blob',[\r\n        'base',\r\n        'runtime/client'\r\n    ], function( Base, RuntimeClient ) {\r\n    \r\n        function Blob( ruid, source ) {\r\n            var me = this;\r\n    \r\n            me.source = source;\r\n            me.ruid = ruid;\r\n            this.size = source.size || 0;\r\n    \r\n            // 如果没有指定 mimetype, 但是知道文件后缀。\r\n            if ( !source.type && this.ext &&\r\n                    ~'jpg,jpeg,png,gif,bmp'.indexOf( this.ext ) ) {\r\n                this.type = 'image/' + (this.ext === 'jpg' ? 'jpeg' : this.ext);\r\n            } else {\r\n                this.type = source.type || 'application/octet-stream';\r\n            }\r\n    \r\n            RuntimeClient.call( me, 'Blob' );\r\n            this.uid = source.uid || this.uid;\r\n    \r\n            if ( ruid ) {\r\n                me.connectRuntime( ruid );\r\n            }\r\n        }\r\n    \r\n        Base.inherits( RuntimeClient, {\r\n            constructor: Blob,\r\n    \r\n            slice: function( start, end ) {\r\n                return this.exec( 'slice', start, end );\r\n            },\r\n    \r\n            getSource: function() {\r\n                return this.source;\r\n            }\r\n        });\r\n    \r\n        return Blob;\r\n    });\r\n    /**\r\n     * 为了统一化Flash的File和HTML5的File而存在。\r\n     * 以至于要调用Flash里面的File，也可以像调用HTML5版本的File一下。\r\n     * @fileOverview File\r\n     */\r\n    define('lib/file',[\r\n        'base',\r\n        'lib/blob'\r\n    ], function( Base, Blob ) {\r\n    \r\n        var uid = 1,\r\n            rExt = /\\.([^.]+)$/;\r\n    \r\n        function File( ruid, file ) {\r\n            var ext;\r\n    \r\n            this.name = file.name || ('untitled' + uid++);\r\n            ext = rExt.exec( file.name ) ? RegExp.$1.toLowerCase() : '';\r\n    \r\n            // todo 支持其他类型文件的转换。\r\n            // 如果有 mimetype, 但是文件名里面没有找出后缀规律\r\n            if ( !ext && file.type ) {\r\n                ext = /\\/(jpg|jpeg|png|gif|bmp)$/i.exec( file.type ) ?\r\n                        RegExp.$1.toLowerCase() : '';\r\n                this.name += '.' + ext;\r\n            }\r\n    \r\n            this.ext = ext;\r\n            this.lastModifiedDate = file.lastModifiedDate ||\r\n                    (new Date()).toLocaleString();\r\n    \r\n            Blob.apply( this, arguments );\r\n        }\r\n    \r\n        return Base.inherits( Blob, File );\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview 错误信息\r\n     */\r\n    define('lib/filepicker',[\r\n        'base',\r\n        'runtime/client',\r\n        'lib/file'\r\n    ], function( Base, RuntimeClient, File ) {\r\n    \r\n        var $ = Base.$;\r\n    \r\n        function FilePicker( opts ) {\r\n            opts = this.options = $.extend({}, FilePicker.options, opts );\r\n    \r\n            opts.container = $( opts.id );\r\n    \r\n            if ( !opts.container.length ) {\r\n                throw new Error('按钮指定错误');\r\n            }\r\n    \r\n            opts.innerHTML = opts.innerHTML || opts.label ||\r\n                    opts.container.html() || '';\r\n    \r\n            opts.button = $( opts.button || document.createElement('div') );\r\n            opts.button.html( opts.innerHTML );\r\n            opts.container.html( opts.button );\r\n    \r\n            RuntimeClient.call( this, 'FilePicker', true );\r\n        }\r\n    \r\n        FilePicker.options = {\r\n            button: null,\r\n            container: null,\r\n            label: null,\r\n            innerHTML: null,\r\n            multiple: true,\r\n            accept: null,\r\n            name: 'file',\r\n            style: 'webuploader-pick'   //pick element class attribute, default is \"webuploader-pick\"\r\n        };\r\n    \r\n        Base.inherits( RuntimeClient, {\r\n            constructor: FilePicker,\r\n    \r\n            init: function() {\r\n                var me = this,\r\n                    opts = me.options,\r\n                    button = opts.button,\r\n                    style = opts.style;\r\n    \r\n                if (style)\r\n                    button.addClass('webuploader-pick');\r\n    \r\n                me.on( 'all', function( type ) {\r\n                    var files;\r\n    \r\n                    switch ( type ) {\r\n                        case 'mouseenter':\r\n                            if (style)\r\n                                button.addClass('webuploader-pick-hover');\r\n                            break;\r\n    \r\n                        case 'mouseleave':\r\n                            if (style)\r\n                                button.removeClass('webuploader-pick-hover');\r\n                            break;\r\n    \r\n                        case 'change':\r\n                            files = me.exec('getFiles');\r\n                            me.trigger( 'select', $.map( files, function( file ) {\r\n                                file = new File( me.getRuid(), file );\r\n    \r\n                                // 记录来源。\r\n                                file._refer = opts.container;\r\n                                return file;\r\n                            }), opts.container );\r\n                            break;\r\n                    }\r\n                });\r\n    \r\n                me.connectRuntime( opts, function() {\r\n                    me.refresh();\r\n                    me.exec( 'init', opts );\r\n                    me.trigger('ready');\r\n                });\r\n    \r\n                this._resizeHandler = Base.bindFn( this.refresh, this );\r\n                $( window ).on( 'resize', this._resizeHandler );\r\n            },\r\n    \r\n            refresh: function() {\r\n                var shimContainer = this.getRuntime().getContainer(),\r\n                    button = this.options.button,\r\n                    width = button.outerWidth ?\r\n                            button.outerWidth() : button.width(),\r\n    \r\n                    height = button.outerHeight ?\r\n                            button.outerHeight() : button.height(),\r\n    \r\n                    pos = button.offset();\r\n    \r\n                width && height && shimContainer.css({\r\n                    bottom: 'auto',\r\n                    right: 'auto',\r\n                    width: width + 'px',\r\n                    height: height + 'px'\r\n                }).offset( pos );\r\n            },\r\n    \r\n            enable: function() {\r\n                var btn = this.options.button;\r\n    \r\n                btn.removeClass('webuploader-pick-disable');\r\n                this.refresh();\r\n            },\r\n    \r\n            disable: function() {\r\n                var btn = this.options.button;\r\n    \r\n                this.getRuntime().getContainer().css({\r\n                    top: '-99999px'\r\n                });\r\n    \r\n                btn.addClass('webuploader-pick-disable');\r\n            },\r\n    \r\n            destroy: function() {\r\n                var btn = this.options.button;\r\n                $( window ).off( 'resize', this._resizeHandler );\r\n                btn.removeClass('webuploader-pick-disable webuploader-pick-hover ' +\r\n                    'webuploader-pick');\r\n            }\r\n        });\r\n    \r\n        return FilePicker;\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview 文件选择相关\r\n     */\r\n    define('widgets/filepicker',[\r\n        'base',\r\n        'uploader',\r\n        'lib/filepicker',\r\n        'widgets/widget'\r\n    ], function( Base, Uploader, FilePicker ) {\r\n        var $ = Base.$;\r\n    \r\n        $.extend( Uploader.options, {\r\n    \r\n            /**\r\n             * @property {Selector | Object} [pick=undefined]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 指定选择文件的按钮容器，不指定则不创建按钮。\r\n             *\r\n             * * `id` {Seletor|dom} 指定选择文件的按钮容器，不指定则不创建按钮。**注意** 这里虽然写的是 id, 但是不是只支持 id, 还支持 class, 或者 dom 节点。\r\n             * * `label` {String} 请采用 `innerHTML` 代替\r\n             * * `innerHTML` {String} 指定按钮文字。不指定时优先从指定的容器中看是否自带文字。\r\n             * * `multiple` {Boolean} 是否开起同时选择多个文件能力。\r\n             */\r\n            pick: null,\r\n    \r\n            /**\r\n             * @property {Arroy} [accept=null]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 指定接受哪些类型的文件。 由于目前还有ext转mimeType表，所以这里需要分开指定。\r\n             *\r\n             * * `title` {String} 文字描述\r\n             * * `extensions` {String} 允许的文件后缀，不带点，多个用逗号分割。\r\n             * * `mimeTypes` {String} 多个用逗号分割。\r\n             *\r\n             * 如：\r\n             *\r\n             * ```\r\n             * {\r\n             *     title: 'Images',\r\n             *     extensions: 'gif,jpg,jpeg,bmp,png',\r\n             *     mimeTypes: 'image/*'\r\n             * }\r\n             * ```\r\n             */\r\n            accept: null/*{\r\n                title: 'Images',\r\n                extensions: 'gif,jpg,jpeg,bmp,png',\r\n                mimeTypes: 'image/*'\r\n            }*/\r\n        });\r\n    \r\n        return Uploader.register({\r\n            name: 'picker',\r\n    \r\n            init: function( opts ) {\r\n                this.pickers = [];\r\n                return opts.pick && this.addBtn( opts.pick );\r\n            },\r\n    \r\n            refresh: function() {\r\n                $.each( this.pickers, function() {\r\n                    this.refresh();\r\n                });\r\n            },\r\n    \r\n            /**\r\n             * @method addBtn\r\n             * @for Uploader\r\n             * @grammar addBtn( pick ) => Promise\r\n             * @description\r\n             * 添加文件选择按钮，如果一个按钮不够，需要调用此方法来添加。参数跟[options.pick](#WebUploader:Uploader:options)一致。\r\n             * @example\r\n             * uploader.addBtn({\r\n             *     id: '#btnContainer',\r\n             *     innerHTML: '选择文件'\r\n             * });\r\n             */\r\n            addBtn: function( pick ) {\r\n                var me = this,\r\n                    opts = me.options,\r\n                    accept = opts.accept,\r\n                    promises = [];\r\n    \r\n                if ( !pick ) {\r\n                    return;\r\n                }\r\n    \r\n                $.isPlainObject( pick ) || (pick = {\r\n                    id: pick\r\n                });\r\n    \r\n                $( pick.id ).each(function() {\r\n                    var options, picker, deferred;\r\n    \r\n                    deferred = Base.Deferred();\r\n    \r\n                    options = $.extend({}, pick, {\r\n                        accept: $.isPlainObject( accept ) ? [ accept ] : accept,\r\n                        swf: opts.swf,\r\n                        runtimeOrder: opts.runtimeOrder,\r\n                        id: this\r\n                    });\r\n    \r\n                    picker = new FilePicker( options );\r\n    \r\n                    picker.once( 'ready', deferred.resolve );\r\n                    picker.on( 'select', function( files ) {\r\n                        me.owner.request( 'add-file', [ files ]);\r\n                    });\r\n                    picker.on('dialogopen', function() {\r\n                        me.owner.trigger('dialogOpen', picker.button);\r\n                    });\r\n                    picker.init();\r\n    \r\n                    me.pickers.push( picker );\r\n    \r\n                    promises.push( deferred.promise() );\r\n                });\r\n    \r\n                return Base.when.apply( Base, promises );\r\n            },\r\n    \r\n            disable: function() {\r\n                $.each( this.pickers, function() {\r\n                    this.disable();\r\n                });\r\n            },\r\n    \r\n            enable: function() {\r\n                $.each( this.pickers, function() {\r\n                    this.enable();\r\n                });\r\n            },\r\n    \r\n            destroy: function() {\r\n                $.each( this.pickers, function() {\r\n                    this.destroy();\r\n                });\r\n                this.pickers = null;\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview Image\r\n     */\r\n    define('lib/image',[\r\n        'base',\r\n        'runtime/client',\r\n        'lib/blob'\r\n    ], function( Base, RuntimeClient, Blob ) {\r\n        var $ = Base.$;\r\n    \r\n        // 构造器。\r\n        function Image( opts ) {\r\n            this.options = $.extend({}, Image.options, opts );\r\n            RuntimeClient.call( this, 'Image' );\r\n    \r\n            this.on( 'load', function() {\r\n                this._info = this.exec('info');\r\n                this._meta = this.exec('meta');\r\n            });\r\n        }\r\n    \r\n        // 默认选项。\r\n        Image.options = {\r\n    \r\n            // 默认的图片处理质量\r\n            quality: 90,\r\n    \r\n            // 是否裁剪\r\n            crop: false,\r\n    \r\n            // 是否保留头部信息\r\n            preserveHeaders: false,\r\n    \r\n            // 是否允许放大。\r\n            allowMagnify: false\r\n        };\r\n    \r\n        // 继承RuntimeClient.\r\n        Base.inherits( RuntimeClient, {\r\n            constructor: Image,\r\n    \r\n            info: function( val ) {\r\n    \r\n                // setter\r\n                if ( val ) {\r\n                    this._info = val;\r\n                    return this;\r\n                }\r\n    \r\n                // getter\r\n                return this._info;\r\n            },\r\n    \r\n            meta: function( val ) {\r\n    \r\n                // setter\r\n                if ( val ) {\r\n                    this._meta = val;\r\n                    return this;\r\n                }\r\n    \r\n                // getter\r\n                return this._meta;\r\n            },\r\n    \r\n            loadFromBlob: function( blob ) {\r\n                var me = this,\r\n                    ruid = blob.getRuid();\r\n    \r\n                this.connectRuntime( ruid, function() {\r\n                    me.exec( 'init', me.options );\r\n                    me.exec( 'loadFromBlob', blob );\r\n                });\r\n            },\r\n    \r\n            resize: function() {\r\n                var args = Base.slice( arguments );\r\n                return this.exec.apply( this, [ 'resize' ].concat( args ) );\r\n            },\r\n    \r\n            crop: function() {\r\n                var args = Base.slice( arguments );\r\n                return this.exec.apply( this, [ 'crop' ].concat( args ) );\r\n            },\r\n    \r\n            getAsDataUrl: function( type ) {\r\n                return this.exec( 'getAsDataUrl', type );\r\n            },\r\n    \r\n            getAsBlob: function( type ) {\r\n                var blob = this.exec( 'getAsBlob', type );\r\n    \r\n                return new Blob( this.getRuid(), blob );\r\n            }\r\n        });\r\n    \r\n        return Image;\r\n    });\r\n    /**\r\n     * @fileOverview 图片操作, 负责预览图片和上传前压缩图片\r\n     */\r\n    define('widgets/image',[\r\n        'base',\r\n        'uploader',\r\n        'lib/image',\r\n        'widgets/widget'\r\n    ], function( Base, Uploader, Image ) {\r\n    \r\n        var $ = Base.$,\r\n            throttle;\r\n    \r\n        // 根据要处理的文件大小来节流，一次不能处理太多，会卡。\r\n        throttle = (function( max ) {\r\n            var occupied = 0,\r\n                waiting = [],\r\n                tick = function() {\r\n                    var item;\r\n    \r\n                    while ( waiting.length && occupied < max ) {\r\n                        item = waiting.shift();\r\n                        occupied += item[ 0 ];\r\n                        item[ 1 ]();\r\n                    }\r\n                };\r\n    \r\n            return function( emiter, size, cb ) {\r\n                waiting.push([ size, cb ]);\r\n                emiter.once( 'destroy', function() {\r\n                    occupied -= size;\r\n                    setTimeout( tick, 1 );\r\n                });\r\n                setTimeout( tick, 1 );\r\n            };\r\n        })( 5 * 1024 * 1024 );\r\n    \r\n        $.extend( Uploader.options, {\r\n    \r\n            /**\r\n             * @property {Object} [thumb]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 配置生成缩略图的选项。\r\n             *\r\n             * 默认为：\r\n             *\r\n             * ```javascript\r\n             * {\r\n             *     width: 110,\r\n             *     height: 110,\r\n             *\r\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\r\n             *     quality: 70,\r\n             *\r\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\r\n             *     allowMagnify: true,\r\n             *\r\n             *     // 是否允许裁剪。\r\n             *     crop: true,\r\n             *\r\n             *     // 为空的话则保留原有图片格式。\r\n             *     // 否则强制转换成指定的类型。\r\n             *     type: 'image/jpeg'\r\n             * }\r\n             * ```\r\n             */\r\n            thumb: {\r\n                width: 110,\r\n                height: 110,\r\n                quality: 70,\r\n                allowMagnify: true,\r\n                crop: true,\r\n                preserveHeaders: false,\r\n    \r\n                // 为空的话则保留原有图片格式。\r\n                // 否则强制转换成指定的类型。\r\n                // IE 8下面 base64 大小不能超过 32K 否则预览失败，而非 jpeg 编码的图片很可\r\n                // 能会超过 32k, 所以这里设置成预览的时候都是 image/jpeg\r\n                type: 'image/jpeg'\r\n            },\r\n    \r\n            /**\r\n             * @property {Object} [compress]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 配置压缩的图片的选项。如果此选项为`false`, 则图片在上传前不进行压缩。\r\n             *\r\n             * 默认为：\r\n             *\r\n             * ```javascript\r\n             * {\r\n             *     width: 1600,\r\n             *     height: 1600,\r\n             *\r\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\r\n             *     quality: 90,\r\n             *\r\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\r\n             *     allowMagnify: false,\r\n             *\r\n             *     // 是否允许裁剪。\r\n             *     crop: false,\r\n             *\r\n             *     // 是否保留头部meta信息。\r\n             *     preserveHeaders: true,\r\n             *\r\n             *     // 如果发现压缩后文件大小比原来还大，则使用原来图片\r\n             *     // 此属性可能会影响图片自动纠正功能\r\n             *     noCompressIfLarger: false,\r\n             *\r\n             *     // 单位字节，如果图片大小小于此值，不会采用压缩。\r\n             *     compressSize: 0\r\n             * }\r\n             * ```\r\n             */\r\n            compress: {\r\n                width: 1600,\r\n                height: 1600,\r\n                quality: 90,\r\n                allowMagnify: false,\r\n                crop: false,\r\n                preserveHeaders: true\r\n            }\r\n        });\r\n    \r\n        return Uploader.register({\r\n    \r\n            name: 'image',\r\n    \r\n    \r\n            /**\r\n             * 生成缩略图，此过程为异步，所以需要传入`callback`。\r\n             * 通常情况在图片加入队里后调用此方法来生成预览图以增强交互效果。\r\n             *\r\n             * 当 width 或者 height 的值介于 0 - 1 时，被当成百分比使用。\r\n             *\r\n             * `callback`中可以接收到两个参数。\r\n             * * 第一个为error，如果生成缩略图有错误，此error将为真。\r\n             * * 第二个为ret, 缩略图的Data URL值。\r\n             *\r\n             * **注意**\r\n             * Date URL在IE6/7中不支持，所以不用调用此方法了，直接显示一张暂不支持预览图片好了。\r\n             * 也可以借助服务端，将 base64 数据传给服务端，生成一个临时文件供预览。\r\n             *\r\n             * @method makeThumb\r\n             * @grammar makeThumb( file, callback ) => undefined\r\n             * @grammar makeThumb( file, callback, width, height ) => undefined\r\n             * @for Uploader\r\n             * @example\r\n             *\r\n             * uploader.on( 'fileQueued', function( file ) {\r\n             *     var $li = ...;\r\n             *\r\n             *     uploader.makeThumb( file, function( error, ret ) {\r\n             *         if ( error ) {\r\n             *             $li.text('预览错误');\r\n             *         } else {\r\n             *             $li.append('<img alt=\"\" src=\"' + ret + '\" />');\r\n             *         }\r\n             *     });\r\n             *\r\n             * });\r\n             */\r\n            makeThumb: function( file, cb, width, height ) {\r\n                var opts, image;\r\n    \r\n                file = this.request( 'get-file', file );\r\n    \r\n                // 只预览图片格式。\r\n                if ( !file.type.match( /^image/ ) ) {\r\n                    cb( true );\r\n                    return;\r\n                }\r\n    \r\n                opts = $.extend({}, this.options.thumb );\r\n    \r\n                // 如果传入的是object.\r\n                if ( $.isPlainObject( width ) ) {\r\n                    opts = $.extend( opts, width );\r\n                    width = null;\r\n                }\r\n    \r\n                width = width || opts.width;\r\n                height = height || opts.height;\r\n    \r\n                image = new Image( opts );\r\n    \r\n                image.once( 'load', function() {\r\n                    file._info = file._info || image.info();\r\n                    file._meta = file._meta || image.meta();\r\n    \r\n                    // 如果 width 的值介于 0 - 1\r\n                    // 说明设置的是百分比。\r\n                    if ( width <= 1 && width > 0 ) {\r\n                        width = file._info.width * width;\r\n                    }\r\n    \r\n                    // 同样的规则应用于 height\r\n                    if ( height <= 1 && height > 0 ) {\r\n                        height = file._info.height * height;\r\n                    }\r\n    \r\n                    image.resize( width, height );\r\n                });\r\n    \r\n                // 当 resize 完后\r\n                image.once( 'complete', function() {\r\n                    cb( false, image.getAsDataUrl( opts.type ) );\r\n                    image.destroy();\r\n                });\r\n    \r\n                image.once( 'error', function( reason ) {\r\n                    cb( reason || true );\r\n                    image.destroy();\r\n                });\r\n    \r\n                throttle( image, file.source.size, function() {\r\n                    file._info && image.info( file._info );\r\n                    file._meta && image.meta( file._meta );\r\n                    image.loadFromBlob( file.source );\r\n                });\r\n            },\r\n    \r\n            beforeSendFile: function( file ) {\r\n                var opts = this.options.compress || this.options.resize,\r\n                    compressSize = opts && opts.compressSize || 0,\r\n                    noCompressIfLarger = opts && opts.noCompressIfLarger || false,\r\n                    image, deferred;\r\n    \r\n                file = this.request( 'get-file', file );\r\n    \r\n                // 只压缩 jpeg 图片格式。\r\n                // gif 可能会丢失针\r\n                // bmp png 基本上尺寸都不大，且压缩比比较小。\r\n                if ( !opts || !~'image/jpeg,image/jpg'.indexOf( file.type ) ||\r\n                        file.size < compressSize ||\r\n                        file._compressed ) {\r\n                    return;\r\n                }\r\n    \r\n                opts = $.extend({}, opts );\r\n                deferred = Base.Deferred();\r\n    \r\n                image = new Image( opts );\r\n    \r\n                deferred.always(function() {\r\n                    image.destroy();\r\n                    image = null;\r\n                });\r\n                image.once( 'error', deferred.reject );\r\n                image.once( 'load', function() {\r\n                    var width = opts.width,\r\n                        height = opts.height;\r\n    \r\n                    file._info = file._info || image.info();\r\n                    file._meta = file._meta || image.meta();\r\n    \r\n                    // 如果 width 的值介于 0 - 1\r\n                    // 说明设置的是百分比。\r\n                    if ( width <= 1 && width > 0 ) {\r\n                        width = file._info.width * width;\r\n                    }\r\n    \r\n                    // 同样的规则应用于 height\r\n                    if ( height <= 1 && height > 0 ) {\r\n                        height = file._info.height * height;\r\n                    }\r\n    \r\n                    image.resize( width, height );\r\n                });\r\n    \r\n                image.once( 'complete', function() {\r\n                    var blob, size;\r\n    \r\n                    // 移动端 UC / qq 浏览器的无图模式下\r\n                    // ctx.getImageData 处理大图的时候会报 Exception\r\n                    // INDEX_SIZE_ERR: DOM Exception 1\r\n                    try {\r\n                        blob = image.getAsBlob( opts.type );\r\n    \r\n                        size = file.size;\r\n    \r\n                        // 如果压缩后，比原来还大则不用压缩后的。\r\n                        if ( !noCompressIfLarger || blob.size < size ) {\r\n                            // file.source.destroy && file.source.destroy();\r\n                            file.source = blob;\r\n                            file.size = blob.size;\r\n    \r\n                            file.trigger( 'resize', blob.size, size );\r\n                        }\r\n    \r\n                        // 标记，避免重复压缩。\r\n                        file._compressed = true;\r\n                        deferred.resolve();\r\n                    } catch ( e ) {\r\n                        // 出错了直接继续，让其上传原始图片\r\n                        deferred.resolve();\r\n                    }\r\n                });\r\n    \r\n                file._info && image.info( file._info );\r\n                file._meta && image.meta( file._meta );\r\n    \r\n                image.loadFromBlob( file.source );\r\n                return deferred.promise();\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview 文件属性封装\r\n     */\r\n    define('file',[\r\n        'base',\r\n        'mediator'\r\n    ], function( Base, Mediator ) {\r\n    \r\n        var $ = Base.$,\r\n            idPrefix = 'WU_FILE_',\r\n            idSuffix = 0,\r\n            rExt = /\\.([^.]+)$/,\r\n            statusMap = {};\r\n    \r\n        function gid() {\r\n            return idPrefix + idSuffix++;\r\n        }\r\n    \r\n        /**\r\n         * 文件类\r\n         * @class File\r\n         * @constructor 构造函数\r\n         * @grammar new File( source ) => File\r\n         * @param {Lib.File} source [lib.File](#Lib.File)实例, 此source对象是带有Runtime信息的。\r\n         */\r\n        function WUFile( source ) {\r\n    \r\n            /**\r\n             * 文件名，包括扩展名（后缀）\r\n             * @property name\r\n             * @type {string}\r\n             */\r\n            this.name = source.name || 'Untitled';\r\n    \r\n            /**\r\n             * 文件体积（字节）\r\n             * @property size\r\n             * @type {uint}\r\n             * @default 0\r\n             */\r\n            this.size = source.size || 0;\r\n    \r\n            /**\r\n             * 文件MIMETYPE类型，与文件类型的对应关系请参考[http://t.cn/z8ZnFny](http://t.cn/z8ZnFny)\r\n             * @property type\r\n             * @type {string}\r\n             * @default 'application/octet-stream'\r\n             */\r\n            this.type = source.type || 'application/octet-stream';\r\n    \r\n            /**\r\n             * 文件最后修改日期\r\n             * @property lastModifiedDate\r\n             * @type {int}\r\n             * @default 当前时间戳\r\n             */\r\n            this.lastModifiedDate = source.lastModifiedDate || (new Date() * 1);\r\n    \r\n            /**\r\n             * 文件ID，每个对象具有唯一ID，与文件名无关\r\n             * @property id\r\n             * @type {string}\r\n             */\r\n            this.id = gid();\r\n    \r\n            /**\r\n             * 文件扩展名，通过文件名获取，例如test.png的扩展名为png\r\n             * @property ext\r\n             * @type {string}\r\n             */\r\n            this.ext = rExt.exec( this.name ) ? RegExp.$1 : '';\r\n    \r\n    \r\n            /**\r\n             * 状态文字说明。在不同的status语境下有不同的用途。\r\n             * @property statusText\r\n             * @type {string}\r\n             */\r\n            this.statusText = '';\r\n    \r\n            // 存储文件状态，防止通过属性直接修改\r\n            statusMap[ this.id ] = WUFile.Status.INITED;\r\n    \r\n            this.source = source;\r\n            this.loaded = 0;\r\n    \r\n            this.on( 'error', function( msg ) {\r\n                this.setStatus( WUFile.Status.ERROR, msg );\r\n            });\r\n        }\r\n    \r\n        $.extend( WUFile.prototype, {\r\n    \r\n            /**\r\n             * 设置状态，状态变化时会触发`change`事件。\r\n             * @method setStatus\r\n             * @grammar setStatus( status[, statusText] );\r\n             * @param {File.Status|String} status [文件状态值](#WebUploader:File:File.Status)\r\n             * @param {String} [statusText=''] 状态说明，常在error时使用，用http, abort,server等来标记是由于什么原因导致文件错误。\r\n             */\r\n            setStatus: function( status, text ) {\r\n    \r\n                var prevStatus = statusMap[ this.id ];\r\n    \r\n                typeof text !== 'undefined' && (this.statusText = text);\r\n    \r\n                if ( status !== prevStatus ) {\r\n                    statusMap[ this.id ] = status;\r\n                    /**\r\n                     * 文件状态变化\r\n                     * @event statuschange\r\n                     */\r\n                    this.trigger( 'statuschange', status, prevStatus );\r\n                }\r\n    \r\n            },\r\n    \r\n            /**\r\n             * 获取文件状态\r\n             * @return {File.Status}\r\n             * @example\r\n                     文件状态具体包括以下几种类型：\r\n                     {\r\n                         // 初始化\r\n                        INITED:     0,\r\n                        // 已入队列\r\n                        QUEUED:     1,\r\n                        // 正在上传\r\n                        PROGRESS:     2,\r\n                        // 上传出错\r\n                        ERROR:         3,\r\n                        // 上传成功\r\n                        COMPLETE:     4,\r\n                        // 上传取消\r\n                        CANCELLED:     5\r\n                    }\r\n             */\r\n            getStatus: function() {\r\n                return statusMap[ this.id ];\r\n            },\r\n    \r\n            /**\r\n             * 获取文件原始信息。\r\n             * @return {*}\r\n             */\r\n            getSource: function() {\r\n                return this.source;\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.off();\r\n                delete statusMap[ this.id ];\r\n            }\r\n        });\r\n    \r\n        Mediator.installTo( WUFile.prototype );\r\n    \r\n        /**\r\n         * 文件状态值，具体包括以下几种类型：\r\n         * * `inited` 初始状态\r\n         * * `queued` 已经进入队列, 等待上传\r\n         * * `progress` 上传中\r\n         * * `complete` 上传完成。\r\n         * * `error` 上传出错，可重试\r\n         * * `interrupt` 上传中断，可续传。\r\n         * * `invalid` 文件不合格，不能重试上传。会自动从队列中移除。\r\n         * * `cancelled` 文件被移除。\r\n         * @property {Object} Status\r\n         * @namespace File\r\n         * @class File\r\n         * @static\r\n         */\r\n        WUFile.Status = {\r\n            INITED:     'inited',    // 初始状态\r\n            QUEUED:     'queued',    // 已经进入队列, 等待上传\r\n            PROGRESS:   'progress',    // 上传中\r\n            ERROR:      'error',    // 上传出错，可重试\r\n            COMPLETE:   'complete',    // 上传完成。\r\n            CANCELLED:  'cancelled',    // 上传取消。\r\n            INTERRUPT:  'interrupt',    // 上传中断，可续传。\r\n            INVALID:    'invalid'    // 文件不合格，不能重试上传。\r\n        };\r\n    \r\n        return WUFile;\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview 文件队列\r\n     */\r\n    define('queue',[\r\n        'base',\r\n        'mediator',\r\n        'file'\r\n    ], function( Base, Mediator, WUFile ) {\r\n    \r\n        var $ = Base.$,\r\n            STATUS = WUFile.Status;\r\n    \r\n        /**\r\n         * 文件队列, 用来存储各个状态中的文件。\r\n         * @class Queue\r\n         * @extends Mediator\r\n         */\r\n        function Queue() {\r\n    \r\n            /**\r\n             * 统计文件数。\r\n             * * `numOfQueue` 队列中的文件数。\r\n             * * `numOfSuccess` 上传成功的文件数\r\n             * * `numOfCancel` 被取消的文件数\r\n             * * `numOfProgress` 正在上传中的文件数\r\n             * * `numOfUploadFailed` 上传错误的文件数。\r\n             * * `numOfInvalid` 无效的文件数。\r\n             * * `numofDeleted` 被移除的文件数。\r\n             * @property {Object} stats\r\n             */\r\n            this.stats = {\r\n                numOfQueue: 0,\r\n                numOfSuccess: 0,\r\n                numOfCancel: 0,\r\n                numOfProgress: 0,\r\n                numOfUploadFailed: 0,\r\n                numOfInvalid: 0,\r\n                numofDeleted: 0,\r\n                numofInterrupt: 0\r\n            };\r\n    \r\n            // 上传队列，仅包括等待上传的文件\r\n            this._queue = [];\r\n    \r\n            // 存储所有文件\r\n            this._map = {};\r\n        }\r\n    \r\n        $.extend( Queue.prototype, {\r\n    \r\n            /**\r\n             * 将新文件加入对队列尾部\r\n             *\r\n             * @method append\r\n             * @param  {File} file   文件对象\r\n             */\r\n            append: function( file ) {\r\n                this._queue.push( file );\r\n                this._fileAdded( file );\r\n                return this;\r\n            },\r\n    \r\n            /**\r\n             * 将新文件加入对队列头部\r\n             *\r\n             * @method prepend\r\n             * @param  {File} file   文件对象\r\n             */\r\n            prepend: function( file ) {\r\n                this._queue.unshift( file );\r\n                this._fileAdded( file );\r\n                return this;\r\n            },\r\n    \r\n            /**\r\n             * 获取文件对象\r\n             *\r\n             * @method getFile\r\n             * @param  {String} fileId   文件ID\r\n             * @return {File}\r\n             */\r\n            getFile: function( fileId ) {\r\n                if ( typeof fileId !== 'string' ) {\r\n                    return fileId;\r\n                }\r\n                return this._map[ fileId ];\r\n            },\r\n    \r\n            /**\r\n             * 从队列中取出一个指定状态的文件。\r\n             * @grammar fetch( status ) => File\r\n             * @method fetch\r\n             * @param {String} status [文件状态值](#WebUploader:File:File.Status)\r\n             * @return {File} [File](#WebUploader:File)\r\n             */\r\n            fetch: function( status ) {\r\n                var len = this._queue.length,\r\n                    i, file;\r\n    \r\n                status = status || STATUS.QUEUED;\r\n    \r\n                for ( i = 0; i < len; i++ ) {\r\n                    file = this._queue[ i ];\r\n    \r\n                    if ( status === file.getStatus() ) {\r\n                        return file;\r\n                    }\r\n                }\r\n    \r\n                return null;\r\n            },\r\n    \r\n            /**\r\n             * 对队列进行排序，能够控制文件上传顺序。\r\n             * @grammar sort( fn ) => undefined\r\n             * @method sort\r\n             * @param {Function} fn 排序方法\r\n             */\r\n            sort: function( fn ) {\r\n                if ( typeof fn === 'function' ) {\r\n                    this._queue.sort( fn );\r\n                }\r\n            },\r\n    \r\n            /**\r\n             * 获取指定类型的文件列表, 列表中每一个成员为[File](#WebUploader:File)对象。\r\n             * @grammar getFiles( [status1[, status2 ...]] ) => Array\r\n             * @method getFiles\r\n             * @param {String} [status] [文件状态值](#WebUploader:File:File.Status)\r\n             */\r\n            getFiles: function() {\r\n                var sts = [].slice.call( arguments, 0 ),\r\n                    ret = [],\r\n                    i = 0,\r\n                    len = this._queue.length,\r\n                    file;\r\n    \r\n                for ( ; i < len; i++ ) {\r\n                    file = this._queue[ i ];\r\n    \r\n                    if ( sts.length && !~$.inArray( file.getStatus(), sts ) ) {\r\n                        continue;\r\n                    }\r\n    \r\n                    ret.push( file );\r\n                }\r\n    \r\n                return ret;\r\n            },\r\n    \r\n            /**\r\n             * 在队列中删除文件。\r\n             * @grammar removeFile( file ) => Array\r\n             * @method removeFile\r\n             * @param {File} 文件对象。\r\n             */\r\n            removeFile: function( file ) {\r\n                var me = this,\r\n                    existing = this._map[ file.id ];\r\n    \r\n                if ( existing ) {\r\n                    delete this._map[ file.id ];\r\n                    file.destroy();\r\n                    this.stats.numofDeleted++;\r\n                }\r\n            },\r\n    \r\n            _fileAdded: function( file ) {\r\n                var me = this,\r\n                    existing = this._map[ file.id ];\r\n    \r\n                if ( !existing ) {\r\n                    this._map[ file.id ] = file;\r\n    \r\n                    file.on( 'statuschange', function( cur, pre ) {\r\n                        me._onFileStatusChange( cur, pre );\r\n                    });\r\n                }\r\n            },\r\n    \r\n            _onFileStatusChange: function( curStatus, preStatus ) {\r\n                var stats = this.stats;\r\n    \r\n                switch ( preStatus ) {\r\n                    case STATUS.PROGRESS:\r\n                        stats.numOfProgress--;\r\n                        break;\r\n    \r\n                    case STATUS.QUEUED:\r\n                        stats.numOfQueue --;\r\n                        break;\r\n    \r\n                    case STATUS.ERROR:\r\n                        stats.numOfUploadFailed--;\r\n                        break;\r\n    \r\n                    case STATUS.INVALID:\r\n                        stats.numOfInvalid--;\r\n                        break;\r\n    \r\n                    case STATUS.INTERRUPT:\r\n                        stats.numofInterrupt--;\r\n                        break;\r\n                }\r\n    \r\n                switch ( curStatus ) {\r\n                    case STATUS.QUEUED:\r\n                        stats.numOfQueue++;\r\n                        break;\r\n    \r\n                    case STATUS.PROGRESS:\r\n                        stats.numOfProgress++;\r\n                        break;\r\n    \r\n                    case STATUS.ERROR:\r\n                        stats.numOfUploadFailed++;\r\n                        break;\r\n    \r\n                    case STATUS.COMPLETE:\r\n                        stats.numOfSuccess++;\r\n                        break;\r\n    \r\n                    case STATUS.CANCELLED:\r\n                        stats.numOfCancel++;\r\n                        break;\r\n    \r\n    \r\n                    case STATUS.INVALID:\r\n                        stats.numOfInvalid++;\r\n                        break;\r\n    \r\n                    case STATUS.INTERRUPT:\r\n                        stats.numofInterrupt++;\r\n                        break;\r\n                }\r\n            }\r\n    \r\n        });\r\n    \r\n        Mediator.installTo( Queue.prototype );\r\n    \r\n        return Queue;\r\n    });\r\n    /**\r\n     * @fileOverview 队列\r\n     */\r\n    define('widgets/queue',[\r\n        'base',\r\n        'uploader',\r\n        'queue',\r\n        'file',\r\n        'lib/file',\r\n        'runtime/client',\r\n        'widgets/widget'\r\n    ], function( Base, Uploader, Queue, WUFile, File, RuntimeClient ) {\r\n    \r\n        var $ = Base.$,\r\n            rExt = /\\.\\w+$/,\r\n            Status = WUFile.Status;\r\n    \r\n        return Uploader.register({\r\n            name: 'queue',\r\n    \r\n            init: function( opts ) {\r\n                var me = this,\r\n                    deferred, len, i, item, arr, accept, runtime;\r\n    \r\n                if ( $.isPlainObject( opts.accept ) ) {\r\n                    opts.accept = [ opts.accept ];\r\n                }\r\n    \r\n                // accept中的中生成匹配正则。\r\n                if ( opts.accept ) {\r\n                    arr = [];\r\n    \r\n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\r\n                        item = opts.accept[ i ].extensions;\r\n                        item && arr.push( item );\r\n                    }\r\n    \r\n                    if ( arr.length ) {\r\n                        accept = '\\\\.' + arr.join(',')\r\n                                .replace( /,/g, '$|\\\\.' )\r\n                                .replace( /\\*/g, '.*' ) + '$';\r\n                    }\r\n    \r\n                    me.accept = new RegExp( accept, 'i' );\r\n                }\r\n    \r\n                me.queue = new Queue();\r\n                me.stats = me.queue.stats;\r\n    \r\n                // 如果当前不是html5运行时，那就算了。\r\n                // 不执行后续操作\r\n                if ( this.request('predict-runtime-type') !== 'html5' ) {\r\n                    return;\r\n                }\r\n    \r\n                // 创建一个 html5 运行时的 placeholder\r\n                // 以至于外部添加原生 File 对象的时候能正确包裹一下供 webuploader 使用。\r\n                deferred = Base.Deferred();\r\n                this.placeholder = runtime = new RuntimeClient('Placeholder');\r\n                runtime.connectRuntime({\r\n                    runtimeOrder: 'html5'\r\n                }, function() {\r\n                    me._ruid = runtime.getRuid();\r\n                    deferred.resolve();\r\n                });\r\n                return deferred.promise();\r\n            },\r\n    \r\n    \r\n            // 为了支持外部直接添加一个原生File对象。\r\n            _wrapFile: function( file ) {\r\n                if ( !(file instanceof WUFile) ) {\r\n    \r\n                    if ( !(file instanceof File) ) {\r\n                        if ( !this._ruid ) {\r\n                            throw new Error('Can\\'t add external files.');\r\n                        }\r\n                        file = new File( this._ruid, file );\r\n                    }\r\n    \r\n                    file = new WUFile( file );\r\n                }\r\n    \r\n                return file;\r\n            },\r\n    \r\n            // 判断文件是否可以被加入队列\r\n            acceptFile: function( file ) {\r\n                var invalid = !file || !file.size || this.accept &&\r\n    \r\n                        // 如果名字中有后缀，才做后缀白名单处理。\r\n                        rExt.exec( file.name ) && !this.accept.test( file.name );\r\n    \r\n                return !invalid;\r\n            },\r\n    \r\n    \r\n            /**\r\n             * @event beforeFileQueued\r\n             * @param {File} file File对象\r\n             * @description 当文件被加入队列之前触发，此事件的handler返回值为`false`，则此文件不会被添加进入队列。\r\n             * @for  Uploader\r\n             */\r\n    \r\n            /**\r\n             * @event fileQueued\r\n             * @param {File} file File对象\r\n             * @description 当文件被加入队列以后触发。\r\n             * @for  Uploader\r\n             */\r\n    \r\n            _addFile: function( file ) {\r\n                var me = this;\r\n    \r\n                file = me._wrapFile( file );\r\n    \r\n                // 不过类型判断允许不允许，先派送 `beforeFileQueued`\r\n                if ( !me.owner.trigger( 'beforeFileQueued', file ) ) {\r\n                    return;\r\n                }\r\n    \r\n                // 类型不匹配，则派送错误事件，并返回。\r\n                if ( !me.acceptFile( file ) ) {\r\n                    me.owner.trigger( 'error', 'Q_TYPE_DENIED', file );\r\n                    return;\r\n                }\r\n    \r\n                me.queue.append( file );\r\n                me.owner.trigger( 'fileQueued', file );\r\n                return file;\r\n            },\r\n    \r\n            getFile: function( fileId ) {\r\n                return this.queue.getFile( fileId );\r\n            },\r\n    \r\n            /**\r\n             * @event filesQueued\r\n             * @param {File} files 数组，内容为原始File(lib/File）对象。\r\n             * @description 当一批文件添加进队列以后触发。\r\n             * @for  Uploader\r\n             */\r\n            \r\n            /**\r\n             * @property {Boolean} [auto=false]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 设置为 true 后，不需要手动调用上传，有文件选择即开始上传。\r\n             * \r\n             */\r\n    \r\n            /**\r\n             * @method addFiles\r\n             * @grammar addFiles( file ) => undefined\r\n             * @grammar addFiles( [file1, file2 ...] ) => undefined\r\n             * @param {Array of File or File} [files] Files 对象 数组\r\n             * @description 添加文件到队列\r\n             * @for  Uploader\r\n             */\r\n            addFile: function( files ) {\r\n                var me = this;\r\n    \r\n                if ( !files.length ) {\r\n                    files = [ files ];\r\n                }\r\n    \r\n                files = $.map( files, function( file ) {\r\n                    return me._addFile( file );\r\n                });\r\n    \t\t\t\r\n    \t\t\tif ( files.length ) {\r\n    \r\n                    me.owner.trigger( 'filesQueued', files );\r\n    \r\n    \t\t\t\tif ( me.options.auto ) {\r\n    \t\t\t\t\tsetTimeout(function() {\r\n    \t\t\t\t\t\tme.request('start-upload');\r\n    \t\t\t\t\t}, 20 );\r\n    \t\t\t\t}\r\n                }\r\n            },\r\n    \r\n            getStats: function() {\r\n                return this.stats;\r\n            },\r\n    \r\n            /**\r\n             * @event fileDequeued\r\n             * @param {File} file File对象\r\n             * @description 当文件被移除队列后触发。\r\n             * @for  Uploader\r\n             */\r\n    \r\n             /**\r\n             * @method removeFile\r\n             * @grammar removeFile( file ) => undefined\r\n             * @grammar removeFile( id ) => undefined\r\n             * @grammar removeFile( file, true ) => undefined\r\n             * @grammar removeFile( id, true ) => undefined\r\n             * @param {File|id} file File对象或这File对象的id\r\n             * @description 移除某一文件, 默认只会标记文件状态为已取消，如果第二个参数为 `true` 则会从 queue 中移除。\r\n             * @for  Uploader\r\n             * @example\r\n             *\r\n             * $li.on('click', '.remove-this', function() {\r\n             *     uploader.removeFile( file );\r\n             * })\r\n             */\r\n            removeFile: function( file, remove ) {\r\n                var me = this;\r\n    \r\n                file = file.id ? file : me.queue.getFile( file );\r\n    \r\n                this.request( 'cancel-file', file );\r\n    \r\n                if ( remove ) {\r\n                    this.queue.removeFile( file );\r\n                }\r\n            },\r\n    \r\n            /**\r\n             * @method getFiles\r\n             * @grammar getFiles() => Array\r\n             * @grammar getFiles( status1, status2, status... ) => Array\r\n             * @description 返回指定状态的文件集合，不传参数将返回所有状态的文件。\r\n             * @for  Uploader\r\n             * @example\r\n             * console.log( uploader.getFiles() );    // => all files\r\n             * console.log( uploader.getFiles('error') )    // => all error files.\r\n             */\r\n            getFiles: function() {\r\n                return this.queue.getFiles.apply( this.queue, arguments );\r\n            },\r\n    \r\n            fetchFile: function() {\r\n                return this.queue.fetch.apply( this.queue, arguments );\r\n            },\r\n    \r\n            /**\r\n             * @method retry\r\n             * @grammar retry() => undefined\r\n             * @grammar retry( file ) => undefined\r\n             * @description 重试上传，重试指定文件，或者从出错的文件开始重新上传。\r\n             * @for  Uploader\r\n             * @example\r\n             * function retry() {\r\n             *     uploader.retry();\r\n             * }\r\n             */\r\n            retry: function( file, noForceStart ) {\r\n                var me = this,\r\n                    files, i, len;\r\n    \r\n                if ( file ) {\r\n                    file = file.id ? file : me.queue.getFile( file );\r\n                    file.setStatus( Status.QUEUED );\r\n                    noForceStart || me.request('start-upload');\r\n                    return;\r\n                }\r\n    \r\n                files = me.queue.getFiles( Status.ERROR );\r\n                i = 0;\r\n                len = files.length;\r\n    \r\n                for ( ; i < len; i++ ) {\r\n                    file = files[ i ];\r\n                    file.setStatus( Status.QUEUED );\r\n                }\r\n    \r\n                me.request('start-upload');\r\n            },\r\n    \r\n            /**\r\n             * @method sort\r\n             * @grammar sort( fn ) => undefined\r\n             * @description 排序队列中的文件，在上传之前调整可以控制上传顺序。\r\n             * @for  Uploader\r\n             */\r\n            sortFiles: function() {\r\n                return this.queue.sort.apply( this.queue, arguments );\r\n            },\r\n    \r\n            /**\r\n             * @event reset\r\n             * @description 当 uploader 被重置的时候触发。\r\n             * @for  Uploader\r\n             */\r\n    \r\n            /**\r\n             * @method reset\r\n             * @grammar reset() => undefined\r\n             * @description 重置uploader。目前只重置了队列。\r\n             * @for  Uploader\r\n             * @example\r\n             * uploader.reset();\r\n             */\r\n            reset: function() {\r\n                this.owner.trigger('reset');\r\n                this.queue = new Queue();\r\n                this.stats = this.queue.stats;\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.reset();\r\n                this.placeholder && this.placeholder.destroy();\r\n            }\r\n        });\r\n    \r\n    });\r\n    /**\r\n     * @fileOverview 添加获取Runtime相关信息的方法。\r\n     */\r\n    define('widgets/runtime',[\r\n        'uploader',\r\n        'runtime/runtime',\r\n        'widgets/widget'\r\n    ], function( Uploader, Runtime ) {\r\n    \r\n        Uploader.support = function() {\r\n            return Runtime.hasRuntime.apply( Runtime, arguments );\r\n        };\r\n    \r\n        /**\r\n         * @property {Object} [runtimeOrder=html5,flash]\r\n         * @namespace options\r\n         * @for Uploader\r\n         * @description 指定运行时启动顺序。默认会想尝试 html5 是否支持，如果支持则使用 html5, 否则则使用 flash.\r\n         *\r\n         * 可以将此值设置成 `flash`，来强制使用 flash 运行时。\r\n         */\r\n    \r\n        return Uploader.register({\r\n            name: 'runtime',\r\n    \r\n            init: function() {\r\n                if ( !this.predictRuntimeType() ) {\r\n                    throw Error('Runtime Error');\r\n                }\r\n            },\r\n    \r\n            /**\r\n             * 预测Uploader将采用哪个`Runtime`\r\n             * @grammar predictRuntimeType() => String\r\n             * @method predictRuntimeType\r\n             * @for  Uploader\r\n             */\r\n            predictRuntimeType: function() {\r\n                var orders = this.options.runtimeOrder || Runtime.orders,\r\n                    type = this.type,\r\n                    i, len;\r\n    \r\n                if ( !type ) {\r\n                    orders = orders.split( /\\s*,\\s*/g );\r\n    \r\n                    for ( i = 0, len = orders.length; i < len; i++ ) {\r\n                        if ( Runtime.hasRuntime( orders[ i ] ) ) {\r\n                            this.type = type = orders[ i ];\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                return type;\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview Transport\r\n     */\r\n    define('lib/transport',[\r\n        'base',\r\n        'runtime/client',\r\n        'mediator'\r\n    ], function( Base, RuntimeClient, Mediator ) {\r\n    \r\n        var $ = Base.$;\r\n    \r\n        function Transport( opts ) {\r\n            var me = this;\r\n    \r\n            opts = me.options = $.extend( true, {}, Transport.options, opts || {} );\r\n            RuntimeClient.call( this, 'Transport' );\r\n    \r\n            this._blob = null;\r\n            this._formData = opts.formData || {};\r\n            this._headers = opts.headers || {};\r\n    \r\n            this.on( 'progress', this._timeout );\r\n            this.on( 'load error', function() {\r\n                me.trigger( 'progress', 1 );\r\n                clearTimeout( me._timer );\r\n            });\r\n        }\r\n    \r\n        Transport.options = {\r\n            server: '',\r\n            method: 'POST',\r\n    \r\n            // 跨域时，是否允许携带cookie, 只有html5 runtime才有效\r\n            withCredentials: false,\r\n            fileVal: 'file',\r\n            timeout: 2 * 60 * 1000,    // 2分钟\r\n            formData: {},\r\n            headers: {},\r\n            sendAsBinary: false\r\n        };\r\n    \r\n        $.extend( Transport.prototype, {\r\n    \r\n            // 添加Blob, 只能添加一次，最后一次有效。\r\n            appendBlob: function( key, blob, filename ) {\r\n                var me = this,\r\n                    opts = me.options;\r\n    \r\n                if ( me.getRuid() ) {\r\n                    me.disconnectRuntime();\r\n                }\r\n    \r\n                // 连接到blob归属的同一个runtime.\r\n                me.connectRuntime( blob.ruid, function() {\r\n                    me.exec('init');\r\n                });\r\n    \r\n                me._blob = blob;\r\n                opts.fileVal = key || opts.fileVal;\r\n                opts.filename = filename || opts.filename;\r\n            },\r\n    \r\n            // 添加其他字段\r\n            append: function( key, value ) {\r\n                if ( typeof key === 'object' ) {\r\n                    $.extend( this._formData, key );\r\n                } else {\r\n                    this._formData[ key ] = value;\r\n                }\r\n            },\r\n    \r\n            setRequestHeader: function( key, value ) {\r\n                if ( typeof key === 'object' ) {\r\n                    $.extend( this._headers, key );\r\n                } else {\r\n                    this._headers[ key ] = value;\r\n                }\r\n            },\r\n    \r\n            send: function( method ) {\r\n                this.exec( 'send', method );\r\n                this._timeout();\r\n            },\r\n    \r\n            abort: function() {\r\n                clearTimeout( this._timer );\r\n                return this.exec('abort');\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.trigger('destroy');\r\n                this.off();\r\n                this.exec('destroy');\r\n                this.disconnectRuntime();\r\n            },\r\n    \r\n            getResponse: function() {\r\n                return this.exec('getResponse');\r\n            },\r\n    \r\n            getResponseAsJson: function() {\r\n                return this.exec('getResponseAsJson');\r\n            },\r\n    \r\n            getStatus: function() {\r\n                return this.exec('getStatus');\r\n            },\r\n    \r\n            _timeout: function() {\r\n                var me = this,\r\n                    duration = me.options.timeout;\r\n    \r\n                if ( !duration ) {\r\n                    return;\r\n                }\r\n    \r\n                clearTimeout( me._timer );\r\n                me._timer = setTimeout(function() {\r\n                    me.abort();\r\n                    me.trigger( 'error', 'timeout' );\r\n                }, duration );\r\n            }\r\n    \r\n        });\r\n    \r\n        // 让Transport具备事件功能。\r\n        Mediator.installTo( Transport.prototype );\r\n    \r\n        return Transport;\r\n    });\r\n    /**\r\n     * @fileOverview 负责文件上传相关。\r\n     */\r\n    define('widgets/upload',[\r\n        'base',\r\n        'uploader',\r\n        'file',\r\n        'lib/transport',\r\n        'widgets/widget'\r\n    ], function( Base, Uploader, WUFile, Transport ) {\r\n    \r\n        var $ = Base.$,\r\n            isPromise = Base.isPromise,\r\n            Status = WUFile.Status;\r\n    \r\n        // 添加默认配置项\r\n        $.extend( Uploader.options, {\r\n    \r\n    \r\n            /**\r\n             * @property {Boolean} [prepareNextFile=false]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 是否允许在文件传输时提前把下一个文件准备好。\r\n             * 对于一个文件的准备工作比较耗时，比如图片压缩，md5序列化。\r\n             * 如果能提前在当前文件传输期处理，可以节省总体耗时。\r\n             */\r\n            prepareNextFile: false,\r\n    \r\n            /**\r\n             * @property {Boolean} [chunked=false]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 是否要分片处理大文件上传。\r\n             */\r\n            chunked: false,\r\n    \r\n            /**\r\n             * @property {Boolean} [chunkSize=5242880]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 如果要分片，分多大一片？ 默认大小为5M.\r\n             */\r\n            chunkSize: 5 * 1024 * 1024,\r\n    \r\n            /**\r\n             * @property {Boolean} [chunkRetry=2]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 如果某个分片由于网络问题出错，允许自动重传多少次？\r\n             */\r\n            chunkRetry: 2,\r\n    \r\n            /**\r\n             * @property {Boolean} [threads=3]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 上传并发数。允许同时最大上传进程数。\r\n             */\r\n            threads: 3,\r\n    \r\n    \r\n            /**\r\n             * @property {Object} [formData={}]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 文件上传请求的参数表，每次发送都会发送此对象中的参数。\r\n             */\r\n            formData: {}\r\n    \r\n            /**\r\n             * @property {Object} [fileVal='file']\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 设置文件上传域的name。\r\n             */\r\n    \r\n            /**\r\n             * @property {Object} [sendAsBinary=false]\r\n             * @namespace options\r\n             * @for Uploader\r\n             * @description 是否已二进制的流的方式发送文件，这样整个上传内容`php://input`都为文件内容，\r\n             * 其他参数在$_GET数组中。\r\n             */\r\n        });\r\n    \r\n        // 负责将文件切片。\r\n        function CuteFile( file, chunkSize ) {\r\n            var pending = [],\r\n                blob = file.source,\r\n                total = blob.size,\r\n                chunks = chunkSize ? Math.ceil( total / chunkSize ) : 1,\r\n                start = 0,\r\n                index = 0,\r\n                len, api;\r\n    \r\n            api = {\r\n                file: file,\r\n    \r\n                has: function() {\r\n                    return !!pending.length;\r\n                },\r\n    \r\n                shift: function() {\r\n                    return pending.shift();\r\n                },\r\n    \r\n                unshift: function( block ) {\r\n                    pending.unshift( block );\r\n                }\r\n            };\r\n    \r\n            while ( index < chunks ) {\r\n                len = Math.min( chunkSize, total - start );\r\n    \r\n                pending.push({\r\n                    file: file,\r\n                    start: start,\r\n                    end: chunkSize ? (start + len) : total,\r\n                    total: total,\r\n                    chunks: chunks,\r\n                    chunk: index++,\r\n                    cuted: api\r\n                });\r\n                start += len;\r\n            }\r\n    \r\n            file.blocks = pending.concat();\r\n            file.remaning = pending.length;\r\n    \r\n            return api;\r\n        }\r\n    \r\n        Uploader.register({\r\n            name: 'upload',\r\n    \r\n            init: function() {\r\n                var owner = this.owner,\r\n                    me = this;\r\n    \r\n                this.runing = false;\r\n                this.progress = false;\r\n    \r\n                owner\r\n                    .on( 'startUpload', function() {\r\n                        me.progress = true;\r\n                    })\r\n                    .on( 'uploadFinished', function() {\r\n                        me.progress = false;\r\n                    });\r\n    \r\n                // 记录当前正在传的数据，跟threads相关\r\n                this.pool = [];\r\n    \r\n                // 缓存分好片的文件。\r\n                this.stack = [];\r\n    \r\n                // 缓存即将上传的文件。\r\n                this.pending = [];\r\n    \r\n                // 跟踪还有多少分片在上传中但是没有完成上传。\r\n                this.remaning = 0;\r\n                this.__tick = Base.bindFn( this._tick, this );\r\n    \r\n                // 销毁上传相关的属性。\r\n                owner.on( 'uploadComplete', function( file ) {\r\n    \r\n                    // 把其他块取消了。\r\n                    file.blocks && $.each( file.blocks, function( _, v ) {\r\n                        v.transport && (v.transport.abort(), v.transport.destroy());\r\n                        delete v.transport;\r\n                    });\r\n    \r\n                    delete file.blocks;\r\n                    delete file.remaning;\r\n                });\r\n            },\r\n    \r\n            reset: function() {\r\n                this.request( 'stop-upload', true );\r\n                this.runing = false;\r\n                this.pool = [];\r\n                this.stack = [];\r\n                this.pending = [];\r\n                this.remaning = 0;\r\n                this._trigged = false;\r\n                this._promise = null;\r\n            },\r\n    \r\n            /**\r\n             * @event startUpload\r\n             * @description 当开始上传流程时触发。\r\n             * @for  Uploader\r\n             */\r\n    \r\n            /**\r\n             * 开始上传。此方法可以从初始状态调用开始上传流程，也可以从暂停状态调用，继续上传流程。\r\n             *\r\n             * 可以指定开始某一个文件。\r\n             * @grammar upload() => undefined\r\n             * @grammar upload( file | fileId) => undefined\r\n             * @method upload\r\n             * @for  Uploader\r\n             */\r\n            startUpload: function(file) {\r\n                var me = this;\r\n    \r\n                // 移出invalid的文件\r\n                $.each( me.request( 'get-files', Status.INVALID ), function() {\r\n                    me.request( 'remove-file', this );\r\n                });\r\n    \r\n                // 如果指定了开始某个文件，则只开始指定的文件。\r\n                if ( file ) {\r\n                    file = file.id ? file : me.request( 'get-file', file );\r\n    \r\n                    if (file.getStatus() === Status.INTERRUPT) {\r\n                        file.setStatus( Status.QUEUED );\r\n    \r\n                        $.each( me.pool, function( _, v ) {\r\n    \r\n                            // 之前暂停过。\r\n                            if (v.file !== file) {\r\n                                return;\r\n                            }\r\n    \r\n                            v.transport && v.transport.send();\r\n                            file.setStatus( Status.PROGRESS );\r\n                        });\r\n    \r\n                        \r\n                    } else if (file.getStatus() !== Status.PROGRESS) {\r\n                        file.setStatus( Status.QUEUED );\r\n                    }\r\n                } else {\r\n                    $.each( me.request( 'get-files', [ Status.INITED ] ), function() {\r\n                        this.setStatus( Status.QUEUED );\r\n                    });\r\n                }\r\n    \r\n                if ( me.runing ) {\r\n                    return Base.nextTick( me.__tick );\r\n                }\r\n    \r\n                me.runing = true;\r\n                var files = [];\r\n    \r\n                // 如果有暂停的，则续传\r\n                file || $.each( me.pool, function( _, v ) {\r\n                    var file = v.file;\r\n    \r\n                    if ( file.getStatus() === Status.INTERRUPT ) {\r\n                        me._trigged = false;\r\n                        files.push(file);\r\n                        v.transport && v.transport.send();\r\n                    }\r\n                });\r\n    \r\n                $.each(files, function() {\r\n                    this.setStatus( Status.PROGRESS );\r\n                });\r\n    \r\n                file || $.each( me.request( 'get-files',\r\n                        Status.INTERRUPT ), function() {\r\n                    this.setStatus( Status.PROGRESS );\r\n                });\r\n    \r\n                me._trigged = false;\r\n                Base.nextTick( me.__tick );\r\n                me.owner.trigger('startUpload');\r\n            },\r\n    \r\n            /**\r\n             * @event stopUpload\r\n             * @description 当开始上传流程暂停时触发。\r\n             * @for  Uploader\r\n             */\r\n    \r\n            /**\r\n             * 暂停上传。第一个参数为是否中断上传当前正在上传的文件。\r\n             *\r\n             * 如果第一个参数是文件，则只暂停指定文件。\r\n             * @grammar stop() => undefined\r\n             * @grammar stop( true ) => undefined\r\n             * @grammar stop( file ) => undefined\r\n             * @method stop\r\n             * @for  Uploader\r\n             */\r\n            stopUpload: function( file, interrupt ) {\r\n                var me = this,\r\n                    block;\r\n    \r\n                if (file === true) {\r\n                    interrupt = file;\r\n                    file = null;\r\n                }\r\n    \r\n                if ( me.runing === false ) {\r\n                    return;\r\n                }\r\n    \r\n                // 如果只是暂停某个文件。\r\n                if ( file ) {\r\n                    file = file.id ? file : me.request( 'get-file', file );\r\n    \r\n                    if ( file.getStatus() !== Status.PROGRESS &&\r\n                            file.getStatus() !== Status.QUEUED ) {\r\n                        return;\r\n                    }\r\n    \r\n                    file.setStatus( Status.INTERRUPT );\r\n    \r\n    \r\n                    $.each( me.pool, function( _, v ) {\r\n    \r\n                        // 只 abort 指定的文件。\r\n                        if (v.file === file) {\r\n                            block = v;\r\n                            return false;\r\n                        }\r\n                    });\r\n    \r\n                    block.transport && block.transport.abort();\r\n    \r\n                    if (interrupt) {\r\n                        me._putback(block);\r\n                        me._popBlock(block);\r\n                    }\r\n    \r\n                    return Base.nextTick( me.__tick );\r\n                }\r\n    \r\n                me.runing = false;\r\n    \r\n                // 正在准备中的文件。\r\n                if (this._promise && this._promise.file) {\r\n                    this._promise.file.setStatus( Status.INTERRUPT );\r\n                }\r\n    \r\n                interrupt && $.each( me.pool, function( _, v ) {\r\n                    v.transport && v.transport.abort();\r\n                    v.file.setStatus( Status.INTERRUPT );\r\n                });\r\n    \r\n                me.owner.trigger('stopUpload');\r\n            },\r\n    \r\n            /**\r\n             * @method cancelFile\r\n             * @grammar cancelFile( file ) => undefined\r\n             * @grammar cancelFile( id ) => undefined\r\n             * @param {File|id} file File对象或这File对象的id\r\n             * @description 标记文件状态为已取消, 同时将中断文件传输。\r\n             * @for  Uploader\r\n             * @example\r\n             *\r\n             * $li.on('click', '.remove-this', function() {\r\n             *     uploader.cancelFile( file );\r\n             * })\r\n             */\r\n            cancelFile: function( file ) {\r\n                file = file.id ? file : this.request( 'get-file', file );\r\n    \r\n                // 如果正在上传。\r\n                file.blocks && $.each( file.blocks, function( _, v ) {\r\n                    var _tr = v.transport;\r\n    \r\n                    if ( _tr ) {\r\n                        _tr.abort();\r\n                        _tr.destroy();\r\n                        delete v.transport;\r\n                    }\r\n                });\r\n    \r\n                file.setStatus( Status.CANCELLED );\r\n                this.owner.trigger( 'fileDequeued', file );\r\n            },\r\n    \r\n            /**\r\n             * 判断`Uplaode`r是否正在上传中。\r\n             * @grammar isInProgress() => Boolean\r\n             * @method isInProgress\r\n             * @for  Uploader\r\n             */\r\n            isInProgress: function() {\r\n                return !!this.progress;\r\n            },\r\n    \r\n            _getStats: function() {\r\n                return this.request('get-stats');\r\n            },\r\n    \r\n            /**\r\n             * 掉过一个文件上传，直接标记指定文件为已上传状态。\r\n             * @grammar skipFile( file ) => undefined\r\n             * @method skipFile\r\n             * @for  Uploader\r\n             */\r\n            skipFile: function( file, status ) {\r\n                file = file.id ? file : this.request( 'get-file', file );\r\n    \r\n                file.setStatus( status || Status.COMPLETE );\r\n                file.skipped = true;\r\n    \r\n                // 如果正在上传。\r\n                file.blocks && $.each( file.blocks, function( _, v ) {\r\n                    var _tr = v.transport;\r\n    \r\n                    if ( _tr ) {\r\n                        _tr.abort();\r\n                        _tr.destroy();\r\n                        delete v.transport;\r\n                    }\r\n                });\r\n    \r\n                this.owner.trigger( 'uploadSkip', file );\r\n            },\r\n    \r\n            /**\r\n             * @event uploadFinished\r\n             * @description 当所有文件上传结束时触发。\r\n             * @for  Uploader\r\n             */\r\n            _tick: function() {\r\n                var me = this,\r\n                    opts = me.options,\r\n                    fn, val;\r\n    \r\n                // 上一个promise还没有结束，则等待完成后再执行。\r\n                if ( me._promise ) {\r\n                    return me._promise.always( me.__tick );\r\n                }\r\n    \r\n                // 还有位置，且还有文件要处理的话。\r\n                if ( me.pool.length < opts.threads && (val = me._nextBlock()) ) {\r\n                    me._trigged = false;\r\n    \r\n                    fn = function( val ) {\r\n                        me._promise = null;\r\n    \r\n                        // 有可能是reject过来的，所以要检测val的类型。\r\n                        val && val.file && me._startSend( val );\r\n                        Base.nextTick( me.__tick );\r\n                    };\r\n    \r\n                    me._promise = isPromise( val ) ? val.always( fn ) : fn( val );\r\n    \r\n                // 没有要上传的了，且没有正在传输的了。\r\n                } else if ( !me.remaning && !me._getStats().numOfQueue &&\r\n                    !me._getStats().numofInterrupt ) {\r\n                    me.runing = false;\r\n    \r\n                    me._trigged || Base.nextTick(function() {\r\n                        me.owner.trigger('uploadFinished');\r\n                    });\r\n                    me._trigged = true;\r\n                }\r\n            },\r\n    \r\n            _putback: function(block) {\r\n                var idx;\r\n    \r\n                block.cuted.unshift(block);\r\n                idx = this.stack.indexOf(block.cuted);\r\n    \r\n                if (!~idx) {\r\n                    this.stack.unshift(block.cuted);\r\n                }\r\n            },\r\n    \r\n            _getStack: function() {\r\n                var i = 0,\r\n                    act;\r\n    \r\n                while ( (act = this.stack[ i++ ]) ) {\r\n                    if ( act.has() && act.file.getStatus() === Status.PROGRESS ) {\r\n                        return act;\r\n                    } else if (!act.has() ||\r\n                            act.file.getStatus() !== Status.PROGRESS &&\r\n                            act.file.getStatus() !== Status.INTERRUPT ) {\r\n    \r\n                        // 把已经处理完了的，或者，状态为非 progress（上传中）、\r\n                        // interupt（暂停中） 的移除。\r\n                        this.stack.splice( --i, 1 );\r\n                    }\r\n                }\r\n    \r\n                return null;\r\n            },\r\n    \r\n            _nextBlock: function() {\r\n                var me = this,\r\n                    opts = me.options,\r\n                    act, next, done, preparing;\r\n    \r\n                // 如果当前文件还有没有需要传输的，则直接返回剩下的。\r\n                if ( (act = this._getStack()) ) {\r\n    \r\n                    // 是否提前准备下一个文件\r\n                    if ( opts.prepareNextFile && !me.pending.length ) {\r\n                        me._prepareNextFile();\r\n                    }\r\n    \r\n                    return act.shift();\r\n    \r\n                // 否则，如果正在运行，则准备下一个文件，并等待完成后返回下个分片。\r\n                } else if ( me.runing ) {\r\n    \r\n                    // 如果缓存中有，则直接在缓存中取，没有则去queue中取。\r\n                    if ( !me.pending.length && me._getStats().numOfQueue ) {\r\n                        me._prepareNextFile();\r\n                    }\r\n    \r\n                    next = me.pending.shift();\r\n                    done = function( file ) {\r\n                        if ( !file ) {\r\n                            return null;\r\n                        }\r\n    \r\n                        act = CuteFile( file, opts.chunked ? opts.chunkSize : 0 );\r\n                        me.stack.push(act);\r\n                        return act.shift();\r\n                    };\r\n    \r\n                    // 文件可能还在prepare中，也有可能已经完全准备好了。\r\n                    if ( isPromise( next) ) {\r\n                        preparing = next.file;\r\n                        next = next[ next.pipe ? 'pipe' : 'then' ]( done );\r\n                        next.file = preparing;\r\n                        return next;\r\n                    }\r\n    \r\n                    return done( next );\r\n                }\r\n            },\r\n    \r\n    \r\n            /**\r\n             * @event uploadStart\r\n             * @param {File} file File对象\r\n             * @description 某个文件开始上传前触发，一个文件只会触发一次。\r\n             * @for  Uploader\r\n             */\r\n            _prepareNextFile: function() {\r\n                var me = this,\r\n                    file = me.request('fetch-file'),\r\n                    pending = me.pending,\r\n                    promise;\r\n    \r\n                if ( file ) {\r\n                    promise = me.request( 'before-send-file', file, function() {\r\n    \r\n                        // 有可能文件被skip掉了。文件被skip掉后，状态坑定不是Queued.\r\n                        if ( file.getStatus() === Status.PROGRESS ||\r\n                            file.getStatus() === Status.INTERRUPT ) {\r\n                            return file;\r\n                        }\r\n    \r\n                        return me._finishFile( file );\r\n                    });\r\n    \r\n                    me.owner.trigger( 'uploadStart', file );\r\n                    file.setStatus( Status.PROGRESS );\r\n    \r\n                    promise.file = file;\r\n    \r\n                    // 如果还在pending中，则替换成文件本身。\r\n                    promise.done(function() {\r\n                        var idx = $.inArray( promise, pending );\r\n    \r\n                        ~idx && pending.splice( idx, 1, file );\r\n                    });\r\n    \r\n                    // befeore-send-file的钩子就有错误发生。\r\n                    promise.fail(function( reason ) {\r\n                        file.setStatus( Status.ERROR, reason );\r\n                        me.owner.trigger( 'uploadError', file, reason );\r\n                        me.owner.trigger( 'uploadComplete', file );\r\n                    });\r\n    \r\n                    pending.push( promise );\r\n                }\r\n            },\r\n    \r\n            // 让出位置了，可以让其他分片开始上传\r\n            _popBlock: function( block ) {\r\n                var idx = $.inArray( block, this.pool );\r\n    \r\n                this.pool.splice( idx, 1 );\r\n                block.file.remaning--;\r\n                this.remaning--;\r\n            },\r\n    \r\n            // 开始上传，可以被掉过。如果promise被reject了，则表示跳过此分片。\r\n            _startSend: function( block ) {\r\n                var me = this,\r\n                    file = block.file,\r\n                    promise;\r\n    \r\n                // 有可能在 before-send-file 的 promise 期间改变了文件状态。\r\n                // 如：暂停，取消\r\n                // 我们不能中断 promise, 但是可以在 promise 完后，不做上传操作。\r\n                if ( file.getStatus() !== Status.PROGRESS ) {\r\n    \r\n                    // 如果是中断，则还需要放回去。\r\n                    if (file.getStatus() === Status.INTERRUPT) {\r\n                        me._putback(block);\r\n                    }\r\n    \r\n                    return;\r\n                }\r\n    \r\n                me.pool.push( block );\r\n                me.remaning++;\r\n    \r\n                // 如果没有分片，则直接使用原始的。\r\n                // 不会丢失content-type信息。\r\n                block.blob = block.chunks === 1 ? file.source :\r\n                        file.source.slice( block.start, block.end );\r\n    \r\n                // hook, 每个分片发送之前可能要做些异步的事情。\r\n                promise = me.request( 'before-send', block, function() {\r\n    \r\n                    // 有可能文件已经上传出错了，所以不需要再传输了。\r\n                    if ( file.getStatus() === Status.PROGRESS ) {\r\n                        me._doSend( block );\r\n                    } else {\r\n                        me._popBlock( block );\r\n                        Base.nextTick( me.__tick );\r\n                    }\r\n                });\r\n    \r\n                // 如果为fail了，则跳过此分片。\r\n                promise.fail(function() {\r\n                    if ( file.remaning === 1 ) {\r\n                        me._finishFile( file ).always(function() {\r\n                            block.percentage = 1;\r\n                            me._popBlock( block );\r\n                            me.owner.trigger( 'uploadComplete', file );\r\n                            Base.nextTick( me.__tick );\r\n                        });\r\n                    } else {\r\n                        block.percentage = 1;\r\n                        me.updateFileProgress( file );\r\n                        me._popBlock( block );\r\n                        Base.nextTick( me.__tick );\r\n                    }\r\n                });\r\n            },\r\n    \r\n    \r\n            /**\r\n             * @event uploadBeforeSend\r\n             * @param {Object} object\r\n             * @param {Object} data 默认的上传参数，可以扩展此对象来控制上传参数。\r\n             * @param {Object} headers 可以扩展此对象来控制上传头部。\r\n             * @description 当某个文件的分块在发送前触发，主要用来询问是否要添加附带参数，大文件在开起分片上传的前提下此事件可能会触发多次。\r\n             * @for  Uploader\r\n             */\r\n    \r\n            /**\r\n             * @event uploadAccept\r\n             * @param {Object} object\r\n             * @param {Object} ret 服务端的返回数据，json格式，如果服务端不是json格式，从ret._raw中取数据，自行解析。\r\n             * @description 当某个文件上传到服务端响应后，会派送此事件来询问服务端响应是否有效。如果此事件handler返回值为`false`, 则此文件将派送`server`类型的`uploadError`事件。\r\n             * @for  Uploader\r\n             */\r\n    \r\n            /**\r\n             * @event uploadProgress\r\n             * @param {File} file File对象\r\n             * @param {Number} percentage 上传进度\r\n             * @description 上传过程中触发，携带上传进度。\r\n             * @for  Uploader\r\n             */\r\n    \r\n    \r\n            /**\r\n             * @event uploadError\r\n             * @param {File} file File对象\r\n             * @param {String} reason 出错的code\r\n             * @description 当文件上传出错时触发。\r\n             * @for  Uploader\r\n             */\r\n    \r\n            /**\r\n             * @event uploadSuccess\r\n             * @param {File} file File对象\r\n             * @param {Object} response 服务端返回的数据\r\n             * @description 当文件上传成功时触发。\r\n             * @for  Uploader\r\n             */\r\n    \r\n            /**\r\n             * @event uploadComplete\r\n             * @param {File} [file] File对象\r\n             * @description 不管成功或者失败，文件上传完成时触发。\r\n             * @for  Uploader\r\n             */\r\n    \r\n            // 做上传操作。\r\n            _doSend: function( block ) {\r\n                var me = this,\r\n                    owner = me.owner,\r\n                    opts = me.options,\r\n                    file = block.file,\r\n                    tr = new Transport( opts ),\r\n                    data = $.extend({}, opts.formData ),\r\n                    headers = $.extend({}, opts.headers ),\r\n                    requestAccept, ret;\r\n    \r\n                block.transport = tr;\r\n    \r\n                tr.on( 'destroy', function() {\r\n                    delete block.transport;\r\n                    me._popBlock( block );\r\n                    Base.nextTick( me.__tick );\r\n                });\r\n    \r\n                // 广播上传进度。以文件为单位。\r\n                tr.on( 'progress', function( percentage ) {\r\n                    block.percentage = percentage;\r\n                    me.updateFileProgress( file );\r\n                });\r\n    \r\n                // 用来询问，是否返回的结果是有错误的。\r\n                requestAccept = function( reject ) {\r\n                    var fn;\r\n    \r\n                    ret = tr.getResponseAsJson() || {};\r\n                    ret._raw = tr.getResponse();\r\n                    fn = function( value ) {\r\n                        reject = value;\r\n                    };\r\n    \r\n                    // 服务端响应了，不代表成功了，询问是否响应正确。\r\n                    if ( !owner.trigger( 'uploadAccept', block, ret, fn ) ) {\r\n                        reject = reject || 'server';\r\n                    }\r\n    \r\n                    return reject;\r\n                };\r\n    \r\n                // 尝试重试，然后广播文件上传出错。\r\n                tr.on( 'error', function( type, flag ) {\r\n                    block.retried = block.retried || 0;\r\n    \r\n                    // 自动重试\r\n                    if ( block.chunks > 1 && ~'http,abort'.indexOf( type ) &&\r\n                            block.retried < opts.chunkRetry ) {\r\n    \r\n                        block.retried++;\r\n                        tr.send();\r\n    \r\n                    } else {\r\n    \r\n                        // http status 500 ~ 600\r\n                        if ( !flag && type === 'server' ) {\r\n                            type = requestAccept( type );\r\n                        }\r\n    \r\n                        file.setStatus( Status.ERROR, type );\r\n                        owner.trigger( 'uploadError', file, type );\r\n                        owner.trigger( 'uploadComplete', file );\r\n                    }\r\n                });\r\n    \r\n                // 上传成功\r\n                tr.on( 'load', function() {\r\n                    var reason;\r\n    \r\n                    // 如果非预期，转向上传出错。\r\n                    if ( (reason = requestAccept()) ) {\r\n                        tr.trigger( 'error', reason, true );\r\n                        return;\r\n                    }\r\n    \r\n                    // 全部上传完成。\r\n                    if ( file.remaning === 1 ) {\r\n                        me._finishFile( file, ret );\r\n                    } else {\r\n                        tr.destroy();\r\n                    }\r\n                });\r\n    \r\n                // 配置默认的上传字段。\r\n                data = $.extend( data, {\r\n                    id: file.id,\r\n                    name: file.name,\r\n                    type: file.type,\r\n                    lastModifiedDate: file.lastModifiedDate,\r\n                    size: file.size\r\n                });\r\n    \r\n                block.chunks > 1 && $.extend( data, {\r\n                    chunks: block.chunks,\r\n                    chunk: block.chunk\r\n                });\r\n    \r\n                // 在发送之间可以添加字段什么的。。。\r\n                // 如果默认的字段不够使用，可以通过监听此事件来扩展\r\n                owner.trigger( 'uploadBeforeSend', block, data, headers );\r\n    \r\n                // 开始发送。\r\n                tr.appendBlob( opts.fileVal, block.blob, file.name );\r\n                tr.append( data );\r\n                tr.setRequestHeader( headers );\r\n                tr.send();\r\n            },\r\n    \r\n            // 完成上传。\r\n            _finishFile: function( file, ret, hds ) {\r\n                var owner = this.owner;\r\n    \r\n                return owner\r\n                        .request( 'after-send-file', arguments, function() {\r\n                            file.setStatus( Status.COMPLETE );\r\n                            owner.trigger( 'uploadSuccess', file, ret, hds );\r\n                        })\r\n                        .fail(function( reason ) {\r\n    \r\n                            // 如果外部已经标记为invalid什么的，不再改状态。\r\n                            if ( file.getStatus() === Status.PROGRESS ) {\r\n                                file.setStatus( Status.ERROR, reason );\r\n                            }\r\n    \r\n                            owner.trigger( 'uploadError', file, reason );\r\n                        })\r\n                        .always(function() {\r\n                            owner.trigger( 'uploadComplete', file );\r\n                        });\r\n            },\r\n    \r\n            updateFileProgress: function(file) {\r\n                var totalPercent = 0,\r\n                    uploaded = 0;\r\n    \r\n                if (!file.blocks) {\r\n                    return;\r\n                }\r\n    \r\n                $.each( file.blocks, function( _, v ) {\r\n                    uploaded += (v.percentage || 0) * (v.end - v.start);\r\n                });\r\n    \r\n                totalPercent = uploaded / file.size;\r\n                this.owner.trigger( 'uploadProgress', file, totalPercent || 0 );\r\n            }\r\n    \r\n        });\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview 各种验证，包括文件总大小是否超出、单文件是否超出和文件是否重复。\r\n     */\r\n    \r\n    define('widgets/validator',[\r\n        'base',\r\n        'uploader',\r\n        'file',\r\n        'widgets/widget'\r\n    ], function( Base, Uploader, WUFile ) {\r\n    \r\n        var $ = Base.$,\r\n            validators = {},\r\n            api;\r\n    \r\n        /**\r\n         * @event error\r\n         * @param {String} type 错误类型。\r\n         * @description 当validate不通过时，会以派送错误事件的形式通知调用者。通过`upload.on('error', handler)`可以捕获到此类错误，目前有以下错误会在特定的情况下派送错来。\r\n         *\r\n         * * `Q_EXCEED_NUM_LIMIT` 在设置了`fileNumLimit`且尝试给`uploader`添加的文件数量超出这个值时派送。\r\n         * * `Q_EXCEED_SIZE_LIMIT` 在设置了`Q_EXCEED_SIZE_LIMIT`且尝试给`uploader`添加的文件总大小超出这个值时派送。\r\n         * * `Q_TYPE_DENIED` 当文件类型不满足时触发。。\r\n         * @for  Uploader\r\n         */\r\n    \r\n        // 暴露给外面的api\r\n        api = {\r\n    \r\n            // 添加验证器\r\n            addValidator: function( type, cb ) {\r\n                validators[ type ] = cb;\r\n            },\r\n    \r\n            // 移除验证器\r\n            removeValidator: function( type ) {\r\n                delete validators[ type ];\r\n            }\r\n        };\r\n    \r\n        // 在Uploader初始化的时候启动Validators的初始化\r\n        Uploader.register({\r\n            name: 'validator',\r\n    \r\n            init: function() {\r\n                var me = this;\r\n                Base.nextTick(function() {\r\n                    $.each( validators, function() {\r\n                        this.call( me.owner );\r\n                    });\r\n                });\r\n            }\r\n        });\r\n    \r\n        /**\r\n         * @property {int} [fileNumLimit=undefined]\r\n         * @namespace options\r\n         * @for Uploader\r\n         * @description 验证文件总数量, 超出则不允许加入队列。\r\n         */\r\n        api.addValidator( 'fileNumLimit', function() {\r\n            var uploader = this,\r\n                opts = uploader.options,\r\n                count = 0,\r\n                max = parseInt( opts.fileNumLimit, 10 ),\r\n                flag = true;\r\n    \r\n            if ( !max ) {\r\n                return;\r\n            }\r\n    \r\n            uploader.on( 'beforeFileQueued', function( file ) {\r\n    \r\n                if ( count >= max && flag ) {\r\n                    flag = false;\r\n                    this.trigger( 'error', 'Q_EXCEED_NUM_LIMIT', max, file );\r\n                    setTimeout(function() {\r\n                        flag = true;\r\n                    }, 1 );\r\n                }\r\n    \r\n                return count >= max ? false : true;\r\n            });\r\n    \r\n            uploader.on( 'fileQueued', function() {\r\n                count++;\r\n            });\r\n    \r\n            uploader.on( 'fileDequeued', function() {\r\n                count--;\r\n            });\r\n    \r\n            uploader.on( 'reset', function() {\r\n                count = 0;\r\n            });\r\n        });\r\n    \r\n    \r\n        /**\r\n         * @property {int} [fileSizeLimit=undefined]\r\n         * @namespace options\r\n         * @for Uploader\r\n         * @description 验证文件总大小是否超出限制, 超出则不允许加入队列。\r\n         */\r\n        api.addValidator( 'fileSizeLimit', function() {\r\n            var uploader = this,\r\n                opts = uploader.options,\r\n                count = 0,\r\n                max = parseInt( opts.fileSizeLimit, 10 ),\r\n                flag = true;\r\n    \r\n            if ( !max ) {\r\n                return;\r\n            }\r\n    \r\n            uploader.on( 'beforeFileQueued', function( file ) {\r\n                var invalid = count + file.size > max;\r\n    \r\n                if ( invalid && flag ) {\r\n                    flag = false;\r\n                    this.trigger( 'error', 'Q_EXCEED_SIZE_LIMIT', max, file );\r\n                    setTimeout(function() {\r\n                        flag = true;\r\n                    }, 1 );\r\n                }\r\n    \r\n                return invalid ? false : true;\r\n            });\r\n    \r\n            uploader.on( 'fileQueued', function( file ) {\r\n                count += file.size;\r\n            });\r\n    \r\n            uploader.on( 'fileDequeued', function( file ) {\r\n                count -= file.size;\r\n            });\r\n    \r\n            uploader.on( 'reset', function() {\r\n                count = 0;\r\n            });\r\n        });\r\n    \r\n        /**\r\n         * @property {int} [fileSingleSizeLimit=undefined]\r\n         * @namespace options\r\n         * @for Uploader\r\n         * @description 验证单个文件大小是否超出限制, 超出则不允许加入队列。\r\n         */\r\n        api.addValidator( 'fileSingleSizeLimit', function() {\r\n            var uploader = this,\r\n                opts = uploader.options,\r\n                max = opts.fileSingleSizeLimit;\r\n    \r\n            if ( !max ) {\r\n                return;\r\n            }\r\n    \r\n            uploader.on( 'beforeFileQueued', function( file ) {\r\n    \r\n                if ( file.size > max ) {\r\n                    file.setStatus( WUFile.Status.INVALID, 'exceed_size' );\r\n                    this.trigger( 'error', 'F_EXCEED_SIZE', max, file );\r\n                    return false;\r\n                }\r\n    \r\n            });\r\n    \r\n        });\r\n    \r\n        /**\r\n         * @property {Boolean} [duplicate=undefined]\r\n         * @namespace options\r\n         * @for Uploader\r\n         * @description 去重， 根据文件名字、文件大小和最后修改时间来生成hash Key.\r\n         */\r\n        api.addValidator( 'duplicate', function() {\r\n            var uploader = this,\r\n                opts = uploader.options,\r\n                mapping = {};\r\n    \r\n            if ( opts.duplicate ) {\r\n                return;\r\n            }\r\n    \r\n            function hashString( str ) {\r\n                var hash = 0,\r\n                    i = 0,\r\n                    len = str.length,\r\n                    _char;\r\n    \r\n                for ( ; i < len; i++ ) {\r\n                    _char = str.charCodeAt( i );\r\n                    hash = _char + (hash << 6) + (hash << 16) - hash;\r\n                }\r\n    \r\n                return hash;\r\n            }\r\n    \r\n            uploader.on( 'beforeFileQueued', function( file ) {\r\n                var hash = file.__hash || (file.__hash = hashString( file.name +\r\n                        file.size + file.lastModifiedDate ));\r\n    \r\n                // 已经重复了\r\n                if ( mapping[ hash ] ) {\r\n                    this.trigger( 'error', 'F_DUPLICATE', file );\r\n                    return false;\r\n                }\r\n            });\r\n    \r\n            uploader.on( 'fileQueued', function( file ) {\r\n                var hash = file.__hash;\r\n    \r\n                hash && (mapping[ hash ] = true);\r\n            });\r\n    \r\n            uploader.on( 'fileDequeued', function( file ) {\r\n                var hash = file.__hash;\r\n    \r\n                hash && (delete mapping[ hash ]);\r\n            });\r\n    \r\n            uploader.on( 'reset', function() {\r\n                mapping = {};\r\n            });\r\n        });\r\n    \r\n        return api;\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview Md5\r\n     */\r\n    define('lib/md5',[\r\n        'runtime/client',\r\n        'mediator'\r\n    ], function( RuntimeClient, Mediator ) {\r\n    \r\n        function Md5() {\r\n            RuntimeClient.call( this, 'Md5' );\r\n        }\r\n    \r\n        // 让 Md5 具备事件功能。\r\n        Mediator.installTo( Md5.prototype );\r\n    \r\n        Md5.prototype.loadFromBlob = function( blob ) {\r\n            var me = this;\r\n    \r\n            if ( me.getRuid() ) {\r\n                me.disconnectRuntime();\r\n            }\r\n    \r\n            // 连接到blob归属的同一个runtime.\r\n            me.connectRuntime( blob.ruid, function() {\r\n                me.exec('init');\r\n                me.exec( 'loadFromBlob', blob );\r\n            });\r\n        };\r\n    \r\n        Md5.prototype.getResult = function() {\r\n            return this.exec('getResult');\r\n        };\r\n    \r\n        return Md5;\r\n    });\r\n    /**\r\n     * @fileOverview 图片操作, 负责预览图片和上传前压缩图片\r\n     */\r\n    define('widgets/md5',[\r\n        'base',\r\n        'uploader',\r\n        'lib/md5',\r\n        'lib/blob',\r\n        'widgets/widget'\r\n    ], function( Base, Uploader, Md5, Blob ) {\r\n    \r\n        return Uploader.register({\r\n            name: 'md5',\r\n    \r\n    \r\n            /**\r\n             * 计算文件 md5 值，返回一个 promise 对象，可以监听 progress 进度。\r\n             *\r\n             *\r\n             * @method md5File\r\n             * @grammar md5File( file[, start[, end]] ) => promise\r\n             * @for Uploader\r\n             * @example\r\n             *\r\n             * uploader.on( 'fileQueued', function( file ) {\r\n             *     var $li = ...;\r\n             *\r\n             *     uploader.md5File( file )\r\n             *\r\n             *         // 及时显示进度\r\n             *         .progress(function(percentage) {\r\n             *             console.log('Percentage:', percentage);\r\n             *         })\r\n             *\r\n             *         // 完成\r\n             *         .then(function(val) {\r\n             *             console.log('md5 result:', val);\r\n             *         });\r\n             *\r\n             * });\r\n             */\r\n            md5File: function( file, start, end ) {\r\n                var md5 = new Md5(),\r\n                    deferred = Base.Deferred(),\r\n                    blob = (file instanceof Blob) ? file :\r\n                        this.request( 'get-file', file ).source;\r\n    \r\n                md5.on( 'progress load', function( e ) {\r\n                    e = e || {};\r\n                    deferred.notify( e.total ? e.loaded / e.total : 1 );\r\n                });\r\n    \r\n                md5.on( 'complete', function() {\r\n                    deferred.resolve( md5.getResult() );\r\n                });\r\n    \r\n                md5.on( 'error', function( reason ) {\r\n                    deferred.reject( reason );\r\n                });\r\n    \r\n                if ( arguments.length > 1 ) {\r\n                    start = start || 0;\r\n                    end = end || 0;\r\n                    start < 0 && (start = blob.size + start);\r\n                    end < 0 && (end = blob.size + end);\r\n                    end = Math.min( end, blob.size );\r\n                    blob = blob.slice( start, end );\r\n                }\r\n    \r\n                md5.loadFromBlob( blob );\r\n    \r\n                return deferred.promise();\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\r\n     */\r\n    define('runtime/compbase',[],function() {\r\n    \r\n        function CompBase( owner, runtime ) {\r\n    \r\n            this.owner = owner;\r\n            this.options = owner.options;\r\n    \r\n            this.getRuntime = function() {\r\n                return runtime;\r\n            };\r\n    \r\n            this.getRuid = function() {\r\n                return runtime.uid;\r\n            };\r\n    \r\n            this.trigger = function() {\r\n                return owner.trigger.apply( owner, arguments );\r\n            };\r\n        }\r\n    \r\n        return CompBase;\r\n    });\r\n    /**\r\n     * @fileOverview Html5Runtime\r\n     */\r\n    define('runtime/html5/runtime',[\r\n        'base',\r\n        'runtime/runtime',\r\n        'runtime/compbase'\r\n    ], function( Base, Runtime, CompBase ) {\r\n    \r\n        var type = 'html5',\r\n            components = {};\r\n    \r\n        function Html5Runtime() {\r\n            var pool = {},\r\n                me = this,\r\n                destroy = this.destroy;\r\n    \r\n            Runtime.apply( me, arguments );\r\n            me.type = type;\r\n    \r\n    \r\n            // 这个方法的调用者，实际上是RuntimeClient\r\n            me.exec = function( comp, fn/*, args...*/) {\r\n                var client = this,\r\n                    uid = client.uid,\r\n                    args = Base.slice( arguments, 2 ),\r\n                    instance;\r\n    \r\n                if ( components[ comp ] ) {\r\n                    instance = pool[ uid ] = pool[ uid ] ||\r\n                            new components[ comp ]( client, me );\r\n    \r\n                    if ( instance[ fn ] ) {\r\n                        return instance[ fn ].apply( instance, args );\r\n                    }\r\n                }\r\n            };\r\n    \r\n            me.destroy = function() {\r\n                // @todo 删除池子中的所有实例\r\n                return destroy && destroy.apply( this, arguments );\r\n            };\r\n        }\r\n    \r\n        Base.inherits( Runtime, {\r\n            constructor: Html5Runtime,\r\n    \r\n            // 不需要连接其他程序，直接执行callback\r\n            init: function() {\r\n                var me = this;\r\n                setTimeout(function() {\r\n                    me.trigger('ready');\r\n                }, 1 );\r\n            }\r\n    \r\n        });\r\n    \r\n        // 注册Components\r\n        Html5Runtime.register = function( name, component ) {\r\n            var klass = components[ name ] = Base.inherits( CompBase, component );\r\n            return klass;\r\n        };\r\n    \r\n        // 注册html5运行时。\r\n        // 只有在支持的前提下注册。\r\n        if ( window.Blob && window.FileReader && window.DataView ) {\r\n            Runtime.addRuntime( type, Html5Runtime );\r\n        }\r\n    \r\n        return Html5Runtime;\r\n    });\r\n    /**\r\n     * @fileOverview Blob Html实现\r\n     */\r\n    define('runtime/html5/blob',[\r\n        'runtime/html5/runtime',\r\n        'lib/blob'\r\n    ], function( Html5Runtime, Blob ) {\r\n    \r\n        return Html5Runtime.register( 'Blob', {\r\n            slice: function( start, end ) {\r\n                var blob = this.owner.source,\r\n                    slice = blob.slice || blob.webkitSlice || blob.mozSlice;\r\n    \r\n                blob = slice.call( blob, start, end );\r\n    \r\n                return new Blob( this.getRuid(), blob );\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview FilePaste\r\n     */\r\n    define('runtime/html5/dnd',[\r\n        'base',\r\n        'runtime/html5/runtime',\r\n        'lib/file'\r\n    ], function( Base, Html5Runtime, File ) {\r\n    \r\n        var $ = Base.$,\r\n            prefix = 'webuploader-dnd-';\r\n    \r\n        return Html5Runtime.register( 'DragAndDrop', {\r\n            init: function() {\r\n                var elem = this.elem = this.options.container;\r\n    \r\n                this.dragEnterHandler = Base.bindFn( this._dragEnterHandler, this );\r\n                this.dragOverHandler = Base.bindFn( this._dragOverHandler, this );\r\n                this.dragLeaveHandler = Base.bindFn( this._dragLeaveHandler, this );\r\n                this.dropHandler = Base.bindFn( this._dropHandler, this );\r\n                this.dndOver = false;\r\n    \r\n                elem.on( 'dragenter', this.dragEnterHandler );\r\n                elem.on( 'dragover', this.dragOverHandler );\r\n                elem.on( 'dragleave', this.dragLeaveHandler );\r\n                elem.on( 'drop', this.dropHandler );\r\n    \r\n                if ( this.options.disableGlobalDnd ) {\r\n                    $( document ).on( 'dragover', this.dragOverHandler );\r\n                    $( document ).on( 'drop', this.dropHandler );\r\n                }\r\n            },\r\n    \r\n            _dragEnterHandler: function( e ) {\r\n                var me = this,\r\n                    denied = me._denied || false,\r\n                    items;\r\n    \r\n                e = e.originalEvent || e;\r\n    \r\n                if ( !me.dndOver ) {\r\n                    me.dndOver = true;\r\n    \r\n                    // 注意只有 chrome 支持。\r\n                    items = e.dataTransfer.items;\r\n    \r\n                    if ( items && items.length ) {\r\n                        me._denied = denied = !me.trigger( 'accept', items );\r\n                    }\r\n    \r\n                    me.elem.addClass( prefix + 'over' );\r\n                    me.elem[ denied ? 'addClass' :\r\n                            'removeClass' ]( prefix + 'denied' );\r\n                }\r\n    \r\n                e.dataTransfer.dropEffect = denied ? 'none' : 'copy';\r\n    \r\n                return false;\r\n            },\r\n    \r\n            _dragOverHandler: function( e ) {\r\n                // 只处理框内的。\r\n                var parentElem = this.elem.parent().get( 0 );\r\n                if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\r\n                    return false;\r\n                }\r\n    \r\n                clearTimeout( this._leaveTimer );\r\n                this._dragEnterHandler.call( this, e );\r\n    \r\n                return false;\r\n            },\r\n    \r\n            _dragLeaveHandler: function() {\r\n                var me = this,\r\n                    handler;\r\n    \r\n                handler = function() {\r\n                    me.dndOver = false;\r\n                    me.elem.removeClass( prefix + 'over ' + prefix + 'denied' );\r\n                };\r\n    \r\n                clearTimeout( me._leaveTimer );\r\n                me._leaveTimer = setTimeout( handler, 100 );\r\n                return false;\r\n            },\r\n    \r\n            _dropHandler: function( e ) {\r\n                var me = this,\r\n                    ruid = me.getRuid(),\r\n                    parentElem = me.elem.parent().get( 0 ),\r\n                    dataTransfer, data;\r\n    \r\n                // 只处理框内的。\r\n                if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\r\n                    return false;\r\n                }\r\n    \r\n                e = e.originalEvent || e;\r\n                dataTransfer = e.dataTransfer;\r\n    \r\n                // 如果是页面内拖拽，还不能处理，不阻止事件。\r\n                // 此处 ie11 下会报参数错误，\r\n                try {\r\n                    data = dataTransfer.getData('text/html');\r\n                } catch( err ) {\r\n                }\r\n    \r\n                me.dndOver = false;\r\n                me.elem.removeClass( prefix + 'over' );\r\n    \r\n                if ( data ) {\r\n                    return;\r\n                }\r\n    \r\n                me._getTansferFiles( dataTransfer, function( results ) {\r\n                    me.trigger( 'drop', $.map( results, function( file ) {\r\n                        return new File( ruid, file );\r\n                    }) );\r\n                });\r\n    \r\n                return false;\r\n            },\r\n    \r\n            // 如果传入 callback 则去查看文件夹，否则只管当前文件夹。\r\n            _getTansferFiles: function( dataTransfer, callback ) {\r\n                var results  = [],\r\n                    promises = [],\r\n                    items, files, file, item, i, len, canAccessFolder;\r\n    \r\n                items = dataTransfer.items;\r\n                files = dataTransfer.files;\r\n    \r\n                canAccessFolder = !!(items && items[ 0 ].webkitGetAsEntry);\r\n    \r\n                for ( i = 0, len = files.length; i < len; i++ ) {\r\n                    file = files[ i ];\r\n                    item = items && items[ i ];\r\n    \r\n                    if ( canAccessFolder && item.webkitGetAsEntry().isDirectory ) {\r\n    \r\n                        promises.push( this._traverseDirectoryTree(\r\n                                item.webkitGetAsEntry(), results ) );\r\n                    } else {\r\n                        results.push( file );\r\n                    }\r\n                }\r\n    \r\n                Base.when.apply( Base, promises ).done(function() {\r\n    \r\n                    if ( !results.length ) {\r\n                        return;\r\n                    }\r\n    \r\n                    callback( results );\r\n                });\r\n            },\r\n    \r\n            _traverseDirectoryTree: function( entry, results ) {\r\n                var deferred = Base.Deferred(),\r\n                    me = this;\r\n    \r\n                if ( entry.isFile ) {\r\n                    entry.file(function( file ) {\r\n                        results.push( file );\r\n                        deferred.resolve();\r\n                    });\r\n                } else if ( entry.isDirectory ) {\r\n                    entry.createReader().readEntries(function( entries ) {\r\n                        var len = entries.length,\r\n                            promises = [],\r\n                            arr = [],    // 为了保证顺序。\r\n                            i;\r\n    \r\n                        for ( i = 0; i < len; i++ ) {\r\n                            promises.push( me._traverseDirectoryTree(\r\n                                    entries[ i ], arr ) );\r\n                        }\r\n    \r\n                        Base.when.apply( Base, promises ).then(function() {\r\n                            results.push.apply( results, arr );\r\n                            deferred.resolve();\r\n                        }, deferred.reject );\r\n                    });\r\n                }\r\n    \r\n                return deferred.promise();\r\n            },\r\n    \r\n            destroy: function() {\r\n                var elem = this.elem;\r\n    \r\n                // 还没 init 就调用 destroy\r\n                if (!elem) {\r\n                    return;\r\n                }\r\n    \r\n                elem.off( 'dragenter', this.dragEnterHandler );\r\n                elem.off( 'dragover', this.dragOverHandler );\r\n                elem.off( 'dragleave', this.dragLeaveHandler );\r\n                elem.off( 'drop', this.dropHandler );\r\n    \r\n                if ( this.options.disableGlobalDnd ) {\r\n                    $( document ).off( 'dragover', this.dragOverHandler );\r\n                    $( document ).off( 'drop', this.dropHandler );\r\n                }\r\n            }\r\n        });\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview FilePaste\r\n     */\r\n    define('runtime/html5/filepaste',[\r\n        'base',\r\n        'runtime/html5/runtime',\r\n        'lib/file'\r\n    ], function( Base, Html5Runtime, File ) {\r\n    \r\n        return Html5Runtime.register( 'FilePaste', {\r\n            init: function() {\r\n                var opts = this.options,\r\n                    elem = this.elem = opts.container,\r\n                    accept = '.*',\r\n                    arr, i, len, item;\r\n    \r\n                // accetp的mimeTypes中生成匹配正则。\r\n                if ( opts.accept ) {\r\n                    arr = [];\r\n    \r\n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\r\n                        item = opts.accept[ i ].mimeTypes;\r\n                        item && arr.push( item );\r\n                    }\r\n    \r\n                    if ( arr.length ) {\r\n                        accept = arr.join(',');\r\n                        accept = accept.replace( /,/g, '|' ).replace( /\\*/g, '.*' );\r\n                    }\r\n                }\r\n                this.accept = accept = new RegExp( accept, 'i' );\r\n                this.hander = Base.bindFn( this._pasteHander, this );\r\n                elem.on( 'paste', this.hander );\r\n            },\r\n    \r\n            _pasteHander: function( e ) {\r\n                var allowed = [],\r\n                    ruid = this.getRuid(),\r\n                    items, item, blob, i, len;\r\n    \r\n                e = e.originalEvent || e;\r\n                items = e.clipboardData.items;\r\n    \r\n                for ( i = 0, len = items.length; i < len; i++ ) {\r\n                    item = items[ i ];\r\n    \r\n                    if ( item.kind !== 'file' || !(blob = item.getAsFile()) ) {\r\n                        continue;\r\n                    }\r\n    \r\n                    allowed.push( new File( ruid, blob ) );\r\n                }\r\n    \r\n                if ( allowed.length ) {\r\n                    // 不阻止非文件粘贴（文字粘贴）的事件冒泡\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    this.trigger( 'paste', allowed );\r\n                }\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.elem.off( 'paste', this.hander );\r\n            }\r\n        });\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview FilePicker\r\n     */\r\n    define('runtime/html5/filepicker',[\r\n        'base',\r\n        'runtime/html5/runtime'\r\n    ], function( Base, Html5Runtime ) {\r\n    \r\n        var $ = Base.$;\r\n    \r\n        return Html5Runtime.register( 'FilePicker', {\r\n            init: function() {\r\n                var container = this.getRuntime().getContainer(),\r\n                    me = this,\r\n                    owner = me.owner,\r\n                    opts = me.options,\r\n                    label = this.label = $( document.createElement('label') ),\r\n                    input =  this.input = $( document.createElement('input') ),\r\n                    arr, i, len, mouseHandler;\r\n    \r\n                input.attr( 'type', 'file' );\r\n                input.attr( 'capture', 'camera');\r\n                input.attr( 'name', opts.name );\r\n                input.addClass('webuploader-element-invisible');\r\n    \r\n                label.on( 'click', function(e) {\r\n                    input.trigger('click');\r\n                    e.stopPropagation();\r\n                    owner.trigger('dialogopen');\r\n                });\r\n    \r\n                label.css({\r\n                    opacity: 0,\r\n                    width: '100%',\r\n                    height: '100%',\r\n                    display: 'block',\r\n                    cursor: 'pointer',\r\n                    background: '#ffffff'\r\n                });\r\n    \r\n                if ( opts.multiple ) {\r\n                    input.attr( 'multiple', 'multiple' );\r\n                }\r\n    \r\n                // @todo Firefox不支持单独指定后缀\r\n                if ( opts.accept && opts.accept.length > 0 ) {\r\n                    arr = [];\r\n    \r\n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\r\n                        arr.push( opts.accept[ i ].mimeTypes );\r\n                    }\r\n    \r\n                    input.attr( 'accept', arr.join(',') );\r\n                }\r\n    \r\n                container.append( input );\r\n                container.append( label );\r\n    \r\n                mouseHandler = function( e ) {\r\n                    owner.trigger( e.type );\r\n                };\r\n    \r\n                input.on( 'change', function( e ) {\r\n                    var fn = arguments.callee,\r\n                        clone;\r\n    \r\n                    me.files = e.target.files;\r\n    \r\n                    // reset input\r\n                    clone = this.cloneNode( true );\r\n                    clone.value = null;\r\n                    this.parentNode.replaceChild( clone, this );\r\n    \r\n                    input.off();\r\n                    input = $( clone ).on( 'change', fn )\r\n                            .on( 'mouseenter mouseleave', mouseHandler );\r\n    \r\n                    owner.trigger('change');\r\n                });\r\n    \r\n                label.on( 'mouseenter mouseleave', mouseHandler );\r\n    \r\n            },\r\n    \r\n    \r\n            getFiles: function() {\r\n                return this.files;\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.input.off();\r\n                this.label.off();\r\n            }\r\n        });\r\n    });\r\n    \r\n    /**\r\n     * Terms:\r\n     *\r\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\r\n     * @fileOverview Image控件\r\n     */\r\n    define('runtime/html5/util',[\r\n        'base'\r\n    ], function( Base ) {\r\n    \r\n        var urlAPI = window.createObjectURL && window ||\r\n                window.URL && URL.revokeObjectURL && URL ||\r\n                window.webkitURL,\r\n            createObjectURL = Base.noop,\r\n            revokeObjectURL = createObjectURL;\r\n    \r\n        if ( urlAPI ) {\r\n    \r\n            // 更安全的方式调用，比如android里面就能把context改成其他的对象。\r\n            createObjectURL = function() {\r\n                return urlAPI.createObjectURL.apply( urlAPI, arguments );\r\n            };\r\n    \r\n            revokeObjectURL = function() {\r\n                return urlAPI.revokeObjectURL.apply( urlAPI, arguments );\r\n            };\r\n        }\r\n    \r\n        return {\r\n            createObjectURL: createObjectURL,\r\n            revokeObjectURL: revokeObjectURL,\r\n    \r\n            dataURL2Blob: function( dataURI ) {\r\n                var byteStr, intArray, ab, i, mimetype, parts;\r\n    \r\n                parts = dataURI.split(',');\r\n    \r\n                if ( ~parts[ 0 ].indexOf('base64') ) {\r\n                    byteStr = atob( parts[ 1 ] );\r\n                } else {\r\n                    byteStr = decodeURIComponent( parts[ 1 ] );\r\n                }\r\n    \r\n                ab = new ArrayBuffer( byteStr.length );\r\n                intArray = new Uint8Array( ab );\r\n    \r\n                for ( i = 0; i < byteStr.length; i++ ) {\r\n                    intArray[ i ] = byteStr.charCodeAt( i );\r\n                }\r\n    \r\n                mimetype = parts[ 0 ].split(':')[ 1 ].split(';')[ 0 ];\r\n    \r\n                return this.arrayBufferToBlob( ab, mimetype );\r\n            },\r\n    \r\n            dataURL2ArrayBuffer: function( dataURI ) {\r\n                var byteStr, intArray, i, parts;\r\n    \r\n                parts = dataURI.split(',');\r\n    \r\n                if ( ~parts[ 0 ].indexOf('base64') ) {\r\n                    byteStr = atob( parts[ 1 ] );\r\n                } else {\r\n                    byteStr = decodeURIComponent( parts[ 1 ] );\r\n                }\r\n    \r\n                intArray = new Uint8Array( byteStr.length );\r\n    \r\n                for ( i = 0; i < byteStr.length; i++ ) {\r\n                    intArray[ i ] = byteStr.charCodeAt( i );\r\n                }\r\n    \r\n                return intArray.buffer;\r\n            },\r\n    \r\n            arrayBufferToBlob: function( buffer, type ) {\r\n                var builder = window.BlobBuilder || window.WebKitBlobBuilder,\r\n                    bb;\r\n    \r\n                // android不支持直接new Blob, 只能借助blobbuilder.\r\n                if ( builder ) {\r\n                    bb = new builder();\r\n                    bb.append( buffer );\r\n                    return bb.getBlob( type );\r\n                }\r\n    \r\n                return new Blob([ buffer ], type ? { type: type } : {} );\r\n            },\r\n    \r\n            // 抽出来主要是为了解决android下面canvas.toDataUrl不支持jpeg.\r\n            // 你得到的结果是png.\r\n            canvasToDataUrl: function( canvas, type, quality ) {\r\n                return canvas.toDataURL( type, quality / 100 );\r\n            },\r\n    \r\n            // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\r\n            parseMeta: function( blob, callback ) {\r\n                callback( false, {});\r\n            },\r\n    \r\n            // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\r\n            updateImageHead: function( data ) {\r\n                return data;\r\n            }\r\n        };\r\n    });\r\n    /**\r\n     * Terms:\r\n     *\r\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\r\n     * @fileOverview Image控件\r\n     */\r\n    define('runtime/html5/imagemeta',[\r\n        'runtime/html5/util'\r\n    ], function( Util ) {\r\n    \r\n        var api;\r\n    \r\n        api = {\r\n            parsers: {\r\n                0xffe1: []\r\n            },\r\n    \r\n            maxMetaDataSize: 262144,\r\n    \r\n            parse: function( blob, cb ) {\r\n                var me = this,\r\n                    fr = new FileReader();\r\n    \r\n                fr.onload = function() {\r\n                    cb( false, me._parse( this.result ) );\r\n                    fr = fr.onload = fr.onerror = null;\r\n                };\r\n    \r\n                fr.onerror = function( e ) {\r\n                    cb( e.message );\r\n                    fr = fr.onload = fr.onerror = null;\r\n                };\r\n    \r\n                blob = blob.slice( 0, me.maxMetaDataSize );\r\n                fr.readAsArrayBuffer( blob.getSource() );\r\n            },\r\n    \r\n            _parse: function( buffer, noParse ) {\r\n                if ( buffer.byteLength < 6 ) {\r\n                    return;\r\n                }\r\n    \r\n                var dataview = new DataView( buffer ),\r\n                    offset = 2,\r\n                    maxOffset = dataview.byteLength - 4,\r\n                    headLength = offset,\r\n                    ret = {},\r\n                    markerBytes, markerLength, parsers, i;\r\n    \r\n                if ( dataview.getUint16( 0 ) === 0xffd8 ) {\r\n    \r\n                    while ( offset < maxOffset ) {\r\n                        markerBytes = dataview.getUint16( offset );\r\n    \r\n                        if ( markerBytes >= 0xffe0 && markerBytes <= 0xffef ||\r\n                                markerBytes === 0xfffe ) {\r\n    \r\n                            markerLength = dataview.getUint16( offset + 2 ) + 2;\r\n    \r\n                            if ( offset + markerLength > dataview.byteLength ) {\r\n                                break;\r\n                            }\r\n    \r\n                            parsers = api.parsers[ markerBytes ];\r\n    \r\n                            if ( !noParse && parsers ) {\r\n                                for ( i = 0; i < parsers.length; i += 1 ) {\r\n                                    parsers[ i ].call( api, dataview, offset,\r\n                                            markerLength, ret );\r\n                                }\r\n                            }\r\n    \r\n                            offset += markerLength;\r\n                            headLength = offset;\r\n                        } else {\r\n                            break;\r\n                        }\r\n                    }\r\n    \r\n                    if ( headLength > 6 ) {\r\n                        if ( buffer.slice ) {\r\n                            ret.imageHead = buffer.slice( 2, headLength );\r\n                        } else {\r\n                            // Workaround for IE10, which does not yet\r\n                            // support ArrayBuffer.slice:\r\n                            ret.imageHead = new Uint8Array( buffer )\r\n                                    .subarray( 2, headLength );\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                return ret;\r\n            },\r\n    \r\n            updateImageHead: function( buffer, head ) {\r\n                var data = this._parse( buffer, true ),\r\n                    buf1, buf2, bodyoffset;\r\n    \r\n    \r\n                bodyoffset = 2;\r\n                if ( data.imageHead ) {\r\n                    bodyoffset = 2 + data.imageHead.byteLength;\r\n                }\r\n    \r\n                if ( buffer.slice ) {\r\n                    buf2 = buffer.slice( bodyoffset );\r\n                } else {\r\n                    buf2 = new Uint8Array( buffer ).subarray( bodyoffset );\r\n                }\r\n    \r\n                buf1 = new Uint8Array( head.byteLength + 2 + buf2.byteLength );\r\n    \r\n                buf1[ 0 ] = 0xFF;\r\n                buf1[ 1 ] = 0xD8;\r\n                buf1.set( new Uint8Array( head ), 2 );\r\n                buf1.set( new Uint8Array( buf2 ), head.byteLength + 2 );\r\n    \r\n                return buf1.buffer;\r\n            }\r\n        };\r\n    \r\n        Util.parseMeta = function() {\r\n            return api.parse.apply( api, arguments );\r\n        };\r\n    \r\n        Util.updateImageHead = function() {\r\n            return api.updateImageHead.apply( api, arguments );\r\n        };\r\n    \r\n        return api;\r\n    });\r\n    /**\r\n     * 代码来自于：https://github.com/blueimp/JavaScript-Load-Image\r\n     * 暂时项目中只用了orientation.\r\n     *\r\n     * 去除了 Exif Sub IFD Pointer, GPS Info IFD Pointer, Exif Thumbnail.\r\n     * @fileOverview EXIF解析\r\n     */\r\n    \r\n    // Sample\r\n    // ====================================\r\n    // Make : Apple\r\n    // Model : iPhone 4S\r\n    // Orientation : 1\r\n    // XResolution : 72 [72/1]\r\n    // YResolution : 72 [72/1]\r\n    // ResolutionUnit : 2\r\n    // Software : QuickTime 7.7.1\r\n    // DateTime : 2013:09:01 22:53:55\r\n    // ExifIFDPointer : 190\r\n    // ExposureTime : 0.058823529411764705 [1/17]\r\n    // FNumber : 2.4 [12/5]\r\n    // ExposureProgram : Normal program\r\n    // ISOSpeedRatings : 800\r\n    // ExifVersion : 0220\r\n    // DateTimeOriginal : 2013:09:01 22:52:51\r\n    // DateTimeDigitized : 2013:09:01 22:52:51\r\n    // ComponentsConfiguration : YCbCr\r\n    // ShutterSpeedValue : 4.058893515764426\r\n    // ApertureValue : 2.5260688216892597 [4845/1918]\r\n    // BrightnessValue : -0.3126686601998395\r\n    // MeteringMode : Pattern\r\n    // Flash : Flash did not fire, compulsory flash mode\r\n    // FocalLength : 4.28 [107/25]\r\n    // SubjectArea : [4 values]\r\n    // FlashpixVersion : 0100\r\n    // ColorSpace : 1\r\n    // PixelXDimension : 2448\r\n    // PixelYDimension : 3264\r\n    // SensingMethod : One-chip color area sensor\r\n    // ExposureMode : 0\r\n    // WhiteBalance : Auto white balance\r\n    // FocalLengthIn35mmFilm : 35\r\n    // SceneCaptureType : Standard\r\n    define('runtime/html5/imagemeta/exif',[\r\n        'base',\r\n        'runtime/html5/imagemeta'\r\n    ], function( Base, ImageMeta ) {\r\n    \r\n        var EXIF = {};\r\n    \r\n        EXIF.ExifMap = function() {\r\n            return this;\r\n        };\r\n    \r\n        EXIF.ExifMap.prototype.map = {\r\n            'Orientation': 0x0112\r\n        };\r\n    \r\n        EXIF.ExifMap.prototype.get = function( id ) {\r\n            return this[ id ] || this[ this.map[ id ] ];\r\n        };\r\n    \r\n        EXIF.exifTagTypes = {\r\n            // byte, 8-bit unsigned int:\r\n            1: {\r\n                getValue: function( dataView, dataOffset ) {\r\n                    return dataView.getUint8( dataOffset );\r\n                },\r\n                size: 1\r\n            },\r\n    \r\n            // ascii, 8-bit byte:\r\n            2: {\r\n                getValue: function( dataView, dataOffset ) {\r\n                    return String.fromCharCode( dataView.getUint8( dataOffset ) );\r\n                },\r\n                size: 1,\r\n                ascii: true\r\n            },\r\n    \r\n            // short, 16 bit int:\r\n            3: {\r\n                getValue: function( dataView, dataOffset, littleEndian ) {\r\n                    return dataView.getUint16( dataOffset, littleEndian );\r\n                },\r\n                size: 2\r\n            },\r\n    \r\n            // long, 32 bit int:\r\n            4: {\r\n                getValue: function( dataView, dataOffset, littleEndian ) {\r\n                    return dataView.getUint32( dataOffset, littleEndian );\r\n                },\r\n                size: 4\r\n            },\r\n    \r\n            // rational = two long values,\r\n            // first is numerator, second is denominator:\r\n            5: {\r\n                getValue: function( dataView, dataOffset, littleEndian ) {\r\n                    return dataView.getUint32( dataOffset, littleEndian ) /\r\n                        dataView.getUint32( dataOffset + 4, littleEndian );\r\n                },\r\n                size: 8\r\n            },\r\n    \r\n            // slong, 32 bit signed int:\r\n            9: {\r\n                getValue: function( dataView, dataOffset, littleEndian ) {\r\n                    return dataView.getInt32( dataOffset, littleEndian );\r\n                },\r\n                size: 4\r\n            },\r\n    \r\n            // srational, two slongs, first is numerator, second is denominator:\r\n            10: {\r\n                getValue: function( dataView, dataOffset, littleEndian ) {\r\n                    return dataView.getInt32( dataOffset, littleEndian ) /\r\n                        dataView.getInt32( dataOffset + 4, littleEndian );\r\n                },\r\n                size: 8\r\n            }\r\n        };\r\n    \r\n        // undefined, 8-bit byte, value depending on field:\r\n        EXIF.exifTagTypes[ 7 ] = EXIF.exifTagTypes[ 1 ];\r\n    \r\n        EXIF.getExifValue = function( dataView, tiffOffset, offset, type, length,\r\n                littleEndian ) {\r\n    \r\n            var tagType = EXIF.exifTagTypes[ type ],\r\n                tagSize, dataOffset, values, i, str, c;\r\n    \r\n            if ( !tagType ) {\r\n                Base.log('Invalid Exif data: Invalid tag type.');\r\n                return;\r\n            }\r\n    \r\n            tagSize = tagType.size * length;\r\n    \r\n            // Determine if the value is contained in the dataOffset bytes,\r\n            // or if the value at the dataOffset is a pointer to the actual data:\r\n            dataOffset = tagSize > 4 ? tiffOffset + dataView.getUint32( offset + 8,\r\n                    littleEndian ) : (offset + 8);\r\n    \r\n            if ( dataOffset + tagSize > dataView.byteLength ) {\r\n                Base.log('Invalid Exif data: Invalid data offset.');\r\n                return;\r\n            }\r\n    \r\n            if ( length === 1 ) {\r\n                return tagType.getValue( dataView, dataOffset, littleEndian );\r\n            }\r\n    \r\n            values = [];\r\n    \r\n            for ( i = 0; i < length; i += 1 ) {\r\n                values[ i ] = tagType.getValue( dataView,\r\n                        dataOffset + i * tagType.size, littleEndian );\r\n            }\r\n    \r\n            if ( tagType.ascii ) {\r\n                str = '';\r\n    \r\n                // Concatenate the chars:\r\n                for ( i = 0; i < values.length; i += 1 ) {\r\n                    c = values[ i ];\r\n    \r\n                    // Ignore the terminating NULL byte(s):\r\n                    if ( c === '\\u0000' ) {\r\n                        break;\r\n                    }\r\n                    str += c;\r\n                }\r\n    \r\n                return str;\r\n            }\r\n            return values;\r\n        };\r\n    \r\n        EXIF.parseExifTag = function( dataView, tiffOffset, offset, littleEndian,\r\n                data ) {\r\n    \r\n            var tag = dataView.getUint16( offset, littleEndian );\r\n            data.exif[ tag ] = EXIF.getExifValue( dataView, tiffOffset, offset,\r\n                    dataView.getUint16( offset + 2, littleEndian ),    // tag type\r\n                    dataView.getUint32( offset + 4, littleEndian ),    // tag length\r\n                    littleEndian );\r\n        };\r\n    \r\n        EXIF.parseExifTags = function( dataView, tiffOffset, dirOffset,\r\n                littleEndian, data ) {\r\n    \r\n            var tagsNumber, dirEndOffset, i;\r\n    \r\n            if ( dirOffset + 6 > dataView.byteLength ) {\r\n                Base.log('Invalid Exif data: Invalid directory offset.');\r\n                return;\r\n            }\r\n    \r\n            tagsNumber = dataView.getUint16( dirOffset, littleEndian );\r\n            dirEndOffset = dirOffset + 2 + 12 * tagsNumber;\r\n    \r\n            if ( dirEndOffset + 4 > dataView.byteLength ) {\r\n                Base.log('Invalid Exif data: Invalid directory size.');\r\n                return;\r\n            }\r\n    \r\n            for ( i = 0; i < tagsNumber; i += 1 ) {\r\n                this.parseExifTag( dataView, tiffOffset,\r\n                        dirOffset + 2 + 12 * i,    // tag offset\r\n                        littleEndian, data );\r\n            }\r\n    \r\n            // Return the offset to the next directory:\r\n            return dataView.getUint32( dirEndOffset, littleEndian );\r\n        };\r\n    \r\n        // EXIF.getExifThumbnail = function(dataView, offset, length) {\r\n        //     var hexData,\r\n        //         i,\r\n        //         b;\r\n        //     if (!length || offset + length > dataView.byteLength) {\r\n        //         Base.log('Invalid Exif data: Invalid thumbnail data.');\r\n        //         return;\r\n        //     }\r\n        //     hexData = [];\r\n        //     for (i = 0; i < length; i += 1) {\r\n        //         b = dataView.getUint8(offset + i);\r\n        //         hexData.push((b < 16 ? '0' : '') + b.toString(16));\r\n        //     }\r\n        //     return 'data:image/jpeg,%' + hexData.join('%');\r\n        // };\r\n    \r\n        EXIF.parseExifData = function( dataView, offset, length, data ) {\r\n    \r\n            var tiffOffset = offset + 10,\r\n                littleEndian, dirOffset;\r\n    \r\n            // Check for the ASCII code for \"Exif\" (0x45786966):\r\n            if ( dataView.getUint32( offset + 4 ) !== 0x45786966 ) {\r\n                // No Exif data, might be XMP data instead\r\n                return;\r\n            }\r\n            if ( tiffOffset + 8 > dataView.byteLength ) {\r\n                Base.log('Invalid Exif data: Invalid segment size.');\r\n                return;\r\n            }\r\n    \r\n            // Check for the two null bytes:\r\n            if ( dataView.getUint16( offset + 8 ) !== 0x0000 ) {\r\n                Base.log('Invalid Exif data: Missing byte alignment offset.');\r\n                return;\r\n            }\r\n    \r\n            // Check the byte alignment:\r\n            switch ( dataView.getUint16( tiffOffset ) ) {\r\n                case 0x4949:\r\n                    littleEndian = true;\r\n                    break;\r\n    \r\n                case 0x4D4D:\r\n                    littleEndian = false;\r\n                    break;\r\n    \r\n                default:\r\n                    Base.log('Invalid Exif data: Invalid byte alignment marker.');\r\n                    return;\r\n            }\r\n    \r\n            // Check for the TIFF tag marker (0x002A):\r\n            if ( dataView.getUint16( tiffOffset + 2, littleEndian ) !== 0x002A ) {\r\n                Base.log('Invalid Exif data: Missing TIFF marker.');\r\n                return;\r\n            }\r\n    \r\n            // Retrieve the directory offset bytes, usually 0x00000008 or 8 decimal:\r\n            dirOffset = dataView.getUint32( tiffOffset + 4, littleEndian );\r\n            // Create the exif object to store the tags:\r\n            data.exif = new EXIF.ExifMap();\r\n            // Parse the tags of the main image directory and retrieve the\r\n            // offset to the next directory, usually the thumbnail directory:\r\n            dirOffset = EXIF.parseExifTags( dataView, tiffOffset,\r\n                    tiffOffset + dirOffset, littleEndian, data );\r\n    \r\n            // 尝试读取缩略图\r\n            // if ( dirOffset ) {\r\n            //     thumbnailData = {exif: {}};\r\n            //     dirOffset = EXIF.parseExifTags(\r\n            //         dataView,\r\n            //         tiffOffset,\r\n            //         tiffOffset + dirOffset,\r\n            //         littleEndian,\r\n            //         thumbnailData\r\n            //     );\r\n    \r\n            //     // Check for JPEG Thumbnail offset:\r\n            //     if (thumbnailData.exif[0x0201]) {\r\n            //         data.exif.Thumbnail = EXIF.getExifThumbnail(\r\n            //             dataView,\r\n            //             tiffOffset + thumbnailData.exif[0x0201],\r\n            //             thumbnailData.exif[0x0202] // Thumbnail data length\r\n            //         );\r\n            //     }\r\n            // }\r\n        };\r\n    \r\n        ImageMeta.parsers[ 0xffe1 ].push( EXIF.parseExifData );\r\n        return EXIF;\r\n    });\r\n    /**\r\n     * 这个方式性能不行，但是可以解决android里面的toDataUrl的bug\r\n     * android里面toDataUrl('image/jpege')得到的结果却是png.\r\n     *\r\n     * 所以这里没辙，只能借助这个工具\r\n     * @fileOverview jpeg encoder\r\n     */\r\n    define('runtime/html5/jpegencoder',[], function( require, exports, module ) {\r\n    \r\n        /*\r\n          Copyright (c) 2008, Adobe Systems Incorporated\r\n          All rights reserved.\r\n    \r\n          Redistribution and use in source and binary forms, with or without\r\n          modification, are permitted provided that the following conditions are\r\n          met:\r\n    \r\n          * Redistributions of source code must retain the above copyright notice,\r\n            this list of conditions and the following disclaimer.\r\n    \r\n          * Redistributions in binary form must reproduce the above copyright\r\n            notice, this list of conditions and the following disclaimer in the\r\n            documentation and/or other materials provided with the distribution.\r\n    \r\n          * Neither the name of Adobe Systems Incorporated nor the names of its\r\n            contributors may be used to endorse or promote products derived from\r\n            this software without specific prior written permission.\r\n    \r\n          THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS\r\n          IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,\r\n          THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\r\n          PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR\r\n          CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\r\n          EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\r\n          PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n          PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\r\n          LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\r\n          NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n          SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n        */\r\n        /*\r\n        JPEG encoder ported to JavaScript and optimized by Andreas Ritter, www.bytestrom.eu, 11/2009\r\n    \r\n        Basic GUI blocking jpeg encoder\r\n        */\r\n    \r\n        function JPEGEncoder(quality) {\r\n          var self = this;\r\n            var fround = Math.round;\r\n            var ffloor = Math.floor;\r\n            var YTable = new Array(64);\r\n            var UVTable = new Array(64);\r\n            var fdtbl_Y = new Array(64);\r\n            var fdtbl_UV = new Array(64);\r\n            var YDC_HT;\r\n            var UVDC_HT;\r\n            var YAC_HT;\r\n            var UVAC_HT;\r\n    \r\n            var bitcode = new Array(65535);\r\n            var category = new Array(65535);\r\n            var outputfDCTQuant = new Array(64);\r\n            var DU = new Array(64);\r\n            var byteout = [];\r\n            var bytenew = 0;\r\n            var bytepos = 7;\r\n    \r\n            var YDU = new Array(64);\r\n            var UDU = new Array(64);\r\n            var VDU = new Array(64);\r\n            var clt = new Array(256);\r\n            var RGB_YUV_TABLE = new Array(2048);\r\n            var currentQuality;\r\n    \r\n            var ZigZag = [\r\n                     0, 1, 5, 6,14,15,27,28,\r\n                     2, 4, 7,13,16,26,29,42,\r\n                     3, 8,12,17,25,30,41,43,\r\n                     9,11,18,24,31,40,44,53,\r\n                    10,19,23,32,39,45,52,54,\r\n                    20,22,33,38,46,51,55,60,\r\n                    21,34,37,47,50,56,59,61,\r\n                    35,36,48,49,57,58,62,63\r\n                ];\r\n    \r\n            var std_dc_luminance_nrcodes = [0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];\r\n            var std_dc_luminance_values = [0,1,2,3,4,5,6,7,8,9,10,11];\r\n            var std_ac_luminance_nrcodes = [0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,0x7d];\r\n            var std_ac_luminance_values = [\r\n                    0x01,0x02,0x03,0x00,0x04,0x11,0x05,0x12,\r\n                    0x21,0x31,0x41,0x06,0x13,0x51,0x61,0x07,\r\n                    0x22,0x71,0x14,0x32,0x81,0x91,0xa1,0x08,\r\n                    0x23,0x42,0xb1,0xc1,0x15,0x52,0xd1,0xf0,\r\n                    0x24,0x33,0x62,0x72,0x82,0x09,0x0a,0x16,\r\n                    0x17,0x18,0x19,0x1a,0x25,0x26,0x27,0x28,\r\n                    0x29,0x2a,0x34,0x35,0x36,0x37,0x38,0x39,\r\n                    0x3a,0x43,0x44,0x45,0x46,0x47,0x48,0x49,\r\n                    0x4a,0x53,0x54,0x55,0x56,0x57,0x58,0x59,\r\n                    0x5a,0x63,0x64,0x65,0x66,0x67,0x68,0x69,\r\n                    0x6a,0x73,0x74,0x75,0x76,0x77,0x78,0x79,\r\n                    0x7a,0x83,0x84,0x85,0x86,0x87,0x88,0x89,\r\n                    0x8a,0x92,0x93,0x94,0x95,0x96,0x97,0x98,\r\n                    0x99,0x9a,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,\r\n                    0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,0xb5,0xb6,\r\n                    0xb7,0xb8,0xb9,0xba,0xc2,0xc3,0xc4,0xc5,\r\n                    0xc6,0xc7,0xc8,0xc9,0xca,0xd2,0xd3,0xd4,\r\n                    0xd5,0xd6,0xd7,0xd8,0xd9,0xda,0xe1,0xe2,\r\n                    0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,0xea,\r\n                    0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,\r\n                    0xf9,0xfa\r\n                ];\r\n    \r\n            var std_dc_chrominance_nrcodes = [0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];\r\n            var std_dc_chrominance_values = [0,1,2,3,4,5,6,7,8,9,10,11];\r\n            var std_ac_chrominance_nrcodes = [0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,0x77];\r\n            var std_ac_chrominance_values = [\r\n                    0x00,0x01,0x02,0x03,0x11,0x04,0x05,0x21,\r\n                    0x31,0x06,0x12,0x41,0x51,0x07,0x61,0x71,\r\n                    0x13,0x22,0x32,0x81,0x08,0x14,0x42,0x91,\r\n                    0xa1,0xb1,0xc1,0x09,0x23,0x33,0x52,0xf0,\r\n                    0x15,0x62,0x72,0xd1,0x0a,0x16,0x24,0x34,\r\n                    0xe1,0x25,0xf1,0x17,0x18,0x19,0x1a,0x26,\r\n                    0x27,0x28,0x29,0x2a,0x35,0x36,0x37,0x38,\r\n                    0x39,0x3a,0x43,0x44,0x45,0x46,0x47,0x48,\r\n                    0x49,0x4a,0x53,0x54,0x55,0x56,0x57,0x58,\r\n                    0x59,0x5a,0x63,0x64,0x65,0x66,0x67,0x68,\r\n                    0x69,0x6a,0x73,0x74,0x75,0x76,0x77,0x78,\r\n                    0x79,0x7a,0x82,0x83,0x84,0x85,0x86,0x87,\r\n                    0x88,0x89,0x8a,0x92,0x93,0x94,0x95,0x96,\r\n                    0x97,0x98,0x99,0x9a,0xa2,0xa3,0xa4,0xa5,\r\n                    0xa6,0xa7,0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,\r\n                    0xb5,0xb6,0xb7,0xb8,0xb9,0xba,0xc2,0xc3,\r\n                    0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xd2,\r\n                    0xd3,0xd4,0xd5,0xd6,0xd7,0xd8,0xd9,0xda,\r\n                    0xe2,0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,\r\n                    0xea,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,\r\n                    0xf9,0xfa\r\n                ];\r\n    \r\n            function initQuantTables(sf){\r\n                    var YQT = [\r\n                        16, 11, 10, 16, 24, 40, 51, 61,\r\n                        12, 12, 14, 19, 26, 58, 60, 55,\r\n                        14, 13, 16, 24, 40, 57, 69, 56,\r\n                        14, 17, 22, 29, 51, 87, 80, 62,\r\n                        18, 22, 37, 56, 68,109,103, 77,\r\n                        24, 35, 55, 64, 81,104,113, 92,\r\n                        49, 64, 78, 87,103,121,120,101,\r\n                        72, 92, 95, 98,112,100,103, 99\r\n                    ];\r\n    \r\n                    for (var i = 0; i < 64; i++) {\r\n                        var t = ffloor((YQT[i]*sf+50)/100);\r\n                        if (t < 1) {\r\n                            t = 1;\r\n                        } else if (t > 255) {\r\n                            t = 255;\r\n                        }\r\n                        YTable[ZigZag[i]] = t;\r\n                    }\r\n                    var UVQT = [\r\n                        17, 18, 24, 47, 99, 99, 99, 99,\r\n                        18, 21, 26, 66, 99, 99, 99, 99,\r\n                        24, 26, 56, 99, 99, 99, 99, 99,\r\n                        47, 66, 99, 99, 99, 99, 99, 99,\r\n                        99, 99, 99, 99, 99, 99, 99, 99,\r\n                        99, 99, 99, 99, 99, 99, 99, 99,\r\n                        99, 99, 99, 99, 99, 99, 99, 99,\r\n                        99, 99, 99, 99, 99, 99, 99, 99\r\n                    ];\r\n                    for (var j = 0; j < 64; j++) {\r\n                        var u = ffloor((UVQT[j]*sf+50)/100);\r\n                        if (u < 1) {\r\n                            u = 1;\r\n                        } else if (u > 255) {\r\n                            u = 255;\r\n                        }\r\n                        UVTable[ZigZag[j]] = u;\r\n                    }\r\n                    var aasf = [\r\n                        1.0, 1.387039845, 1.306562965, 1.175875602,\r\n                        1.0, 0.785694958, 0.541196100, 0.275899379\r\n                    ];\r\n                    var k = 0;\r\n                    for (var row = 0; row < 8; row++)\r\n                    {\r\n                        for (var col = 0; col < 8; col++)\r\n                        {\r\n                            fdtbl_Y[k]  = (1.0 / (YTable [ZigZag[k]] * aasf[row] * aasf[col] * 8.0));\r\n                            fdtbl_UV[k] = (1.0 / (UVTable[ZigZag[k]] * aasf[row] * aasf[col] * 8.0));\r\n                            k++;\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                function computeHuffmanTbl(nrcodes, std_table){\r\n                    var codevalue = 0;\r\n                    var pos_in_table = 0;\r\n                    var HT = new Array();\r\n                    for (var k = 1; k <= 16; k++) {\r\n                        for (var j = 1; j <= nrcodes[k]; j++) {\r\n                            HT[std_table[pos_in_table]] = [];\r\n                            HT[std_table[pos_in_table]][0] = codevalue;\r\n                            HT[std_table[pos_in_table]][1] = k;\r\n                            pos_in_table++;\r\n                            codevalue++;\r\n                        }\r\n                        codevalue*=2;\r\n                    }\r\n                    return HT;\r\n                }\r\n    \r\n                function initHuffmanTbl()\r\n                {\r\n                    YDC_HT = computeHuffmanTbl(std_dc_luminance_nrcodes,std_dc_luminance_values);\r\n                    UVDC_HT = computeHuffmanTbl(std_dc_chrominance_nrcodes,std_dc_chrominance_values);\r\n                    YAC_HT = computeHuffmanTbl(std_ac_luminance_nrcodes,std_ac_luminance_values);\r\n                    UVAC_HT = computeHuffmanTbl(std_ac_chrominance_nrcodes,std_ac_chrominance_values);\r\n                }\r\n    \r\n                function initCategoryNumber()\r\n                {\r\n                    var nrlower = 1;\r\n                    var nrupper = 2;\r\n                    for (var cat = 1; cat <= 15; cat++) {\r\n                        //Positive numbers\r\n                        for (var nr = nrlower; nr<nrupper; nr++) {\r\n                            category[32767+nr] = cat;\r\n                            bitcode[32767+nr] = [];\r\n                            bitcode[32767+nr][1] = cat;\r\n                            bitcode[32767+nr][0] = nr;\r\n                        }\r\n                        //Negative numbers\r\n                        for (var nrneg =-(nrupper-1); nrneg<=-nrlower; nrneg++) {\r\n                            category[32767+nrneg] = cat;\r\n                            bitcode[32767+nrneg] = [];\r\n                            bitcode[32767+nrneg][1] = cat;\r\n                            bitcode[32767+nrneg][0] = nrupper-1+nrneg;\r\n                        }\r\n                        nrlower <<= 1;\r\n                        nrupper <<= 1;\r\n                    }\r\n                }\r\n    \r\n                function initRGBYUVTable() {\r\n                    for(var i = 0; i < 256;i++) {\r\n                        RGB_YUV_TABLE[i]            =  19595 * i;\r\n                        RGB_YUV_TABLE[(i+ 256)>>0]  =  38470 * i;\r\n                        RGB_YUV_TABLE[(i+ 512)>>0]  =   7471 * i + 0x8000;\r\n                        RGB_YUV_TABLE[(i+ 768)>>0]  = -11059 * i;\r\n                        RGB_YUV_TABLE[(i+1024)>>0]  = -21709 * i;\r\n                        RGB_YUV_TABLE[(i+1280)>>0]  =  32768 * i + 0x807FFF;\r\n                        RGB_YUV_TABLE[(i+1536)>>0]  = -27439 * i;\r\n                        RGB_YUV_TABLE[(i+1792)>>0]  = - 5329 * i;\r\n                    }\r\n                }\r\n    \r\n                // IO functions\r\n                function writeBits(bs)\r\n                {\r\n                    var value = bs[0];\r\n                    var posval = bs[1]-1;\r\n                    while ( posval >= 0 ) {\r\n                        if (value & (1 << posval) ) {\r\n                            bytenew |= (1 << bytepos);\r\n                        }\r\n                        posval--;\r\n                        bytepos--;\r\n                        if (bytepos < 0) {\r\n                            if (bytenew == 0xFF) {\r\n                                writeByte(0xFF);\r\n                                writeByte(0);\r\n                            }\r\n                            else {\r\n                                writeByte(bytenew);\r\n                            }\r\n                            bytepos=7;\r\n                            bytenew=0;\r\n                        }\r\n                    }\r\n                }\r\n    \r\n                function writeByte(value)\r\n                {\r\n                    byteout.push(clt[value]); // write char directly instead of converting later\r\n                }\r\n    \r\n                function writeWord(value)\r\n                {\r\n                    writeByte((value>>8)&0xFF);\r\n                    writeByte((value   )&0xFF);\r\n                }\r\n    \r\n                // DCT & quantization core\r\n                function fDCTQuant(data, fdtbl)\r\n                {\r\n                    var d0, d1, d2, d3, d4, d5, d6, d7;\r\n                    /* Pass 1: process rows. */\r\n                    var dataOff=0;\r\n                    var i;\r\n                    var I8 = 8;\r\n                    var I64 = 64;\r\n                    for (i=0; i<I8; ++i)\r\n                    {\r\n                        d0 = data[dataOff];\r\n                        d1 = data[dataOff+1];\r\n                        d2 = data[dataOff+2];\r\n                        d3 = data[dataOff+3];\r\n                        d4 = data[dataOff+4];\r\n                        d5 = data[dataOff+5];\r\n                        d6 = data[dataOff+6];\r\n                        d7 = data[dataOff+7];\r\n    \r\n                        var tmp0 = d0 + d7;\r\n                        var tmp7 = d0 - d7;\r\n                        var tmp1 = d1 + d6;\r\n                        var tmp6 = d1 - d6;\r\n                        var tmp2 = d2 + d5;\r\n                        var tmp5 = d2 - d5;\r\n                        var tmp3 = d3 + d4;\r\n                        var tmp4 = d3 - d4;\r\n    \r\n                        /* Even part */\r\n                        var tmp10 = tmp0 + tmp3;    /* phase 2 */\r\n                        var tmp13 = tmp0 - tmp3;\r\n                        var tmp11 = tmp1 + tmp2;\r\n                        var tmp12 = tmp1 - tmp2;\r\n    \r\n                        data[dataOff] = tmp10 + tmp11; /* phase 3 */\r\n                        data[dataOff+4] = tmp10 - tmp11;\r\n    \r\n                        var z1 = (tmp12 + tmp13) * 0.707106781; /* c4 */\r\n                        data[dataOff+2] = tmp13 + z1; /* phase 5 */\r\n                        data[dataOff+6] = tmp13 - z1;\r\n    \r\n                        /* Odd part */\r\n                        tmp10 = tmp4 + tmp5; /* phase 2 */\r\n                        tmp11 = tmp5 + tmp6;\r\n                        tmp12 = tmp6 + tmp7;\r\n    \r\n                        /* The rotator is modified from fig 4-8 to avoid extra negations. */\r\n                        var z5 = (tmp10 - tmp12) * 0.382683433; /* c6 */\r\n                        var z2 = 0.541196100 * tmp10 + z5; /* c2-c6 */\r\n                        var z4 = 1.306562965 * tmp12 + z5; /* c2+c6 */\r\n                        var z3 = tmp11 * 0.707106781; /* c4 */\r\n    \r\n                        var z11 = tmp7 + z3;    /* phase 5 */\r\n                        var z13 = tmp7 - z3;\r\n    \r\n                        data[dataOff+5] = z13 + z2; /* phase 6 */\r\n                        data[dataOff+3] = z13 - z2;\r\n                        data[dataOff+1] = z11 + z4;\r\n                        data[dataOff+7] = z11 - z4;\r\n    \r\n                        dataOff += 8; /* advance pointer to next row */\r\n                    }\r\n    \r\n                    /* Pass 2: process columns. */\r\n                    dataOff = 0;\r\n                    for (i=0; i<I8; ++i)\r\n                    {\r\n                        d0 = data[dataOff];\r\n                        d1 = data[dataOff + 8];\r\n                        d2 = data[dataOff + 16];\r\n                        d3 = data[dataOff + 24];\r\n                        d4 = data[dataOff + 32];\r\n                        d5 = data[dataOff + 40];\r\n                        d6 = data[dataOff + 48];\r\n                        d7 = data[dataOff + 56];\r\n    \r\n                        var tmp0p2 = d0 + d7;\r\n                        var tmp7p2 = d0 - d7;\r\n                        var tmp1p2 = d1 + d6;\r\n                        var tmp6p2 = d1 - d6;\r\n                        var tmp2p2 = d2 + d5;\r\n                        var tmp5p2 = d2 - d5;\r\n                        var tmp3p2 = d3 + d4;\r\n                        var tmp4p2 = d3 - d4;\r\n    \r\n                        /* Even part */\r\n                        var tmp10p2 = tmp0p2 + tmp3p2;  /* phase 2 */\r\n                        var tmp13p2 = tmp0p2 - tmp3p2;\r\n                        var tmp11p2 = tmp1p2 + tmp2p2;\r\n                        var tmp12p2 = tmp1p2 - tmp2p2;\r\n    \r\n                        data[dataOff] = tmp10p2 + tmp11p2; /* phase 3 */\r\n                        data[dataOff+32] = tmp10p2 - tmp11p2;\r\n    \r\n                        var z1p2 = (tmp12p2 + tmp13p2) * 0.707106781; /* c4 */\r\n                        data[dataOff+16] = tmp13p2 + z1p2; /* phase 5 */\r\n                        data[dataOff+48] = tmp13p2 - z1p2;\r\n    \r\n                        /* Odd part */\r\n                        tmp10p2 = tmp4p2 + tmp5p2; /* phase 2 */\r\n                        tmp11p2 = tmp5p2 + tmp6p2;\r\n                        tmp12p2 = tmp6p2 + tmp7p2;\r\n    \r\n                        /* The rotator is modified from fig 4-8 to avoid extra negations. */\r\n                        var z5p2 = (tmp10p2 - tmp12p2) * 0.382683433; /* c6 */\r\n                        var z2p2 = 0.541196100 * tmp10p2 + z5p2; /* c2-c6 */\r\n                        var z4p2 = 1.306562965 * tmp12p2 + z5p2; /* c2+c6 */\r\n                        var z3p2 = tmp11p2 * 0.707106781; /* c4 */\r\n    \r\n                        var z11p2 = tmp7p2 + z3p2;  /* phase 5 */\r\n                        var z13p2 = tmp7p2 - z3p2;\r\n    \r\n                        data[dataOff+40] = z13p2 + z2p2; /* phase 6 */\r\n                        data[dataOff+24] = z13p2 - z2p2;\r\n                        data[dataOff+ 8] = z11p2 + z4p2;\r\n                        data[dataOff+56] = z11p2 - z4p2;\r\n    \r\n                        dataOff++; /* advance pointer to next column */\r\n                    }\r\n    \r\n                    // Quantize/descale the coefficients\r\n                    var fDCTQuant;\r\n                    for (i=0; i<I64; ++i)\r\n                    {\r\n                        // Apply the quantization and scaling factor & Round to nearest integer\r\n                        fDCTQuant = data[i]*fdtbl[i];\r\n                        outputfDCTQuant[i] = (fDCTQuant > 0.0) ? ((fDCTQuant + 0.5)|0) : ((fDCTQuant - 0.5)|0);\r\n                        //outputfDCTQuant[i] = fround(fDCTQuant);\r\n    \r\n                    }\r\n                    return outputfDCTQuant;\r\n                }\r\n    \r\n                function writeAPP0()\r\n                {\r\n                    writeWord(0xFFE0); // marker\r\n                    writeWord(16); // length\r\n                    writeByte(0x4A); // J\r\n                    writeByte(0x46); // F\r\n                    writeByte(0x49); // I\r\n                    writeByte(0x46); // F\r\n                    writeByte(0); // = \"JFIF\",'\\0'\r\n                    writeByte(1); // versionhi\r\n                    writeByte(1); // versionlo\r\n                    writeByte(0); // xyunits\r\n                    writeWord(1); // xdensity\r\n                    writeWord(1); // ydensity\r\n                    writeByte(0); // thumbnwidth\r\n                    writeByte(0); // thumbnheight\r\n                }\r\n    \r\n                function writeSOF0(width, height)\r\n                {\r\n                    writeWord(0xFFC0); // marker\r\n                    writeWord(17);   // length, truecolor YUV JPG\r\n                    writeByte(8);    // precision\r\n                    writeWord(height);\r\n                    writeWord(width);\r\n                    writeByte(3);    // nrofcomponents\r\n                    writeByte(1);    // IdY\r\n                    writeByte(0x11); // HVY\r\n                    writeByte(0);    // QTY\r\n                    writeByte(2);    // IdU\r\n                    writeByte(0x11); // HVU\r\n                    writeByte(1);    // QTU\r\n                    writeByte(3);    // IdV\r\n                    writeByte(0x11); // HVV\r\n                    writeByte(1);    // QTV\r\n                }\r\n    \r\n                function writeDQT()\r\n                {\r\n                    writeWord(0xFFDB); // marker\r\n                    writeWord(132);    // length\r\n                    writeByte(0);\r\n                    for (var i=0; i<64; i++) {\r\n                        writeByte(YTable[i]);\r\n                    }\r\n                    writeByte(1);\r\n                    for (var j=0; j<64; j++) {\r\n                        writeByte(UVTable[j]);\r\n                    }\r\n                }\r\n    \r\n                function writeDHT()\r\n                {\r\n                    writeWord(0xFFC4); // marker\r\n                    writeWord(0x01A2); // length\r\n    \r\n                    writeByte(0); // HTYDCinfo\r\n                    for (var i=0; i<16; i++) {\r\n                        writeByte(std_dc_luminance_nrcodes[i+1]);\r\n                    }\r\n                    for (var j=0; j<=11; j++) {\r\n                        writeByte(std_dc_luminance_values[j]);\r\n                    }\r\n    \r\n                    writeByte(0x10); // HTYACinfo\r\n                    for (var k=0; k<16; k++) {\r\n                        writeByte(std_ac_luminance_nrcodes[k+1]);\r\n                    }\r\n                    for (var l=0; l<=161; l++) {\r\n                        writeByte(std_ac_luminance_values[l]);\r\n                    }\r\n    \r\n                    writeByte(1); // HTUDCinfo\r\n                    for (var m=0; m<16; m++) {\r\n                        writeByte(std_dc_chrominance_nrcodes[m+1]);\r\n                    }\r\n                    for (var n=0; n<=11; n++) {\r\n                        writeByte(std_dc_chrominance_values[n]);\r\n                    }\r\n    \r\n                    writeByte(0x11); // HTUACinfo\r\n                    for (var o=0; o<16; o++) {\r\n                        writeByte(std_ac_chrominance_nrcodes[o+1]);\r\n                    }\r\n                    for (var p=0; p<=161; p++) {\r\n                        writeByte(std_ac_chrominance_values[p]);\r\n                    }\r\n                }\r\n    \r\n                function writeSOS()\r\n                {\r\n                    writeWord(0xFFDA); // marker\r\n                    writeWord(12); // length\r\n                    writeByte(3); // nrofcomponents\r\n                    writeByte(1); // IdY\r\n                    writeByte(0); // HTY\r\n                    writeByte(2); // IdU\r\n                    writeByte(0x11); // HTU\r\n                    writeByte(3); // IdV\r\n                    writeByte(0x11); // HTV\r\n                    writeByte(0); // Ss\r\n                    writeByte(0x3f); // Se\r\n                    writeByte(0); // Bf\r\n                }\r\n    \r\n                function processDU(CDU, fdtbl, DC, HTDC, HTAC){\r\n                    var EOB = HTAC[0x00];\r\n                    var M16zeroes = HTAC[0xF0];\r\n                    var pos;\r\n                    var I16 = 16;\r\n                    var I63 = 63;\r\n                    var I64 = 64;\r\n                    var DU_DCT = fDCTQuant(CDU, fdtbl);\r\n                    //ZigZag reorder\r\n                    for (var j=0;j<I64;++j) {\r\n                        DU[ZigZag[j]]=DU_DCT[j];\r\n                    }\r\n                    var Diff = DU[0] - DC; DC = DU[0];\r\n                    //Encode DC\r\n                    if (Diff==0) {\r\n                        writeBits(HTDC[0]); // Diff might be 0\r\n                    } else {\r\n                        pos = 32767+Diff;\r\n                        writeBits(HTDC[category[pos]]);\r\n                        writeBits(bitcode[pos]);\r\n                    }\r\n                    //Encode ACs\r\n                    var end0pos = 63; // was const... which is crazy\r\n                    for (; (end0pos>0)&&(DU[end0pos]==0); end0pos--) {};\r\n                    //end0pos = first element in reverse order !=0\r\n                    if ( end0pos == 0) {\r\n                        writeBits(EOB);\r\n                        return DC;\r\n                    }\r\n                    var i = 1;\r\n                    var lng;\r\n                    while ( i <= end0pos ) {\r\n                        var startpos = i;\r\n                        for (; (DU[i]==0) && (i<=end0pos); ++i) {}\r\n                        var nrzeroes = i-startpos;\r\n                        if ( nrzeroes >= I16 ) {\r\n                            lng = nrzeroes>>4;\r\n                            for (var nrmarker=1; nrmarker <= lng; ++nrmarker)\r\n                                writeBits(M16zeroes);\r\n                            nrzeroes = nrzeroes&0xF;\r\n                        }\r\n                        pos = 32767+DU[i];\r\n                        writeBits(HTAC[(nrzeroes<<4)+category[pos]]);\r\n                        writeBits(bitcode[pos]);\r\n                        i++;\r\n                    }\r\n                    if ( end0pos != I63 ) {\r\n                        writeBits(EOB);\r\n                    }\r\n                    return DC;\r\n                }\r\n    \r\n                function initCharLookupTable(){\r\n                    var sfcc = String.fromCharCode;\r\n                    for(var i=0; i < 256; i++){ ///// ACHTUNG // 255\r\n                        clt[i] = sfcc(i);\r\n                    }\r\n                }\r\n    \r\n                this.encode = function(image,quality) // image data object\r\n                {\r\n                    // var time_start = new Date().getTime();\r\n    \r\n                    if(quality) setQuality(quality);\r\n    \r\n                    // Initialize bit writer\r\n                    byteout = new Array();\r\n                    bytenew=0;\r\n                    bytepos=7;\r\n    \r\n                    // Add JPEG headers\r\n                    writeWord(0xFFD8); // SOI\r\n                    writeAPP0();\r\n                    writeDQT();\r\n                    writeSOF0(image.width,image.height);\r\n                    writeDHT();\r\n                    writeSOS();\r\n    \r\n    \r\n                    // Encode 8x8 macroblocks\r\n                    var DCY=0;\r\n                    var DCU=0;\r\n                    var DCV=0;\r\n    \r\n                    bytenew=0;\r\n                    bytepos=7;\r\n    \r\n    \r\n                    this.encode.displayName = \"_encode_\";\r\n    \r\n                    var imageData = image.data;\r\n                    var width = image.width;\r\n                    var height = image.height;\r\n    \r\n                    var quadWidth = width*4;\r\n                    var tripleWidth = width*3;\r\n    \r\n                    var x, y = 0;\r\n                    var r, g, b;\r\n                    var start,p, col,row,pos;\r\n                    while(y < height){\r\n                        x = 0;\r\n                        while(x < quadWidth){\r\n                        start = quadWidth * y + x;\r\n                        p = start;\r\n                        col = -1;\r\n                        row = 0;\r\n    \r\n                        for(pos=0; pos < 64; pos++){\r\n                            row = pos >> 3;// /8\r\n                            col = ( pos & 7 ) * 4; // %8\r\n                            p = start + ( row * quadWidth ) + col;\r\n    \r\n                            if(y+row >= height){ // padding bottom\r\n                                p-= (quadWidth*(y+1+row-height));\r\n                            }\r\n    \r\n                            if(x+col >= quadWidth){ // padding right\r\n                                p-= ((x+col) - quadWidth +4)\r\n                            }\r\n    \r\n                            r = imageData[ p++ ];\r\n                            g = imageData[ p++ ];\r\n                            b = imageData[ p++ ];\r\n    \r\n    \r\n                            /* // calculate YUV values dynamically\r\n                            YDU[pos]=((( 0.29900)*r+( 0.58700)*g+( 0.11400)*b))-128; //-0x80\r\n                            UDU[pos]=(((-0.16874)*r+(-0.33126)*g+( 0.50000)*b));\r\n                            VDU[pos]=((( 0.50000)*r+(-0.41869)*g+(-0.08131)*b));\r\n                            */\r\n    \r\n                            // use lookup table (slightly faster)\r\n                            YDU[pos] = ((RGB_YUV_TABLE[r]             + RGB_YUV_TABLE[(g +  256)>>0] + RGB_YUV_TABLE[(b +  512)>>0]) >> 16)-128;\r\n                            UDU[pos] = ((RGB_YUV_TABLE[(r +  768)>>0] + RGB_YUV_TABLE[(g + 1024)>>0] + RGB_YUV_TABLE[(b + 1280)>>0]) >> 16)-128;\r\n                            VDU[pos] = ((RGB_YUV_TABLE[(r + 1280)>>0] + RGB_YUV_TABLE[(g + 1536)>>0] + RGB_YUV_TABLE[(b + 1792)>>0]) >> 16)-128;\r\n    \r\n                        }\r\n    \r\n                        DCY = processDU(YDU, fdtbl_Y, DCY, YDC_HT, YAC_HT);\r\n                        DCU = processDU(UDU, fdtbl_UV, DCU, UVDC_HT, UVAC_HT);\r\n                        DCV = processDU(VDU, fdtbl_UV, DCV, UVDC_HT, UVAC_HT);\r\n                        x+=32;\r\n                        }\r\n                        y+=8;\r\n                    }\r\n    \r\n    \r\n                    ////////////////////////////////////////////////////////////////\r\n    \r\n                    // Do the bit alignment of the EOI marker\r\n                    if ( bytepos >= 0 ) {\r\n                        var fillbits = [];\r\n                        fillbits[1] = bytepos+1;\r\n                        fillbits[0] = (1<<(bytepos+1))-1;\r\n                        writeBits(fillbits);\r\n                    }\r\n    \r\n                    writeWord(0xFFD9); //EOI\r\n    \r\n                    var jpegDataUri = 'data:image/jpeg;base64,' + btoa(byteout.join(''));\r\n    \r\n                    byteout = [];\r\n    \r\n                    // benchmarking\r\n                    // var duration = new Date().getTime() - time_start;\r\n                    // console.log('Encoding time: '+ currentQuality + 'ms');\r\n                    //\r\n    \r\n                    return jpegDataUri\r\n            }\r\n    \r\n            function setQuality(quality){\r\n                if (quality <= 0) {\r\n                    quality = 1;\r\n                }\r\n                if (quality > 100) {\r\n                    quality = 100;\r\n                }\r\n    \r\n                if(currentQuality == quality) return // don't recalc if unchanged\r\n    \r\n                var sf = 0;\r\n                if (quality < 50) {\r\n                    sf = Math.floor(5000 / quality);\r\n                } else {\r\n                    sf = Math.floor(200 - quality*2);\r\n                }\r\n    \r\n                initQuantTables(sf);\r\n                currentQuality = quality;\r\n                // console.log('Quality set to: '+quality +'%');\r\n            }\r\n    \r\n            function init(){\r\n                // var time_start = new Date().getTime();\r\n                if(!quality) quality = 50;\r\n                // Create tables\r\n                initCharLookupTable()\r\n                initHuffmanTbl();\r\n                initCategoryNumber();\r\n                initRGBYUVTable();\r\n    \r\n                setQuality(quality);\r\n                // var duration = new Date().getTime() - time_start;\r\n                // console.log('Initialization '+ duration + 'ms');\r\n            }\r\n    \r\n            init();\r\n    \r\n        };\r\n    \r\n        JPEGEncoder.encode = function( data, quality ) {\r\n            var encoder = new JPEGEncoder( quality );\r\n    \r\n            return encoder.encode( data );\r\n        }\r\n    \r\n        return JPEGEncoder;\r\n    });\r\n    /**\r\n     * @fileOverview Fix android canvas.toDataUrl bug.\r\n     */\r\n    define('runtime/html5/androidpatch',[\r\n        'runtime/html5/util',\r\n        'runtime/html5/jpegencoder',\r\n        'base'\r\n    ], function( Util, encoder, Base ) {\r\n        var origin = Util.canvasToDataUrl,\r\n            supportJpeg;\r\n    \r\n        Util.canvasToDataUrl = function( canvas, type, quality ) {\r\n            var ctx, w, h, fragement, parts;\r\n    \r\n            // 非android手机直接跳过。\r\n            if ( !Base.os.android ) {\r\n                return origin.apply( null, arguments );\r\n            }\r\n    \r\n            // 检测是否canvas支持jpeg导出，根据数据格式来判断。\r\n            // JPEG 前两位分别是：255, 216\r\n            if ( type === 'image/jpeg' && typeof supportJpeg === 'undefined' ) {\r\n                fragement = origin.apply( null, arguments );\r\n    \r\n                parts = fragement.split(',');\r\n    \r\n                if ( ~parts[ 0 ].indexOf('base64') ) {\r\n                    fragement = atob( parts[ 1 ] );\r\n                } else {\r\n                    fragement = decodeURIComponent( parts[ 1 ] );\r\n                }\r\n    \r\n                fragement = fragement.substring( 0, 2 );\r\n    \r\n                supportJpeg = fragement.charCodeAt( 0 ) === 255 &&\r\n                        fragement.charCodeAt( 1 ) === 216;\r\n            }\r\n    \r\n            // 只有在android环境下才修复\r\n            if ( type === 'image/jpeg' && !supportJpeg ) {\r\n                w = canvas.width;\r\n                h = canvas.height;\r\n                ctx = canvas.getContext('2d');\r\n    \r\n                return encoder.encode( ctx.getImageData( 0, 0, w, h ), quality );\r\n            }\r\n    \r\n            return origin.apply( null, arguments );\r\n        };\r\n    });\r\n    /**\r\n     * @fileOverview Image\r\n     */\r\n    define('runtime/html5/image',[\r\n        'base',\r\n        'runtime/html5/runtime',\r\n        'runtime/html5/util'\r\n    ], function( Base, Html5Runtime, Util ) {\r\n    \r\n        var BLANK = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D';\r\n    \r\n        return Html5Runtime.register( 'Image', {\r\n    \r\n            // flag: 标记是否被修改过。\r\n            modified: false,\r\n    \r\n            init: function() {\r\n                var me = this,\r\n                    img = new Image();\r\n    \r\n                img.onload = function() {\r\n    \r\n                    me._info = {\r\n                        type: me.type,\r\n                        width: this.width,\r\n                        height: this.height\r\n                    };\r\n    \r\n                    //debugger;\r\n    \r\n                    // 读取meta信息。\r\n                    if ( !me._metas && 'image/jpeg' === me.type ) {\r\n                        Util.parseMeta( me._blob, function( error, ret ) {\r\n                            me._metas = ret;\r\n                            me.owner.trigger('load');\r\n                        });\r\n                    } else {\r\n                        me.owner.trigger('load');\r\n                    }\r\n                };\r\n    \r\n                img.onerror = function() {\r\n                    me.owner.trigger('error');\r\n                };\r\n    \r\n                me._img = img;\r\n            },\r\n    \r\n            loadFromBlob: function( blob ) {\r\n                var me = this,\r\n                    img = me._img;\r\n    \r\n                me._blob = blob;\r\n                me.type = blob.type;\r\n                img.src = Util.createObjectURL( blob.getSource() );\r\n                me.owner.once( 'load', function() {\r\n                    Util.revokeObjectURL( img.src );\r\n                });\r\n            },\r\n    \r\n            resize: function( width, height ) {\r\n                var canvas = this._canvas ||\r\n                        (this._canvas = document.createElement('canvas'));\r\n    \r\n                this._resize( this._img, canvas, width, height );\r\n                this._blob = null;    // 没用了，可以删掉了。\r\n                this.modified = true;\r\n                this.owner.trigger( 'complete', 'resize' );\r\n            },\r\n    \r\n            crop: function( x, y, w, h, s ) {\r\n                var cvs = this._canvas ||\r\n                        (this._canvas = document.createElement('canvas')),\r\n                    opts = this.options,\r\n                    img = this._img,\r\n                    iw = img.naturalWidth,\r\n                    ih = img.naturalHeight,\r\n                    orientation = this.getOrientation();\r\n    \r\n                s = s || 1;\r\n    \r\n                // todo 解决 orientation 的问题。\r\n                // values that require 90 degree rotation\r\n                // if ( ~[ 5, 6, 7, 8 ].indexOf( orientation ) ) {\r\n    \r\n                //     switch ( orientation ) {\r\n                //         case 6:\r\n                //             tmp = x;\r\n                //             x = y;\r\n                //             y = iw * s - tmp - w;\r\n                //             console.log(ih * s, tmp, w)\r\n                //             break;\r\n                //     }\r\n    \r\n                //     (w ^= h, h ^= w, w ^= h);\r\n                // }\r\n    \r\n                cvs.width = w;\r\n                cvs.height = h;\r\n    \r\n                opts.preserveHeaders || this._rotate2Orientaion( cvs, orientation );\r\n                this._renderImageToCanvas( cvs, img, -x, -y, iw * s, ih * s );\r\n    \r\n                this._blob = null;    // 没用了，可以删掉了。\r\n                this.modified = true;\r\n                this.owner.trigger( 'complete', 'crop' );\r\n            },\r\n    \r\n            getAsBlob: function( type ) {\r\n                var blob = this._blob,\r\n                    opts = this.options,\r\n                    canvas;\r\n    \r\n                type = type || this.type;\r\n    \r\n                // blob需要重新生成。\r\n                if ( this.modified || this.type !== type ) {\r\n                    canvas = this._canvas;\r\n    \r\n                    if ( type === 'image/jpeg' ) {\r\n    \r\n                        blob = Util.canvasToDataUrl( canvas, type, opts.quality );\r\n    \r\n                        if ( opts.preserveHeaders && this._metas &&\r\n                                this._metas.imageHead ) {\r\n    \r\n                            blob = Util.dataURL2ArrayBuffer( blob );\r\n                            blob = Util.updateImageHead( blob,\r\n                                    this._metas.imageHead );\r\n                            blob = Util.arrayBufferToBlob( blob, type );\r\n                            return blob;\r\n                        }\r\n                    } else {\r\n                        blob = Util.canvasToDataUrl( canvas, type );\r\n                    }\r\n    \r\n                    blob = Util.dataURL2Blob( blob );\r\n                }\r\n    \r\n                return blob;\r\n            },\r\n    \r\n            getAsDataUrl: function( type ) {\r\n                var opts = this.options;\r\n    \r\n                type = type || this.type;\r\n    \r\n                if ( type === 'image/jpeg' ) {\r\n                    return Util.canvasToDataUrl( this._canvas, type, opts.quality );\r\n                } else {\r\n                    return this._canvas.toDataURL( type );\r\n                }\r\n            },\r\n    \r\n            getOrientation: function() {\r\n                return this._metas && this._metas.exif &&\r\n                        this._metas.exif.get('Orientation') || 1;\r\n            },\r\n    \r\n            info: function( val ) {\r\n    \r\n                // setter\r\n                if ( val ) {\r\n                    this._info = val;\r\n                    return this;\r\n                }\r\n    \r\n                // getter\r\n                return this._info;\r\n            },\r\n    \r\n            meta: function( val ) {\r\n    \r\n                // setter\r\n                if ( val ) {\r\n                    this._metas = val;\r\n                    return this;\r\n                }\r\n    \r\n                // getter\r\n                return this._metas;\r\n            },\r\n    \r\n            destroy: function() {\r\n                var canvas = this._canvas;\r\n                this._img.onload = null;\r\n    \r\n                if ( canvas ) {\r\n                    canvas.getContext('2d')\r\n                            .clearRect( 0, 0, canvas.width, canvas.height );\r\n                    canvas.width = canvas.height = 0;\r\n                    this._canvas = null;\r\n                }\r\n    \r\n                // 释放内存。非常重要，否则释放不了image的内存。\r\n                this._img.src = BLANK;\r\n                this._img = this._blob = null;\r\n            },\r\n    \r\n            _resize: function( img, cvs, width, height ) {\r\n                var opts = this.options,\r\n                    naturalWidth = img.width,\r\n                    naturalHeight = img.height,\r\n                    orientation = this.getOrientation(),\r\n                    scale, w, h, x, y;\r\n    \r\n                // values that require 90 degree rotation\r\n                if ( ~[ 5, 6, 7, 8 ].indexOf( orientation ) ) {\r\n    \r\n                    // 交换width, height的值。\r\n                    width ^= height;\r\n                    height ^= width;\r\n                    width ^= height;\r\n                }\r\n    \r\n                scale = Math[ opts.crop ? 'max' : 'min' ]( width / naturalWidth,\r\n                        height / naturalHeight );\r\n    \r\n                // 不允许放大。\r\n                opts.allowMagnify || (scale = Math.min( 1, scale ));\r\n    \r\n                w = naturalWidth * scale;\r\n                h = naturalHeight * scale;\r\n    \r\n                if ( opts.crop ) {\r\n                    cvs.width = width;\r\n                    cvs.height = height;\r\n                } else {\r\n                    cvs.width = w;\r\n                    cvs.height = h;\r\n                }\r\n    \r\n                x = (cvs.width - w) / 2;\r\n                y = (cvs.height - h) / 2;\r\n    \r\n                opts.preserveHeaders || this._rotate2Orientaion( cvs, orientation );\r\n    \r\n                this._renderImageToCanvas( cvs, img, x, y, w, h );\r\n            },\r\n    \r\n            _rotate2Orientaion: function( canvas, orientation ) {\r\n                var width = canvas.width,\r\n                    height = canvas.height,\r\n                    ctx = canvas.getContext('2d');\r\n    \r\n                switch ( orientation ) {\r\n                    case 5:\r\n                    case 6:\r\n                    case 7:\r\n                    case 8:\r\n                        canvas.width = height;\r\n                        canvas.height = width;\r\n                        break;\r\n                }\r\n    \r\n                switch ( orientation ) {\r\n                    case 2:    // horizontal flip\r\n                        ctx.translate( width, 0 );\r\n                        ctx.scale( -1, 1 );\r\n                        break;\r\n    \r\n                    case 3:    // 180 rotate left\r\n                        ctx.translate( width, height );\r\n                        ctx.rotate( Math.PI );\r\n                        break;\r\n    \r\n                    case 4:    // vertical flip\r\n                        ctx.translate( 0, height );\r\n                        ctx.scale( 1, -1 );\r\n                        break;\r\n    \r\n                    case 5:    // vertical flip + 90 rotate right\r\n                        ctx.rotate( 0.5 * Math.PI );\r\n                        ctx.scale( 1, -1 );\r\n                        break;\r\n    \r\n                    case 6:    // 90 rotate right\r\n                        ctx.rotate( 0.5 * Math.PI );\r\n                        ctx.translate( 0, -height );\r\n                        break;\r\n    \r\n                    case 7:    // horizontal flip + 90 rotate right\r\n                        ctx.rotate( 0.5 * Math.PI );\r\n                        ctx.translate( width, -height );\r\n                        ctx.scale( -1, 1 );\r\n                        break;\r\n    \r\n                    case 8:    // 90 rotate left\r\n                        ctx.rotate( -0.5 * Math.PI );\r\n                        ctx.translate( -width, 0 );\r\n                        break;\r\n                }\r\n            },\r\n    \r\n            // https://github.com/stomita/ios-imagefile-megapixel/\r\n            // blob/master/src/megapix-image.js\r\n            _renderImageToCanvas: (function() {\r\n    \r\n                // 如果不是ios, 不需要这么复杂！\r\n                if ( !Base.os.ios ) {\r\n                    return function( canvas ) {\r\n                        var args = Base.slice( arguments, 1 ),\r\n                            ctx = canvas.getContext('2d');\r\n    \r\n                        ctx.drawImage.apply( ctx, args );\r\n                    };\r\n                }\r\n    \r\n                /**\r\n                 * Detecting vertical squash in loaded image.\r\n                 * Fixes a bug which squash image vertically while drawing into\r\n                 * canvas for some images.\r\n                 */\r\n                function detectVerticalSquash( img, iw, ih ) {\r\n                    var canvas = document.createElement('canvas'),\r\n                        ctx = canvas.getContext('2d'),\r\n                        sy = 0,\r\n                        ey = ih,\r\n                        py = ih,\r\n                        data, alpha, ratio;\r\n    \r\n    \r\n                    canvas.width = 1;\r\n                    canvas.height = ih;\r\n                    ctx.drawImage( img, 0, 0 );\r\n                    data = ctx.getImageData( 0, 0, 1, ih ).data;\r\n    \r\n                    // search image edge pixel position in case\r\n                    // it is squashed vertically.\r\n                    while ( py > sy ) {\r\n                        alpha = data[ (py - 1) * 4 + 3 ];\r\n    \r\n                        if ( alpha === 0 ) {\r\n                            ey = py;\r\n                        } else {\r\n                            sy = py;\r\n                        }\r\n    \r\n                        py = (ey + sy) >> 1;\r\n                    }\r\n    \r\n                    ratio = (py / ih);\r\n                    return (ratio === 0) ? 1 : ratio;\r\n                }\r\n    \r\n                // fix ie7 bug\r\n                // http://stackoverflow.com/questions/11929099/\r\n                // html5-canvas-drawimage-ratio-bug-ios\r\n                if ( Base.os.ios >= 7 ) {\r\n                    return function( canvas, img, x, y, w, h ) {\r\n                        var iw = img.naturalWidth,\r\n                            ih = img.naturalHeight,\r\n                            vertSquashRatio = detectVerticalSquash( img, iw, ih );\r\n    \r\n                        return canvas.getContext('2d').drawImage( img, 0, 0,\r\n                                iw * vertSquashRatio, ih * vertSquashRatio,\r\n                                x, y, w, h );\r\n                    };\r\n                }\r\n    \r\n                /**\r\n                 * Detect subsampling in loaded image.\r\n                 * In iOS, larger images than 2M pixels may be\r\n                 * subsampled in rendering.\r\n                 */\r\n                function detectSubsampling( img ) {\r\n                    var iw = img.naturalWidth,\r\n                        ih = img.naturalHeight,\r\n                        canvas, ctx;\r\n    \r\n                    // subsampling may happen overmegapixel image\r\n                    if ( iw * ih > 1024 * 1024 ) {\r\n                        canvas = document.createElement('canvas');\r\n                        canvas.width = canvas.height = 1;\r\n                        ctx = canvas.getContext('2d');\r\n                        ctx.drawImage( img, -iw + 1, 0 );\r\n    \r\n                        // subsampled image becomes half smaller in rendering size.\r\n                        // check alpha channel value to confirm image is covering\r\n                        // edge pixel or not. if alpha value is 0\r\n                        // image is not covering, hence subsampled.\r\n                        return ctx.getImageData( 0, 0, 1, 1 ).data[ 3 ] === 0;\r\n                    } else {\r\n                        return false;\r\n                    }\r\n                }\r\n    \r\n    \r\n                return function( canvas, img, x, y, width, height ) {\r\n                    var iw = img.naturalWidth,\r\n                        ih = img.naturalHeight,\r\n                        ctx = canvas.getContext('2d'),\r\n                        subsampled = detectSubsampling( img ),\r\n                        doSquash = this.type === 'image/jpeg',\r\n                        d = 1024,\r\n                        sy = 0,\r\n                        dy = 0,\r\n                        tmpCanvas, tmpCtx, vertSquashRatio, dw, dh, sx, dx;\r\n    \r\n                    if ( subsampled ) {\r\n                        iw /= 2;\r\n                        ih /= 2;\r\n                    }\r\n    \r\n                    ctx.save();\r\n                    tmpCanvas = document.createElement('canvas');\r\n                    tmpCanvas.width = tmpCanvas.height = d;\r\n    \r\n                    tmpCtx = tmpCanvas.getContext('2d');\r\n                    vertSquashRatio = doSquash ?\r\n                            detectVerticalSquash( img, iw, ih ) : 1;\r\n    \r\n                    dw = Math.ceil( d * width / iw );\r\n                    dh = Math.ceil( d * height / ih / vertSquashRatio );\r\n    \r\n                    while ( sy < ih ) {\r\n                        sx = 0;\r\n                        dx = 0;\r\n                        while ( sx < iw ) {\r\n                            tmpCtx.clearRect( 0, 0, d, d );\r\n                            tmpCtx.drawImage( img, -sx, -sy );\r\n                            ctx.drawImage( tmpCanvas, 0, 0, d, d,\r\n                                    x + dx, y + dy, dw, dh );\r\n                            sx += d;\r\n                            dx += dw;\r\n                        }\r\n                        sy += d;\r\n                        dy += dh;\r\n                    }\r\n                    ctx.restore();\r\n                    tmpCanvas = tmpCtx = null;\r\n                };\r\n            })()\r\n        });\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview Transport\r\n     * @todo 支持chunked传输，优势：\r\n     * 可以将大文件分成小块，挨个传输，可以提高大文件成功率，当失败的时候，也只需要重传那小部分，\r\n     * 而不需要重头再传一次。另外断点续传也需要用chunked方式。\r\n     */\r\n    define('runtime/html5/transport',[\r\n        'base',\r\n        'runtime/html5/runtime'\r\n    ], function( Base, Html5Runtime ) {\r\n    \r\n        var noop = Base.noop,\r\n            $ = Base.$;\r\n    \r\n        return Html5Runtime.register( 'Transport', {\r\n            init: function() {\r\n                this._status = 0;\r\n                this._response = null;\r\n            },\r\n    \r\n            send: function() {\r\n                var owner = this.owner,\r\n                    opts = this.options,\r\n                    xhr = this._initAjax(),\r\n                    blob = owner._blob,\r\n                    server = opts.server,\r\n                    formData, binary, fr;\r\n    \r\n                if ( opts.sendAsBinary ) {\r\n                    server += (/\\?/.test( server ) ? '&' : '?') +\r\n                            $.param( owner._formData );\r\n    \r\n                    binary = blob.getSource();\r\n                } else {\r\n                    formData = new FormData();\r\n                    $.each( owner._formData, function( k, v ) {\r\n                        formData.append( k, v );\r\n                    });\r\n    \r\n                    formData.append( opts.fileVal, blob.getSource(),\r\n                            opts.filename || owner._formData.name || '' );\r\n                }\r\n    \r\n                if ( opts.withCredentials && 'withCredentials' in xhr ) {\r\n                    xhr.open( opts.method, server, true );\r\n                    xhr.withCredentials = true;\r\n                } else {\r\n                    xhr.open( opts.method, server );\r\n                }\r\n    \r\n                this._setRequestHeader( xhr, opts.headers );\r\n    \r\n                if ( binary ) {\r\n                    // 强制设置成 content-type 为文件流。\r\n                    xhr.overrideMimeType &&\r\n                            xhr.overrideMimeType('application/octet-stream');\r\n    \r\n                    // android直接发送blob会导致服务端接收到的是空文件。\r\n                    // bug详情。\r\n                    // https://code.google.com/p/android/issues/detail?id=39882\r\n                    // 所以先用fileReader读取出来再通过arraybuffer的方式发送。\r\n                    if ( Base.os.android ) {\r\n                        fr = new FileReader();\r\n    \r\n                        fr.onload = function() {\r\n                            xhr.send( this.result );\r\n                            fr = fr.onload = null;\r\n                        };\r\n    \r\n                        fr.readAsArrayBuffer( binary );\r\n                    } else {\r\n                        xhr.send( binary );\r\n                    }\r\n                } else {\r\n                    xhr.send( formData );\r\n                }\r\n            },\r\n    \r\n            getResponse: function() {\r\n                return this._response;\r\n            },\r\n    \r\n            getResponseAsJson: function() {\r\n                return this._parseJson( this._response );\r\n            },\r\n    \r\n            getStatus: function() {\r\n                return this._status;\r\n            },\r\n    \r\n            abort: function() {\r\n                var xhr = this._xhr;\r\n    \r\n                if ( xhr ) {\r\n                    xhr.upload.onprogress = noop;\r\n                    xhr.onreadystatechange = noop;\r\n                    xhr.abort();\r\n    \r\n                    this._xhr = xhr = null;\r\n                }\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.abort();\r\n            },\r\n    \r\n            _initAjax: function() {\r\n                var me = this,\r\n                    xhr = new XMLHttpRequest(),\r\n                    opts = this.options;\r\n    \r\n                if ( opts.withCredentials && !('withCredentials' in xhr) &&\r\n                        typeof XDomainRequest !== 'undefined' ) {\r\n                    xhr = new XDomainRequest();\r\n                }\r\n    \r\n                xhr.upload.onprogress = function( e ) {\r\n                    var percentage = 0;\r\n    \r\n                    if ( e.lengthComputable ) {\r\n                        percentage = e.loaded / e.total;\r\n                    }\r\n    \r\n                    return me.trigger( 'progress', percentage );\r\n                };\r\n    \r\n                xhr.onreadystatechange = function() {\r\n    \r\n                    if ( xhr.readyState !== 4 ) {\r\n                        return;\r\n                    }\r\n    \r\n                    xhr.upload.onprogress = noop;\r\n                    xhr.onreadystatechange = noop;\r\n                    me._xhr = null;\r\n                    me._status = xhr.status;\r\n    \r\n                    if ( xhr.status >= 200 && xhr.status < 300 ) {\r\n                        me._response = xhr.responseText;\r\n                        return me.trigger('load');\r\n                    } else if ( xhr.status >= 500 && xhr.status < 600 ) {\r\n                        me._response = xhr.responseText;\r\n                        return me.trigger( 'error', 'server' );\r\n                    }\r\n    \r\n    \r\n                    return me.trigger( 'error', me._status ? 'http' : 'abort' );\r\n                };\r\n    \r\n                me._xhr = xhr;\r\n                return xhr;\r\n            },\r\n    \r\n            _setRequestHeader: function( xhr, headers ) {\r\n                $.each( headers, function( key, val ) {\r\n                    xhr.setRequestHeader( key, val );\r\n                });\r\n            },\r\n    \r\n            _parseJson: function( str ) {\r\n                var json;\r\n    \r\n                try {\r\n                    json = JSON.parse( str );\r\n                } catch ( ex ) {\r\n                    json = {};\r\n                }\r\n    \r\n                return json;\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview  Transport flash实现\r\n     */\r\n    define('runtime/html5/md5',[\r\n        'runtime/html5/runtime'\r\n    ], function( FlashRuntime ) {\r\n    \r\n        /*\r\n         * Fastest md5 implementation around (JKM md5)\r\n         * Credits: Joseph Myers\r\n         *\r\n         * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\r\n         * @see http://jsperf.com/md5-shootout/7\r\n         */\r\n    \r\n        /* this function is much faster,\r\n          so if possible we use it. Some IEs\r\n          are the only ones I know of that\r\n          need the idiotic second function,\r\n          generated by an if clause.  */\r\n        var add32 = function (a, b) {\r\n            return (a + b) & 0xFFFFFFFF;\r\n        },\r\n    \r\n        cmn = function (q, a, b, x, s, t) {\r\n            a = add32(add32(a, q), add32(x, t));\r\n            return add32((a << s) | (a >>> (32 - s)), b);\r\n        },\r\n    \r\n        ff = function (a, b, c, d, x, s, t) {\r\n            return cmn((b & c) | ((~b) & d), a, b, x, s, t);\r\n        },\r\n    \r\n        gg = function (a, b, c, d, x, s, t) {\r\n            return cmn((b & d) | (c & (~d)), a, b, x, s, t);\r\n        },\r\n    \r\n        hh = function (a, b, c, d, x, s, t) {\r\n            return cmn(b ^ c ^ d, a, b, x, s, t);\r\n        },\r\n    \r\n        ii = function (a, b, c, d, x, s, t) {\r\n            return cmn(c ^ (b | (~d)), a, b, x, s, t);\r\n        },\r\n    \r\n        md5cycle = function (x, k) {\r\n            var a = x[0],\r\n                b = x[1],\r\n                c = x[2],\r\n                d = x[3];\r\n    \r\n            a = ff(a, b, c, d, k[0], 7, -680876936);\r\n            d = ff(d, a, b, c, k[1], 12, -389564586);\r\n            c = ff(c, d, a, b, k[2], 17, 606105819);\r\n            b = ff(b, c, d, a, k[3], 22, -1044525330);\r\n            a = ff(a, b, c, d, k[4], 7, -176418897);\r\n            d = ff(d, a, b, c, k[5], 12, 1200080426);\r\n            c = ff(c, d, a, b, k[6], 17, -1473231341);\r\n            b = ff(b, c, d, a, k[7], 22, -45705983);\r\n            a = ff(a, b, c, d, k[8], 7, 1770035416);\r\n            d = ff(d, a, b, c, k[9], 12, -1958414417);\r\n            c = ff(c, d, a, b, k[10], 17, -42063);\r\n            b = ff(b, c, d, a, k[11], 22, -1990404162);\r\n            a = ff(a, b, c, d, k[12], 7, 1804603682);\r\n            d = ff(d, a, b, c, k[13], 12, -40341101);\r\n            c = ff(c, d, a, b, k[14], 17, -1502002290);\r\n            b = ff(b, c, d, a, k[15], 22, 1236535329);\r\n    \r\n            a = gg(a, b, c, d, k[1], 5, -165796510);\r\n            d = gg(d, a, b, c, k[6], 9, -1069501632);\r\n            c = gg(c, d, a, b, k[11], 14, 643717713);\r\n            b = gg(b, c, d, a, k[0], 20, -373897302);\r\n            a = gg(a, b, c, d, k[5], 5, -701558691);\r\n            d = gg(d, a, b, c, k[10], 9, 38016083);\r\n            c = gg(c, d, a, b, k[15], 14, -660478335);\r\n            b = gg(b, c, d, a, k[4], 20, -405537848);\r\n            a = gg(a, b, c, d, k[9], 5, 568446438);\r\n            d = gg(d, a, b, c, k[14], 9, -1019803690);\r\n            c = gg(c, d, a, b, k[3], 14, -187363961);\r\n            b = gg(b, c, d, a, k[8], 20, 1163531501);\r\n            a = gg(a, b, c, d, k[13], 5, -1444681467);\r\n            d = gg(d, a, b, c, k[2], 9, -51403784);\r\n            c = gg(c, d, a, b, k[7], 14, 1735328473);\r\n            b = gg(b, c, d, a, k[12], 20, -1926607734);\r\n    \r\n            a = hh(a, b, c, d, k[5], 4, -378558);\r\n            d = hh(d, a, b, c, k[8], 11, -2022574463);\r\n            c = hh(c, d, a, b, k[11], 16, 1839030562);\r\n            b = hh(b, c, d, a, k[14], 23, -35309556);\r\n            a = hh(a, b, c, d, k[1], 4, -1530992060);\r\n            d = hh(d, a, b, c, k[4], 11, 1272893353);\r\n            c = hh(c, d, a, b, k[7], 16, -155497632);\r\n            b = hh(b, c, d, a, k[10], 23, -1094730640);\r\n            a = hh(a, b, c, d, k[13], 4, 681279174);\r\n            d = hh(d, a, b, c, k[0], 11, -358537222);\r\n            c = hh(c, d, a, b, k[3], 16, -722521979);\r\n            b = hh(b, c, d, a, k[6], 23, 76029189);\r\n            a = hh(a, b, c, d, k[9], 4, -640364487);\r\n            d = hh(d, a, b, c, k[12], 11, -421815835);\r\n            c = hh(c, d, a, b, k[15], 16, 530742520);\r\n            b = hh(b, c, d, a, k[2], 23, -995338651);\r\n    \r\n            a = ii(a, b, c, d, k[0], 6, -198630844);\r\n            d = ii(d, a, b, c, k[7], 10, 1126891415);\r\n            c = ii(c, d, a, b, k[14], 15, -1416354905);\r\n            b = ii(b, c, d, a, k[5], 21, -57434055);\r\n            a = ii(a, b, c, d, k[12], 6, 1700485571);\r\n            d = ii(d, a, b, c, k[3], 10, -1894986606);\r\n            c = ii(c, d, a, b, k[10], 15, -1051523);\r\n            b = ii(b, c, d, a, k[1], 21, -2054922799);\r\n            a = ii(a, b, c, d, k[8], 6, 1873313359);\r\n            d = ii(d, a, b, c, k[15], 10, -30611744);\r\n            c = ii(c, d, a, b, k[6], 15, -1560198380);\r\n            b = ii(b, c, d, a, k[13], 21, 1309151649);\r\n            a = ii(a, b, c, d, k[4], 6, -145523070);\r\n            d = ii(d, a, b, c, k[11], 10, -1120210379);\r\n            c = ii(c, d, a, b, k[2], 15, 718787259);\r\n            b = ii(b, c, d, a, k[9], 21, -343485551);\r\n    \r\n            x[0] = add32(a, x[0]);\r\n            x[1] = add32(b, x[1]);\r\n            x[2] = add32(c, x[2]);\r\n            x[3] = add32(d, x[3]);\r\n        },\r\n    \r\n        /* there needs to be support for Unicode here,\r\n           * unless we pretend that we can redefine the MD-5\r\n           * algorithm for multi-byte characters (perhaps\r\n           * by adding every four 16-bit characters and\r\n           * shortening the sum to 32 bits). Otherwise\r\n           * I suggest performing MD-5 as if every character\r\n           * was two bytes--e.g., 0040 0025 = @%--but then\r\n           * how will an ordinary MD-5 sum be matched?\r\n           * There is no way to standardize text to something\r\n           * like UTF-8 before transformation; speed cost is\r\n           * utterly prohibitive. The JavaScript standard\r\n           * itself needs to look at this: it should start\r\n           * providing access to strings as preformed UTF-8\r\n           * 8-bit unsigned value arrays.\r\n           */\r\n        md5blk = function (s) {\r\n            var md5blks = [],\r\n                i; /* Andy King said do it this way. */\r\n    \r\n            for (i = 0; i < 64; i += 4) {\r\n                md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\r\n            }\r\n            return md5blks;\r\n        },\r\n    \r\n        md5blk_array = function (a) {\r\n            var md5blks = [],\r\n                i; /* Andy King said do it this way. */\r\n    \r\n            for (i = 0; i < 64; i += 4) {\r\n                md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\r\n            }\r\n            return md5blks;\r\n        },\r\n    \r\n        md51 = function (s) {\r\n            var n = s.length,\r\n                state = [1732584193, -271733879, -1732584194, 271733878],\r\n                i,\r\n                length,\r\n                tail,\r\n                tmp,\r\n                lo,\r\n                hi;\r\n    \r\n            for (i = 64; i <= n; i += 64) {\r\n                md5cycle(state, md5blk(s.substring(i - 64, i)));\r\n            }\r\n            s = s.substring(i - 64);\r\n            length = s.length;\r\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n            for (i = 0; i < length; i += 1) {\r\n                tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\r\n            }\r\n            tail[i >> 2] |= 0x80 << ((i % 4) << 3);\r\n            if (i > 55) {\r\n                md5cycle(state, tail);\r\n                for (i = 0; i < 16; i += 1) {\r\n                    tail[i] = 0;\r\n                }\r\n            }\r\n    \r\n            // Beware that the final length might not fit in 32 bits so we take care of that\r\n            tmp = n * 8;\r\n            tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\r\n            lo = parseInt(tmp[2], 16);\r\n            hi = parseInt(tmp[1], 16) || 0;\r\n    \r\n            tail[14] = lo;\r\n            tail[15] = hi;\r\n    \r\n            md5cycle(state, tail);\r\n            return state;\r\n        },\r\n    \r\n        md51_array = function (a) {\r\n            var n = a.length,\r\n                state = [1732584193, -271733879, -1732584194, 271733878],\r\n                i,\r\n                length,\r\n                tail,\r\n                tmp,\r\n                lo,\r\n                hi;\r\n    \r\n            for (i = 64; i <= n; i += 64) {\r\n                md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\r\n            }\r\n    \r\n            // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\r\n            // containing the last element of the parent array if the sub array specified starts\r\n            // beyond the length of the parent array - weird.\r\n            // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\r\n            a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\r\n    \r\n            length = a.length;\r\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n            for (i = 0; i < length; i += 1) {\r\n                tail[i >> 2] |= a[i] << ((i % 4) << 3);\r\n            }\r\n    \r\n            tail[i >> 2] |= 0x80 << ((i % 4) << 3);\r\n            if (i > 55) {\r\n                md5cycle(state, tail);\r\n                for (i = 0; i < 16; i += 1) {\r\n                    tail[i] = 0;\r\n                }\r\n            }\r\n    \r\n            // Beware that the final length might not fit in 32 bits so we take care of that\r\n            tmp = n * 8;\r\n            tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\r\n            lo = parseInt(tmp[2], 16);\r\n            hi = parseInt(tmp[1], 16) || 0;\r\n    \r\n            tail[14] = lo;\r\n            tail[15] = hi;\r\n    \r\n            md5cycle(state, tail);\r\n    \r\n            return state;\r\n        },\r\n    \r\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'],\r\n    \r\n        rhex = function (n) {\r\n            var s = '',\r\n                j;\r\n            for (j = 0; j < 4; j += 1) {\r\n                s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\r\n            }\r\n            return s;\r\n        },\r\n    \r\n        hex = function (x) {\r\n            var i;\r\n            for (i = 0; i < x.length; i += 1) {\r\n                x[i] = rhex(x[i]);\r\n            }\r\n            return x.join('');\r\n        },\r\n    \r\n        md5 = function (s) {\r\n            return hex(md51(s));\r\n        },\r\n    \r\n    \r\n    \r\n        ////////////////////////////////////////////////////////////////////////////\r\n    \r\n        /**\r\n         * SparkMD5 OOP implementation.\r\n         *\r\n         * Use this class to perform an incremental md5, otherwise use the\r\n         * static methods instead.\r\n         */\r\n        SparkMD5 = function () {\r\n            // call reset to init the instance\r\n            this.reset();\r\n        };\r\n    \r\n    \r\n        // In some cases the fast add32 function cannot be used..\r\n        if (md5('hello') !== '5d41402abc4b2a76b9719d911017c592') {\r\n            add32 = function (x, y) {\r\n                var lsw = (x & 0xFFFF) + (y & 0xFFFF),\r\n                    msw = (x >> 16) + (y >> 16) + (lsw >> 16);\r\n                return (msw << 16) | (lsw & 0xFFFF);\r\n            };\r\n        }\r\n    \r\n    \r\n        /**\r\n         * Appends a string.\r\n         * A conversion will be applied if an utf8 string is detected.\r\n         *\r\n         * @param {String} str The string to be appended\r\n         *\r\n         * @return {SparkMD5} The instance itself\r\n         */\r\n        SparkMD5.prototype.append = function (str) {\r\n            // converts the string to utf8 bytes if necessary\r\n            if (/[\\u0080-\\uFFFF]/.test(str)) {\r\n                str = unescape(encodeURIComponent(str));\r\n            }\r\n    \r\n            // then append as binary\r\n            this.appendBinary(str);\r\n    \r\n            return this;\r\n        };\r\n    \r\n        /**\r\n         * Appends a binary string.\r\n         *\r\n         * @param {String} contents The binary string to be appended\r\n         *\r\n         * @return {SparkMD5} The instance itself\r\n         */\r\n        SparkMD5.prototype.appendBinary = function (contents) {\r\n            this._buff += contents;\r\n            this._length += contents.length;\r\n    \r\n            var length = this._buff.length,\r\n                i;\r\n    \r\n            for (i = 64; i <= length; i += 64) {\r\n                md5cycle(this._state, md5blk(this._buff.substring(i - 64, i)));\r\n            }\r\n    \r\n            this._buff = this._buff.substr(i - 64);\r\n    \r\n            return this;\r\n        };\r\n    \r\n        /**\r\n         * Finishes the incremental computation, reseting the internal state and\r\n         * returning the result.\r\n         * Use the raw parameter to obtain the raw result instead of the hex one.\r\n         *\r\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\r\n         *\r\n         * @return {String|Array} The result\r\n         */\r\n        SparkMD5.prototype.end = function (raw) {\r\n            var buff = this._buff,\r\n                length = buff.length,\r\n                i,\r\n                tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n                ret;\r\n    \r\n            for (i = 0; i < length; i += 1) {\r\n                tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\r\n            }\r\n    \r\n            this._finish(tail, length);\r\n            ret = !!raw ? this._state : hex(this._state);\r\n    \r\n            this.reset();\r\n    \r\n            return ret;\r\n        };\r\n    \r\n        /**\r\n         * Finish the final calculation based on the tail.\r\n         *\r\n         * @param {Array}  tail   The tail (will be modified)\r\n         * @param {Number} length The length of the remaining buffer\r\n         */\r\n        SparkMD5.prototype._finish = function (tail, length) {\r\n            var i = length,\r\n                tmp,\r\n                lo,\r\n                hi;\r\n    \r\n            tail[i >> 2] |= 0x80 << ((i % 4) << 3);\r\n            if (i > 55) {\r\n                md5cycle(this._state, tail);\r\n                for (i = 0; i < 16; i += 1) {\r\n                    tail[i] = 0;\r\n                }\r\n            }\r\n    \r\n            // Do the final computation based on the tail and length\r\n            // Beware that the final length may not fit in 32 bits so we take care of that\r\n            tmp = this._length * 8;\r\n            tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\r\n            lo = parseInt(tmp[2], 16);\r\n            hi = parseInt(tmp[1], 16) || 0;\r\n    \r\n            tail[14] = lo;\r\n            tail[15] = hi;\r\n            md5cycle(this._state, tail);\r\n        };\r\n    \r\n        /**\r\n         * Resets the internal state of the computation.\r\n         *\r\n         * @return {SparkMD5} The instance itself\r\n         */\r\n        SparkMD5.prototype.reset = function () {\r\n            this._buff = \"\";\r\n            this._length = 0;\r\n            this._state = [1732584193, -271733879, -1732584194, 271733878];\r\n    \r\n            return this;\r\n        };\r\n    \r\n        /**\r\n         * Releases memory used by the incremental buffer and other aditional\r\n         * resources. If you plan to use the instance again, use reset instead.\r\n         */\r\n        SparkMD5.prototype.destroy = function () {\r\n            delete this._state;\r\n            delete this._buff;\r\n            delete this._length;\r\n        };\r\n    \r\n    \r\n        /**\r\n         * Performs the md5 hash on a string.\r\n         * A conversion will be applied if utf8 string is detected.\r\n         *\r\n         * @param {String}  str The string\r\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\r\n         *\r\n         * @return {String|Array} The result\r\n         */\r\n        SparkMD5.hash = function (str, raw) {\r\n            // converts the string to utf8 bytes if necessary\r\n            if (/[\\u0080-\\uFFFF]/.test(str)) {\r\n                str = unescape(encodeURIComponent(str));\r\n            }\r\n    \r\n            var hash = md51(str);\r\n    \r\n            return !!raw ? hash : hex(hash);\r\n        };\r\n    \r\n        /**\r\n         * Performs the md5 hash on a binary string.\r\n         *\r\n         * @param {String}  content The binary string\r\n         * @param {Boolean} raw     True to get the raw result, false to get the hex result\r\n         *\r\n         * @return {String|Array} The result\r\n         */\r\n        SparkMD5.hashBinary = function (content, raw) {\r\n            var hash = md51(content);\r\n    \r\n            return !!raw ? hash : hex(hash);\r\n        };\r\n    \r\n        /**\r\n         * SparkMD5 OOP implementation for array buffers.\r\n         *\r\n         * Use this class to perform an incremental md5 ONLY for array buffers.\r\n         */\r\n        SparkMD5.ArrayBuffer = function () {\r\n            // call reset to init the instance\r\n            this.reset();\r\n        };\r\n    \r\n        ////////////////////////////////////////////////////////////////////////////\r\n    \r\n        /**\r\n         * Appends an array buffer.\r\n         *\r\n         * @param {ArrayBuffer} arr The array to be appended\r\n         *\r\n         * @return {SparkMD5.ArrayBuffer} The instance itself\r\n         */\r\n        SparkMD5.ArrayBuffer.prototype.append = function (arr) {\r\n            // TODO: we could avoid the concatenation here but the algorithm would be more complex\r\n            //       if you find yourself needing extra performance, please make a PR.\r\n            var buff = this._concatArrayBuffer(this._buff, arr),\r\n                length = buff.length,\r\n                i;\r\n    \r\n            this._length += arr.byteLength;\r\n    \r\n            for (i = 64; i <= length; i += 64) {\r\n                md5cycle(this._state, md5blk_array(buff.subarray(i - 64, i)));\r\n            }\r\n    \r\n            // Avoids IE10 weirdness (documented above)\r\n            this._buff = (i - 64) < length ? buff.subarray(i - 64) : new Uint8Array(0);\r\n    \r\n            return this;\r\n        };\r\n    \r\n        /**\r\n         * Finishes the incremental computation, reseting the internal state and\r\n         * returning the result.\r\n         * Use the raw parameter to obtain the raw result instead of the hex one.\r\n         *\r\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\r\n         *\r\n         * @return {String|Array} The result\r\n         */\r\n        SparkMD5.ArrayBuffer.prototype.end = function (raw) {\r\n            var buff = this._buff,\r\n                length = buff.length,\r\n                tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n                i,\r\n                ret;\r\n    \r\n            for (i = 0; i < length; i += 1) {\r\n                tail[i >> 2] |= buff[i] << ((i % 4) << 3);\r\n            }\r\n    \r\n            this._finish(tail, length);\r\n            ret = !!raw ? this._state : hex(this._state);\r\n    \r\n            this.reset();\r\n    \r\n            return ret;\r\n        };\r\n    \r\n        SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\r\n    \r\n        /**\r\n         * Resets the internal state of the computation.\r\n         *\r\n         * @return {SparkMD5.ArrayBuffer} The instance itself\r\n         */\r\n        SparkMD5.ArrayBuffer.prototype.reset = function () {\r\n            this._buff = new Uint8Array(0);\r\n            this._length = 0;\r\n            this._state = [1732584193, -271733879, -1732584194, 271733878];\r\n    \r\n            return this;\r\n        };\r\n    \r\n        /**\r\n         * Releases memory used by the incremental buffer and other aditional\r\n         * resources. If you plan to use the instance again, use reset instead.\r\n         */\r\n        SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\r\n    \r\n        /**\r\n         * Concats two array buffers, returning a new one.\r\n         *\r\n         * @param  {ArrayBuffer} first  The first array buffer\r\n         * @param  {ArrayBuffer} second The second array buffer\r\n         *\r\n         * @return {ArrayBuffer} The new array buffer\r\n         */\r\n        SparkMD5.ArrayBuffer.prototype._concatArrayBuffer = function (first, second) {\r\n            var firstLength = first.length,\r\n                result = new Uint8Array(firstLength + second.byteLength);\r\n    \r\n            result.set(first);\r\n            result.set(new Uint8Array(second), firstLength);\r\n    \r\n            return result;\r\n        };\r\n    \r\n        /**\r\n         * Performs the md5 hash on an array buffer.\r\n         *\r\n         * @param {ArrayBuffer} arr The array buffer\r\n         * @param {Boolean}     raw True to get the raw result, false to get the hex result\r\n         *\r\n         * @return {String|Array} The result\r\n         */\r\n        SparkMD5.ArrayBuffer.hash = function (arr, raw) {\r\n            var hash = md51_array(new Uint8Array(arr));\r\n    \r\n            return !!raw ? hash : hex(hash);\r\n        };\r\n        \r\n        return FlashRuntime.register( 'Md5', {\r\n            init: function() {\r\n                // do nothing.\r\n            },\r\n    \r\n            loadFromBlob: function( file ) {\r\n                var blob = file.getSource(),\r\n                    chunkSize = 2 * 1024 * 1024,\r\n                    chunks = Math.ceil( blob.size / chunkSize ),\r\n                    chunk = 0,\r\n                    owner = this.owner,\r\n                    spark = new SparkMD5.ArrayBuffer(),\r\n                    me = this,\r\n                    blobSlice = blob.mozSlice || blob.webkitSlice || blob.slice,\r\n                    loadNext, fr;\r\n    \r\n                fr = new FileReader();\r\n    \r\n                loadNext = function() {\r\n                    var start, end;\r\n    \r\n                    start = chunk * chunkSize;\r\n                    end = Math.min( start + chunkSize, blob.size );\r\n    \r\n                    fr.onload = function( e ) {\r\n                        spark.append( e.target.result );\r\n                        owner.trigger( 'progress', {\r\n                            total: file.size,\r\n                            loaded: end\r\n                        });\r\n                    };\r\n    \r\n                    fr.onloadend = function() {\r\n                        fr.onloadend = fr.onload = null;\r\n    \r\n                        if ( ++chunk < chunks ) {\r\n                            setTimeout( loadNext, 1 );\r\n                        } else {\r\n                            setTimeout(function(){\r\n                                owner.trigger('load');\r\n                                me.result = spark.end();\r\n                                loadNext = file = blob = spark = null;\r\n                                owner.trigger('complete');\r\n                            }, 50 );\r\n                        }\r\n                    };\r\n    \r\n                    fr.readAsArrayBuffer( blobSlice.call( blob, start, end ) );\r\n                };\r\n    \r\n                loadNext();\r\n            },\r\n    \r\n            getResult: function() {\r\n                return this.result;\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview FlashRuntime\r\n     */\r\n    define('runtime/flash/runtime',[\r\n        'base',\r\n        'runtime/runtime',\r\n        'runtime/compbase'\r\n    ], function( Base, Runtime, CompBase ) {\r\n    \r\n        var $ = Base.$,\r\n            type = 'flash',\r\n            components = {};\r\n    \r\n    \r\n        function getFlashVersion() {\r\n            var version;\r\n    \r\n            try {\r\n                version = navigator.plugins[ 'Shockwave Flash' ];\r\n                version = version.description;\r\n            } catch ( ex ) {\r\n                try {\r\n                    version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\r\n                            .GetVariable('$version');\r\n                } catch ( ex2 ) {\r\n                    version = '0.0';\r\n                }\r\n            }\r\n            version = version.match( /\\d+/g );\r\n            return parseFloat( version[ 0 ] + '.' + version[ 1 ], 10 );\r\n        }\r\n    \r\n        function FlashRuntime() {\r\n            var pool = {},\r\n                clients = {},\r\n                destroy = this.destroy,\r\n                me = this,\r\n                jsreciver = Base.guid('webuploader_');\r\n    \r\n            Runtime.apply( me, arguments );\r\n            me.type = type;\r\n    \r\n    \r\n            // 这个方法的调用者，实际上是RuntimeClient\r\n            me.exec = function( comp, fn/*, args...*/ ) {\r\n                var client = this,\r\n                    uid = client.uid,\r\n                    args = Base.slice( arguments, 2 ),\r\n                    instance;\r\n    \r\n                clients[ uid ] = client;\r\n    \r\n                if ( components[ comp ] ) {\r\n                    if ( !pool[ uid ] ) {\r\n                        pool[ uid ] = new components[ comp ]( client, me );\r\n                    }\r\n    \r\n                    instance = pool[ uid ];\r\n    \r\n                    if ( instance[ fn ] ) {\r\n                        return instance[ fn ].apply( instance, args );\r\n                    }\r\n                }\r\n    \r\n                return me.flashExec.apply( client, arguments );\r\n            };\r\n    \r\n            function handler( evt, obj ) {\r\n                var type = evt.type || evt,\r\n                    parts, uid;\r\n    \r\n                parts = type.split('::');\r\n                uid = parts[ 0 ];\r\n                type = parts[ 1 ];\r\n    \r\n                // console.log.apply( console, arguments );\r\n    \r\n                if ( type === 'Ready' && uid === me.uid ) {\r\n                    me.trigger('ready');\r\n                } else if ( clients[ uid ] ) {\r\n                    clients[ uid ].trigger( type.toLowerCase(), evt, obj );\r\n                }\r\n    \r\n                // Base.log( evt, obj );\r\n            }\r\n    \r\n            // flash的接受器。\r\n            window[ jsreciver ] = function() {\r\n                var args = arguments;\r\n    \r\n                // 为了能捕获得到。\r\n                setTimeout(function() {\r\n                    handler.apply( null, args );\r\n                }, 1 );\r\n            };\r\n    \r\n            this.jsreciver = jsreciver;\r\n    \r\n            this.destroy = function() {\r\n                // @todo 删除池子中的所有实例\r\n                return destroy && destroy.apply( this, arguments );\r\n            };\r\n    \r\n            this.flashExec = function( comp, fn ) {\r\n                var flash = me.getFlash(),\r\n                    args = Base.slice( arguments, 2 );\r\n    \r\n                return flash.exec( this.uid, comp, fn, args );\r\n            };\r\n    \r\n            // @todo\r\n        }\r\n    \r\n        Base.inherits( Runtime, {\r\n            constructor: FlashRuntime,\r\n    \r\n            init: function() {\r\n                var container = this.getContainer(),\r\n                    opts = this.options,\r\n                    html;\r\n    \r\n                // if not the minimal height, shims are not initialized\r\n                // in older browsers (e.g FF3.6, IE6,7,8, Safari 4.0,5.0, etc)\r\n                container.css({\r\n                    position: 'absolute',\r\n                    top: '-8px',\r\n                    left: '-8px',\r\n                    width: '9px',\r\n                    height: '9px',\r\n                    overflow: 'hidden'\r\n                });\r\n    \r\n                // insert flash object\r\n                html = '<object id=\"' + this.uid + '\" type=\"application/' +\r\n                        'x-shockwave-flash\" data=\"' +  opts.swf + '\" ';\r\n    \r\n                if ( Base.browser.ie ) {\r\n                    html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\r\n                }\r\n    \r\n                html += 'width=\"100%\" height=\"100%\" style=\"outline:0\">'  +\r\n                    '<param name=\"movie\" value=\"' + opts.swf + '\" />' +\r\n                    '<param name=\"flashvars\" value=\"uid=' + this.uid +\r\n                    '&jsreciver=' + this.jsreciver + '\" />' +\r\n                    '<param name=\"wmode\" value=\"transparent\" />' +\r\n                    '<param name=\"allowscriptaccess\" value=\"always\" />' +\r\n                '</object>';\r\n    \r\n                container.html( html );\r\n            },\r\n    \r\n            getFlash: function() {\r\n                if ( this._flash ) {\r\n                    return this._flash;\r\n                }\r\n    \r\n                this._flash = $( '#' + this.uid ).get( 0 );\r\n                return this._flash;\r\n            }\r\n    \r\n        });\r\n    \r\n        FlashRuntime.register = function( name, component ) {\r\n            component = components[ name ] = Base.inherits( CompBase, $.extend({\r\n    \r\n                // @todo fix this later\r\n                flashExec: function() {\r\n                    var owner = this.owner,\r\n                        runtime = this.getRuntime();\r\n    \r\n                    return runtime.flashExec.apply( owner, arguments );\r\n                }\r\n            }, component ) );\r\n    \r\n            return component;\r\n        };\r\n    \r\n        if ( getFlashVersion() >= 11.4 ) {\r\n            Runtime.addRuntime( type, FlashRuntime );\r\n        }\r\n    \r\n        return FlashRuntime;\r\n    });\r\n    /**\r\n     * @fileOverview FilePicker\r\n     */\r\n    define('runtime/flash/filepicker',[\r\n        'base',\r\n        'runtime/flash/runtime'\r\n    ], function( Base, FlashRuntime ) {\r\n        var $ = Base.$;\r\n    \r\n        return FlashRuntime.register( 'FilePicker', {\r\n            init: function( opts ) {\r\n                var copy = $.extend({}, opts ),\r\n                    len, i;\r\n    \r\n                // 修复Flash再没有设置title的情况下无法弹出flash文件选择框的bug.\r\n                len = copy.accept && copy.accept.length;\r\n                for (  i = 0; i < len; i++ ) {\r\n                    if ( !copy.accept[ i ].title ) {\r\n                        copy.accept[ i ].title = 'Files';\r\n                    }\r\n                }\r\n    \r\n                delete copy.button;\r\n                delete copy.id;\r\n                delete copy.container;\r\n    \r\n                this.flashExec( 'FilePicker', 'init', copy );\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.flashExec( 'FilePicker', 'destroy' );\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview 图片压缩\r\n     */\r\n    define('runtime/flash/image',[\r\n        'runtime/flash/runtime'\r\n    ], function( FlashRuntime ) {\r\n    \r\n        return FlashRuntime.register( 'Image', {\r\n            // init: function( options ) {\r\n            //     var owner = this.owner;\r\n    \r\n            //     this.flashExec( 'Image', 'init', options );\r\n            //     owner.on( 'load', function() {\r\n            //         debugger;\r\n            //     });\r\n            // },\r\n    \r\n            loadFromBlob: function( blob ) {\r\n                var owner = this.owner;\r\n    \r\n                owner.info() && this.flashExec( 'Image', 'info', owner.info() );\r\n                owner.meta() && this.flashExec( 'Image', 'meta', owner.meta() );\r\n    \r\n                this.flashExec( 'Image', 'loadFromBlob', blob.uid );\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview  Transport flash实现\r\n     */\r\n    define('runtime/flash/transport',[\r\n        'base',\r\n        'runtime/flash/runtime',\r\n        'runtime/client'\r\n    ], function( Base, FlashRuntime, RuntimeClient ) {\r\n        var $ = Base.$;\r\n    \r\n        return FlashRuntime.register( 'Transport', {\r\n            init: function() {\r\n                this._status = 0;\r\n                this._response = null;\r\n                this._responseJson = null;\r\n            },\r\n    \r\n            send: function() {\r\n                var owner = this.owner,\r\n                    opts = this.options,\r\n                    xhr = this._initAjax(),\r\n                    blob = owner._blob,\r\n                    server = opts.server,\r\n                    binary;\r\n    \r\n                xhr.connectRuntime( blob.ruid );\r\n    \r\n                if ( opts.sendAsBinary ) {\r\n                    server += (/\\?/.test( server ) ? '&' : '?') +\r\n                            $.param( owner._formData );\r\n    \r\n                    binary = blob.uid;\r\n                } else {\r\n                    $.each( owner._formData, function( k, v ) {\r\n                        xhr.exec( 'append', k, v );\r\n                    });\r\n    \r\n                    xhr.exec( 'appendBlob', opts.fileVal, blob.uid,\r\n                            opts.filename || owner._formData.name || '' );\r\n                }\r\n    \r\n                this._setRequestHeader( xhr, opts.headers );\r\n                xhr.exec( 'send', {\r\n                    method: opts.method,\r\n                    url: server,\r\n                    forceURLStream: opts.forceURLStream,\r\n                    mimeType: 'application/octet-stream'\r\n                }, binary );\r\n            },\r\n    \r\n            getStatus: function() {\r\n                return this._status;\r\n            },\r\n    \r\n            getResponse: function() {\r\n                return this._response || '';\r\n            },\r\n    \r\n            getResponseAsJson: function() {\r\n                return this._responseJson;\r\n            },\r\n    \r\n            abort: function() {\r\n                var xhr = this._xhr;\r\n    \r\n                if ( xhr ) {\r\n                    xhr.exec('abort');\r\n                    xhr.destroy();\r\n                    this._xhr = xhr = null;\r\n                }\r\n            },\r\n    \r\n            destroy: function() {\r\n                this.abort();\r\n            },\r\n    \r\n            _initAjax: function() {\r\n                var me = this,\r\n                    xhr = new RuntimeClient('XMLHttpRequest');\r\n    \r\n                xhr.on( 'uploadprogress progress', function( e ) {\r\n                    var percent = e.loaded / e.total;\r\n                    percent = Math.min( 1, Math.max( 0, percent ) );\r\n                    return me.trigger( 'progress', percent );\r\n                });\r\n    \r\n                xhr.on( 'load', function() {\r\n                    var status = xhr.exec('getStatus'),\r\n                        readBody = false,\r\n                        err = '',\r\n                        p;\r\n    \r\n                    xhr.off();\r\n                    me._xhr = null;\r\n    \r\n                    if ( status >= 200 && status < 300 ) {\r\n                        readBody = true;\r\n                    } else if ( status >= 500 && status < 600 ) {\r\n                        readBody = true;\r\n                        err = 'server';\r\n                    } else {\r\n                        err = 'http';\r\n                    }\r\n    \r\n                    if ( readBody ) {\r\n                        me._response = xhr.exec('getResponse');\r\n                        me._response = decodeURIComponent( me._response );\r\n    \r\n                        // flash 处理可能存在 bug, 没辙只能靠 js 了\r\n                        // try {\r\n                        //     me._responseJson = xhr.exec('getResponseAsJson');\r\n                        // } catch ( error ) {\r\n    \r\n                        p = function( s ) {\r\n                            try {\r\n                                if (window.JSON && window.JSON.parse) {\r\n                                    return JSON.parse(s);\r\n                                }\r\n    \r\n                                return new Function('return ' + s).call();\r\n                            } catch ( err ) {\r\n                                return {};\r\n                            }\r\n                        };\r\n                        me._responseJson  = me._response ? p(me._response) : {};\r\n    \r\n                        // }\r\n                    }\r\n    \r\n                    xhr.destroy();\r\n                    xhr = null;\r\n    \r\n                    return err ? me.trigger( 'error', err ) : me.trigger('load');\r\n                });\r\n    \r\n                xhr.on( 'error', function() {\r\n                    xhr.off();\r\n                    me._xhr = null;\r\n                    me.trigger( 'error', 'http' );\r\n                });\r\n    \r\n                me._xhr = xhr;\r\n                return xhr;\r\n            },\r\n    \r\n            _setRequestHeader: function( xhr, headers ) {\r\n                $.each( headers, function( key, val ) {\r\n                    xhr.exec( 'setRequestHeader', key, val );\r\n                });\r\n            }\r\n        });\r\n    });\r\n    \r\n    /**\r\n     * @fileOverview Blob Html实现\r\n     */\r\n    define('runtime/flash/blob',[\r\n        'runtime/flash/runtime',\r\n        'lib/blob'\r\n    ], function( FlashRuntime, Blob ) {\r\n    \r\n        return FlashRuntime.register( 'Blob', {\r\n            slice: function( start, end ) {\r\n                var blob = this.flashExec( 'Blob', 'slice', start, end );\r\n    \r\n                return new Blob( this.getRuid(), blob );\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview  Md5 flash实现\r\n     */\r\n    define('runtime/flash/md5',[\r\n        'runtime/flash/runtime'\r\n    ], function( FlashRuntime ) {\r\n        \r\n        return FlashRuntime.register( 'Md5', {\r\n            init: function() {\r\n                // do nothing.\r\n            },\r\n    \r\n            loadFromBlob: function( blob ) {\r\n                return this.flashExec( 'Md5', 'loadFromBlob', blob.uid );\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview 完全版本。\r\n     */\r\n    define('preset/all',[\r\n        'base',\r\n    \r\n        // widgets\r\n        'widgets/filednd',\r\n        'widgets/filepaste',\r\n        'widgets/filepicker',\r\n        'widgets/image',\r\n        'widgets/queue',\r\n        'widgets/runtime',\r\n        'widgets/upload',\r\n        'widgets/validator',\r\n        'widgets/md5',\r\n    \r\n        // runtimes\r\n        // html5\r\n        'runtime/html5/blob',\r\n        'runtime/html5/dnd',\r\n        'runtime/html5/filepaste',\r\n        'runtime/html5/filepicker',\r\n        'runtime/html5/imagemeta/exif',\r\n        'runtime/html5/androidpatch',\r\n        'runtime/html5/image',\r\n        'runtime/html5/transport',\r\n        'runtime/html5/md5',\r\n    \r\n        // flash\r\n        'runtime/flash/filepicker',\r\n        'runtime/flash/image',\r\n        'runtime/flash/transport',\r\n        'runtime/flash/blob',\r\n        'runtime/flash/md5'\r\n    ], function( Base ) {\r\n        return Base;\r\n    });\r\n    /**\r\n     * @fileOverview 日志组件，主要用来收集错误信息，可以帮助 webuploader 更好的定位问题和发展。\r\n     *\r\n     * 如果您不想要启用此功能，请在打包的时候去掉 log 模块。\r\n     *\r\n     * 或者可以在初始化的时候通过 options.disableWidgets 属性禁用。\r\n     *\r\n     * 如：\r\n     * WebUploader.create({\r\n     *     ...\r\n     *\r\n     *     disableWidgets: 'log',\r\n     *\r\n     *     ...\r\n     * })\r\n     */\r\n    define('widgets/log',[\r\n        'base',\r\n        'uploader',\r\n        'widgets/widget'\r\n    ], function( Base, Uploader ) {\r\n        var $ = Base.$,\r\n            logUrl = ' http://static.tieba.baidu.com/tb/pms/img/st.gif??',\r\n            product = (location.hostname || location.host || 'protected').toLowerCase(),\r\n    \r\n            // 只针对 baidu 内部产品用户做统计功能。\r\n            enable = product && /baidu/i.exec(product),\r\n            base;\r\n    \r\n        if (!enable) {\r\n            return;\r\n        }\r\n    \r\n        base = {\r\n            dv: 3,\r\n            master: 'webuploader',\r\n            online: /test/.exec(product) ? 0 : 1,\r\n            module: '',\r\n            product: product,\r\n            type: 0\r\n        };\r\n    \r\n        function send(data) {\r\n            var obj = $.extend({}, base, data),\r\n                url = logUrl.replace(/^(.*)\\?/, '$1' + $.param( obj )),\r\n                image = new Image();\r\n    \r\n            image.src = url;\r\n        }\r\n    \r\n        return Uploader.register({\r\n            name: 'log',\r\n    \r\n            init: function() {\r\n                var owner = this.owner,\r\n                    count = 0,\r\n                    size = 0;\r\n    \r\n                owner\r\n                    .on('error', function(code) {\r\n                        send({\r\n                            type: 2,\r\n                            c_error_code: code\r\n                        });\r\n                    })\r\n                    .on('uploadError', function(file, reason) {\r\n                        send({\r\n                            type: 2,\r\n                            c_error_code: 'UPLOAD_ERROR',\r\n                            c_reason: '' + reason\r\n                        });\r\n                    })\r\n                    .on('uploadComplete', function(file) {\r\n                        count++;\r\n                        size += file.size;\r\n                    }).\r\n                    on('uploadFinished', function() {\r\n                        send({\r\n                            c_count: count,\r\n                            c_size: size\r\n                        });\r\n                        count = size = 0;\r\n                    });\r\n    \r\n                send({\r\n                    c_usage: 1\r\n                });\r\n            }\r\n        });\r\n    });\r\n    /**\r\n     * @fileOverview Uploader上传类\r\n     */\r\n    define('webuploader',[\r\n        'preset/all',\r\n        'widgets/log'\r\n    ], function( preset ) {\r\n        return preset;\r\n    });\r\n    return require('webuploader');\r\n});\r\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy91cGxvYWQvd2VidXBsb2FkZXIuanM/ZTA0ZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9COztBQUVwQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSw4Q0FBOEMsU0FBUztBQUN2RDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQzs7O0FBR0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFD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QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTs7QUFFQSxpQkFBaUIsT0FBTztBQUN4QjtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsMEJBQTBCOztBQUUxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDs7O0FBR0E7QUFDQTtBQUNBLG1CQUFtQixPQUFPO0FBQzFCLG1CQUFtQixRQUFRO0FBQzNCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCOztBQUVqQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxpQkFBaUI7O0FBRWpCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSw2Q0FBNkM7O0FBRTdDOztBQUVBO0FB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YTs7QUFFYjtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsU0FBUzs7QUFFVDs7QUFFQTtBQUNBLDBCQUEwQixPQUFPO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBLDBCQUEwQixPQUFPO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDs7QUFFQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FB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O0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBUzs7QUFFVDs7QUFFQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUEsMERBQTBELFNBQVM7QUFDbkU7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxhQUFhOzs7QUFHYjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsYUFBYTs7O0FBR2I7QUFDQTtBQUNBLHVCQUF1QixLQUFLO0FBQzVCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsdUJBQXVCLEtBQUs7QUFDNUI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7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QUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsdUJBQXVCLFNBQVM7QUFDaEM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7O0FBRUE7QUFDQSxhQUFhOztBQUViO0FBQ0E7O0FBRUE7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7O0FBRUE7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7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QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esb0NBQW9DO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0Q7QUFDdEQsa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtB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O0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhOztBQUViOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNULEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7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LEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QjtBQUN6QixxQkFBcUI7QUFDckI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0EscUJBQXFCOztBQUVyQjtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsQ0FBQyIsImZpbGUiOiI4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohIFdlYlVwbG9hZGVyIDAuMS42ICovXHJcblxyXG5cclxuLyoqXHJcbiAqIEBmaWxlT3ZlcnZpZXcg6K6p5YaF6YOo5ZCE5Liq6YOo5Lu255qE5Luj56CB5Y+v5Lul55SoW2FtZF0oaHR0cHM6Ly9naXRodWIuY29tL2FtZGpzL2FtZGpzLWFwaS93aWtpL0FNRCnmqKHlnZflrprkuYnmlrnlvI/nu4Tnu4fotbfmnaXjgIJcclxuICpcclxuICogQU1EIEFQSSDlhoXpg6jnmoTnroDljZXkuI3lrozlhajlrp7njrDvvIzor7flv73nlaXjgILlj6rmnInlvZNXZWJVcGxvYWRlcuiiq+WQiOW5tuaIkOS4gOS4quaWh+S7tueahOaXtuWAmeaJjeS8muW8leWFpeOAglxyXG4gKi9cclxuKGZ1bmN0aW9uKCByb290LCBmYWN0b3J5ICkge1xyXG4gICAgdmFyIG1vZHVsZXMgPSB7fSxcclxuXHJcbiAgICAgICAgLy8g5YaF6YOocmVxdWlyZSwg566A5Y2V5LiN5a6M5YWo5a6e546w44CCXHJcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FtZGpzL2FtZGpzLWFwaS93aWtpL3JlcXVpcmVcclxuICAgICAgICBfcmVxdWlyZSA9IGZ1bmN0aW9uKCBkZXBzLCBjYWxsYmFjayApIHtcclxuICAgICAgICAgICAgdmFyIGFyZ3MsIGxlbiwgaTtcclxuXHJcbiAgICAgICAgICAgIC8vIOWmguaenGRlcHPkuI3mmK/mlbDnu4TvvIzliJnnm7TmjqXov5Tlm57mjIflrpptb2R1bGVcclxuICAgICAgICAgICAgaWYgKCB0eXBlb2YgZGVwcyA9PT0gJ3N0cmluZycgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0TW9kdWxlKCBkZXBzICk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhcmdzID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IoIGxlbiA9IGRlcHMubGVuZ3RoLCBpID0gMDsgaSA8IGxlbjsgaSsrICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCggZ2V0TW9kdWxlKCBkZXBzWyBpIF0gKSApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjay5hcHBseSggbnVsbCwgYXJncyApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLy8g5YaF6YOoZGVmaW5l77yM5pqC5pe25LiN5pSv5oyB5LiN5oyH5a6aaWQuXHJcbiAgICAgICAgX2RlZmluZSA9IGZ1bmN0aW9uKCBpZCwgZGVwcywgZmFjdG9yeSApIHtcclxuICAgICAgICAgICAgaWYgKCBhcmd1bWVudHMubGVuZ3RoID09PSAyICkge1xyXG4gICAgICAgICAgICAgICAgZmFjdG9yeSA9IGRlcHM7XHJcbiAgICAgICAgICAgICAgICBkZXBzID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgX3JlcXVpcmUoIGRlcHMgfHwgW10sIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgc2V0TW9kdWxlKCBpZCwgZmFjdG9yeSwgYXJndW1lbnRzICk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIC8vIOiuvue9rm1vZHVsZSwg5YW85a65Q29tbW9uSnPlhpnms5XjgIJcclxuICAgICAgICBzZXRNb2R1bGUgPSBmdW5jdGlvbiggaWQsIGZhY3RvcnksIGFyZ3MgKSB7XHJcbiAgICAgICAgICAgIHZhciBtb2R1bGUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXhwb3J0czogZmFjdG9yeVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJldHVybmVkO1xyXG5cclxuICAgICAgICAgICAgaWYgKCB0eXBlb2YgZmFjdG9yeSA9PT0gJ2Z1bmN0aW9uJyApIHtcclxuICAgICAgICAgICAgICAgIGFyZ3MubGVuZ3RoIHx8IChhcmdzID0gWyBfcmVxdWlyZSwgbW9kdWxlLmV4cG9ydHMsIG1vZHVsZSBdKTtcclxuICAgICAgICAgICAgICAgIHJldHVybmVkID0gZmFjdG9yeS5hcHBseSggbnVsbCwgYXJncyApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuZWQgIT09IHVuZGVmaW5lZCAmJiAobW9kdWxlLmV4cG9ydHMgPSByZXR1cm5lZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG1vZHVsZXNbIGlkIF0gPSBtb2R1bGUuZXhwb3J0cztcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICAvLyDmoLnmja5pZOiOt+WPlm1vZHVsZVxyXG4gICAgICAgIGdldE1vZHVsZSA9IGZ1bmN0aW9uKCBpZCApIHtcclxuICAgICAgICAgICAgdmFyIG1vZHVsZSA9IG1vZHVsZXNbIGlkIF0gfHwgcm9vdFsgaWQgXTtcclxuXHJcbiAgICAgICAgICAgIGlmICggIW1vZHVsZSApIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvciggJ2AnICsgaWQgKyAnYCBpcyB1bmRlZmluZWQnICk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGU7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgLy8g5bCG5omA5pyJbW9kdWxlc++8jOWwhui3r+W+hGlkc+ijheaNouaIkOWvueixoeOAglxyXG4gICAgICAgIGV4cG9ydHNUbyA9IGZ1bmN0aW9uKCBvYmogKSB7XHJcbiAgICAgICAgICAgIHZhciBrZXksIGhvc3QsIHBhcnRzLCBwYXJ0LCBsYXN0LCB1Y0ZpcnN0O1xyXG5cclxuICAgICAgICAgICAgLy8gbWFrZSB0aGUgZmlyc3QgY2hhcmFjdGVyIHVwcGVyIGNhc2UuXHJcbiAgICAgICAgICAgIHVjRmlyc3QgPSBmdW5jdGlvbiggc3RyICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0ciAmJiAoc3RyLmNoYXJBdCggMCApLnRvVXBwZXJDYXNlKCkgKyBzdHIuc3Vic3RyKCAxICkpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZm9yICgga2V5IGluIG1vZHVsZXMgKSB7XHJcbiAgICAgICAgICAgICAgICBob3N0ID0gb2JqO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICggIW1vZHVsZXMuaGFzT3duUHJvcGVydHkoIGtleSApICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHBhcnRzID0ga2V5LnNwbGl0KCcvJyk7XHJcbiAgICAgICAgICAgICAgICBsYXN0ID0gdWNGaXJzdCggcGFydHMucG9wKCkgKTtcclxuXHJcbiAgICAgICAgICAgICAgICB3aGlsZSggKHBhcnQgPSB1Y0ZpcnN0KCBwYXJ0cy5zaGlmdCgpICkpICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGhvc3RbIHBhcnQgXSA9IGhvc3RbIHBhcnQgXSB8fCB7fTtcclxuICAgICAgICAgICAgICAgICAgICBob3N0ID0gaG9zdFsgcGFydCBdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGhvc3RbIGxhc3QgXSA9IG1vZHVsZXNbIGtleSBdO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIG1ha2VFeHBvcnQgPSBmdW5jdGlvbiggZG9sbGFyICkge1xyXG4gICAgICAgICAgICByb290Ll9fZG9sbGFyID0gZG9sbGFyO1xyXG5cclxuICAgICAgICAgICAgLy8gZXhwb3J0cyBldmVyeSBtb2R1bGUuXHJcbiAgICAgICAgICAgIHJldHVybiBleHBvcnRzVG8oIGZhY3RvcnkoIHJvb3QsIF9kZWZpbmUsIF9yZXF1aXJlICkgKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBvcmlnaW47XHJcblxyXG4gICAgaWYgKCB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlLmV4cG9ydHMgPT09ICdvYmplY3QnICkge1xyXG5cclxuICAgICAgICAvLyBGb3IgQ29tbW9uSlMgYW5kIENvbW1vbkpTLWxpa2UgZW52aXJvbm1lbnRzIHdoZXJlIGEgcHJvcGVyIHdpbmRvdyBpcyBwcmVzZW50LFxyXG4gICAgICAgIG1vZHVsZS5leHBvcnRzID0gbWFrZUV4cG9ydCgpO1xyXG4gICAgfSBlbHNlIGlmICggdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kICkge1xyXG5cclxuICAgICAgICAvLyBBbGxvdyB1c2luZyB0aGlzIGJ1aWx0IGxpYnJhcnkgYXMgYW4gQU1EIG1vZHVsZVxyXG4gICAgICAgIC8vIGluIGFub3RoZXIgcHJvamVjdC4gVGhhdCBvdGhlciBwcm9qZWN0IHdpbGwgb25seVxyXG4gICAgICAgIC8vIHNlZSB0aGlzIEFNRCBjYWxsLCBub3QgdGhlIGludGVybmFsIG1vZHVsZXMgaW5cclxuICAgICAgICAvLyB0aGUgY2xvc3VyZSBiZWxvdy5cclxuICAgICAgICBkZWZpbmUoWyAnanF1ZXJ5JyBdLCBtYWtlRXhwb3J0ICk7XHJcbiAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAvLyBCcm93c2VyIGdsb2JhbHMgY2FzZS4gSnVzdCBhc3NpZ24gdGhlXHJcbiAgICAgICAgLy8gcmVzdWx0IHRvIGEgcHJvcGVydHkgb24gdGhlIGdsb2JhbC5cclxuICAgICAgICBvcmlnaW4gPSByb290LldlYlVwbG9hZGVyO1xyXG4gICAgICAgIHJvb3QuV2ViVXBsb2FkZXIgPSBtYWtlRXhwb3J0KCk7XHJcbiAgICAgICAgcm9vdC5XZWJVcGxvYWRlci5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJvb3QuV2ViVXBsb2FkZXIgPSBvcmlnaW47XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoIHdpbmRvdywgZnVuY3Rpb24oIHdpbmRvdywgZGVmaW5lLCByZXF1aXJlICkge1xyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcgalF1ZXJ5IG9yIFplcHRvXHJcbiAgICAgKiBAcmVxdWlyZSBcImpxdWVyeVwiXHJcbiAgICAgKiBAcmVxdWlyZSBcInplcHRvXCJcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdkb2xsYXItdGhpcmQnLFtdLGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciByZXEgPSB3aW5kb3cucmVxdWlyZTtcclxuICAgICAgICB2YXIgJCA9IHdpbmRvdy5fX2RvbGxhciB8fCBcclxuICAgICAgICAgICAgd2luZG93LmpRdWVyeSB8fCBcclxuICAgICAgICAgICAgd2luZG93LlplcHRvIHx8IFxyXG4gICAgICAgICAgICByZXEoJ2pxdWVyeScpIHx8IFxyXG4gICAgICAgICAgICByZXEoJ3plcHRvJyk7XHJcbiAgICBcclxuICAgICAgICBpZiAoICEkICkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2pRdWVyeSBvciBaZXB0byBub3QgZm91bmQhJyk7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuICQ7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IERvbSDmk43kvZznm7jlhbNcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdkb2xsYXInLFtcclxuICAgICAgICAnZG9sbGFyLXRoaXJkJ1xyXG4gICAgXSwgZnVuY3Rpb24oIF8gKSB7XHJcbiAgICAgICAgcmV0dXJuIF87XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogQGZpbGVPdmVydmlldyDkvb/nlKhqUXVlcnnnmoRQcm9taXNlXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgncHJvbWlzZS10aGlyZCcsW1xyXG4gICAgICAgICdkb2xsYXInXHJcbiAgICBdLCBmdW5jdGlvbiggJCApIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBEZWZlcnJlZDogJC5EZWZlcnJlZCxcclxuICAgICAgICAgICAgd2hlbjogJC53aGVuLFxyXG4gICAgXHJcbiAgICAgICAgICAgIGlzUHJvbWlzZTogZnVuY3Rpb24oIGFueXRoaW5nICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFueXRoaW5nICYmIHR5cGVvZiBhbnl0aGluZy50aGVuID09PSAnZnVuY3Rpb24nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IFByb21pc2UvQStcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdwcm9taXNlJyxbXHJcbiAgICAgICAgJ3Byb21pc2UtdGhpcmQnXHJcbiAgICBdLCBmdW5jdGlvbiggXyApIHtcclxuICAgICAgICByZXR1cm4gXztcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IOWfuuehgOexu+aWueazleOAglxyXG4gICAgICovXHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICogV2ViIFVwbG9hZGVy5YaF6YOo57G755qE6K+m57uG6K+05piO77yM5Lul5LiL5o+Q5Y+K55qE5Yqf6IO957G777yM6YO95Y+v5Lul5ZyoYFdlYlVwbG9hZGVyYOi/meS4quWPmOmHj+S4reiuv+mXruWIsOOAglxyXG4gICAgICpcclxuICAgICAqIEFzIHlvdSBrbm93LCBXZWIgVXBsb2FkZXLnmoTmr4/kuKrmlofku7bpg73mmK/nlKjov4dbQU1EXShodHRwczovL2dpdGh1Yi5jb20vYW1kanMvYW1kanMtYXBpL3dpa2kvQU1EKeinhOiMg+S4reeahGBkZWZpbmVg57uE57uH6LW35p2l55qELCDmr4/kuKpNb2R1bGXpg73kvJrmnInkuKptb2R1bGUgaWQuXHJcbiAgICAgKiDpu5jorqRtb2R1bGUgaWTkuLror6Xmlofku7bnmoTot6/lvoTvvIzogIzmraTot6/lvoTlsIbkvJrovazljJbmiJDlkI3lrZfnqbrpl7TlrZjmlL7lnKhXZWJVcGxvYWRlcuS4reOAguWmgu+8mlxyXG4gICAgICpcclxuICAgICAqICogbW9kdWxlIGBiYXNlYO+8mldlYlVwbG9hZGVyLkJhc2VcclxuICAgICAqICogbW9kdWxlIGBmaWxlYDogV2ViVXBsb2FkZXIuRmlsZVxyXG4gICAgICogKiBtb2R1bGUgYGxpYi9kbmRgOiBXZWJVcGxvYWRlci5MaWIuRG5kXHJcbiAgICAgKiAqIG1vZHVsZSBgcnVudGltZS9odG1sNS9kbmRgOiBXZWJVcGxvYWRlci5SdW50aW1lLkh0bWw1LkRuZFxyXG4gICAgICpcclxuICAgICAqXHJcbiAgICAgKiDku6XkuIvmlofmoaPkuK3lr7nnsbvnmoTkvb/nlKjlj6/og73nnIHnlaXmjonkuoZgV2ViVXBsb2FkZXJg5YmN57yA44CCXHJcbiAgICAgKiBAbW9kdWxlIFdlYlVwbG9hZGVyXHJcbiAgICAgKiBAdGl0bGUgV2ViVXBsb2FkZXIgQVBJ5paH5qGjXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgnYmFzZScsW1xyXG4gICAgICAgICdkb2xsYXInLFxyXG4gICAgICAgICdwcm9taXNlJ1xyXG4gICAgXSwgZnVuY3Rpb24oICQsIHByb21pc2UgKSB7XHJcbiAgICBcclxuICAgICAgICB2YXIgbm9vcCA9IGZ1bmN0aW9uKCkge30sXHJcbiAgICAgICAgICAgIGNhbGwgPSBGdW5jdGlvbi5jYWxsO1xyXG4gICAgXHJcbiAgICAgICAgLy8gaHR0cDovL2pzcGVyZi5jb20vdW5jdXJyeXRoaXNcclxuICAgICAgICAvLyDlj43np5Hph4zljJZcclxuICAgICAgICBmdW5jdGlvbiB1bmN1cnJ5VGhpcyggZm4gKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsLmFwcGx5KCBmbiwgYXJndW1lbnRzICk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYmluZEZuKCBmbiwgY29udGV4dCApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZuLmFwcGx5KCBjb250ZXh0LCBhcmd1bWVudHMgKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVPYmplY3QoIHByb3RvICkge1xyXG4gICAgICAgICAgICB2YXIgZjtcclxuICAgIFxyXG4gICAgICAgICAgICBpZiAoIE9iamVjdC5jcmVhdGUgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmNyZWF0ZSggcHJvdG8gKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGYgPSBmdW5jdGlvbigpIHt9O1xyXG4gICAgICAgICAgICAgICAgZi5wcm90b3R5cGUgPSBwcm90bztcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgZigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDln7rnoYDnsbvvvIzmj5DkvpvkuIDkupvnroDljZXluLjnlKjnmoTmlrnms5XjgIJcclxuICAgICAgICAgKiBAY2xhc3MgQmFzZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSB2ZXJzaW9uIOW9k+WJjeeJiOacrOWPt+OAglxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgdmVyc2lvbjogJzAuMS42JyxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtqUXVlcnl8WmVwdG99ICQg5byV55So5L6d6LWW55qEalF1ZXJ55oiW6ICFWmVwdG/lr7nosaHjgIJcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICQ6ICQsXHJcbiAgICBcclxuICAgICAgICAgICAgRGVmZXJyZWQ6IHByb21pc2UuRGVmZXJyZWQsXHJcbiAgICBcclxuICAgICAgICAgICAgaXNQcm9taXNlOiBwcm9taXNlLmlzUHJvbWlzZSxcclxuICAgIFxyXG4gICAgICAgICAgICB3aGVuOiBwcm9taXNlLndoZW4sXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiAg566A5Y2V55qE5rWP6KeI5Zmo5qOA5p+l57uT5p6c44CCXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICogYHdlYmtpdGAgIHdlYmtpdOeJiOacrOWPt++8jOWmguaenOa1j+iniOWZqOS4uumdnndlYmtpdOWGheaguO+8jOatpOWxnuaAp+S4umB1bmRlZmluZWRg44CCXHJcbiAgICAgICAgICAgICAqICogYGNocm9tZWAgIGNocm9tZea1j+iniOWZqOeJiOacrOWPt++8jOWmguaenOa1j+iniOWZqOS4umNocm9tZe+8jOatpOWxnuaAp+S4umB1bmRlZmluZWRg44CCXHJcbiAgICAgICAgICAgICAqICogYGllYCAgaWXmtY/op4jlmajniYjmnKzlj7fvvIzlpoLmnpzmtY/op4jlmajkuLrpnZ5pZe+8jOatpOWxnuaAp+S4umB1bmRlZmluZWRg44CCKirmmoLkuI3mlK/mjIFpZTEwKyoqXHJcbiAgICAgICAgICAgICAqICogYGZpcmVmb3hgICBmaXJlZm945rWP6KeI5Zmo54mI5pys5Y+377yM5aaC5p6c5rWP6KeI5Zmo5Li66Z2eZmlyZWZveO+8jOatpOWxnuaAp+S4umB1bmRlZmluZWRg44CCXHJcbiAgICAgICAgICAgICAqICogYHNhZmFyaWAgIHNhZmFyaea1j+iniOWZqOeJiOacrOWPt++8jOWmguaenOa1j+iniOWZqOS4uumdnnNhZmFyae+8jOatpOWxnuaAp+S4umB1bmRlZmluZWRg44CCXHJcbiAgICAgICAgICAgICAqICogYG9wZXJhYCAgb3BlcmHmtY/op4jlmajniYjmnKzlj7fvvIzlpoLmnpzmtY/op4jlmajkuLrpnZ5vcGVyYe+8jOatpOWxnuaAp+S4umB1bmRlZmluZWRg44CCXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBbYnJvd3Nlcl1cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGJyb3dzZXI6IChmdW5jdGlvbiggdWEgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmV0ID0ge30sXHJcbiAgICAgICAgICAgICAgICAgICAgd2Via2l0ID0gdWEubWF0Y2goIC9XZWJLaXRcXC8oW1xcZC5dKykvICksXHJcbiAgICAgICAgICAgICAgICAgICAgY2hyb21lID0gdWEubWF0Y2goIC9DaHJvbWVcXC8oW1xcZC5dKykvICkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdWEubWF0Y2goIC9DcmlPU1xcLyhbXFxkLl0rKS8gKSxcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGllID0gdWEubWF0Y2goIC9NU0lFXFxzKFtcXGRcXC5dKykvICkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdWEubWF0Y2goIC8oPzp0cmlkZW50KSg/Oi4qcnY6KFtcXHcuXSspKT8vaSApLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpcmVmb3ggPSB1YS5tYXRjaCggL0ZpcmVmb3hcXC8oW1xcZC5dKykvICksXHJcbiAgICAgICAgICAgICAgICAgICAgc2FmYXJpID0gdWEubWF0Y2goIC9TYWZhcmlcXC8oW1xcZC5dKykvICksXHJcbiAgICAgICAgICAgICAgICAgICAgb3BlcmEgPSB1YS5tYXRjaCggL09QUlxcLyhbXFxkLl0rKS8gKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgd2Via2l0ICYmIChyZXQud2Via2l0ID0gcGFyc2VGbG9hdCggd2Via2l0WyAxIF0gKSk7XHJcbiAgICAgICAgICAgICAgICBjaHJvbWUgJiYgKHJldC5jaHJvbWUgPSBwYXJzZUZsb2F0KCBjaHJvbWVbIDEgXSApKTtcclxuICAgICAgICAgICAgICAgIGllICYmIChyZXQuaWUgPSBwYXJzZUZsb2F0KCBpZVsgMSBdICkpO1xyXG4gICAgICAgICAgICAgICAgZmlyZWZveCAmJiAocmV0LmZpcmVmb3ggPSBwYXJzZUZsb2F0KCBmaXJlZm94WyAxIF0gKSk7XHJcbiAgICAgICAgICAgICAgICBzYWZhcmkgJiYgKHJldC5zYWZhcmkgPSBwYXJzZUZsb2F0KCBzYWZhcmlbIDEgXSApKTtcclxuICAgICAgICAgICAgICAgIG9wZXJhICYmIChyZXQub3BlcmEgPSBwYXJzZUZsb2F0KCBvcGVyYVsgMSBdICkpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgICAgICB9KSggbmF2aWdhdG9yLnVzZXJBZ2VudCApLFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24gIOaTjeS9nOezu+e7n+ajgOafpee7k+aenOOAglxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAqIGBhbmRyb2lkYCAg5aaC5p6c5ZyoYW5kcm9pZOa1j+iniOWZqOeOr+Wig+S4i++8jOatpOWAvOS4uuWvueW6lOeahGFuZHJvaWTniYjmnKzlj7fvvIzlkKbliJnkuLpgdW5kZWZpbmVkYOOAglxyXG4gICAgICAgICAgICAgKiAqIGBpb3NgIOWmguaenOWcqGlvc+a1j+iniOWZqOeOr+Wig+S4i++8jOatpOWAvOS4uuWvueW6lOeahGlvc+eJiOacrOWPt++8jOWQpuWImeS4umB1bmRlZmluZWRg44CCXHJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBbb3NdXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBvczogKGZ1bmN0aW9uKCB1YSApIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXQgPSB7fSxcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIG9zeCA9ICEhdWEubWF0Y2goIC9cXChNYWNpbnRvc2hcXDsgSW50ZWwgLyApLFxyXG4gICAgICAgICAgICAgICAgICAgIGFuZHJvaWQgPSB1YS5tYXRjaCggLyg/OkFuZHJvaWQpOz9bXFxzXFwvXSsoW1xcZC5dKyk/LyApLFxyXG4gICAgICAgICAgICAgICAgICAgIGlvcyA9IHVhLm1hdGNoKCAvKD86aVBhZHxpUG9kfGlQaG9uZSkuKk9TXFxzKFtcXGRfXSspLyApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBvc3ggJiYgKHJldC5vc3ggPSB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGFuZHJvaWQgJiYgKHJldC5hbmRyb2lkID0gcGFyc2VGbG9hdCggYW5kcm9pZFsgMSBdICkpO1xyXG4gICAgICAgICAgICAgICAgaW9zICYmIChyZXQuaW9zID0gcGFyc2VGbG9hdCggaW9zWyAxIF0ucmVwbGFjZSggL18vZywgJy4nICkgKSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXQ7XHJcbiAgICAgICAgICAgIH0pKCBuYXZpZ2F0b3IudXNlckFnZW50ICksXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOWunueOsOexu+S4juexu+S5i+mXtOeahOe7p+aJv+OAglxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIGluaGVyaXRzXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIEJhc2UuaW5oZXJpdHMoIHN1cGVyICkgPT4gY2hpbGRcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgQmFzZS5pbmhlcml0cyggc3VwZXIsIHByb3RvcyApID0+IGNoaWxkXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIEJhc2UuaW5oZXJpdHMoIHN1cGVyLCBwcm90b3MsIHN0YXRpY3MgKSA9PiBjaGlsZFxyXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHtDbGFzc30gc3VwZXIg54i257G7XHJcbiAgICAgICAgICAgICAqIEBwYXJhbSAge09iamVjdCB8IEZ1bmN0aW9ufSBbcHJvdG9zXSDlrZDnsbvmiJbogIXlr7nosaHjgILlpoLmnpzlr7nosaHkuK3ljIXlkKtjb25zdHJ1Y3Rvcu+8jOWtkOexu+WwhuaYr+eUqOatpOWxnuaAp+WAvOOAglxyXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gW3Byb3Rvcy5jb25zdHJ1Y3Rvcl0g5a2Q57G75p6E6YCg5Zmo77yM5LiN5oyH5a6a55qE6K+d5bCG5Yib5bu65Liq5Li05pe255qE55u05o6l5omn6KGM54i257G75p6E6YCg5Zmo55qE5pa55rOV44CCXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSAge09iamVjdH0gW3N0YXRpY3NdIOmdmeaAgeWxnuaAp+aIluaWueazleOAglxyXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHtDbGFzc30g6L+U5Zue5a2Q57G744CCXHJcbiAgICAgICAgICAgICAqIEBleGFtcGxlXHJcbiAgICAgICAgICAgICAqIGZ1bmN0aW9uIFBlcnNvbigpIHtcclxuICAgICAgICAgICAgICogICAgIGNvbnNvbGUubG9nKCAnU3VwZXInICk7XHJcbiAgICAgICAgICAgICAqIH1cclxuICAgICAgICAgICAgICogUGVyc29uLnByb3RvdHlwZS5oZWxsbyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgKiAgICAgY29uc29sZS5sb2coICdoZWxsbycgKTtcclxuICAgICAgICAgICAgICogfTtcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogdmFyIE1hbmFnZXIgPSBCYXNlLmluaGVyaXRzKCBQZXJzb24sIHtcclxuICAgICAgICAgICAgICogICAgIHdvcmxkOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICogICAgICAgICBjb25zb2xlLmxvZyggJ1dvcmxkJyApO1xyXG4gICAgICAgICAgICAgKiAgICAgfVxyXG4gICAgICAgICAgICAgKiB9KTtcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogLy8g5Zug5Li65rKh5pyJ5oyH5a6a5p6E6YCg5Zmo77yM54i257G755qE5p6E6YCg5Zmo5bCG5Lya5omn6KGM44CCXHJcbiAgICAgICAgICAgICAqIHZhciBpbnN0YW5jZSA9IG5ldyBNYW5hZ2VyKCk7ICAgIC8vID0+IFN1cGVyXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIC8vIOe7p+aJv+WtkOeItuexu+eahOaWueazlVxyXG4gICAgICAgICAgICAgKiBpbnN0YW5jZS5oZWxsbygpOyAgICAvLyA9PiBoZWxsb1xyXG4gICAgICAgICAgICAgKiBpbnN0YW5jZS53b3JsZCgpOyAgICAvLyA9PiBXb3JsZFxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAvLyDlrZDnsbvnmoRfX3N1cGVyX1/lsZ7mgKfmjIflkJHniLbnsbtcclxuICAgICAgICAgICAgICogY29uc29sZS5sb2coIE1hbmFnZXIuX19zdXBlcl9fID09PSBQZXJzb24gKTsgICAgLy8gPT4gdHJ1ZVxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgaW5oZXJpdHM6IGZ1bmN0aW9uKCBTdXBlciwgcHJvdG9zLCBzdGF0aWNQcm90b3MgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hpbGQ7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIHByb3RvcyA9PT0gJ2Z1bmN0aW9uJyApIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IHByb3RvcztcclxuICAgICAgICAgICAgICAgICAgICBwcm90b3MgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggcHJvdG9zICYmIHByb3Rvcy5oYXNPd25Qcm9wZXJ0eSgnY29uc3RydWN0b3InKSApIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZCA9IHByb3Rvcy5jb25zdHJ1Y3RvcjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN1cGVyLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDlpI3liLbpnZnmgIHmlrnms5VcclxuICAgICAgICAgICAgICAgICQuZXh0ZW5kKCB0cnVlLCBjaGlsZCwgU3VwZXIsIHN0YXRpY1Byb3RvcyB8fCB7fSApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvKiBqc2hpbnQgY2FtZWxjYXNlOiBmYWxzZSAqL1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDorqnlrZDnsbvnmoRfX3N1cGVyX1/lsZ7mgKfmjIflkJHniLbnsbvjgIJcclxuICAgICAgICAgICAgICAgIGNoaWxkLl9fc3VwZXJfXyA9IFN1cGVyLnByb3RvdHlwZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5p6E5bu65Y6f5Z6L77yM5re75Yqg5Y6f5Z6L5pa55rOV5oiW5bGe5oCn44CCXHJcbiAgICAgICAgICAgICAgICAvLyDmmoLml7bnlKhPYmplY3QuY3JlYXRl5a6e546w44CCXHJcbiAgICAgICAgICAgICAgICBjaGlsZC5wcm90b3R5cGUgPSBjcmVhdGVPYmplY3QoIFN1cGVyLnByb3RvdHlwZSApO1xyXG4gICAgICAgICAgICAgICAgcHJvdG9zICYmICQuZXh0ZW5kKCB0cnVlLCBjaGlsZC5wcm90b3R5cGUsIHByb3RvcyApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGQ7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOS4gOS4quS4jeWBmuS7u+S9leS6i+aDheeahOaWueazleOAguWPr+S7peeUqOadpei1i+WAvOe7mem7mOiupOeahGNhbGxiYWNrLlxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIG5vb3BcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIG5vb3A6IG5vb3AsXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOi/lOWbnuS4gOS4quaWsOeahOaWueazle+8jOatpOaWueazleWwhuW3suaMh+WumueahGBjb250ZXh0YOadpeaJp+ihjOOAglxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciBCYXNlLmJpbmRGbiggZm4sIGNvbnRleHQgKSA9PiBGdW5jdGlvblxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIGJpbmRGblxyXG4gICAgICAgICAgICAgKiBAZXhhbXBsZVxyXG4gICAgICAgICAgICAgKiB2YXIgZG9Tb21ldGhpbmcgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICogICAgICAgICBjb25zb2xlLmxvZyggdGhpcy5uYW1lICk7XHJcbiAgICAgICAgICAgICAqICAgICB9LFxyXG4gICAgICAgICAgICAgKiAgICAgb2JqID0ge1xyXG4gICAgICAgICAgICAgKiAgICAgICAgIG5hbWU6ICdPYmplY3QgTmFtZSdcclxuICAgICAgICAgICAgICogICAgIH0sXHJcbiAgICAgICAgICAgICAqICAgICBhbGlhc0ZuID0gQmFzZS5iaW5kKCBkb1NvbWV0aGluZywgb2JqICk7XHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICBhbGlhc0ZuKCk7ICAgIC8vID0+IE9iamVjdCBOYW1lXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBiaW5kRm46IGJpbmRGbixcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5byV55SoQ29uc29sZS5sb2flpoLmnpzlrZjlnKjnmoTor53vvIzlkKbliJnlvJXnlKjkuIDkuKpb56m65Ye95pWwbm9vcF0oI1dlYlVwbG9hZGVyOkJhc2Uubm9vcCnjgIJcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgQmFzZS5sb2coIGFyZ3MuLi4gKSA9PiB1bmRlZmluZWRcclxuICAgICAgICAgICAgICogQG1ldGhvZCBsb2dcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGxvZzogKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCB3aW5kb3cuY29uc29sZSApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYmluZEZuKCBjb25zb2xlLmxvZywgY29uc29sZSApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vb3A7XHJcbiAgICAgICAgICAgIH0pKCksXHJcbiAgICBcclxuICAgICAgICAgICAgbmV4dFRpY2s6IChmdW5jdGlvbigpIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCBjYiApIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCBjYiwgMSApO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gQGJ1ZyDlvZPmtY/op4jlmajkuI3lnKjlvZPliY3nqpflj6Pml7blsLHlgZzkuobjgIJcclxuICAgICAgICAgICAgICAgIC8vIHZhciBuZXh0ID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxyXG4gICAgICAgICAgICAgICAgLy8gICAgIHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcclxuICAgICAgICAgICAgICAgIC8vICAgICB3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgZnVuY3Rpb24oIGNiICkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICB3aW5kb3cuc2V0VGltZW91dCggY2IsIDEwMDAgLyA2MCApO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIH07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIC8vIGZpeDogVW5jYXVnaHQgVHlwZUVycm9yOiBJbGxlZ2FsIGludm9jYXRpb25cclxuICAgICAgICAgICAgICAgIC8vIHJldHVybiBiaW5kRm4oIG5leHQsIHdpbmRvdyApO1xyXG4gICAgICAgICAgICB9KSgpLFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiDooqtbdW5jdXJyeXRoaXNdKGh0dHA6Ly93d3cuMmFsaXR5LmNvbS8yMDExLzExL3VuY3VycnlpbmctdGhpcy5odG1sKeeahOaVsOe7hHNsaWNl5pa55rOV44CCXHJcbiAgICAgICAgICAgICAqIOWwhueUqOadpeWwhumdnuaVsOe7hOWvueixoei9rOWMluaIkOaVsOe7hOWvueixoeOAglxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciBCYXNlLnNsaWNlKCB0YXJnZXQsIHN0YXJ0WywgZW5kXSApID0+IEFycmF5XHJcbiAgICAgICAgICAgICAqIEBtZXRob2Qgc2xpY2VcclxuICAgICAgICAgICAgICogQGV4YW1wbGVcclxuICAgICAgICAgICAgICogZnVuY3Rpb24gZG9Tb210aGluZygpIHtcclxuICAgICAgICAgICAgICogICAgIHZhciBhcmdzID0gQmFzZS5zbGljZSggYXJndW1lbnRzLCAxICk7XHJcbiAgICAgICAgICAgICAqICAgICBjb25zb2xlLmxvZyggYXJncyApO1xyXG4gICAgICAgICAgICAgKiB9XHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIGRvU29tdGhpbmcoICdpZ25vcmVkJywgJ2FyZzInLCAnYXJnMycgKTsgICAgLy8gPT4gQXJyYXkgW1wiYXJnMlwiLCBcImFyZzNcIl1cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHNsaWNlOiB1bmN1cnJ5VGhpcyggW10uc2xpY2UgKSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog55Sf5oiQ5ZSv5LiA55qESURcclxuICAgICAgICAgICAgICogQG1ldGhvZCBndWlkXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIEJhc2UuZ3VpZCgpID0+IFN0cmluZ1xyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciBCYXNlLmd1aWQoIHByZWZ4ICkgPT4gU3RyaW5nXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBndWlkOiAoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IDA7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiggcHJlZml4ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBndWlkID0gKCtuZXcgRGF0ZSgpKS50b1N0cmluZyggMzIgKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaSA9IDA7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKCA7IGkgPCA1OyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGd1aWQgKz0gTWF0aC5mbG9vciggTWF0aC5yYW5kb20oKSAqIDY1NTM1ICkudG9TdHJpbmcoIDMyICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChwcmVmaXggfHwgJ3d1XycpICsgZ3VpZCArIChjb3VudGVyKyspLnRvU3RyaW5nKCAzMiApO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSkoKSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5qC85byP5YyW5paH5Lu25aSn5bCPLCDovpPlh7rmiJDluKbljZXkvY3nmoTlrZfnrKbkuLJcclxuICAgICAgICAgICAgICogQG1ldGhvZCBmb3JtYXRTaXplXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIEJhc2UuZm9ybWF0U2l6ZSggc2l6ZSApID0+IFN0cmluZ1xyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciBCYXNlLmZvcm1hdFNpemUoIHNpemUsIHBvaW50TGVuZ3RoICkgPT4gU3RyaW5nXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIEJhc2UuZm9ybWF0U2l6ZSggc2l6ZSwgcG9pbnRMZW5ndGgsIHVuaXRzICkgPT4gU3RyaW5nXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBzaXplIOaWh+S7tuWkp+Wwj1xyXG4gICAgICAgICAgICAgKiBAcGFyYW0ge051bWJlcn0gW3BvaW50TGVuZ3RoPTJdIOeyvuehruWIsOeahOWwj+aVsOeCueaVsOOAglxyXG4gICAgICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSBbdW5pdHM9WyAnQicsICdLJywgJ00nLCAnRycsICdUQicgXV0g5Y2V5L2N5pWw57uE44CC5LuO5a2X6IqC77yM5Yiw5Y2D5a2X6IqC77yM5LiA55u05b6A5LiK5oyH5a6a44CC5aaC5p6c5Y2V5L2N5pWw57uE6YeM6Z2i5Y+q5oyH5a6a5LqG5Yiw5LqGSyjljYPlrZfoioIp77yM5ZCM5pe25paH5Lu25aSn5bCP5aSn5LqOTSwg5q2k5pa55rOV55qE6L6T5Ye65bCG6L+Y5piv5pi+56S65oiQ5aSa5bCRSy5cclxuICAgICAgICAgICAgICogQGV4YW1wbGVcclxuICAgICAgICAgICAgICogY29uc29sZS5sb2coIEJhc2UuZm9ybWF0U2l6ZSggMTAwICkgKTsgICAgLy8gPT4gMTAwQlxyXG4gICAgICAgICAgICAgKiBjb25zb2xlLmxvZyggQmFzZS5mb3JtYXRTaXplKCAxMDI0ICkgKTsgICAgLy8gPT4gMS4wMEtcclxuICAgICAgICAgICAgICogY29uc29sZS5sb2coIEJhc2UuZm9ybWF0U2l6ZSggMTAyNCwgMCApICk7ICAgIC8vID0+IDFLXHJcbiAgICAgICAgICAgICAqIGNvbnNvbGUubG9nKCBCYXNlLmZvcm1hdFNpemUoIDEwMjQgKiAxMDI0ICkgKTsgICAgLy8gPT4gMS4wME1cclxuICAgICAgICAgICAgICogY29uc29sZS5sb2coIEJhc2UuZm9ybWF0U2l6ZSggMTAyNCAqIDEwMjQgKiAxMDI0ICkgKTsgICAgLy8gPT4gMS4wMEdcclxuICAgICAgICAgICAgICogY29uc29sZS5sb2coIEJhc2UuZm9ybWF0U2l6ZSggMTAyNCAqIDEwMjQgKiAxMDI0LCAwLCBbJ0InLCAnS0InLCAnTUInXSApICk7ICAgIC8vID0+IDEwMjRNQlxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgZm9ybWF0U2l6ZTogZnVuY3Rpb24oIHNpemUsIHBvaW50TGVuZ3RoLCB1bml0cyApIHtcclxuICAgICAgICAgICAgICAgIHZhciB1bml0O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB1bml0cyA9IHVuaXRzIHx8IFsgJ0InLCAnSycsICdNJywgJ0cnLCAnVEInIF07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHdoaWxlICggKHVuaXQgPSB1bml0cy5zaGlmdCgpKSAmJiBzaXplID4gMTAyNCApIHtcclxuICAgICAgICAgICAgICAgICAgICBzaXplID0gc2l6ZSAvIDEwMjQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiAodW5pdCA9PT0gJ0InID8gc2l6ZSA6IHNpemUudG9GaXhlZCggcG9pbnRMZW5ndGggfHwgMiApKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVuaXQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIOS6i+S7tuWkhOeQhuexu++8jOWPr+S7peeLrOeri+S9v+eUqO+8jOS5n+WPr+S7peaJqeWxlee7meWvueixoeS9v+eUqOOAglxyXG4gICAgICogQGZpbGVPdmVydmlldyBNZWRpYXRvclxyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ21lZGlhdG9yJyxbXHJcbiAgICAgICAgJ2Jhc2UnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSApIHtcclxuICAgICAgICB2YXIgJCA9IEJhc2UuJCxcclxuICAgICAgICAgICAgc2xpY2UgPSBbXS5zbGljZSxcclxuICAgICAgICAgICAgc2VwYXJhdG9yID0gL1xccysvLFxyXG4gICAgICAgICAgICBwcm90b3M7XHJcbiAgICBcclxuICAgICAgICAvLyDmoLnmja7mnaHku7bov4fmu6Tlh7rkuovku7ZoYW5kbGVycy5cclxuICAgICAgICBmdW5jdGlvbiBmaW5kSGFuZGxlcnMoIGFyciwgbmFtZSwgY2FsbGJhY2ssIGNvbnRleHQgKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkLmdyZXAoIGFyciwgZnVuY3Rpb24oIGhhbmRsZXIgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlciAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoIW5hbWUgfHwgaGFuZGxlci5lID09PSBuYW1lKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAoIWNhbGxiYWNrIHx8IGhhbmRsZXIuY2IgPT09IGNhbGxiYWNrIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuY2IuX2NiID09PSBjYWxsYmFjaykgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgKCFjb250ZXh0IHx8IGhhbmRsZXIuY3R4ID09PSBjb250ZXh0KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgZnVuY3Rpb24gZWFjaEV2ZW50KCBldmVudHMsIGNhbGxiYWNrLCBpdGVyYXRvciApIHtcclxuICAgICAgICAgICAgLy8g5LiN5pSv5oyB5a+56LGh77yM5Y+q5pSv5oyB5aSa5LiqZXZlbnTnlKjnqbrmoLzpmpTlvIBcclxuICAgICAgICAgICAgJC5lYWNoKCAoZXZlbnRzIHx8ICcnKS5zcGxpdCggc2VwYXJhdG9yICksIGZ1bmN0aW9uKCBfLCBrZXkgKSB7XHJcbiAgICAgICAgICAgICAgICBpdGVyYXRvcigga2V5LCBjYWxsYmFjayApO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBmdW5jdGlvbiB0cmlnZ2VySGFuZGVycyggZXZlbnRzLCBhcmdzICkge1xyXG4gICAgICAgICAgICB2YXIgc3RvcGVkID0gZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBpID0gLTEsXHJcbiAgICAgICAgICAgICAgICBsZW4gPSBldmVudHMubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgaGFuZGxlcjtcclxuICAgIFxyXG4gICAgICAgICAgICB3aGlsZSAoICsraSA8IGxlbiApIHtcclxuICAgICAgICAgICAgICAgIGhhbmRsZXIgPSBldmVudHNbIGkgXTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCBoYW5kbGVyLmNiLmFwcGx5KCBoYW5kbGVyLmN0eDIsIGFyZ3MgKSA9PT0gZmFsc2UgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIHJldHVybiAhc3RvcGVkO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIHByb3RvcyA9IHtcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog57uR5a6a5LqL5Lu244CCXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIGBjYWxsYmFja2Dmlrnms5XlnKjmiafooYzml7bvvIxhcmd1bWVudHPlsIbkvJrmnaXmupDkuo50cmlnZ2Vy55qE5pe25YCZ5pC65bim55qE5Y+C5pWw44CC5aaCXHJcbiAgICAgICAgICAgICAqIGBgYGphdmFzY3JpcHRcclxuICAgICAgICAgICAgICogdmFyIG9iaiA9IHt9O1xyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAvLyDkvb/lvpdvYmrmnInkuovku7booYzkuLpcclxuICAgICAgICAgICAgICogTWVkaWF0b3IuaW5zdGFsbFRvKCBvYmogKTtcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogb2JqLm9uKCAndGVzdGEnLCBmdW5jdGlvbiggYXJnMSwgYXJnMiApIHtcclxuICAgICAgICAgICAgICogICAgIGNvbnNvbGUubG9nKCBhcmcxLCBhcmcyICk7IC8vID0+ICdhcmcxJywgJ2FyZzInXHJcbiAgICAgICAgICAgICAqIH0pO1xyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiBvYmoudHJpZ2dlciggJ3Rlc3RhJywgJ2FyZzEnLCAnYXJnMicgKTtcclxuICAgICAgICAgICAgICogYGBgXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIOWmguaenGBjYWxsYmFja2DkuK3vvIzmn5DkuIDkuKrmlrnms5VgcmV0dXJuIGZhbHNlYOS6hu+8jOWImeWQjue7reeahOWFtuS7lmBjYWxsYmFja2Dpg73kuI3kvJrooqvmiafooYzliLDjgIJcclxuICAgICAgICAgICAgICog5YiH5Lya5b2x5ZON5YiwYHRyaWdnZXJg5pa55rOV55qE6L+U5Zue5YC877yM5Li6YGZhbHNlYOOAglxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiBgb25g6L+Y5Y+v5Lul55So5p2l5re75Yqg5LiA5Liq54m55q6K5LqL5Lu2YGFsbGAsIOi/meagt+aJgOacieeahOS6i+S7tuinpuWPkemDveS8muWTjeW6lOWIsOOAguWQjOaXtuatpOexu2BjYWxsYmFja2DkuK3nmoRhcmd1bWVudHPmnInkuIDkuKrkuI3lkIzlpITvvIxcclxuICAgICAgICAgICAgICog5bCx5piv56ys5LiA5Liq5Y+C5pWw5Li6YHR5cGVg77yM6K6w5b2V5b2T5YmN5piv5LuA5LmI5LqL5Lu25Zyo6Kem5Y+R44CC5q2k57G7YGNhbGxiYWNrYOeahOS8mOWFiOe6p+avlOiEmuS9ju+8jOS8muWGjeato+W4uGBjYWxsYmFja2DmiafooYzlrozlkI7op6blj5HjgIJcclxuICAgICAgICAgICAgICogYGBgamF2YXNjcmlwdFxyXG4gICAgICAgICAgICAgKiBvYmoub24oICdhbGwnLCBmdW5jdGlvbiggdHlwZSwgYXJnMSwgYXJnMiApIHtcclxuICAgICAgICAgICAgICogICAgIGNvbnNvbGUubG9nKCB0eXBlLCBhcmcxLCBhcmcyICk7IC8vID0+ICd0ZXN0YScsICdhcmcxJywgJ2FyZzInXHJcbiAgICAgICAgICAgICAqIH0pO1xyXG4gICAgICAgICAgICAgKiBgYGBcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogQG1ldGhvZCBvblxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciBvbiggbmFtZSwgY2FsbGJhY2tbLCBjb250ZXh0XSApID0+IHNlbGZcclxuICAgICAgICAgICAgICogQHBhcmFtICB7U3RyaW5nfSAgIG5hbWUgICAgIOS6i+S7tuWQje+8jOaUr+aMgeWkmuS4quS6i+S7tueUqOepuuagvOmalOW8gFxyXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2FsbGJhY2sg5LqL5Lu25aSE55CG5ZmoXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSAge09iamVjdH0gICBbY29udGV4dF0gIOS6i+S7tuWkhOeQhuWZqOeahOS4iuS4i+aWh+OAglxyXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHtzZWxmfSDov5Tlm57oh6rouqvvvIzmlrnkvr/pk77lvI9cclxuICAgICAgICAgICAgICogQGNoYWluYWJsZVxyXG4gICAgICAgICAgICAgKiBAY2xhc3MgTWVkaWF0b3JcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIG9uOiBmdW5jdGlvbiggbmFtZSwgY2FsbGJhY2ssIGNvbnRleHQgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIHNldDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCAhY2FsbGJhY2sgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHNldCA9IHRoaXMuX2V2ZW50cyB8fCAodGhpcy5fZXZlbnRzID0gW10pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBlYWNoRXZlbnQoIG5hbWUsIGNhbGxiYWNrLCBmdW5jdGlvbiggbmFtZSwgY2FsbGJhY2sgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSB7IGU6IG5hbWUgfTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXIuY2IgPSBjYWxsYmFjaztcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmN0eCA9IGNvbnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5jdHgyID0gY29udGV4dCB8fCBtZTtcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyLmlkID0gc2V0Lmxlbmd0aDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHNldC5wdXNoKCBoYW5kbGVyICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOe7keWumuS6i+S7tu+8jOS4lOW9k2hhbmRsZXLmiafooYzlrozlkI7vvIzoh6rliqjop6PpmaTnu5HlrprjgIJcclxuICAgICAgICAgICAgICogQG1ldGhvZCBvbmNlXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIG9uY2UoIG5hbWUsIGNhbGxiYWNrWywgY29udGV4dF0gKSA9PiBzZWxmXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSAge1N0cmluZ30gICBuYW1lICAgICDkuovku7blkI1cclxuICAgICAgICAgICAgICogQHBhcmFtICB7RnVuY3Rpb259IGNhbGxiYWNrIOS6i+S7tuWkhOeQhuWZqFxyXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHtPYmplY3R9ICAgW2NvbnRleHRdICDkuovku7blpITnkIblmajnmoTkuIrkuIvmlofjgIJcclxuICAgICAgICAgICAgICogQHJldHVybiB7c2VsZn0g6L+U5Zue6Ieq6Lqr77yM5pa55L6/6ZO+5byPXHJcbiAgICAgICAgICAgICAqIEBjaGFpbmFibGVcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIG9uY2U6IGZ1bmN0aW9uKCBuYW1lLCBjYWxsYmFjaywgY29udGV4dCApIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggIWNhbGxiYWNrICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZWFjaEV2ZW50KCBuYW1lLCBjYWxsYmFjaywgZnVuY3Rpb24oIG5hbWUsIGNhbGxiYWNrICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvbmNlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZS5vZmYoIG5hbWUsIG9uY2UgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjay5hcHBseSggY29udGV4dCB8fCBtZSwgYXJndW1lbnRzICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBvbmNlLl9jYiA9IGNhbGxiYWNrO1xyXG4gICAgICAgICAgICAgICAgICAgIG1lLm9uKCBuYW1lLCBvbmNlLCBjb250ZXh0ICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1lO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiDop6PpmaTkuovku7bnu5HlrppcclxuICAgICAgICAgICAgICogQG1ldGhvZCBvZmZcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgb2ZmKCBbbmFtZVssIGNhbGxiYWNrWywgY29udGV4dF0gXSBdICkgPT4gc2VsZlxyXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgW25hbWVdICAgICDkuovku7blkI1cclxuICAgICAgICAgICAgICogQHBhcmFtICB7RnVuY3Rpb259IFtjYWxsYmFja10g5LqL5Lu25aSE55CG5ZmoXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSAge09iamVjdH0gICBbY29udGV4dF0gIOS6i+S7tuWkhOeQhuWZqOeahOS4iuS4i+aWh+OAglxyXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHtzZWxmfSDov5Tlm57oh6rouqvvvIzmlrnkvr/pk77lvI9cclxuICAgICAgICAgICAgICogQGNoYWluYWJsZVxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgb2ZmOiBmdW5jdGlvbiggbmFtZSwgY2IsIGN0eCApIHtcclxuICAgICAgICAgICAgICAgIHZhciBldmVudHMgPSB0aGlzLl9ldmVudHM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggIWV2ZW50cyApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCAhbmFtZSAmJiAhY2IgJiYgIWN0eCApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9ldmVudHMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZWFjaEV2ZW50KCBuYW1lLCBjYiwgZnVuY3Rpb24oIG5hbWUsIGNiICkge1xyXG4gICAgICAgICAgICAgICAgICAgICQuZWFjaCggZmluZEhhbmRsZXJzKCBldmVudHMsIG5hbWUsIGNiLCBjdHggKSwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBldmVudHNbIHRoaXMuaWQgXTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog6Kem5Y+R5LqL5Lu2XHJcbiAgICAgICAgICAgICAqIEBtZXRob2QgdHJpZ2dlclxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciB0cmlnZ2VyKCBuYW1lWywgYXJncy4uLl0gKSA9PiBzZWxmXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSAge1N0cmluZ30gICB0eXBlICAgICDkuovku7blkI1cclxuICAgICAgICAgICAgICogQHBhcmFtICB7Kn0gWy4uLl0g5Lu75oSP5Y+C5pWwXHJcbiAgICAgICAgICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IOWmguaenGhhbmRsZXLkuK1yZXR1cm4gZmFsc2XkuobvvIzliJnov5Tlm55mYWxzZSwg5ZCm5YiZ6L+U5ZuedHJ1ZVxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgdHJpZ2dlcjogZnVuY3Rpb24oIHR5cGUgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJncywgZXZlbnRzLCBhbGxFdmVudHM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggIXRoaXMuX2V2ZW50cyB8fCAhdHlwZSApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgYXJncyA9IHNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApO1xyXG4gICAgICAgICAgICAgICAgZXZlbnRzID0gZmluZEhhbmRsZXJzKCB0aGlzLl9ldmVudHMsIHR5cGUgKTtcclxuICAgICAgICAgICAgICAgIGFsbEV2ZW50cyA9IGZpbmRIYW5kbGVycyggdGhpcy5fZXZlbnRzLCAnYWxsJyApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJpZ2dlckhhbmRlcnMoIGV2ZW50cywgYXJncyApICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJIYW5kZXJzKCBhbGxFdmVudHMsIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOS4reS7i+iAhe+8jOWug+acrOi6q+aYr+S4quWNleS+i++8jOS9huWPr+S7pemAmui/h1tpbnN0YWxsVG9dKCNXZWJVcGxvYWRlcjpNZWRpYXRvcjppbnN0YWxsVG8p5pa55rOV77yM5L2/5Lu75L2V5a+56LGh5YW35aSH5LqL5Lu26KGM5Li644CCXHJcbiAgICAgICAgICog5Li76KaB55uu55qE5piv6LSf6LSj5qih5Z2X5LiO5qih5Z2X5LmL6Ze055qE5ZCI5L2c77yM6ZmN5L2O6ICm5ZCI5bqm44CCXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAY2xhc3MgTWVkaWF0b3JcclxuICAgICAgICAgKi9cclxuICAgICAgICByZXR1cm4gJC5leHRlbmQoe1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiDlj6/ku6XpgJrov4fov5nkuKrmjqXlj6PvvIzkvb/ku7vkvZXlr7nosaHlhbflpIfkuovku7blip/og73jgIJcclxuICAgICAgICAgICAgICogQG1ldGhvZCBpbnN0YWxsVG9cclxuICAgICAgICAgICAgICogQHBhcmFtICB7T2JqZWN0fSBvYmog6ZyA6KaB5YW35aSH5LqL5Lu26KGM5Li655qE5a+56LGh44CCXHJcbiAgICAgICAgICAgICAqIEByZXR1cm4ge09iamVjdH0g6L+U5Zueb2JqLlxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgaW5zdGFsbFRvOiBmdW5jdGlvbiggb2JqICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICQuZXh0ZW5kKCBvYmosIHByb3RvcyApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICB9LCBwcm90b3MgKTtcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IFVwbG9hZGVy5LiK5Lyg57G7XHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgndXBsb2FkZXInLFtcclxuICAgICAgICAnYmFzZScsXHJcbiAgICAgICAgJ21lZGlhdG9yJ1xyXG4gICAgXSwgZnVuY3Rpb24oIEJhc2UsIE1lZGlhdG9yICkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQ7XHJcbiAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDkuIrkvKDlhaXlj6PnsbvjgIJcclxuICAgICAgICAgKiBAY2xhc3MgVXBsb2FkZXJcclxuICAgICAgICAgKiBAY29uc3RydWN0b3JcclxuICAgICAgICAgKiBAZ3JhbW1hciBuZXcgVXBsb2FkZXIoIG9wdHMgKSA9PiBVcGxvYWRlclxyXG4gICAgICAgICAqIEBleGFtcGxlXHJcbiAgICAgICAgICogdmFyIHVwbG9hZGVyID0gV2ViVXBsb2FkZXIuVXBsb2FkZXIoe1xyXG4gICAgICAgICAqICAgICBzd2Y6ICdwYXRoX29mX3N3Zi9VcGxvYWRlci5zd2YnLFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogICAgIC8vIOW8gOi1t+WIhueJh+S4iuS8oOOAglxyXG4gICAgICAgICAqICAgICBjaHVua2VkOiB0cnVlXHJcbiAgICAgICAgICogfSk7XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZnVuY3Rpb24gVXBsb2FkZXIoIG9wdHMgKSB7XHJcbiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgVXBsb2FkZXIub3B0aW9ucywgb3B0cyApO1xyXG4gICAgICAgICAgICB0aGlzLl9pbml0KCB0aGlzLm9wdGlvbnMgKTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAvLyBkZWZhdWx0IE9wdGlvbnNcclxuICAgICAgICAvLyB3aWRnZXRz5Lit5pyJ55u45bqU5omp5bGVXHJcbiAgICAgICAgVXBsb2FkZXIub3B0aW9ucyA9IHt9O1xyXG4gICAgICAgIE1lZGlhdG9yLmluc3RhbGxUbyggVXBsb2FkZXIucHJvdG90eXBlICk7XHJcbiAgICBcclxuICAgICAgICAvLyDmibnph4/mt7vliqDnuq/lkb3ku6TlvI/mlrnms5XjgIJcclxuICAgICAgICAkLmVhY2goe1xyXG4gICAgICAgICAgICB1cGxvYWQ6ICdzdGFydC11cGxvYWQnLFxyXG4gICAgICAgICAgICBzdG9wOiAnc3RvcC11cGxvYWQnLFxyXG4gICAgICAgICAgICBnZXRGaWxlOiAnZ2V0LWZpbGUnLFxyXG4gICAgICAgICAgICBnZXRGaWxlczogJ2dldC1maWxlcycsXHJcbiAgICAgICAgICAgIGFkZEZpbGU6ICdhZGQtZmlsZScsXHJcbiAgICAgICAgICAgIGFkZEZpbGVzOiAnYWRkLWZpbGUnLFxyXG4gICAgICAgICAgICBzb3J0OiAnc29ydC1maWxlcycsXHJcbiAgICAgICAgICAgIHJlbW92ZUZpbGU6ICdyZW1vdmUtZmlsZScsXHJcbiAgICAgICAgICAgIGNhbmNlbEZpbGU6ICdjYW5jZWwtZmlsZScsXHJcbiAgICAgICAgICAgIHNraXBGaWxlOiAnc2tpcC1maWxlJyxcclxuICAgICAgICAgICAgcmV0cnk6ICdyZXRyeScsXHJcbiAgICAgICAgICAgIGlzSW5Qcm9ncmVzczogJ2lzLWluLXByb2dyZXNzJyxcclxuICAgICAgICAgICAgbWFrZVRodW1iOiAnbWFrZS10aHVtYicsXHJcbiAgICAgICAgICAgIG1kNUZpbGU6ICdtZDUtZmlsZScsXHJcbiAgICAgICAgICAgIGdldERpbWVuc2lvbjogJ2dldC1kaW1lbnNpb24nLFxyXG4gICAgICAgICAgICBhZGRCdXR0b246ICdhZGQtYnRuJyxcclxuICAgICAgICAgICAgcHJlZGljdFJ1bnRpbWVUeXBlOiAncHJlZGljdC1ydW50aW1lLXR5cGUnLFxyXG4gICAgICAgICAgICByZWZyZXNoOiAncmVmcmVzaCcsXHJcbiAgICAgICAgICAgIGRpc2FibGU6ICdkaXNhYmxlJyxcclxuICAgICAgICAgICAgZW5hYmxlOiAnZW5hYmxlJyxcclxuICAgICAgICAgICAgcmVzZXQ6ICdyZXNldCdcclxuICAgICAgICB9LCBmdW5jdGlvbiggZm4sIGNvbW1hbmQgKSB7XHJcbiAgICAgICAgICAgIFVwbG9hZGVyLnByb3RvdHlwZVsgZm4gXSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVxdWVzdCggY29tbWFuZCwgYXJndW1lbnRzICk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAkLmV4dGVuZCggVXBsb2FkZXIucHJvdG90eXBlLCB7XHJcbiAgICAgICAgICAgIHN0YXRlOiAncGVuZGluZycsXHJcbiAgICBcclxuICAgICAgICAgICAgX2luaXQ6IGZ1bmN0aW9uKCBvcHRzICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbWUucmVxdWVzdCggJ2luaXQnLCBvcHRzLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBtZS5zdGF0ZSA9ICdyZWFkeSc7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUudHJpZ2dlcigncmVhZHknKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiDojrflj5bmiJbogIXorr7nva5VcGxvYWRlcumFjee9rumhueOAglxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIG9wdGlvblxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciBvcHRpb24oIGtleSApID0+ICpcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgb3B0aW9uKCBrZXksIHZhbCApID0+IHNlbGZcclxuICAgICAgICAgICAgICogQGV4YW1wbGVcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogLy8g5Yid5aeL54q25oCB5Zu+54mH5LiK5Lyg5YmN5LiN5Lya5Y6L57ypXHJcbiAgICAgICAgICAgICAqIHZhciB1cGxvYWRlciA9IG5ldyBXZWJVcGxvYWRlci5VcGxvYWRlcih7XHJcbiAgICAgICAgICAgICAqICAgICBjb21wcmVzczogbnVsbDtcclxuICAgICAgICAgICAgICogfSk7XHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIC8vIOS/ruaUueWQjuWbvueJh+S4iuS8oOWJje+8jOWwneivleWwhuWbvueJh+WOi+e8qeWIsDE2MDAgKiAxNjAwXHJcbiAgICAgICAgICAgICAqIHVwbG9hZGVyLm9wdGlvbiggJ2NvbXByZXNzJywge1xyXG4gICAgICAgICAgICAgKiAgICAgd2lkdGg6IDE2MDAsXHJcbiAgICAgICAgICAgICAqICAgICBoZWlnaHQ6IDE2MDBcclxuICAgICAgICAgICAgICogfSk7XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBvcHRpb246IGZ1bmN0aW9uKCBrZXksIHZhbCApIHtcclxuICAgICAgICAgICAgICAgIHZhciBvcHRzID0gdGhpcy5vcHRpb25zO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBzZXR0ZXJcclxuICAgICAgICAgICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA+IDEgKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAoICQuaXNQbGFpbk9iamVjdCggdmFsICkgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuaXNQbGFpbk9iamVjdCggb3B0c1sga2V5IF0gKSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJC5leHRlbmQoIG9wdHNbIGtleSBdLCB2YWwgKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRzWyBrZXkgXSA9IHZhbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7ICAgIC8vIGdldHRlclxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBrZXkgPyBvcHRzWyBrZXkgXSA6IG9wdHM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOiOt+WPluaWh+S7tue7n+iuoeS/oeaBr+OAgui/lOWbnuS4gOS4quWMheWQq+S4gOS4i+S/oeaBr+eahOWvueixoeOAglxyXG4gICAgICAgICAgICAgKiAqIGBzdWNjZXNzTnVtYCDkuIrkvKDmiJDlip/nmoTmlofku7bmlbBcclxuICAgICAgICAgICAgICogKiBgcHJvZ3Jlc3NOdW1gIOS4iuS8oOS4reeahOaWh+S7tuaVsFxyXG4gICAgICAgICAgICAgKiAqIGBjYW5jZWxOdW1gIOiiq+WIoOmZpOeahOaWh+S7tuaVsFxyXG4gICAgICAgICAgICAgKiAqIGBpbnZhbGlkTnVtYCDml6DmlYjnmoTmlofku7bmlbBcclxuICAgICAgICAgICAgICogKiBgdXBsb2FkRmFpbE51bWAg5LiK5Lyg5aSx6LSl55qE5paH5Lu25pWwXHJcbiAgICAgICAgICAgICAqICogYHF1ZXVlTnVtYCDov5jlnKjpmJ/liJfkuK3nmoTmlofku7bmlbBcclxuICAgICAgICAgICAgICogKiBgaW50ZXJydXB0TnVtYCDooqvmmoLlgZznmoTmlofku7bmlbBcclxuICAgICAgICAgICAgICogQG1ldGhvZCBnZXRTdGF0c1xyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciBnZXRTdGF0cygpID0+IE9iamVjdFxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgZ2V0U3RhdHM6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuIHRoaXMuX21nci5nZXRTdGF0cy5hcHBseSggdGhpcy5fbWdyLCBhcmd1bWVudHMgKTtcclxuICAgICAgICAgICAgICAgIHZhciBzdGF0cyA9IHRoaXMucmVxdWVzdCgnZ2V0LXN0YXRzJyk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0cyA/IHtcclxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzTnVtOiBzdGF0cy5udW1PZlN1Y2Nlc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3NOdW06IHN0YXRzLm51bU9mUHJvZ3Jlc3MsXHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyB3aG8gY2FyZT9cclxuICAgICAgICAgICAgICAgICAgICAvLyBxdWV1ZUZhaWxOdW06IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsTnVtOiBzdGF0cy5udW1PZkNhbmNlbCxcclxuICAgICAgICAgICAgICAgICAgICBpbnZhbGlkTnVtOiBzdGF0cy5udW1PZkludmFsaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkRmFpbE51bTogc3RhdHMubnVtT2ZVcGxvYWRGYWlsZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcXVldWVOdW06IHN0YXRzLm51bU9mUXVldWUsXHJcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJydXB0TnVtOiBzdGF0cy5udW1vZkludGVycnVwdFxyXG4gICAgICAgICAgICAgICAgfSA6IHt9O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOmcgOimgemHjeWGmeatpOaWueazleadpeadpeaUr+aMgW9wdHMub25FdmVudOWSjGluc3RhbmNlLm9uRXZlbnTnmoTlpITnkIblmahcclxuICAgICAgICAgICAgdHJpZ2dlcjogZnVuY3Rpb24oIHR5cGUvKiwgYXJncy4uLiovICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsKCBhcmd1bWVudHMsIDEgKSxcclxuICAgICAgICAgICAgICAgICAgICBvcHRzID0gdGhpcy5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWUgPSAnb24nICsgdHlwZS5zdWJzdHJpbmcoIDAsIDEgKS50b1VwcGVyQ2FzZSgpICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZS5zdWJzdHJpbmcoIDEgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDosIPnlKjpgJrov4dvbuaWueazleazqOWGjOeahGhhbmRsZXIuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1lZGlhdG9yLnRyaWdnZXIuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApID09PSBmYWxzZSB8fFxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOiwg+eUqG9wdHMub25FdmVudFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmlzRnVuY3Rpb24oIG9wdHNbIG5hbWUgXSApICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdHNbIG5hbWUgXS5hcHBseSggdGhpcywgYXJncyApID09PSBmYWxzZSB8fFxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOiwg+eUqHRoaXMub25FdmVudFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkLmlzRnVuY3Rpb24oIHRoaXNbIG5hbWUgXSApICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbIG5hbWUgXS5hcHBseSggdGhpcywgYXJncyApID09PSBmYWxzZSB8fFxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW5v+aSreaJgOaciXVwbG9hZGVy55qE5LqL5Lu244CCXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1lZGlhdG9yLnRyaWdnZXIuYXBwbHkoIE1lZGlhdG9yLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbIHRoaXMsIHR5cGUgXS5jb25jYXQoIGFyZ3MgKSApID09PSBmYWxzZSApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOmUgOavgSB3ZWJ1cGxvYWRlciDlrp7kvotcclxuICAgICAgICAgICAgICogQG1ldGhvZCBkZXN0cm95XHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIGRlc3Ryb3koKSA9PiB1bmRlZmluZWRcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0KCAnZGVzdHJveScsIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vZmYoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvLyB3aWRnZXRzL3dpZGdldC5qc+WwhuihpeWFheatpOaWueazleeahOivpue7huaWh+aho+OAglxyXG4gICAgICAgICAgICByZXF1ZXN0OiBCYXNlLm5vb3BcclxuICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOWIm+W7ulVwbG9hZGVy5a6e5L6L77yM562J5ZCM5LqObmV3IFVwbG9hZGVyKCBvcHRzICk7XHJcbiAgICAgICAgICogQG1ldGhvZCBjcmVhdGVcclxuICAgICAgICAgKiBAY2xhc3MgQmFzZVxyXG4gICAgICAgICAqIEBzdGF0aWNcclxuICAgICAgICAgKiBAZ3JhbW1hciBCYXNlLmNyZWF0ZSggb3B0cyApID0+IFVwbG9hZGVyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgQmFzZS5jcmVhdGUgPSBVcGxvYWRlci5jcmVhdGUgPSBmdW5jdGlvbiggb3B0cyApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBVcGxvYWRlciggb3B0cyApO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAvLyDmmrTpnLJVcGxvYWRlcu+8jOWPr+S7pemAmui/h+Wug+adpeaJqeWxleS4muWKoemAu+i+keOAglxyXG4gICAgICAgIEJhc2UuVXBsb2FkZXIgPSBVcGxvYWRlcjtcclxuICAgIFxyXG4gICAgICAgIHJldHVybiBVcGxvYWRlcjtcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IFJ1bnRpbWXnrqHnkIblmajvvIzotJ/otKNSdW50aW1l55qE6YCJ5oupLCDov57mjqVcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdydW50aW1lL3J1bnRpbWUnLFtcclxuICAgICAgICAnYmFzZScsXHJcbiAgICAgICAgJ21lZGlhdG9yJ1xyXG4gICAgXSwgZnVuY3Rpb24oIEJhc2UsIE1lZGlhdG9yICkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQsXHJcbiAgICAgICAgICAgIGZhY3RvcmllcyA9IHt9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOiOt+WPluWvueixoeeahOesrOS4gOS4qmtleVxyXG4gICAgICAgICAgICBnZXRGaXJzdEtleSA9IGZ1bmN0aW9uKCBvYmogKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKCB2YXIga2V5IGluIG9iaiApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIG9iai5oYXNPd25Qcm9wZXJ0eSgga2V5ICkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBrZXk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAvLyDmjqXlj6PnsbvjgIJcclxuICAgICAgICBmdW5jdGlvbiBSdW50aW1lKCBvcHRpb25zICkge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXI6IGRvY3VtZW50LmJvZHlcclxuICAgICAgICAgICAgfSwgb3B0aW9ucyApO1xyXG4gICAgICAgICAgICB0aGlzLnVpZCA9IEJhc2UuZ3VpZCgncnRfJyk7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgJC5leHRlbmQoIFJ1bnRpbWUucHJvdG90eXBlLCB7XHJcbiAgICBcclxuICAgICAgICAgICAgZ2V0Q29udGFpbmVyOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBvcHRzID0gdGhpcy5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudCwgY29udGFpbmVyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIHRoaXMuX2NvbnRhaW5lciApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29udGFpbmVyO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBwYXJlbnQgPSAkKCBvcHRzLmNvbnRhaW5lciB8fCBkb2N1bWVudC5ib2R5ICk7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIgPSAkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYXR0ciggJ2lkJywgJ3J0XycgKyB0aGlzLnVpZCApO1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXHJcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAnMHB4JyxcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAnMHB4JyxcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogJzFweCcsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAnMXB4JyxcclxuICAgICAgICAgICAgICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbidcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBwYXJlbnQuYXBwZW5kKCBjb250YWluZXIgKTtcclxuICAgICAgICAgICAgICAgIHBhcmVudC5hZGRDbGFzcygnd2VidXBsb2FkZXItY29udGFpbmVyJyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXJlbnQgPSBwYXJlbnQ7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udGFpbmVyO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGluaXQ6IEJhc2Uubm9vcCxcclxuICAgICAgICAgICAgZXhlYzogQmFzZS5ub29wLFxyXG4gICAgXHJcbiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY29udGFpbmVyICYmIHRoaXMuX2NvbnRhaW5lci5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3BhcmVudCAmJiB0aGlzLl9wYXJlbnQucmVtb3ZlQ2xhc3MoJ3dlYnVwbG9hZGVyLWNvbnRhaW5lcicpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vZmYoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgUnVudGltZS5vcmRlcnMgPSAnaHRtbDUsZmxhc2gnO1xyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDmt7vliqBSdW50aW1l5a6e546w44CCXHJcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUgICAg57G75Z6LXHJcbiAgICAgICAgICogQHBhcmFtIHtSdW50aW1lfSBmYWN0b3J5IOWFt+S9k1J1bnRpbWXlrp7njrDjgIJcclxuICAgICAgICAgKi9cclxuICAgICAgICBSdW50aW1lLmFkZFJ1bnRpbWUgPSBmdW5jdGlvbiggdHlwZSwgZmFjdG9yeSApIHtcclxuICAgICAgICAgICAgZmFjdG9yaWVzWyB0eXBlIF0gPSBmYWN0b3J5O1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICBSdW50aW1lLmhhc1J1bnRpbWUgPSBmdW5jdGlvbiggdHlwZSApIHtcclxuICAgICAgICAgICAgcmV0dXJuICEhKHR5cGUgPyBmYWN0b3JpZXNbIHR5cGUgXSA6IGdldEZpcnN0S2V5KCBmYWN0b3JpZXMgKSk7XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIFJ1bnRpbWUuY3JlYXRlID0gZnVuY3Rpb24oIG9wdHMsIG9yZGVycyApIHtcclxuICAgICAgICAgICAgdmFyIHR5cGUsIHJ1bnRpbWU7XHJcbiAgICBcclxuICAgICAgICAgICAgb3JkZXJzID0gb3JkZXJzIHx8IFJ1bnRpbWUub3JkZXJzO1xyXG4gICAgICAgICAgICAkLmVhY2goIG9yZGVycy5zcGxpdCggL1xccyosXFxzKi9nICksIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCBmYWN0b3JpZXNbIHRoaXMgXSApIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gdGhpcztcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHR5cGUgPSB0eXBlIHx8IGdldEZpcnN0S2V5KCBmYWN0b3JpZXMgKTtcclxuICAgIFxyXG4gICAgICAgICAgICBpZiAoICF0eXBlICkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSdW50aW1lIEVycm9yJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICBydW50aW1lID0gbmV3IGZhY3Rvcmllc1sgdHlwZSBdKCBvcHRzICk7XHJcbiAgICAgICAgICAgIHJldHVybiBydW50aW1lO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICBNZWRpYXRvci5pbnN0YWxsVG8oIFJ1bnRpbWUucHJvdG90eXBlICk7XHJcbiAgICAgICAgcmV0dXJuIFJ1bnRpbWU7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IFJ1bnRpbWXnrqHnkIblmajvvIzotJ/otKNSdW50aW1l55qE6YCJ5oupLCDov57mjqVcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdydW50aW1lL2NsaWVudCcsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAnbWVkaWF0b3InLFxyXG4gICAgICAgICdydW50aW1lL3J1bnRpbWUnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgTWVkaWF0b3IsIFJ1bnRpbWUgKSB7XHJcbiAgICBcclxuICAgICAgICB2YXIgY2FjaGU7XHJcbiAgICBcclxuICAgICAgICBjYWNoZSA9IChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIG9iaiA9IHt9O1xyXG4gICAgXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBhZGQ6IGZ1bmN0aW9uKCBydW50aW1lICkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ialsgcnVudGltZS51aWQgXSA9IHJ1bnRpbWU7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBydWlkLCBzdGFuZGFsb25lICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBydWlkICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb2JqWyBydWlkIF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICggaSBpbiBvYmogKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOacieS6m+exu+Wei+S4jeiDvemHjeeUqO+8jOavlOWmgmZpbGVwaWNrZXIuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggc3RhbmRhbG9uZSAmJiBvYmpbIGkgXS5fX3N0YW5kYWxvbmUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvYmpbIGkgXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24oIHJ1bnRpbWUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG9ialsgcnVudGltZS51aWQgXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KSgpO1xyXG4gICAgXHJcbiAgICAgICAgZnVuY3Rpb24gUnVudGltZUNsaWVudCggY29tcG9uZW50LCBzdGFuZGFsb25lICkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSBCYXNlLkRlZmVycmVkKCksXHJcbiAgICAgICAgICAgICAgICBydW50aW1lO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMudWlkID0gQmFzZS5ndWlkKCdjbGllbnRfJyk7XHJcbiAgICBcclxuICAgICAgICAgICAgLy8g5YWB6K64cnVudGltZeayoeacieWIneWni+WMluS5i+WJje+8jOazqOWGjOS4gOS6m+aWueazleWcqOWIneWni+WMluWQjuaJp+ihjOOAglxyXG4gICAgICAgICAgICB0aGlzLnJ1bnRpbWVSZWFkeSA9IGZ1bmN0aW9uKCBjYiApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5kb25lKCBjYiApO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdFJ1bnRpbWUgPSBmdW5jdGlvbiggb3B0cywgY2IgKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIGFscmVhZHkgY29ubmVjdGVkLlxyXG4gICAgICAgICAgICAgICAgaWYgKCBydW50aW1lICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYWxyZWFkeSBjb25uZWN0ZWQhJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLmRvbmUoIGNiICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIG9wdHMgPT09ICdzdHJpbmcnICYmIGNhY2hlLmdldCggb3B0cyApICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJ1bnRpbWUgPSBjYWNoZS5nZXQoIG9wdHMgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5YOPZmlsZVBpY2tlcuWPquiDveeLrOeri+WtmOWcqO+8jOS4jeiDveWFrOeUqOOAglxyXG4gICAgICAgICAgICAgICAgcnVudGltZSA9IHJ1bnRpbWUgfHwgY2FjaGUuZ2V0KCBudWxsLCBzdGFuZGFsb25lICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOmcgOimgeWIm+W7ulxyXG4gICAgICAgICAgICAgICAgaWYgKCAhcnVudGltZSApIHtcclxuICAgICAgICAgICAgICAgICAgICBydW50aW1lID0gUnVudGltZS5jcmVhdGUoIG9wdHMsIG9wdHMucnVudGltZU9yZGVyICk7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVudGltZS5fX3Byb21pc2UgPSBkZWZlcnJlZC5wcm9taXNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVudGltZS5vbmNlKCAncmVhZHknLCBkZWZlcnJlZC5yZXNvbHZlICk7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVudGltZS5pbml0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FjaGUuYWRkKCBydW50aW1lICk7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVudGltZS5fX2NsaWVudCA9IDE7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOadpeiHqmNhY2hlXHJcbiAgICAgICAgICAgICAgICAgICAgQmFzZS4kLmV4dGVuZCggcnVudGltZS5vcHRpb25zLCBvcHRzICk7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVudGltZS5fX3Byb21pc2UudGhlbiggZGVmZXJyZWQucmVzb2x2ZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJ1bnRpbWUuX19jbGllbnQrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgc3RhbmRhbG9uZSAmJiAocnVudGltZS5fX3N0YW5kYWxvbmUgPSBzdGFuZGFsb25lKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBydW50aW1lO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0UnVudGltZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJ1bnRpbWU7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0UnVudGltZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCAhcnVudGltZSApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJ1bnRpbWUuX19jbGllbnQtLTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCBydW50aW1lLl9fY2xpZW50IDw9IDAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FjaGUucmVtb3ZlKCBydW50aW1lICk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHJ1bnRpbWUuX19wcm9taXNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJ1bnRpbWUuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBydW50aW1lID0gbnVsbDtcclxuICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICB0aGlzLmV4ZWMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmICggIXJ1bnRpbWUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEJhc2Uuc2xpY2UoIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50ICYmIGFyZ3MudW5zaGlmdCggY29tcG9uZW50ICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBydW50aW1lLmV4ZWMuYXBwbHkoIHRoaXMsIGFyZ3MgKTtcclxuICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICB0aGlzLmdldFJ1aWQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBydW50aW1lICYmIHJ1bnRpbWUudWlkO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveSA9IChmdW5jdGlvbiggZGVzdHJveSApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZXN0cm95ICYmIGRlc3Ryb3kuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignZGVzdHJveScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub2ZmKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGVjKCdkZXN0cm95Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNjb25uZWN0UnVudGltZSgpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSkoIHRoaXMuZGVzdHJveSApO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIE1lZGlhdG9yLmluc3RhbGxUbyggUnVudGltZUNsaWVudC5wcm90b3R5cGUgKTtcclxuICAgICAgICByZXR1cm4gUnVudGltZUNsaWVudDtcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IOmUmeivr+S/oeaBr1xyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ2xpYi9kbmQnLFtcclxuICAgICAgICAnYmFzZScsXHJcbiAgICAgICAgJ21lZGlhdG9yJyxcclxuICAgICAgICAncnVudGltZS9jbGllbnQnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgTWVkaWF0b3IsIFJ1bnRpbWVDbGVudCApIHtcclxuICAgIFxyXG4gICAgICAgIHZhciAkID0gQmFzZS4kO1xyXG4gICAgXHJcbiAgICAgICAgZnVuY3Rpb24gRHJhZ0FuZERyb3AoIG9wdHMgKSB7XHJcbiAgICAgICAgICAgIG9wdHMgPSB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgRHJhZ0FuZERyb3Aub3B0aW9ucywgb3B0cyApO1xyXG4gICAgXHJcbiAgICAgICAgICAgIG9wdHMuY29udGFpbmVyID0gJCggb3B0cy5jb250YWluZXIgKTtcclxuICAgIFxyXG4gICAgICAgICAgICBpZiAoICFvcHRzLmNvbnRhaW5lci5sZW5ndGggKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICBSdW50aW1lQ2xlbnQuY2FsbCggdGhpcywgJ0RyYWdBbmREcm9wJyApO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIERyYWdBbmREcm9wLm9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGFjY2VwdDogbnVsbCxcclxuICAgICAgICAgICAgZGlzYWJsZUdsb2JhbERuZDogZmFsc2VcclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgQmFzZS5pbmhlcml0cyggUnVudGltZUNsZW50LCB7XHJcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yOiBEcmFnQW5kRHJvcCxcclxuICAgIFxyXG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIG1lLmNvbm5lY3RSdW50aW1lKCBtZS5vcHRpb25zLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBtZS5leGVjKCdpbml0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUudHJpZ2dlcigncmVhZHknKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICBNZWRpYXRvci5pbnN0YWxsVG8oIERyYWdBbmREcm9wLnByb3RvdHlwZSApO1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIERyYWdBbmREcm9wO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcg57uE5Lu25Z+657G744CCXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgnd2lkZ2V0cy93aWRnZXQnLFtcclxuICAgICAgICAnYmFzZScsXHJcbiAgICAgICAgJ3VwbG9hZGVyJ1xyXG4gICAgXSwgZnVuY3Rpb24oIEJhc2UsIFVwbG9hZGVyICkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQsXHJcbiAgICAgICAgICAgIF9pbml0ID0gVXBsb2FkZXIucHJvdG90eXBlLl9pbml0LFxyXG4gICAgICAgICAgICBfZGVzdHJveSA9IFVwbG9hZGVyLnByb3RvdHlwZS5kZXN0cm95LFxyXG4gICAgICAgICAgICBJR05PUkUgPSB7fSxcclxuICAgICAgICAgICAgd2lkZ2V0Q2xhc3MgPSBbXTtcclxuICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGlzQXJyYXlMaWtlKCBvYmogKSB7XHJcbiAgICAgICAgICAgIGlmICggIW9iaiApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIHZhciBsZW5ndGggPSBvYmoubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgdHlwZSA9ICQudHlwZSggb2JqICk7XHJcbiAgICBcclxuICAgICAgICAgICAgaWYgKCBvYmoubm9kZVR5cGUgPT09IDEgJiYgbGVuZ3RoICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gdHlwZSA9PT0gJ2FycmF5JyB8fCB0eXBlICE9PSAnZnVuY3Rpb24nICYmIHR5cGUgIT09ICdzdHJpbmcnICYmXHJcbiAgICAgICAgICAgICAgICAgICAgKGxlbmd0aCA9PT0gMCB8fCB0eXBlb2YgbGVuZ3RoID09PSAnbnVtYmVyJyAmJiBsZW5ndGggPiAwICYmXHJcbiAgICAgICAgICAgICAgICAgICAgKGxlbmd0aCAtIDEpIGluIG9iaik7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgZnVuY3Rpb24gV2lkZ2V0KCB1cGxvYWRlciApIHtcclxuICAgICAgICAgICAgdGhpcy5vd25lciA9IHVwbG9hZGVyO1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSB1cGxvYWRlci5vcHRpb25zO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICQuZXh0ZW5kKCBXaWRnZXQucHJvdG90eXBlLCB7XHJcbiAgICBcclxuICAgICAgICAgICAgaW5pdDogQmFzZS5ub29wLFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOexu0JhY2tib25l55qE5LqL5Lu255uR5ZCs5aOw5piO77yM55uR5ZCsdXBsb2FkZXLlrp7kvovkuIrnmoTkuovku7ZcclxuICAgICAgICAgICAgLy8gd2lkZ2V055u05o6l5peg5rOV55uR5ZCs5LqL5Lu277yM5LqL5Lu25Y+q6IO96YCa6L+HdXBsb2FkZXLmnaXkvKDpgJJcclxuICAgICAgICAgICAgaW52b2tlOiBmdW5jdGlvbiggYXBpTmFtZSwgYXJncyApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLypcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdtYWtlLXRodW1iJzogJ21ha2VUaHVtYidcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgIHZhciBtYXAgPSB0aGlzLnJlc3BvbnNlTWFwO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpzml6BBUEnlk43lupTlo7DmmI7liJnlv73nlaVcclxuICAgICAgICAgICAgICAgIGlmICggIW1hcCB8fCAhKGFwaU5hbWUgaW4gbWFwKSB8fCAhKG1hcFsgYXBpTmFtZSBdIGluIHRoaXMpIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICEkLmlzRnVuY3Rpb24oIHRoaXNbIG1hcFsgYXBpTmFtZSBdIF0gKSApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBJR05PUkU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzWyBtYXBbIGFwaU5hbWUgXSBdLmFwcGx5KCB0aGlzLCBhcmdzICk7XHJcbiAgICBcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5Y+R6YCB5ZG95Luk44CC5b2T5Lyg5YWlYGNhbGxiYWNrYOaIluiAhWBoYW5kbGVyYOS4rei/lOWbnmBwcm9taXNlYOaXtuOAgui/lOWbnuS4gOS4quW9k+aJgOaciWBoYW5kbGVyYOS4reeahHByb21pc2Xpg73lrozmiJDlkI7lrozmiJDnmoTmlrBgcHJvbWlzZWDjgIJcclxuICAgICAgICAgICAgICogQG1ldGhvZCByZXF1ZXN0XHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIHJlcXVlc3QoIGNvbW1hbmQsIGFyZ3MgKSA9PiAqIHwgUHJvbWlzZVxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciByZXF1ZXN0KCBjb21tYW5kLCBhcmdzLCBjYWxsYmFjayApID0+IFByb21pc2VcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMub3duZXIucmVxdWVzdC5hcHBseSggdGhpcy5vd25lciwgYXJndW1lbnRzICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgIC8vIOaJqeWxlVVwbG9hZGVyLlxyXG4gICAgICAgICQuZXh0ZW5kKCBVcGxvYWRlci5wcm90b3R5cGUsIHtcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtTdHJpbmcgfCBBcnJheX0gW2Rpc2FibGVXaWRnZXRzPXVuZGVmaW5lZF1cclxuICAgICAgICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zXHJcbiAgICAgICAgICAgICAqIEBmb3IgVXBsb2FkZXJcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOm7mOiupOaJgOaciSBVcGxvYWRlci5yZWdpc3RlciDkuobnmoQgd2lkZ2V0IOmDveS8muiiq+WKoOi9ve+8jOWmguaenOemgeeUqOafkOS4gOmDqOWIhu+8jOivt+mAmui/h+atpCBvcHRpb24g5oyH5a6a6buR5ZCN5Y2V44CCXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOimhuWGmV9pbml055So5p2l5Yid5aeL5YyWd2lkZ2V0c1xyXG4gICAgICAgICAgICBfaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIHdpZGdldHMgPSBtZS5fd2lkZ2V0cyA9IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlYWN0aXZlcyA9IG1lLm9wdGlvbnMuZGlzYWJsZVdpZGdldHMgfHwgJyc7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICQuZWFjaCggd2lkZ2V0Q2xhc3MsIGZ1bmN0aW9uKCBfLCBrbGFzcyApIHtcclxuICAgICAgICAgICAgICAgICAgICAoIWRlYWN0aXZlcyB8fCAhfmRlYWN0aXZlcy5pbmRleE9mKCBrbGFzcy5fbmFtZSApKSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXRzLnB1c2goIG5ldyBrbGFzcyggbWUgKSApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBfaW5pdC5hcHBseSggbWUsIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uKCBhcGlOYW1lLCBhcmdzLCBjYWxsYmFjayApIHtcclxuICAgICAgICAgICAgICAgIHZhciBpID0gMCxcclxuICAgICAgICAgICAgICAgICAgICB3aWRnZXRzID0gdGhpcy5fd2lkZ2V0cyxcclxuICAgICAgICAgICAgICAgICAgICBsZW4gPSB3aWRnZXRzICYmIHdpZGdldHMubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgICAgIHJsdHMgPSBbXSxcclxuICAgICAgICAgICAgICAgICAgICBkZmRzID0gW10sXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0LCBybHQsIHByb21pc2UsIGtleTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgYXJncyA9IGlzQXJyYXlMaWtlKCBhcmdzICkgPyBhcmdzIDogWyBhcmdzIF07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZGdldCA9IHdpZGdldHNbIGkgXTtcclxuICAgICAgICAgICAgICAgICAgICBybHQgPSB3aWRnZXQuaW52b2tlKCBhcGlOYW1lLCBhcmdzICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIHJsdCAhPT0gSUdOT1JFICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERlZmVycmVk5a+56LGhXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggQmFzZS5pc1Byb21pc2UoIHJsdCApICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGZkcy5wdXNoKCBybHQgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJsdHMucHVzaCggcmx0ICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOWmguaenOaciWNhbGxiYWNr77yM5YiZ55So5byC5q2l5pa55byP44CCXHJcbiAgICAgICAgICAgICAgICBpZiAoIGNhbGxiYWNrIHx8IGRmZHMubGVuZ3RoICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UgPSBCYXNlLndoZW4uYXBwbHkoIEJhc2UsIGRmZHMgKTtcclxuICAgICAgICAgICAgICAgICAgICBrZXkgPSBwcm9taXNlLnBpcGUgPyAncGlwZScgOiAndGhlbic7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyDlvojph43opoHkuI3og73liKDpmaTjgILliKDpmaTkuobkvJrmrbvlvqrnjq/jgIJcclxuICAgICAgICAgICAgICAgICAgICAvLyDkv53or4HmiafooYzpobrluo/jgILorqljYWxsYmFja+aAu+aYr+WcqOS4i+S4gOS4qiB0aWNrIOS4reaJp+ihjOOAglxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlWyBrZXkgXShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSBCYXNlLkRlZmVycmVkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGFyZ3MubGVuZ3RoID09PSAxICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdzID0gYXJnc1sgMCBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoIGFyZ3MgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAxICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlbIGNhbGxiYWNrID8ga2V5IDogJ2RvbmUnIF0oIGNhbGxiYWNrIHx8IEJhc2Uubm9vcCApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmx0c1sgMCBdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgX2Rlc3Ryb3kuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fd2lkZ2V0cyA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOa3u+WKoOe7hOS7tlxyXG4gICAgICAgICAqIEBncmFtbWFyIFVwbG9hZGVyLnJlZ2lzdGVyKHByb3RvKTtcclxuICAgICAgICAgKiBAZ3JhbW1hciBVcGxvYWRlci5yZWdpc3RlcihtYXAsIHByb3RvKTtcclxuICAgICAgICAgKiBAcGFyYW0gIHtvYmplY3R9IHJlc3BvbnNlTWFwIEFQSSDlkI3np7DkuI7lh73mlbDlrp7njrDnmoTmmKDlsIRcclxuICAgICAgICAgKiBAcGFyYW0gIHtvYmplY3R9IHByb3RvIOe7hOS7tuWOn+Wei++8jOaehOmAoOWHveaVsOmAmui/hyBjb25zdHJ1Y3RvciDlsZ7mgKflrprkuYlcclxuICAgICAgICAgKiBAbWV0aG9kIFVwbG9hZGVyLnJlZ2lzdGVyXHJcbiAgICAgICAgICogQGZvciBVcGxvYWRlclxyXG4gICAgICAgICAqIEBleGFtcGxlXHJcbiAgICAgICAgICogVXBsb2FkZXIucmVnaXN0ZXIoe1xyXG4gICAgICAgICAqICAgICAnbWFrZS10aHVtYic6ICdtYWtlVGh1bWInXHJcbiAgICAgICAgICogfSwge1xyXG4gICAgICAgICAqICAgICBpbml0OiBmdW5jdGlvbiggb3B0aW9ucyApIHt9LFxyXG4gICAgICAgICAqICAgICBtYWtlVGh1bWI6IGZ1bmN0aW9uKCkge31cclxuICAgICAgICAgKiB9KTtcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIFVwbG9hZGVyLnJlZ2lzdGVyKHtcclxuICAgICAgICAgKiAgICAgJ21ha2UtdGh1bWInOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgKiAgICAgICAgIFxyXG4gICAgICAgICAqICAgICB9XHJcbiAgICAgICAgICogfSk7XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgVXBsb2FkZXIucmVnaXN0ZXIgPSBXaWRnZXQucmVnaXN0ZXIgPSBmdW5jdGlvbiggcmVzcG9uc2VNYXAsIHdpZGdldFByb3RvICkge1xyXG4gICAgICAgICAgICB2YXIgbWFwID0geyBpbml0OiAnaW5pdCcsIGRlc3Ryb3k6ICdkZXN0cm95JywgbmFtZTogJ2Fub255bW91cycgfSxcclxuICAgICAgICAgICAgICAgIGtsYXNzO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGlmICggYXJndW1lbnRzLmxlbmd0aCA9PT0gMSApIHtcclxuICAgICAgICAgICAgICAgIHdpZGdldFByb3RvID0gcmVzcG9uc2VNYXA7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOiHquWKqOeUn+aIkCBtYXAg6KGo44CCXHJcbiAgICAgICAgICAgICAgICAkLmVhY2god2lkZ2V0UHJvdG8sIGZ1bmN0aW9uKGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgga2V5WzBdID09PSAnXycgfHwga2V5ID09PSAnbmFtZScgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9PT0gJ25hbWUnICYmIChtYXAubmFtZSA9IHdpZGdldFByb3RvLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwW2tleS5yZXBsYWNlKC9bQS1aXS9nLCAnLSQmJykudG9Mb3dlckNhc2UoKV0gPSBrZXk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbWFwID0gJC5leHRlbmQoIG1hcCwgcmVzcG9uc2VNYXAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIHdpZGdldFByb3RvLnJlc3BvbnNlTWFwID0gbWFwO1xyXG4gICAgICAgICAgICBrbGFzcyA9IEJhc2UuaW5oZXJpdHMoIFdpZGdldCwgd2lkZ2V0UHJvdG8gKTtcclxuICAgICAgICAgICAga2xhc3MuX25hbWUgPSBtYXAubmFtZTtcclxuICAgICAgICAgICAgd2lkZ2V0Q2xhc3MucHVzaCgga2xhc3MgKTtcclxuICAgIFxyXG4gICAgICAgICAgICByZXR1cm4ga2xhc3M7XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOWIoOmZpOaPkuS7tu+8jOWPquacieWcqOazqOWGjOaXtuaMh+WumuS6huWQjeWtl+eahOaJjeiDveiiq+WIoOmZpOOAglxyXG4gICAgICAgICAqIEBncmFtbWFyIFVwbG9hZGVyLnVuUmVnaXN0ZXIobmFtZSk7XHJcbiAgICAgICAgICogQHBhcmFtICB7c3RyaW5nfSBuYW1lIOe7hOS7tuWQjeWtl1xyXG4gICAgICAgICAqIEBtZXRob2QgVXBsb2FkZXIudW5SZWdpc3RlclxyXG4gICAgICAgICAqIEBmb3IgVXBsb2FkZXJcclxuICAgICAgICAgKiBAZXhhbXBsZVxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogVXBsb2FkZXIucmVnaXN0ZXIoe1xyXG4gICAgICAgICAqICAgICBuYW1lOiAnY3VzdG9tJyxcclxuICAgICAgICAgKiAgICAgXHJcbiAgICAgICAgICogICAgICdtYWtlLXRodW1iJzogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICogICAgICAgICBcclxuICAgICAgICAgKiAgICAgfVxyXG4gICAgICAgICAqIH0pO1xyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogVXBsb2FkZXIudW5SZWdpc3RlcignY3VzdG9tJyk7XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgVXBsb2FkZXIudW5SZWdpc3RlciA9IFdpZGdldC51blJlZ2lzdGVyID0gZnVuY3Rpb24oIG5hbWUgKSB7XHJcbiAgICAgICAgICAgIGlmICggIW5hbWUgfHwgbmFtZSA9PT0gJ2Fub255bW91cycgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIOWIoOmZpOaMh+WumueahOaPkuS7tuOAglxyXG4gICAgICAgICAgICBmb3IgKCB2YXIgaSA9IHdpZGdldENsYXNzLmxlbmd0aDsgaS0tOyApIHtcclxuICAgICAgICAgICAgICAgIGlmICggd2lkZ2V0Q2xhc3NbaV0uX25hbWUgPT09IG5hbWUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0Q2xhc3Muc3BsaWNlKGksIDEpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIFdpZGdldDtcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IERyYWdBbmREcm9wIFdpZGdldOOAglxyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ3dpZGdldHMvZmlsZWRuZCcsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAndXBsb2FkZXInLFxyXG4gICAgICAgICdsaWIvZG5kJyxcclxuICAgICAgICAnd2lkZ2V0cy93aWRnZXQnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgVXBsb2FkZXIsIERuZCApIHtcclxuICAgICAgICB2YXIgJCA9IEJhc2UuJDtcclxuICAgIFxyXG4gICAgICAgIFVwbG9hZGVyLm9wdGlvbnMuZG5kID0gJyc7XHJcbiAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBAcHJvcGVydHkge1NlbGVjdG9yfSBbZG5kPXVuZGVmaW5lZF0gIOaMh+WumkRyYWcgQW5kIERyb3Dmi5bmi73nmoTlrrnlmajvvIzlpoLmnpzkuI3mjIflrprvvIzliJnkuI3lkK/liqjjgIJcclxuICAgICAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnNcclxuICAgICAgICAgKiBAZm9yIFVwbG9hZGVyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQHByb3BlcnR5IHtTZWxlY3Rvcn0gW2Rpc2FibGVHbG9iYWxEbmQ9ZmFsc2VdICDmmK/lkKbnpoHmjonmlbTkuKrpobXpnaLnmoTmi5bmi73lip/og73vvIzlpoLmnpzkuI3npoHnlKjvvIzlm77niYfmi5bov5vmnaXnmoTml7blgJnkvJrpu5jorqTooqvmtY/op4jlmajmiZPlvIDjgIJcclxuICAgICAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnNcclxuICAgICAgICAgKiBAZm9yIFVwbG9hZGVyXHJcbiAgICAgICAgICovXHJcbiAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBAZXZlbnQgZG5kQWNjZXB0XHJcbiAgICAgICAgICogQHBhcmFtIHtEYXRhVHJhbnNmZXJJdGVtTGlzdH0gaXRlbXMgRGF0YVRyYW5zZmVySXRlbVxyXG4gICAgICAgICAqIEBkZXNjcmlwdGlvbiDpmLvmraLmraTkuovku7blj6/ku6Xmi5Lnu53mn5DkupvnsbvlnovnmoTmlofku7bmi5blhaXov5vmnaXjgILnm67liY3lj6rmnIkgY2hyb21lIOaPkOS+m+i/meagt+eahCBBUEnvvIzkuJTlj6rog73pgJrov4cgbWltZS10eXBlIOmqjOivgeOAglxyXG4gICAgICAgICAqIEBmb3IgIFVwbG9hZGVyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgcmV0dXJuIFVwbG9hZGVyLnJlZ2lzdGVyKHtcclxuICAgICAgICAgICAgbmFtZTogJ2RuZCcsXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbiggb3B0cyApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCAhb3B0cy5kbmQgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0KCdwcmVkaWN0LXJ1bnRpbWUtdHlwZScpICE9PSAnaHRtbDUnICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZCA9IEJhc2UuRGVmZXJyZWQoKSxcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzYWJsZUdsb2JhbERuZDogb3B0cy5kaXNhYmxlR2xvYmFsRG5kLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXI6IG9wdHMuZG5kLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY2NlcHQ6IG9wdHMuYWNjZXB0XHJcbiAgICAgICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICAgICAgICAgZG5kO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRuZCA9IGRuZCA9IG5ldyBEbmQoIG9wdGlvbnMgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZG5kLm9uY2UoICdyZWFkeScsIGRlZmVycmVkLnJlc29sdmUgKTtcclxuICAgICAgICAgICAgICAgIGRuZC5vbiggJ2Ryb3AnLCBmdW5jdGlvbiggZmlsZXMgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUucmVxdWVzdCggJ2FkZC1maWxlJywgWyBmaWxlcyBdKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDmo4DmtYvmlofku7bmmK/lkKblhajpg6jlhYHorrjmt7vliqDjgIJcclxuICAgICAgICAgICAgICAgIGRuZC5vbiggJ2FjY2VwdCcsIGZ1bmN0aW9uKCBpdGVtcyApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWUub3duZXIudHJpZ2dlciggJ2RuZEFjY2VwdCcsIGl0ZW1zICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZG5kLmluaXQoKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZG5kICYmIHRoaXMuZG5kLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICogQGZpbGVPdmVydmlldyDplJnor6/kv6Hmga9cclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdsaWIvZmlsZXBhc3RlJyxbXHJcbiAgICAgICAgJ2Jhc2UnLFxyXG4gICAgICAgICdtZWRpYXRvcicsXHJcbiAgICAgICAgJ3J1bnRpbWUvY2xpZW50J1xyXG4gICAgXSwgZnVuY3Rpb24oIEJhc2UsIE1lZGlhdG9yLCBSdW50aW1lQ2xlbnQgKSB7XHJcbiAgICBcclxuICAgICAgICB2YXIgJCA9IEJhc2UuJDtcclxuICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIEZpbGVQYXN0ZSggb3B0cyApIHtcclxuICAgICAgICAgICAgb3B0cyA9IHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRzICk7XHJcbiAgICAgICAgICAgIG9wdHMuY29udGFpbmVyID0gJCggb3B0cy5jb250YWluZXIgfHwgZG9jdW1lbnQuYm9keSApO1xyXG4gICAgICAgICAgICBSdW50aW1lQ2xlbnQuY2FsbCggdGhpcywgJ0ZpbGVQYXN0ZScgKTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBCYXNlLmluaGVyaXRzKCBSdW50aW1lQ2xlbnQsIHtcclxuICAgICAgICAgICAgY29uc3RydWN0b3I6IEZpbGVQYXN0ZSxcclxuICAgIFxyXG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIG1lLmNvbm5lY3RSdW50aW1lKCBtZS5vcHRpb25zLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBtZS5leGVjKCdpbml0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUudHJpZ2dlcigncmVhZHknKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICBNZWRpYXRvci5pbnN0YWxsVG8oIEZpbGVQYXN0ZS5wcm90b3R5cGUgKTtcclxuICAgIFxyXG4gICAgICAgIHJldHVybiBGaWxlUGFzdGU7XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogQGZpbGVPdmVydmlldyDnu4Tku7bln7rnsbvjgIJcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCd3aWRnZXRzL2ZpbGVwYXN0ZScsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAndXBsb2FkZXInLFxyXG4gICAgICAgICdsaWIvZmlsZXBhc3RlJyxcclxuICAgICAgICAnd2lkZ2V0cy93aWRnZXQnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgVXBsb2FkZXIsIEZpbGVQYXN0ZSApIHtcclxuICAgICAgICB2YXIgJCA9IEJhc2UuJDtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBwcm9wZXJ0eSB7U2VsZWN0b3J9IFtwYXN0ZT11bmRlZmluZWRdICDmjIflrprnm5HlkKxwYXN0ZeS6i+S7tueahOWuueWZqO+8jOWmguaenOS4jeaMh+Wumu+8jOS4jeWQr+eUqOatpOWKn+iDveOAguatpOWKn+iDveS4uumAmui/h+eymOi0tOadpea3u+WKoOaIquWxj+eahOWbvueJh+OAguW7uuiuruiuvue9ruS4umBkb2N1bWVudC5ib2R5YC5cclxuICAgICAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnNcclxuICAgICAgICAgKiBAZm9yIFVwbG9hZGVyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgcmV0dXJuIFVwbG9hZGVyLnJlZ2lzdGVyKHtcclxuICAgICAgICAgICAgbmFtZTogJ3Bhc3RlJyxcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRzICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoICFvcHRzLnBhc3RlIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVxdWVzdCgncHJlZGljdC1ydW50aW1lLXR5cGUnKSAhPT0gJ2h0bWw1JyApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHZhciBtZSA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQgPSBCYXNlLkRlZmVycmVkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcjogb3B0cy5wYXN0ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXB0OiBvcHRzLmFjY2VwdFxyXG4gICAgICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhc3RlO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBhc3RlID0gcGFzdGUgPSBuZXcgRmlsZVBhc3RlKCBvcHRpb25zICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHBhc3RlLm9uY2UoICdyZWFkeScsIGRlZmVycmVkLnJlc29sdmUgKTtcclxuICAgICAgICAgICAgICAgIHBhc3RlLm9uKCAncGFzdGUnLCBmdW5jdGlvbiggZmlsZXMgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUub3duZXIucmVxdWVzdCggJ2FkZC1maWxlJywgWyBmaWxlcyBdKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcGFzdGUuaW5pdCgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXN0ZSAmJiB0aGlzLnBhc3RlLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcgQmxvYlxyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ2xpYi9ibG9iJyxbXHJcbiAgICAgICAgJ2Jhc2UnLFxyXG4gICAgICAgICdydW50aW1lL2NsaWVudCdcclxuICAgIF0sIGZ1bmN0aW9uKCBCYXNlLCBSdW50aW1lQ2xpZW50ICkge1xyXG4gICAgXHJcbiAgICAgICAgZnVuY3Rpb24gQmxvYiggcnVpZCwgc291cmNlICkge1xyXG4gICAgICAgICAgICB2YXIgbWUgPSB0aGlzO1xyXG4gICAgXHJcbiAgICAgICAgICAgIG1lLnNvdXJjZSA9IHNvdXJjZTtcclxuICAgICAgICAgICAgbWUucnVpZCA9IHJ1aWQ7XHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZSA9IHNvdXJjZS5zaXplIHx8IDA7XHJcbiAgICBcclxuICAgICAgICAgICAgLy8g5aaC5p6c5rKh5pyJ5oyH5a6aIG1pbWV0eXBlLCDkvYbmmK/nn6XpgZPmlofku7blkI7nvIDjgIJcclxuICAgICAgICAgICAgaWYgKCAhc291cmNlLnR5cGUgJiYgdGhpcy5leHQgJiZcclxuICAgICAgICAgICAgICAgICAgICB+J2pwZyxqcGVnLHBuZyxnaWYsYm1wJy5pbmRleE9mKCB0aGlzLmV4dCApICkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50eXBlID0gJ2ltYWdlLycgKyAodGhpcy5leHQgPT09ICdqcGcnID8gJ2pwZWcnIDogdGhpcy5leHQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50eXBlID0gc291cmNlLnR5cGUgfHwgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICBSdW50aW1lQ2xpZW50LmNhbGwoIG1lLCAnQmxvYicgKTtcclxuICAgICAgICAgICAgdGhpcy51aWQgPSBzb3VyY2UudWlkIHx8IHRoaXMudWlkO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGlmICggcnVpZCApIHtcclxuICAgICAgICAgICAgICAgIG1lLmNvbm5lY3RSdW50aW1lKCBydWlkICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBCYXNlLmluaGVyaXRzKCBSdW50aW1lQ2xpZW50LCB7XHJcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yOiBCbG9iLFxyXG4gICAgXHJcbiAgICAgICAgICAgIHNsaWNlOiBmdW5jdGlvbiggc3RhcnQsIGVuZCApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmV4ZWMoICdzbGljZScsIHN0YXJ0LCBlbmQgKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBnZXRTb3VyY2U6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gQmxvYjtcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiDkuLrkuobnu5/kuIDljJZGbGFzaOeahEZpbGXlkoxIVE1MNeeahEZpbGXogIzlrZjlnKjjgIJcclxuICAgICAqIOS7peiHs+S6juimgeiwg+eUqEZsYXNo6YeM6Z2i55qERmlsZe+8jOS5n+WPr+S7peWDj+iwg+eUqEhUTUw154mI5pys55qERmlsZeS4gOS4i+OAglxyXG4gICAgICogQGZpbGVPdmVydmlldyBGaWxlXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgnbGliL2ZpbGUnLFtcclxuICAgICAgICAnYmFzZScsXHJcbiAgICAgICAgJ2xpYi9ibG9iJ1xyXG4gICAgXSwgZnVuY3Rpb24oIEJhc2UsIEJsb2IgKSB7XHJcbiAgICBcclxuICAgICAgICB2YXIgdWlkID0gMSxcclxuICAgICAgICAgICAgckV4dCA9IC9cXC4oW14uXSspJC87XHJcbiAgICBcclxuICAgICAgICBmdW5jdGlvbiBGaWxlKCBydWlkLCBmaWxlICkge1xyXG4gICAgICAgICAgICB2YXIgZXh0O1xyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IGZpbGUubmFtZSB8fCAoJ3VudGl0bGVkJyArIHVpZCsrKTtcclxuICAgICAgICAgICAgZXh0ID0gckV4dC5leGVjKCBmaWxlLm5hbWUgKSA/IFJlZ0V4cC4kMS50b0xvd2VyQ2FzZSgpIDogJyc7XHJcbiAgICBcclxuICAgICAgICAgICAgLy8gdG9kbyDmlK/mjIHlhbbku5bnsbvlnovmlofku7bnmoTovazmjaLjgIJcclxuICAgICAgICAgICAgLy8g5aaC5p6c5pyJIG1pbWV0eXBlLCDkvYbmmK/mlofku7blkI3ph4zpnaLmsqHmnInmib7lh7rlkI7nvIDop4TlvotcclxuICAgICAgICAgICAgaWYgKCAhZXh0ICYmIGZpbGUudHlwZSApIHtcclxuICAgICAgICAgICAgICAgIGV4dCA9IC9cXC8oanBnfGpwZWd8cG5nfGdpZnxibXApJC9pLmV4ZWMoIGZpbGUudHlwZSApID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgUmVnRXhwLiQxLnRvTG93ZXJDYXNlKCkgOiAnJztcclxuICAgICAgICAgICAgICAgIHRoaXMubmFtZSArPSAnLicgKyBleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICB0aGlzLmV4dCA9IGV4dDtcclxuICAgICAgICAgICAgdGhpcy5sYXN0TW9kaWZpZWREYXRlID0gZmlsZS5sYXN0TW9kaWZpZWREYXRlIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgKG5ldyBEYXRlKCkpLnRvTG9jYWxlU3RyaW5nKCk7XHJcbiAgICBcclxuICAgICAgICAgICAgQmxvYi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIEJhc2UuaW5oZXJpdHMoIEJsb2IsIEZpbGUgKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcg6ZSZ6K+v5L+h5oGvXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgnbGliL2ZpbGVwaWNrZXInLFtcclxuICAgICAgICAnYmFzZScsXHJcbiAgICAgICAgJ3J1bnRpbWUvY2xpZW50JyxcclxuICAgICAgICAnbGliL2ZpbGUnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgUnVudGltZUNsaWVudCwgRmlsZSApIHtcclxuICAgIFxyXG4gICAgICAgIHZhciAkID0gQmFzZS4kO1xyXG4gICAgXHJcbiAgICAgICAgZnVuY3Rpb24gRmlsZVBpY2tlciggb3B0cyApIHtcclxuICAgICAgICAgICAgb3B0cyA9IHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBGaWxlUGlja2VyLm9wdGlvbnMsIG9wdHMgKTtcclxuICAgIFxyXG4gICAgICAgICAgICBvcHRzLmNvbnRhaW5lciA9ICQoIG9wdHMuaWQgKTtcclxuICAgIFxyXG4gICAgICAgICAgICBpZiAoICFvcHRzLmNvbnRhaW5lci5sZW5ndGggKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+aMiemSruaMh+WumumUmeivrycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgb3B0cy5pbm5lckhUTUwgPSBvcHRzLmlubmVySFRNTCB8fCBvcHRzLmxhYmVsIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0cy5jb250YWluZXIuaHRtbCgpIHx8ICcnO1xyXG4gICAgXHJcbiAgICAgICAgICAgIG9wdHMuYnV0dG9uID0gJCggb3B0cy5idXR0b24gfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykgKTtcclxuICAgICAgICAgICAgb3B0cy5idXR0b24uaHRtbCggb3B0cy5pbm5lckhUTUwgKTtcclxuICAgICAgICAgICAgb3B0cy5jb250YWluZXIuaHRtbCggb3B0cy5idXR0b24gKTtcclxuICAgIFxyXG4gICAgICAgICAgICBSdW50aW1lQ2xpZW50LmNhbGwoIHRoaXMsICdGaWxlUGlja2VyJywgdHJ1ZSApO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIEZpbGVQaWNrZXIub3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgYnV0dG9uOiBudWxsLFxyXG4gICAgICAgICAgICBjb250YWluZXI6IG51bGwsXHJcbiAgICAgICAgICAgIGxhYmVsOiBudWxsLFxyXG4gICAgICAgICAgICBpbm5lckhUTUw6IG51bGwsXHJcbiAgICAgICAgICAgIG11bHRpcGxlOiB0cnVlLFxyXG4gICAgICAgICAgICBhY2NlcHQ6IG51bGwsXHJcbiAgICAgICAgICAgIG5hbWU6ICdmaWxlJyxcclxuICAgICAgICAgICAgc3R5bGU6ICd3ZWJ1cGxvYWRlci1waWNrJyAgIC8vcGljayBlbGVtZW50IGNsYXNzIGF0dHJpYnV0ZSwgZGVmYXVsdCBpcyBcIndlYnVwbG9hZGVyLXBpY2tcIlxyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICBCYXNlLmluaGVyaXRzKCBSdW50aW1lQ2xpZW50LCB7XHJcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yOiBGaWxlUGlja2VyLFxyXG4gICAgXHJcbiAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBvcHRzID0gbWUub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBvcHRzLmJ1dHRvbixcclxuICAgICAgICAgICAgICAgICAgICBzdHlsZSA9IG9wdHMuc3R5bGU7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmIChzdHlsZSlcclxuICAgICAgICAgICAgICAgICAgICBidXR0b24uYWRkQ2xhc3MoJ3dlYnVwbG9hZGVyLXBpY2snKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbWUub24oICdhbGwnLCBmdW5jdGlvbiggdHlwZSApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZmlsZXM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKCB0eXBlICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdtb3VzZWVudGVyJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHlsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uYWRkQ2xhc3MoJ3dlYnVwbG9hZGVyLXBpY2staG92ZXInKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ21vdXNlbGVhdmUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0eWxlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5yZW1vdmVDbGFzcygnd2VidXBsb2FkZXItcGljay1ob3ZlcicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnY2hhbmdlJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzID0gbWUuZXhlYygnZ2V0RmlsZXMnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lLnRyaWdnZXIoICdzZWxlY3QnLCAkLm1hcCggZmlsZXMsIGZ1bmN0aW9uKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUgPSBuZXcgRmlsZSggbWUuZ2V0UnVpZCgpLCBmaWxlICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDorrDlvZXmnaXmupDjgIJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLl9yZWZlciA9IG9wdHMuY29udGFpbmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIG9wdHMuY29udGFpbmVyICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbWUuY29ubmVjdFJ1bnRpbWUoIG9wdHMsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgICAgICBtZS5leGVjKCAnaW5pdCcsIG9wdHMgKTtcclxuICAgICAgICAgICAgICAgICAgICBtZS50cmlnZ2VyKCdyZWFkeScpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2l6ZUhhbmRsZXIgPSBCYXNlLmJpbmRGbiggdGhpcy5yZWZyZXNoLCB0aGlzICk7XHJcbiAgICAgICAgICAgICAgICAkKCB3aW5kb3cgKS5vbiggJ3Jlc2l6ZScsIHRoaXMuX3Jlc2l6ZUhhbmRsZXIgKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICByZWZyZXNoOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzaGltQ29udGFpbmVyID0gdGhpcy5nZXRSdW50aW1lKCkuZ2V0Q29udGFpbmVyKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uID0gdGhpcy5vcHRpb25zLmJ1dHRvbixcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGJ1dHRvbi5vdXRlcldpZHRoID9cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5vdXRlcldpZHRoKCkgOiBidXR0b24ud2lkdGgoKSxcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGJ1dHRvbi5vdXRlckhlaWdodCA/XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24ub3V0ZXJIZWlnaHQoKSA6IGJ1dHRvbi5oZWlnaHQoKSxcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHBvcyA9IGJ1dHRvbi5vZmZzZXQoKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgd2lkdGggJiYgaGVpZ2h0ICYmIHNoaW1Db250YWluZXIuY3NzKHtcclxuICAgICAgICAgICAgICAgICAgICBib3R0b206ICdhdXRvJyxcclxuICAgICAgICAgICAgICAgICAgICByaWdodDogJ2F1dG8nLFxyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCArICdweCcsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQgKyAncHgnXHJcbiAgICAgICAgICAgICAgICB9KS5vZmZzZXQoIHBvcyApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGVuYWJsZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYnRuID0gdGhpcy5vcHRpb25zLmJ1dHRvbjtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgYnRuLnJlbW92ZUNsYXNzKCd3ZWJ1cGxvYWRlci1waWNrLWRpc2FibGUnKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaCgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJ0biA9IHRoaXMub3B0aW9ucy5idXR0b247XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0UnVudGltZSgpLmdldENvbnRhaW5lcigpLmNzcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9wOiAnLTk5OTk5cHgnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgYnRuLmFkZENsYXNzKCd3ZWJ1cGxvYWRlci1waWNrLWRpc2FibGUnKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBidG4gPSB0aGlzLm9wdGlvbnMuYnV0dG9uO1xyXG4gICAgICAgICAgICAgICAgJCggd2luZG93ICkub2ZmKCAncmVzaXplJywgdGhpcy5fcmVzaXplSGFuZGxlciApO1xyXG4gICAgICAgICAgICAgICAgYnRuLnJlbW92ZUNsYXNzKCd3ZWJ1cGxvYWRlci1waWNrLWRpc2FibGUgd2VidXBsb2FkZXItcGljay1ob3ZlciAnICtcclxuICAgICAgICAgICAgICAgICAgICAnd2VidXBsb2FkZXItcGljaycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gRmlsZVBpY2tlcjtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcg5paH5Lu26YCJ5oup55u45YWzXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgnd2lkZ2V0cy9maWxlcGlja2VyJyxbXHJcbiAgICAgICAgJ2Jhc2UnLFxyXG4gICAgICAgICd1cGxvYWRlcicsXHJcbiAgICAgICAgJ2xpYi9maWxlcGlja2VyJyxcclxuICAgICAgICAnd2lkZ2V0cy93aWRnZXQnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgVXBsb2FkZXIsIEZpbGVQaWNrZXIgKSB7XHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQ7XHJcbiAgICBcclxuICAgICAgICAkLmV4dGVuZCggVXBsb2FkZXIub3B0aW9ucywge1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge1NlbGVjdG9yIHwgT2JqZWN0fSBbcGljaz11bmRlZmluZWRdXHJcbiAgICAgICAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9uc1xyXG4gICAgICAgICAgICAgKiBAZm9yIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDmjIflrprpgInmi6nmlofku7bnmoTmjInpkq7lrrnlmajvvIzkuI3mjIflrprliJnkuI3liJvlu7rmjInpkq7jgIJcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogKiBgaWRgIHtTZWxldG9yfGRvbX0g5oyH5a6a6YCJ5oup5paH5Lu255qE5oyJ6ZKu5a655Zmo77yM5LiN5oyH5a6a5YiZ5LiN5Yib5bu65oyJ6ZKu44CCKirms6jmhI8qKiDov5nph4zomb3nhLblhpnnmoTmmK8gaWQsIOS9huaYr+S4jeaYr+WPquaUr+aMgSBpZCwg6L+Y5pSv5oyBIGNsYXNzLCDmiJbogIUgZG9tIOiKgueCueOAglxyXG4gICAgICAgICAgICAgKiAqIGBsYWJlbGAge1N0cmluZ30g6K+36YeH55SoIGBpbm5lckhUTUxgIOS7o+abv1xyXG4gICAgICAgICAgICAgKiAqIGBpbm5lckhUTUxgIHtTdHJpbmd9IOaMh+WumuaMiemSruaWh+Wtl+OAguS4jeaMh+WumuaXtuS8mOWFiOS7juaMh+WumueahOWuueWZqOS4reeci+aYr+WQpuiHquW4puaWh+Wtl+OAglxyXG4gICAgICAgICAgICAgKiAqIGBtdWx0aXBsZWAge0Jvb2xlYW59IOaYr+WQpuW8gOi1t+WQjOaXtumAieaLqeWkmuS4quaWh+S7tuiDveWKm+OAglxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgcGljazogbnVsbCxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtBcnJveX0gW2FjY2VwdD1udWxsXVxyXG4gICAgICAgICAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnNcclxuICAgICAgICAgICAgICogQGZvciBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24g5oyH5a6a5o6l5Y+X5ZOq5Lqb57G75Z6L55qE5paH5Lu244CCIOeUseS6juebruWJjei/mOaciWV4dOi9rG1pbWVUeXBl6KGo77yM5omA5Lul6L+Z6YeM6ZyA6KaB5YiG5byA5oyH5a6a44CCXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICogYHRpdGxlYCB7U3RyaW5nfSDmloflrZfmj4/ov7BcclxuICAgICAgICAgICAgICogKiBgZXh0ZW5zaW9uc2Age1N0cmluZ30g5YWB6K6455qE5paH5Lu25ZCO57yA77yM5LiN5bim54K577yM5aSa5Liq55So6YCX5Y+35YiG5Ymy44CCXHJcbiAgICAgICAgICAgICAqICogYG1pbWVUeXBlc2Age1N0cmluZ30g5aSa5Liq55So6YCX5Y+35YiG5Ymy44CCXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIOWmgu+8mlxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiBgYGBcclxuICAgICAgICAgICAgICoge1xyXG4gICAgICAgICAgICAgKiAgICAgdGl0bGU6ICdJbWFnZXMnLFxyXG4gICAgICAgICAgICAgKiAgICAgZXh0ZW5zaW9uczogJ2dpZixqcGcsanBlZyxibXAscG5nJyxcclxuICAgICAgICAgICAgICogICAgIG1pbWVUeXBlczogJ2ltYWdlLyonXHJcbiAgICAgICAgICAgICAqIH1cclxuICAgICAgICAgICAgICogYGBgXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBhY2NlcHQ6IG51bGwvKntcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAnSW1hZ2VzJyxcclxuICAgICAgICAgICAgICAgIGV4dGVuc2lvbnM6ICdnaWYsanBnLGpwZWcsYm1wLHBuZycsXHJcbiAgICAgICAgICAgICAgICBtaW1lVHlwZXM6ICdpbWFnZS8qJ1xyXG4gICAgICAgICAgICB9Ki9cclxuICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgIHJldHVybiBVcGxvYWRlci5yZWdpc3Rlcih7XHJcbiAgICAgICAgICAgIG5hbWU6ICdwaWNrZXInLFxyXG4gICAgXHJcbiAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRzICkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5waWNrZXJzID0gW107XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3B0cy5waWNrICYmIHRoaXMuYWRkQnRuKCBvcHRzLnBpY2sgKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICByZWZyZXNoOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICQuZWFjaCggdGhpcy5waWNrZXJzLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIGFkZEJ0blxyXG4gICAgICAgICAgICAgKiBAZm9yIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIGFkZEJ0biggcGljayApID0+IFByb21pc2VcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uXHJcbiAgICAgICAgICAgICAqIOa3u+WKoOaWh+S7tumAieaLqeaMiemSru+8jOWmguaenOS4gOS4quaMiemSruS4jeWkn++8jOmcgOimgeiwg+eUqOatpOaWueazleadpea3u+WKoOOAguWPguaVsOi3n1tvcHRpb25zLnBpY2tdKCNXZWJVcGxvYWRlcjpVcGxvYWRlcjpvcHRpb25zKeS4gOiHtOOAglxyXG4gICAgICAgICAgICAgKiBAZXhhbXBsZVxyXG4gICAgICAgICAgICAgKiB1cGxvYWRlci5hZGRCdG4oe1xyXG4gICAgICAgICAgICAgKiAgICAgaWQ6ICcjYnRuQ29udGFpbmVyJyxcclxuICAgICAgICAgICAgICogICAgIGlubmVySFRNTDogJ+mAieaLqeaWh+S7tidcclxuICAgICAgICAgICAgICogfSk7XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBhZGRCdG46IGZ1bmN0aW9uKCBwaWNrICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBvcHRzID0gbWUub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgICAgICBhY2NlcHQgPSBvcHRzLmFjY2VwdCxcclxuICAgICAgICAgICAgICAgICAgICBwcm9taXNlcyA9IFtdO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoICFwaWNrICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgJC5pc1BsYWluT2JqZWN0KCBwaWNrICkgfHwgKHBpY2sgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHBpY2tcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAkKCBwaWNrLmlkICkuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucywgcGlja2VyLCBkZWZlcnJlZDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkID0gQmFzZS5EZWZlcnJlZCgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBwaWNrLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdDogJC5pc1BsYWluT2JqZWN0KCBhY2NlcHQgKSA/IFsgYWNjZXB0IF0gOiBhY2NlcHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3Zjogb3B0cy5zd2YsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bnRpbWVPcmRlcjogb3B0cy5ydW50aW1lT3JkZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0aGlzXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBwaWNrZXIgPSBuZXcgRmlsZVBpY2tlciggb3B0aW9ucyApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcGlja2VyLm9uY2UoICdyZWFkeScsIGRlZmVycmVkLnJlc29sdmUgKTtcclxuICAgICAgICAgICAgICAgICAgICBwaWNrZXIub24oICdzZWxlY3QnLCBmdW5jdGlvbiggZmlsZXMgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLm93bmVyLnJlcXVlc3QoICdhZGQtZmlsZScsIFsgZmlsZXMgXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGlja2VyLm9uKCdkaWFsb2dvcGVuJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLm93bmVyLnRyaWdnZXIoJ2RpYWxvZ09wZW4nLCBwaWNrZXIuYnV0dG9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBwaWNrZXIuaW5pdCgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgbWUucGlja2Vycy5wdXNoKCBwaWNrZXIgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2goIGRlZmVycmVkLnByb21pc2UoKSApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBCYXNlLndoZW4uYXBwbHkoIEJhc2UsIHByb21pc2VzICk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkLmVhY2goIHRoaXMucGlja2VycywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgJC5lYWNoKCB0aGlzLnBpY2tlcnMsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW5hYmxlKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICQuZWFjaCggdGhpcy5waWNrZXJzLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5waWNrZXJzID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcgSW1hZ2VcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdsaWIvaW1hZ2UnLFtcclxuICAgICAgICAnYmFzZScsXHJcbiAgICAgICAgJ3J1bnRpbWUvY2xpZW50JyxcclxuICAgICAgICAnbGliL2Jsb2InXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgUnVudGltZUNsaWVudCwgQmxvYiApIHtcclxuICAgICAgICB2YXIgJCA9IEJhc2UuJDtcclxuICAgIFxyXG4gICAgICAgIC8vIOaehOmAoOWZqOOAglxyXG4gICAgICAgIGZ1bmN0aW9uIEltYWdlKCBvcHRzICkge1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgSW1hZ2Uub3B0aW9ucywgb3B0cyApO1xyXG4gICAgICAgICAgICBSdW50aW1lQ2xpZW50LmNhbGwoIHRoaXMsICdJbWFnZScgKTtcclxuICAgIFxyXG4gICAgICAgICAgICB0aGlzLm9uKCAnbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5faW5mbyA9IHRoaXMuZXhlYygnaW5mbycpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fbWV0YSA9IHRoaXMuZXhlYygnbWV0YScpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAvLyDpu5jorqTpgInpobnjgIJcclxuICAgICAgICBJbWFnZS5vcHRpb25zID0ge1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOm7mOiupOeahOWbvueJh+WkhOeQhui0qOmHj1xyXG4gICAgICAgICAgICBxdWFsaXR5OiA5MCxcclxuICAgIFxyXG4gICAgICAgICAgICAvLyDmmK/lkKboo4HliapcclxuICAgICAgICAgICAgY3JvcDogZmFsc2UsXHJcbiAgICBcclxuICAgICAgICAgICAgLy8g5piv5ZCm5L+d55WZ5aS06YOo5L+h5oGvXHJcbiAgICAgICAgICAgIHByZXNlcnZlSGVhZGVyczogZmFsc2UsXHJcbiAgICBcclxuICAgICAgICAgICAgLy8g5piv5ZCm5YWB6K645pS+5aSn44CCXHJcbiAgICAgICAgICAgIGFsbG93TWFnbmlmeTogZmFsc2VcclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgLy8g57un5om/UnVudGltZUNsaWVudC5cclxuICAgICAgICBCYXNlLmluaGVyaXRzKCBSdW50aW1lQ2xpZW50LCB7XHJcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yOiBJbWFnZSxcclxuICAgIFxyXG4gICAgICAgICAgICBpbmZvOiBmdW5jdGlvbiggdmFsICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBzZXR0ZXJcclxuICAgICAgICAgICAgICAgIGlmICggdmFsICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2luZm8gPSB2YWw7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIGdldHRlclxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luZm87XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgbWV0YTogZnVuY3Rpb24oIHZhbCApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gc2V0dGVyXHJcbiAgICAgICAgICAgICAgICBpZiAoIHZhbCApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9tZXRhID0gdmFsO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBnZXR0ZXJcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tZXRhO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGxvYWRGcm9tQmxvYjogZnVuY3Rpb24oIGJsb2IgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIHJ1aWQgPSBibG9iLmdldFJ1aWQoKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0UnVudGltZSggcnVpZCwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUuZXhlYyggJ2luaXQnLCBtZS5vcHRpb25zICk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUuZXhlYyggJ2xvYWRGcm9tQmxvYicsIGJsb2IgKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIHJlc2l6ZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEJhc2Uuc2xpY2UoIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhlYy5hcHBseSggdGhpcywgWyAncmVzaXplJyBdLmNvbmNhdCggYXJncyApICk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgY3JvcDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJncyA9IEJhc2Uuc2xpY2UoIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhlYy5hcHBseSggdGhpcywgWyAnY3JvcCcgXS5jb25jYXQoIGFyZ3MgKSApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGdldEFzRGF0YVVybDogZnVuY3Rpb24oIHR5cGUgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5leGVjKCAnZ2V0QXNEYXRhVXJsJywgdHlwZSApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGdldEFzQmxvYjogZnVuY3Rpb24oIHR5cGUgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IHRoaXMuZXhlYyggJ2dldEFzQmxvYicsIHR5cGUgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCbG9iKCB0aGlzLmdldFJ1aWQoKSwgYmxvYiApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gSW1hZ2U7XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogQGZpbGVPdmVydmlldyDlm77niYfmk43kvZwsIOi0n+i0o+mihOiniOWbvueJh+WSjOS4iuS8oOWJjeWOi+e8qeWbvueJh1xyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ3dpZGdldHMvaW1hZ2UnLFtcclxuICAgICAgICAnYmFzZScsXHJcbiAgICAgICAgJ3VwbG9hZGVyJyxcclxuICAgICAgICAnbGliL2ltYWdlJyxcclxuICAgICAgICAnd2lkZ2V0cy93aWRnZXQnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgVXBsb2FkZXIsIEltYWdlICkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQsXHJcbiAgICAgICAgICAgIHRocm90dGxlO1xyXG4gICAgXHJcbiAgICAgICAgLy8g5qC55o2u6KaB5aSE55CG55qE5paH5Lu25aSn5bCP5p2l6IqC5rWB77yM5LiA5qyh5LiN6IO95aSE55CG5aSq5aSa77yM5Lya5Y2h44CCXHJcbiAgICAgICAgdGhyb3R0bGUgPSAoZnVuY3Rpb24oIG1heCApIHtcclxuICAgICAgICAgICAgdmFyIG9jY3VwaWVkID0gMCxcclxuICAgICAgICAgICAgICAgIHdhaXRpbmcgPSBbXSxcclxuICAgICAgICAgICAgICAgIHRpY2sgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICggd2FpdGluZy5sZW5ndGggJiYgb2NjdXBpZWQgPCBtYXggKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSB3YWl0aW5nLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9jY3VwaWVkICs9IGl0ZW1bIDAgXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbVsgMSBdKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oIGVtaXRlciwgc2l6ZSwgY2IgKSB7XHJcbiAgICAgICAgICAgICAgICB3YWl0aW5nLnB1c2goWyBzaXplLCBjYiBdKTtcclxuICAgICAgICAgICAgICAgIGVtaXRlci5vbmNlKCAnZGVzdHJveScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9jY3VwaWVkIC09IHNpemU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCggdGljaywgMSApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCB0aWNrLCAxICk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSkoIDUgKiAxMDI0ICogMTAyNCApO1xyXG4gICAgXHJcbiAgICAgICAgJC5leHRlbmQoIFVwbG9hZGVyLm9wdGlvbnMsIHtcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtPYmplY3R9IFt0aHVtYl1cclxuICAgICAgICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zXHJcbiAgICAgICAgICAgICAqIEBmb3IgVXBsb2FkZXJcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOmFjee9rueUn+aIkOe8qeeVpeWbvueahOmAiemhueOAglxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiDpu5jorqTkuLrvvJpcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogYGBgamF2YXNjcmlwdFxyXG4gICAgICAgICAgICAgKiB7XHJcbiAgICAgICAgICAgICAqICAgICB3aWR0aDogMTEwLFxyXG4gICAgICAgICAgICAgKiAgICAgaGVpZ2h0OiAxMTAsXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICAgICAvLyDlm77niYfotKjph4/vvIzlj6rmnIl0eXBl5Li6YGltYWdlL2pwZWdg55qE5pe25YCZ5omN5pyJ5pWI44CCXHJcbiAgICAgICAgICAgICAqICAgICBxdWFsaXR5OiA3MCxcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogICAgIC8vIOaYr+WQpuWFgeiuuOaUvuWkp++8jOWmguaenOaDs+imgeeUn+aIkOWwj+WbvueahOaXtuWAmeS4jeWkseecn++8jOatpOmAiemhueW6lOivpeiuvue9ruS4umZhbHNlLlxyXG4gICAgICAgICAgICAgKiAgICAgYWxsb3dNYWduaWZ5OiB0cnVlLFxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAgICAgLy8g5piv5ZCm5YWB6K646KOB5Ymq44CCXHJcbiAgICAgICAgICAgICAqICAgICBjcm9wOiB0cnVlLFxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAgICAgLy8g5Li656m655qE6K+d5YiZ5L+d55WZ5Y6f5pyJ5Zu+54mH5qC85byP44CCXHJcbiAgICAgICAgICAgICAqICAgICAvLyDlkKbliJnlvLrliLbovazmjaLmiJDmjIflrprnmoTnsbvlnovjgIJcclxuICAgICAgICAgICAgICogICAgIHR5cGU6ICdpbWFnZS9qcGVnJ1xyXG4gICAgICAgICAgICAgKiB9XHJcbiAgICAgICAgICAgICAqIGBgYFxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgdGh1bWI6IHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiAxMTAsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDExMCxcclxuICAgICAgICAgICAgICAgIHF1YWxpdHk6IDcwLFxyXG4gICAgICAgICAgICAgICAgYWxsb3dNYWduaWZ5OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgY3JvcDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHByZXNlcnZlSGVhZGVyczogZmFsc2UsXHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOS4uuepuueahOivneWImeS/neeVmeWOn+acieWbvueJh+agvOW8j+OAglxyXG4gICAgICAgICAgICAgICAgLy8g5ZCm5YiZ5by65Yi26L2s5o2i5oiQ5oyH5a6a55qE57G75Z6L44CCXHJcbiAgICAgICAgICAgICAgICAvLyBJRSA45LiL6Z2iIGJhc2U2NCDlpKflsI/kuI3og73otoXov4cgMzJLIOWQpuWImemihOiniOWksei0pe+8jOiAjOmdniBqcGVnIOe8lueggeeahOWbvueJh+W+iOWPr1xyXG4gICAgICAgICAgICAgICAgLy8g6IO95Lya6LaF6L+HIDMyaywg5omA5Lul6L+Z6YeM6K6+572u5oiQ6aKE6KeI55qE5pe25YCZ6YO95pivIGltYWdlL2pwZWdcclxuICAgICAgICAgICAgICAgIHR5cGU6ICdpbWFnZS9qcGVnJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge09iamVjdH0gW2NvbXByZXNzXVxyXG4gICAgICAgICAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnNcclxuICAgICAgICAgICAgICogQGZvciBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24g6YWN572u5Y6L57yp55qE5Zu+54mH55qE6YCJ6aG544CC5aaC5p6c5q2k6YCJ6aG55Li6YGZhbHNlYCwg5YiZ5Zu+54mH5Zyo5LiK5Lyg5YmN5LiN6L+b6KGM5Y6L57yp44CCXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIOm7mOiupOS4uu+8mlxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiBgYGBqYXZhc2NyaXB0XHJcbiAgICAgICAgICAgICAqIHtcclxuICAgICAgICAgICAgICogICAgIHdpZHRoOiAxNjAwLFxyXG4gICAgICAgICAgICAgKiAgICAgaGVpZ2h0OiAxNjAwLFxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAgICAgLy8g5Zu+54mH6LSo6YeP77yM5Y+q5pyJdHlwZeS4umBpbWFnZS9qcGVnYOeahOaXtuWAmeaJjeacieaViOOAglxyXG4gICAgICAgICAgICAgKiAgICAgcXVhbGl0eTogOTAsXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICAgICAvLyDmmK/lkKblhYHorrjmlL7lpKfvvIzlpoLmnpzmg7PopoHnlJ/miJDlsI/lm77nmoTml7blgJnkuI3lpLHnnJ/vvIzmraTpgInpobnlupTor6Xorr7nva7kuLpmYWxzZS5cclxuICAgICAgICAgICAgICogICAgIGFsbG93TWFnbmlmeTogZmFsc2UsXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICAgICAvLyDmmK/lkKblhYHorrjoo4HliarjgIJcclxuICAgICAgICAgICAgICogICAgIGNyb3A6IGZhbHNlLFxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAgICAgLy8g5piv5ZCm5L+d55WZ5aS06YOobWV0YeS/oeaBr+OAglxyXG4gICAgICAgICAgICAgKiAgICAgcHJlc2VydmVIZWFkZXJzOiB0cnVlLFxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAgICAgLy8g5aaC5p6c5Y+R546w5Y6L57yp5ZCO5paH5Lu25aSn5bCP5q+U5Y6f5p2l6L+Y5aSn77yM5YiZ5L2/55So5Y6f5p2l5Zu+54mHXHJcbiAgICAgICAgICAgICAqICAgICAvLyDmraTlsZ7mgKflj6/og73kvJrlvbHlk43lm77niYfoh6rliqjnuqDmraPlip/og71cclxuICAgICAgICAgICAgICogICAgIG5vQ29tcHJlc3NJZkxhcmdlcjogZmFsc2UsXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICAgICAvLyDljZXkvY3lrZfoioLvvIzlpoLmnpzlm77niYflpKflsI/lsI/kuo7mraTlgLzvvIzkuI3kvJrph4fnlKjljovnvKnjgIJcclxuICAgICAgICAgICAgICogICAgIGNvbXByZXNzU2l6ZTogMFxyXG4gICAgICAgICAgICAgKiB9XHJcbiAgICAgICAgICAgICAqIGBgYFxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgY29tcHJlc3M6IHtcclxuICAgICAgICAgICAgICAgIHdpZHRoOiAxNjAwLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAxNjAwLFxyXG4gICAgICAgICAgICAgICAgcXVhbGl0eTogOTAsXHJcbiAgICAgICAgICAgICAgICBhbGxvd01hZ25pZnk6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgY3JvcDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBwcmVzZXJ2ZUhlYWRlcnM6IHRydWVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIFVwbG9hZGVyLnJlZ2lzdGVyKHtcclxuICAgIFxyXG4gICAgICAgICAgICBuYW1lOiAnaW1hZ2UnLFxyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOeUn+aIkOe8qeeVpeWbvu+8jOatpOi/h+eoi+S4uuW8guatpe+8jOaJgOS7pemcgOimgeS8oOWFpWBjYWxsYmFja2DjgIJcclxuICAgICAgICAgICAgICog6YCa5bi45oOF5Ya15Zyo5Zu+54mH5Yqg5YWl6Zif6YeM5ZCO6LCD55So5q2k5pa55rOV5p2l55Sf5oiQ6aKE6KeI5Zu+5Lul5aKe5by65Lqk5LqS5pWI5p6c44CCXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIOW9kyB3aWR0aCDmiJbogIUgaGVpZ2h0IOeahOWAvOS7i+S6jiAwIC0gMSDml7bvvIzooqvlvZPmiJDnmb7liIbmr5Tkvb/nlKjjgIJcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogYGNhbGxiYWNrYOS4reWPr+S7peaOpeaUtuWIsOS4pOS4quWPguaVsOOAglxyXG4gICAgICAgICAgICAgKiAqIOesrOS4gOS4quS4umVycm9y77yM5aaC5p6c55Sf5oiQ57yp55Wl5Zu+5pyJ6ZSZ6K+v77yM5q2kZXJyb3LlsIbkuLrnnJ/jgIJcclxuICAgICAgICAgICAgICogKiDnrKzkuozkuKrkuLpyZXQsIOe8qeeVpeWbvueahERhdGEgVVJM5YC844CCXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICoq5rOo5oSPKipcclxuICAgICAgICAgICAgICogRGF0ZSBVUkzlnKhJRTYvN+S4reS4jeaUr+aMge+8jOaJgOS7peS4jeeUqOiwg+eUqOatpOaWueazleS6hu+8jOebtOaOpeaYvuekuuS4gOW8oOaaguS4jeaUr+aMgemihOiniOWbvueJh+WlveS6huOAglxyXG4gICAgICAgICAgICAgKiDkuZ/lj6/ku6XlgJ/liqnmnI3liqHnq6/vvIzlsIYgYmFzZTY0IOaVsOaNruS8oOe7meacjeWKoeerr++8jOeUn+aIkOS4gOS4quS4tOaXtuaWh+S7tuS+m+mihOiniOOAglxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIG1ha2VUaHVtYlxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciBtYWtlVGh1bWIoIGZpbGUsIGNhbGxiYWNrICkgPT4gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIG1ha2VUaHVtYiggZmlsZSwgY2FsbGJhY2ssIHdpZHRoLCBoZWlnaHQgKSA9PiB1bmRlZmluZWRcclxuICAgICAgICAgICAgICogQGZvciBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKiBAZXhhbXBsZVxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiB1cGxvYWRlci5vbiggJ2ZpbGVRdWV1ZWQnLCBmdW5jdGlvbiggZmlsZSApIHtcclxuICAgICAgICAgICAgICogICAgIHZhciAkbGkgPSAuLi47XHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICAgICB1cGxvYWRlci5tYWtlVGh1bWIoIGZpbGUsIGZ1bmN0aW9uKCBlcnJvciwgcmV0ICkge1xyXG4gICAgICAgICAgICAgKiAgICAgICAgIGlmICggZXJyb3IgKSB7XHJcbiAgICAgICAgICAgICAqICAgICAgICAgICAgICRsaS50ZXh0KCfpooTop4jplJnor68nKTtcclxuICAgICAgICAgICAgICogICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgKiAgICAgICAgICAgICAkbGkuYXBwZW5kKCc8aW1nIGFsdD1cIlwiIHNyYz1cIicgKyByZXQgKyAnXCIgLz4nKTtcclxuICAgICAgICAgICAgICogICAgICAgICB9XHJcbiAgICAgICAgICAgICAqICAgICB9KTtcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogfSk7XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBtYWtlVGh1bWI6IGZ1bmN0aW9uKCBmaWxlLCBjYiwgd2lkdGgsIGhlaWdodCApIHtcclxuICAgICAgICAgICAgICAgIHZhciBvcHRzLCBpbWFnZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZmlsZSA9IHRoaXMucmVxdWVzdCggJ2dldC1maWxlJywgZmlsZSApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDlj6rpooTop4jlm77niYfmoLzlvI/jgIJcclxuICAgICAgICAgICAgICAgIGlmICggIWZpbGUudHlwZS5tYXRjaCggL15pbWFnZS8gKSApIHtcclxuICAgICAgICAgICAgICAgICAgICBjYiggdHJ1ZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgb3B0cyA9ICQuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMudGh1bWIgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5aaC5p6c5Lyg5YWl55qE5pivb2JqZWN0LlxyXG4gICAgICAgICAgICAgICAgaWYgKCAkLmlzUGxhaW5PYmplY3QoIHdpZHRoICkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0cyA9ICQuZXh0ZW5kKCBvcHRzLCB3aWR0aCApO1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgd2lkdGggPSB3aWR0aCB8fCBvcHRzLndpZHRoO1xyXG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gaGVpZ2h0IHx8IG9wdHMuaGVpZ2h0O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpbWFnZSA9IG5ldyBJbWFnZSggb3B0cyApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpbWFnZS5vbmNlKCAnbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUuX2luZm8gPSBmaWxlLl9pbmZvIHx8IGltYWdlLmluZm8oKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlLl9tZXRhID0gZmlsZS5fbWV0YSB8fCBpbWFnZS5tZXRhKCk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpwgd2lkdGgg55qE5YC85LuL5LqOIDAgLSAxXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g6K+05piO6K6+572u55qE5piv55m+5YiG5q+U44CCXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCB3aWR0aCA8PSAxICYmIHdpZHRoID4gMCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggPSBmaWxlLl9pbmZvLndpZHRoICogd2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5ZCM5qC355qE6KeE5YiZ5bqU55So5LqOIGhlaWdodFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggaGVpZ2h0IDw9IDEgJiYgaGVpZ2h0ID4gMCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gZmlsZS5faW5mby5oZWlnaHQgKiBoZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2UucmVzaXplKCB3aWR0aCwgaGVpZ2h0ICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5b2TIHJlc2l6ZSDlrozlkI5cclxuICAgICAgICAgICAgICAgIGltYWdlLm9uY2UoICdjb21wbGV0ZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiKCBmYWxzZSwgaW1hZ2UuZ2V0QXNEYXRhVXJsKCBvcHRzLnR5cGUgKSApO1xyXG4gICAgICAgICAgICAgICAgICAgIGltYWdlLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpbWFnZS5vbmNlKCAnZXJyb3InLCBmdW5jdGlvbiggcmVhc29uICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiKCByZWFzb24gfHwgdHJ1ZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIGltYWdlLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0aHJvdHRsZSggaW1hZ2UsIGZpbGUuc291cmNlLnNpemUsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUuX2luZm8gJiYgaW1hZ2UuaW5mbyggZmlsZS5faW5mbyApO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUuX21ldGEgJiYgaW1hZ2UubWV0YSggZmlsZS5fbWV0YSApO1xyXG4gICAgICAgICAgICAgICAgICAgIGltYWdlLmxvYWRGcm9tQmxvYiggZmlsZS5zb3VyY2UgKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGJlZm9yZVNlbmRGaWxlOiBmdW5jdGlvbiggZmlsZSApIHtcclxuICAgICAgICAgICAgICAgIHZhciBvcHRzID0gdGhpcy5vcHRpb25zLmNvbXByZXNzIHx8IHRoaXMub3B0aW9ucy5yZXNpemUsXHJcbiAgICAgICAgICAgICAgICAgICAgY29tcHJlc3NTaXplID0gb3B0cyAmJiBvcHRzLmNvbXByZXNzU2l6ZSB8fCAwLFxyXG4gICAgICAgICAgICAgICAgICAgIG5vQ29tcHJlc3NJZkxhcmdlciA9IG9wdHMgJiYgb3B0cy5ub0NvbXByZXNzSWZMYXJnZXIgfHwgZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2UsIGRlZmVycmVkO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmaWxlID0gdGhpcy5yZXF1ZXN0KCAnZ2V0LWZpbGUnLCBmaWxlICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOWPquWOi+e8qSBqcGVnIOWbvueJh+agvOW8j+OAglxyXG4gICAgICAgICAgICAgICAgLy8gZ2lmIOWPr+iDveS8muS4ouWksemSiFxyXG4gICAgICAgICAgICAgICAgLy8gYm1wIHBuZyDln7rmnKzkuIrlsLrlr7jpg73kuI3lpKfvvIzkuJTljovnvKnmr5Tmr5TovoPlsI/jgIJcclxuICAgICAgICAgICAgICAgIGlmICggIW9wdHMgfHwgIX4naW1hZ2UvanBlZyxpbWFnZS9qcGcnLmluZGV4T2YoIGZpbGUudHlwZSApIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuc2l6ZSA8IGNvbXByZXNzU2l6ZSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlLl9jb21wcmVzc2VkICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgb3B0cyA9ICQuZXh0ZW5kKHt9LCBvcHRzICk7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZCA9IEJhc2UuRGVmZXJyZWQoKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaW1hZ2UgPSBuZXcgSW1hZ2UoIG9wdHMgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQuYWx3YXlzKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGltYWdlLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgICAgICBpbWFnZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGltYWdlLm9uY2UoICdlcnJvcicsIGRlZmVycmVkLnJlamVjdCApO1xyXG4gICAgICAgICAgICAgICAgaW1hZ2Uub25jZSggJ2xvYWQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBvcHRzLndpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSBvcHRzLmhlaWdodDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUuX2luZm8gPSBmaWxlLl9pbmZvIHx8IGltYWdlLmluZm8oKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlLl9tZXRhID0gZmlsZS5fbWV0YSB8fCBpbWFnZS5tZXRhKCk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpwgd2lkdGgg55qE5YC85LuL5LqOIDAgLSAxXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g6K+05piO6K6+572u55qE5piv55m+5YiG5q+U44CCXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCB3aWR0aCA8PSAxICYmIHdpZHRoID4gMCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggPSBmaWxlLl9pbmZvLndpZHRoICogd2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5ZCM5qC355qE6KeE5YiZ5bqU55So5LqOIGhlaWdodFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggaGVpZ2h0IDw9IDEgJiYgaGVpZ2h0ID4gMCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gZmlsZS5faW5mby5oZWlnaHQgKiBoZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2UucmVzaXplKCB3aWR0aCwgaGVpZ2h0ICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaW1hZ2Uub25jZSggJ2NvbXBsZXRlJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJsb2IsIHNpemU7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyDnp7vliqjnq68gVUMgLyBxcSDmtY/op4jlmajnmoTml6Dlm77mqKHlvI/kuItcclxuICAgICAgICAgICAgICAgICAgICAvLyBjdHguZ2V0SW1hZ2VEYXRhIOWkhOeQhuWkp+WbvueahOaXtuWAmeS8muaKpSBFeGNlcHRpb25cclxuICAgICAgICAgICAgICAgICAgICAvLyBJTkRFWF9TSVpFX0VSUjogRE9NIEV4Y2VwdGlvbiAxXHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvYiA9IGltYWdlLmdldEFzQmxvYiggb3B0cy50eXBlICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IGZpbGUuc2l6ZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzljovnvKnlkI7vvIzmr5Tljp/mnaXov5jlpKfliJnkuI3nlKjljovnvKnlkI7nmoTjgIJcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhbm9Db21wcmVzc0lmTGFyZ2VyIHx8IGJsb2Iuc2l6ZSA8IHNpemUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmaWxlLnNvdXJjZS5kZXN0cm95ICYmIGZpbGUuc291cmNlLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuc291cmNlID0gYmxvYjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuc2l6ZSA9IGJsb2Iuc2l6ZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS50cmlnZ2VyKCAncmVzaXplJywgYmxvYi5zaXplLCBzaXplICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDmoIforrDvvIzpgb/lhY3ph43lpI3ljovnvKnjgIJcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5fY29tcHJlc3NlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoICggZSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Ye66ZSZ5LqG55u05o6l57un57ut77yM6K6p5YW25LiK5Lyg5Y6f5aeL5Zu+54mHXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZmlsZS5faW5mbyAmJiBpbWFnZS5pbmZvKCBmaWxlLl9pbmZvICk7XHJcbiAgICAgICAgICAgICAgICBmaWxlLl9tZXRhICYmIGltYWdlLm1ldGEoIGZpbGUuX21ldGEgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaW1hZ2UubG9hZEZyb21CbG9iKCBmaWxlLnNvdXJjZSApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcg5paH5Lu25bGe5oCn5bCB6KOFXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgnZmlsZScsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAnbWVkaWF0b3InXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgTWVkaWF0b3IgKSB7XHJcbiAgICBcclxuICAgICAgICB2YXIgJCA9IEJhc2UuJCxcclxuICAgICAgICAgICAgaWRQcmVmaXggPSAnV1VfRklMRV8nLFxyXG4gICAgICAgICAgICBpZFN1ZmZpeCA9IDAsXHJcbiAgICAgICAgICAgIHJFeHQgPSAvXFwuKFteLl0rKSQvLFxyXG4gICAgICAgICAgICBzdGF0dXNNYXAgPSB7fTtcclxuICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGdpZCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlkUHJlZml4ICsgaWRTdWZmaXgrKztcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDmlofku7bnsbtcclxuICAgICAgICAgKiBAY2xhc3MgRmlsZVxyXG4gICAgICAgICAqIEBjb25zdHJ1Y3RvciDmnoTpgKDlh73mlbBcclxuICAgICAgICAgKiBAZ3JhbW1hciBuZXcgRmlsZSggc291cmNlICkgPT4gRmlsZVxyXG4gICAgICAgICAqIEBwYXJhbSB7TGliLkZpbGV9IHNvdXJjZSBbbGliLkZpbGVdKCNMaWIuRmlsZSnlrp7kvossIOatpHNvdXJjZeWvueixoeaYr+W4puaciVJ1bnRpbWXkv6Hmga/nmoTjgIJcclxuICAgICAgICAgKi9cclxuICAgICAgICBmdW5jdGlvbiBXVUZpbGUoIHNvdXJjZSApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5paH5Lu25ZCN77yM5YyF5ous5omp5bGV5ZCN77yI5ZCO57yA77yJXHJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBuYW1lXHJcbiAgICAgICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBzb3VyY2UubmFtZSB8fCAnVW50aXRsZWQnO1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiDmlofku7bkvZPnp6/vvIjlrZfoioLvvIlcclxuICAgICAgICAgICAgICogQHByb3BlcnR5IHNpemVcclxuICAgICAgICAgICAgICogQHR5cGUge3VpbnR9XHJcbiAgICAgICAgICAgICAqIEBkZWZhdWx0IDBcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZSA9IHNvdXJjZS5zaXplIHx8IDA7XHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOaWh+S7tk1JTUVUWVBF57G75Z6L77yM5LiO5paH5Lu257G75Z6L55qE5a+55bqU5YWz57O76K+35Y+C6ICDW2h0dHA6Ly90LmNuL3o4Wm5GbnldKGh0dHA6Ly90LmNuL3o4Wm5GbnkpXHJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB0eXBlXHJcbiAgICAgICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XHJcbiAgICAgICAgICAgICAqIEBkZWZhdWx0ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICB0aGlzLnR5cGUgPSBzb3VyY2UudHlwZSB8fCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJztcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5paH5Lu25pyA5ZCO5L+u5pS55pel5pyfXHJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBsYXN0TW9kaWZpZWREYXRlXHJcbiAgICAgICAgICAgICAqIEB0eXBlIHtpbnR9XHJcbiAgICAgICAgICAgICAqIEBkZWZhdWx0IOW9k+WJjeaXtumXtOaIs1xyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgdGhpcy5sYXN0TW9kaWZpZWREYXRlID0gc291cmNlLmxhc3RNb2RpZmllZERhdGUgfHwgKG5ldyBEYXRlKCkgKiAxKTtcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5paH5Lu2SUTvvIzmr4/kuKrlr7nosaHlhbfmnInllK/kuIBJRO+8jOS4juaWh+S7tuWQjeaXoOWFs1xyXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkgaWRcclxuICAgICAgICAgICAgICogQHR5cGUge3N0cmluZ31cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHRoaXMuaWQgPSBnaWQoKTtcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5paH5Lu25omp5bGV5ZCN77yM6YCa6L+H5paH5Lu25ZCN6I635Y+W77yM5L6L5aaCdGVzdC5wbmfnmoTmianlsZXlkI3kuLpwbmdcclxuICAgICAgICAgICAgICogQHByb3BlcnR5IGV4dFxyXG4gICAgICAgICAgICAgKiBAdHlwZSB7c3RyaW5nfVxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgdGhpcy5leHQgPSByRXh0LmV4ZWMoIHRoaXMubmFtZSApID8gUmVnRXhwLiQxIDogJyc7XHJcbiAgICBcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog54q25oCB5paH5a2X6K+05piO44CC5Zyo5LiN5ZCM55qEc3RhdHVz6K+t5aKD5LiL5pyJ5LiN5ZCM55qE55So6YCU44CCXHJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSBzdGF0dXNUZXh0XHJcbiAgICAgICAgICAgICAqIEB0eXBlIHtzdHJpbmd9XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICB0aGlzLnN0YXR1c1RleHQgPSAnJztcclxuICAgIFxyXG4gICAgICAgICAgICAvLyDlrZjlgqjmlofku7bnirbmgIHvvIzpmLLmraLpgJrov4flsZ7mgKfnm7TmjqXkv67mlLlcclxuICAgICAgICAgICAgc3RhdHVzTWFwWyB0aGlzLmlkIF0gPSBXVUZpbGUuU3RhdHVzLklOSVRFRDtcclxuICAgIFxyXG4gICAgICAgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcclxuICAgICAgICAgICAgdGhpcy5sb2FkZWQgPSAwO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMub24oICdlcnJvcicsIGZ1bmN0aW9uKCBtc2cgKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1cyggV1VGaWxlLlN0YXR1cy5FUlJPUiwgbXNnICk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICQuZXh0ZW5kKCBXVUZpbGUucHJvdG90eXBlLCB7XHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOiuvue9rueKtuaAge+8jOeKtuaAgeWPmOWMluaXtuS8muinpuWPkWBjaGFuZ2Vg5LqL5Lu244CCXHJcbiAgICAgICAgICAgICAqIEBtZXRob2Qgc2V0U3RhdHVzXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIHNldFN0YXR1cyggc3RhdHVzWywgc3RhdHVzVGV4dF0gKTtcclxuICAgICAgICAgICAgICogQHBhcmFtIHtGaWxlLlN0YXR1c3xTdHJpbmd9IHN0YXR1cyBb5paH5Lu254q25oCB5YC8XSgjV2ViVXBsb2FkZXI6RmlsZTpGaWxlLlN0YXR1cylcclxuICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IFtzdGF0dXNUZXh0PScnXSDnirbmgIHor7TmmI7vvIzluLjlnKhlcnJvcuaXtuS9v+eUqO+8jOeUqGh0dHAsIGFib3J0LHNlcnZlcuetieadpeagh+iusOaYr+eUseS6juS7gOS5iOWOn+WboOWvvOiHtOaWh+S7tumUmeivr+OAglxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgc2V0U3RhdHVzOiBmdW5jdGlvbiggc3RhdHVzLCB0ZXh0ICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgcHJldlN0YXR1cyA9IHN0YXR1c01hcFsgdGhpcy5pZCBdO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0eXBlb2YgdGV4dCAhPT0gJ3VuZGVmaW5lZCcgJiYgKHRoaXMuc3RhdHVzVGV4dCA9IHRleHQpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIHN0YXR1cyAhPT0gcHJldlN0YXR1cyApIHtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0dXNNYXBbIHRoaXMuaWQgXSA9IHN0YXR1cztcclxuICAgICAgICAgICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICAgICAgICAgKiDmlofku7bnirbmgIHlj5jljJZcclxuICAgICAgICAgICAgICAgICAgICAgKiBAZXZlbnQgc3RhdHVzY2hhbmdlXHJcbiAgICAgICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCAnc3RhdHVzY2hhbmdlJywgc3RhdHVzLCBwcmV2U3RhdHVzICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog6I635Y+W5paH5Lu254q25oCBXHJcbiAgICAgICAgICAgICAqIEByZXR1cm4ge0ZpbGUuU3RhdHVzfVxyXG4gICAgICAgICAgICAgKiBAZXhhbXBsZVxyXG4gICAgICAgICAgICAgICAgICAgICDmlofku7bnirbmgIHlhbfkvZPljIXmi6zku6XkuIvlh6Dnp43nsbvlnovvvJpcclxuICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Yid5aeL5YyWXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIElOSVRFRDogICAgIDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW3suWFpemYn+WIl1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBRVUVVRUQ6ICAgICAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDmraPlnKjkuIrkvKBcclxuICAgICAgICAgICAgICAgICAgICAgICAgUFJPR1JFU1M6ICAgICAyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDkuIrkvKDlh7rplJlcclxuICAgICAgICAgICAgICAgICAgICAgICAgRVJST1I6ICAgICAgICAgMyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5LiK5Lyg5oiQ5YqfXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIENPTVBMRVRFOiAgICAgNCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5LiK5Lyg5Y+W5raIXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIENBTkNFTExFRDogICAgIDVcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBnZXRTdGF0dXM6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXR1c01hcFsgdGhpcy5pZCBdO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiDojrflj5bmlofku7bljp/lp4vkv6Hmga/jgIJcclxuICAgICAgICAgICAgICogQHJldHVybiB7Kn1cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGdldFNvdXJjZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2U7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9mZigpO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHN0YXR1c01hcFsgdGhpcy5pZCBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICBNZWRpYXRvci5pbnN0YWxsVG8oIFdVRmlsZS5wcm90b3R5cGUgKTtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOaWh+S7tueKtuaAgeWAvO+8jOWFt+S9k+WMheaLrOS7peS4i+WHoOenjeexu+Wei++8mlxyXG4gICAgICAgICAqICogYGluaXRlZGAg5Yid5aeL54q25oCBXHJcbiAgICAgICAgICogKiBgcXVldWVkYCDlt7Lnu4/ov5vlhaXpmJ/liJcsIOetieW+heS4iuS8oFxyXG4gICAgICAgICAqICogYHByb2dyZXNzYCDkuIrkvKDkuK1cclxuICAgICAgICAgKiAqIGBjb21wbGV0ZWAg5LiK5Lyg5a6M5oiQ44CCXHJcbiAgICAgICAgICogKiBgZXJyb3JgIOS4iuS8oOWHuumUme+8jOWPr+mHjeivlVxyXG4gICAgICAgICAqICogYGludGVycnVwdGAg5LiK5Lyg5Lit5pat77yM5Y+v57ut5Lyg44CCXHJcbiAgICAgICAgICogKiBgaW52YWxpZGAg5paH5Lu25LiN5ZCI5qC877yM5LiN6IO96YeN6K+V5LiK5Lyg44CC5Lya6Ieq5Yqo5LuO6Zif5YiX5Lit56e76Zmk44CCXHJcbiAgICAgICAgICogKiBgY2FuY2VsbGVkYCDmlofku7booqvnp7vpmaTjgIJcclxuICAgICAgICAgKiBAcHJvcGVydHkge09iamVjdH0gU3RhdHVzXHJcbiAgICAgICAgICogQG5hbWVzcGFjZSBGaWxlXHJcbiAgICAgICAgICogQGNsYXNzIEZpbGVcclxuICAgICAgICAgKiBAc3RhdGljXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgV1VGaWxlLlN0YXR1cyA9IHtcclxuICAgICAgICAgICAgSU5JVEVEOiAgICAgJ2luaXRlZCcsICAgIC8vIOWIneWni+eKtuaAgVxyXG4gICAgICAgICAgICBRVUVVRUQ6ICAgICAncXVldWVkJywgICAgLy8g5bey57uP6L+b5YWl6Zif5YiXLCDnrYnlvoXkuIrkvKBcclxuICAgICAgICAgICAgUFJPR1JFU1M6ICAgJ3Byb2dyZXNzJywgICAgLy8g5LiK5Lyg5LitXHJcbiAgICAgICAgICAgIEVSUk9SOiAgICAgICdlcnJvcicsICAgIC8vIOS4iuS8oOWHuumUme+8jOWPr+mHjeivlVxyXG4gICAgICAgICAgICBDT01QTEVURTogICAnY29tcGxldGUnLCAgICAvLyDkuIrkvKDlrozmiJDjgIJcclxuICAgICAgICAgICAgQ0FOQ0VMTEVEOiAgJ2NhbmNlbGxlZCcsICAgIC8vIOS4iuS8oOWPlua2iOOAglxyXG4gICAgICAgICAgICBJTlRFUlJVUFQ6ICAnaW50ZXJydXB0JywgICAgLy8g5LiK5Lyg5Lit5pat77yM5Y+v57ut5Lyg44CCXHJcbiAgICAgICAgICAgIElOVkFMSUQ6ICAgICdpbnZhbGlkJyAgICAvLyDmlofku7bkuI3lkIjmoLzvvIzkuI3og73ph43or5XkuIrkvKDjgIJcclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIFdVRmlsZTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcg5paH5Lu26Zif5YiXXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgncXVldWUnLFtcclxuICAgICAgICAnYmFzZScsXHJcbiAgICAgICAgJ21lZGlhdG9yJyxcclxuICAgICAgICAnZmlsZSdcclxuICAgIF0sIGZ1bmN0aW9uKCBCYXNlLCBNZWRpYXRvciwgV1VGaWxlICkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQsXHJcbiAgICAgICAgICAgIFNUQVRVUyA9IFdVRmlsZS5TdGF0dXM7XHJcbiAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDmlofku7bpmJ/liJcsIOeUqOadpeWtmOWCqOWQhOS4queKtuaAgeS4reeahOaWh+S7tuOAglxyXG4gICAgICAgICAqIEBjbGFzcyBRdWV1ZVxyXG4gICAgICAgICAqIEBleHRlbmRzIE1lZGlhdG9yXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgZnVuY3Rpb24gUXVldWUoKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOe7n+iuoeaWh+S7tuaVsOOAglxyXG4gICAgICAgICAgICAgKiAqIGBudW1PZlF1ZXVlYCDpmJ/liJfkuK3nmoTmlofku7bmlbDjgIJcclxuICAgICAgICAgICAgICogKiBgbnVtT2ZTdWNjZXNzYCDkuIrkvKDmiJDlip/nmoTmlofku7bmlbBcclxuICAgICAgICAgICAgICogKiBgbnVtT2ZDYW5jZWxgIOiiq+WPlua2iOeahOaWh+S7tuaVsFxyXG4gICAgICAgICAgICAgKiAqIGBudW1PZlByb2dyZXNzYCDmraPlnKjkuIrkvKDkuK3nmoTmlofku7bmlbBcclxuICAgICAgICAgICAgICogKiBgbnVtT2ZVcGxvYWRGYWlsZWRgIOS4iuS8oOmUmeivr+eahOaWh+S7tuaVsOOAglxyXG4gICAgICAgICAgICAgKiAqIGBudW1PZkludmFsaWRgIOaXoOaViOeahOaWh+S7tuaVsOOAglxyXG4gICAgICAgICAgICAgKiAqIGBudW1vZkRlbGV0ZWRgIOiiq+enu+mZpOeahOaWh+S7tuaVsOOAglxyXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge09iamVjdH0gc3RhdHNcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHRoaXMuc3RhdHMgPSB7XHJcbiAgICAgICAgICAgICAgICBudW1PZlF1ZXVlOiAwLFxyXG4gICAgICAgICAgICAgICAgbnVtT2ZTdWNjZXNzOiAwLFxyXG4gICAgICAgICAgICAgICAgbnVtT2ZDYW5jZWw6IDAsXHJcbiAgICAgICAgICAgICAgICBudW1PZlByb2dyZXNzOiAwLFxyXG4gICAgICAgICAgICAgICAgbnVtT2ZVcGxvYWRGYWlsZWQ6IDAsXHJcbiAgICAgICAgICAgICAgICBudW1PZkludmFsaWQ6IDAsXHJcbiAgICAgICAgICAgICAgICBudW1vZkRlbGV0ZWQ6IDAsXHJcbiAgICAgICAgICAgICAgICBudW1vZkludGVycnVwdDogMFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOS4iuS8oOmYn+WIl++8jOS7heWMheaLrOetieW+heS4iuS8oOeahOaWh+S7tlxyXG4gICAgICAgICAgICB0aGlzLl9xdWV1ZSA9IFtdO1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOWtmOWCqOaJgOacieaWh+S7tlxyXG4gICAgICAgICAgICB0aGlzLl9tYXAgPSB7fTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAkLmV4dGVuZCggUXVldWUucHJvdG90eXBlLCB7XHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOWwhuaWsOaWh+S7tuWKoOWFpeWvuemYn+WIl+WwvumDqFxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIGFwcGVuZFxyXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHtGaWxlfSBmaWxlICAg5paH5Lu25a+56LGhXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBhcHBlbmQ6IGZ1bmN0aW9uKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcXVldWUucHVzaCggZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZmlsZUFkZGVkKCBmaWxlICk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5bCG5paw5paH5Lu25Yqg5YWl5a+56Zif5YiX5aS06YOoXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIEBtZXRob2QgcHJlcGVuZFxyXG4gICAgICAgICAgICAgKiBAcGFyYW0gIHtGaWxlfSBmaWxlICAg5paH5Lu25a+56LGhXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBwcmVwZW5kOiBmdW5jdGlvbiggZmlsZSApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3F1ZXVlLnVuc2hpZnQoIGZpbGUgKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVBZGRlZCggZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOiOt+WPluaWh+S7tuWvueixoVxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIGdldEZpbGVcclxuICAgICAgICAgICAgICogQHBhcmFtICB7U3RyaW5nfSBmaWxlSWQgICDmlofku7ZJRFxyXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHtGaWxlfVxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgZ2V0RmlsZTogZnVuY3Rpb24oIGZpbGVJZCApIHtcclxuICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGZpbGVJZCAhPT0gJ3N0cmluZycgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbGVJZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYXBbIGZpbGVJZCBdO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiDku47pmJ/liJfkuK3lj5blh7rkuIDkuKrmjIflrprnirbmgIHnmoTmlofku7bjgIJcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgZmV0Y2goIHN0YXR1cyApID0+IEZpbGVcclxuICAgICAgICAgICAgICogQG1ldGhvZCBmZXRjaFxyXG4gICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RhdHVzIFvmlofku7bnirbmgIHlgLxdKCNXZWJVcGxvYWRlcjpGaWxlOkZpbGUuU3RhdHVzKVxyXG4gICAgICAgICAgICAgKiBAcmV0dXJuIHtGaWxlfSBbRmlsZV0oI1dlYlVwbG9hZGVyOkZpbGUpXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBmZXRjaDogZnVuY3Rpb24oIHN0YXR1cyApIHtcclxuICAgICAgICAgICAgICAgIHZhciBsZW4gPSB0aGlzLl9xdWV1ZS5sZW5ndGgsXHJcbiAgICAgICAgICAgICAgICAgICAgaSwgZmlsZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgc3RhdHVzID0gc3RhdHVzIHx8IFNUQVRVUy5RVUVVRUQ7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgbGVuOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZSA9IHRoaXMuX3F1ZXVlWyBpIF07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIHN0YXR1cyA9PT0gZmlsZS5nZXRTdGF0dXMoKSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpbGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5a+56Zif5YiX6L+b6KGM5o6S5bqP77yM6IO95aSf5o6n5Yi25paH5Lu25LiK5Lyg6aG65bqP44CCXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIHNvcnQoIGZuICkgPT4gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAqIEBtZXRob2Qgc29ydFxyXG4gICAgICAgICAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiDmjpLluo/mlrnms5VcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHNvcnQ6IGZ1bmN0aW9uKCBmbiApIHtcclxuICAgICAgICAgICAgICAgIGlmICggdHlwZW9mIGZuID09PSAnZnVuY3Rpb24nICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3F1ZXVlLnNvcnQoIGZuICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOiOt+WPluaMh+Wumuexu+Wei+eahOaWh+S7tuWIl+ihqCwg5YiX6KGo5Lit5q+P5LiA5Liq5oiQ5ZGY5Li6W0ZpbGVdKCNXZWJVcGxvYWRlcjpGaWxlKeWvueixoeOAglxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciBnZXRGaWxlcyggW3N0YXR1czFbLCBzdGF0dXMyIC4uLl1dICkgPT4gQXJyYXlcclxuICAgICAgICAgICAgICogQG1ldGhvZCBnZXRGaWxlc1xyXG4gICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3N0YXR1c10gW+aWh+S7tueKtuaAgeWAvF0oI1dlYlVwbG9hZGVyOkZpbGU6RmlsZS5TdGF0dXMpXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBnZXRGaWxlczogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RzID0gW10uc2xpY2UuY2FsbCggYXJndW1lbnRzLCAwICksXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0ID0gW10sXHJcbiAgICAgICAgICAgICAgICAgICAgaSA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgbGVuID0gdGhpcy5fcXVldWUubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGU7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUgPSB0aGlzLl9xdWV1ZVsgaSBdO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBzdHMubGVuZ3RoICYmICF+JC5pbkFycmF5KCBmaWxlLmdldFN0YXR1cygpLCBzdHMgKSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0LnB1c2goIGZpbGUgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5Zyo6Zif5YiX5Lit5Yig6Zmk5paH5Lu244CCXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIHJlbW92ZUZpbGUoIGZpbGUgKSA9PiBBcnJheVxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIHJlbW92ZUZpbGVcclxuICAgICAgICAgICAgICogQHBhcmFtIHtGaWxlfSDmlofku7blr7nosaHjgIJcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHJlbW92ZUZpbGU6IGZ1bmN0aW9uKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBleGlzdGluZyA9IHRoaXMuX21hcFsgZmlsZS5pZCBdO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIGV4aXN0aW5nICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9tYXBbIGZpbGUuaWQgXTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRzLm51bW9mRGVsZXRlZCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIF9maWxlQWRkZWQ6IGZ1bmN0aW9uKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBleGlzdGluZyA9IHRoaXMuX21hcFsgZmlsZS5pZCBdO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoICFleGlzdGluZyApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYXBbIGZpbGUuaWQgXSA9IGZpbGU7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBmaWxlLm9uKCAnc3RhdHVzY2hhbmdlJywgZnVuY3Rpb24oIGN1ciwgcHJlICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5fb25GaWxlU3RhdHVzQ2hhbmdlKCBjdXIsIHByZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIF9vbkZpbGVTdGF0dXNDaGFuZ2U6IGZ1bmN0aW9uKCBjdXJTdGF0dXMsIHByZVN0YXR1cyApIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdGF0cyA9IHRoaXMuc3RhdHM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoIHByZVN0YXR1cyApIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFNUQVRVUy5QUk9HUkVTUzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHMubnVtT2ZQcm9ncmVzcy0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgU1RBVFVTLlFVRVVFRDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHMubnVtT2ZRdWV1ZSAtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFNUQVRVUy5FUlJPUjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHMubnVtT2ZVcGxvYWRGYWlsZWQtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFNUQVRVUy5JTlZBTElEOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0cy5udW1PZkludmFsaWQtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFNUQVRVUy5JTlRFUlJVUFQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzLm51bW9mSW50ZXJydXB0LS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKCBjdXJTdGF0dXMgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBTVEFUVVMuUVVFVUVEOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0cy5udW1PZlF1ZXVlKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBTVEFUVVMuUFJPR1JFU1M6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRzLm51bU9mUHJvZ3Jlc3MrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFNUQVRVUy5FUlJPUjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHMubnVtT2ZVcGxvYWRGYWlsZWQrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIFNUQVRVUy5DT01QTEVURTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHMubnVtT2ZTdWNjZXNzKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBTVEFUVVMuQ0FOQ0VMTEVEOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0cy5udW1PZkNhbmNlbCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBTVEFUVVMuSU5WQUxJRDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHMubnVtT2ZJbnZhbGlkKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBTVEFUVVMuSU5URVJSVVBUOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0cy5udW1vZkludGVycnVwdCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICBNZWRpYXRvci5pbnN0YWxsVG8oIFF1ZXVlLnByb3RvdHlwZSApO1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIFF1ZXVlO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcg6Zif5YiXXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgnd2lkZ2V0cy9xdWV1ZScsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAndXBsb2FkZXInLFxyXG4gICAgICAgICdxdWV1ZScsXHJcbiAgICAgICAgJ2ZpbGUnLFxyXG4gICAgICAgICdsaWIvZmlsZScsXHJcbiAgICAgICAgJ3J1bnRpbWUvY2xpZW50JyxcclxuICAgICAgICAnd2lkZ2V0cy93aWRnZXQnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgVXBsb2FkZXIsIFF1ZXVlLCBXVUZpbGUsIEZpbGUsIFJ1bnRpbWVDbGllbnQgKSB7XHJcbiAgICBcclxuICAgICAgICB2YXIgJCA9IEJhc2UuJCxcclxuICAgICAgICAgICAgckV4dCA9IC9cXC5cXHcrJC8sXHJcbiAgICAgICAgICAgIFN0YXR1cyA9IFdVRmlsZS5TdGF0dXM7XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gVXBsb2FkZXIucmVnaXN0ZXIoe1xyXG4gICAgICAgICAgICBuYW1lOiAncXVldWUnLFxyXG4gICAgXHJcbiAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBvcHRzICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZCwgbGVuLCBpLCBpdGVtLCBhcnIsIGFjY2VwdCwgcnVudGltZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCAkLmlzUGxhaW5PYmplY3QoIG9wdHMuYWNjZXB0ICkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0cy5hY2NlcHQgPSBbIG9wdHMuYWNjZXB0IF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIGFjY2VwdOS4reeahOS4reeUn+aIkOWMuemFjeato+WImeOAglxyXG4gICAgICAgICAgICAgICAgaWYgKCBvcHRzLmFjY2VwdCApIHtcclxuICAgICAgICAgICAgICAgICAgICBhcnIgPSBbXTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwLCBsZW4gPSBvcHRzLmFjY2VwdC5sZW5ndGg7IGkgPCBsZW47IGkrKyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9IG9wdHMuYWNjZXB0WyBpIF0uZXh0ZW5zaW9ucztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSAmJiBhcnIucHVzaCggaXRlbSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggYXJyLmxlbmd0aCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXB0ID0gJ1xcXFwuJyArIGFyci5qb2luKCcsJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSggLywvZywgJyR8XFxcXC4nIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSggL1xcKi9nLCAnLionICkgKyAnJCc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgbWUuYWNjZXB0ID0gbmV3IFJlZ0V4cCggYWNjZXB0LCAnaScgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbWUucXVldWUgPSBuZXcgUXVldWUoKTtcclxuICAgICAgICAgICAgICAgIG1lLnN0YXRzID0gbWUucXVldWUuc3RhdHM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOWmguaenOW9k+WJjeS4jeaYr2h0bWw16L+Q6KGM5pe277yM6YKj5bCx566X5LqG44CCXHJcbiAgICAgICAgICAgICAgICAvLyDkuI3miafooYzlkI7nu63mk43kvZxcclxuICAgICAgICAgICAgICAgIGlmICggdGhpcy5yZXF1ZXN0KCdwcmVkaWN0LXJ1bnRpbWUtdHlwZScpICE9PSAnaHRtbDUnICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5Yib5bu65LiA5LiqIGh0bWw1IOi/kOihjOaXtueahCBwbGFjZWhvbGRlclxyXG4gICAgICAgICAgICAgICAgLy8g5Lul6Iez5LqO5aSW6YOo5re75Yqg5Y6f55SfIEZpbGUg5a+56LGh55qE5pe25YCZ6IO95q2j56Gu5YyF6KO55LiA5LiL5L6bIHdlYnVwbG9hZGVyIOS9v+eUqOOAglxyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQgPSBCYXNlLkRlZmVycmVkKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyID0gcnVudGltZSA9IG5ldyBSdW50aW1lQ2xpZW50KCdQbGFjZWhvbGRlcicpO1xyXG4gICAgICAgICAgICAgICAgcnVudGltZS5jb25uZWN0UnVudGltZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgcnVudGltZU9yZGVyOiAnaHRtbDUnXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBtZS5fcnVpZCA9IHJ1bnRpbWUuZ2V0UnVpZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOS4uuS6huaUr+aMgeWklumDqOebtOaOpea3u+WKoOS4gOS4quWOn+eUn0ZpbGXlr7nosaHjgIJcclxuICAgICAgICAgICAgX3dyYXBGaWxlOiBmdW5jdGlvbiggZmlsZSApIHtcclxuICAgICAgICAgICAgICAgIGlmICggIShmaWxlIGluc3RhbmNlb2YgV1VGaWxlKSApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggIShmaWxlIGluc3RhbmNlb2YgRmlsZSkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIXRoaXMuX3J1aWQgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NhblxcJ3QgYWRkIGV4dGVybmFsIGZpbGVzLicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUgPSBuZXcgRmlsZSggdGhpcy5fcnVpZCwgZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUgPSBuZXcgV1VGaWxlKCBmaWxlICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBmaWxlO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOWIpOaWreaWh+S7tuaYr+WQpuWPr+S7peiiq+WKoOWFpemYn+WIl1xyXG4gICAgICAgICAgICBhY2NlcHRGaWxlOiBmdW5jdGlvbiggZmlsZSApIHtcclxuICAgICAgICAgICAgICAgIHZhciBpbnZhbGlkID0gIWZpbGUgfHwgIWZpbGUuc2l6ZSB8fCB0aGlzLmFjY2VwdCAmJlxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWmguaenOWQjeWtl+S4reacieWQjue8gO+8jOaJjeWBmuWQjue8gOeZveWQjeWNleWkhOeQhuOAglxyXG4gICAgICAgICAgICAgICAgICAgICAgICByRXh0LmV4ZWMoIGZpbGUubmFtZSApICYmICF0aGlzLmFjY2VwdC50ZXN0KCBmaWxlLm5hbWUgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICFpbnZhbGlkO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEBldmVudCBiZWZvcmVGaWxlUXVldWVkXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSB7RmlsZX0gZmlsZSBGaWxl5a+56LGhXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDlvZPmlofku7booqvliqDlhaXpmJ/liJfkuYvliY3op6blj5HvvIzmraTkuovku7bnmoRoYW5kbGVy6L+U5Zue5YC85Li6YGZhbHNlYO+8jOWImeatpOaWh+S7tuS4jeS8muiiq+a3u+WKoOi/m+WFpemYn+WIl+OAglxyXG4gICAgICAgICAgICAgKiBAZm9yICBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKi9cclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQGV2ZW50IGZpbGVRdWV1ZWRcclxuICAgICAgICAgICAgICogQHBhcmFtIHtGaWxlfSBmaWxlIEZpbGXlr7nosaFcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOW9k+aWh+S7tuiiq+WKoOWFpemYn+WIl+S7peWQjuinpuWPkeOAglxyXG4gICAgICAgICAgICAgKiBAZm9yICBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKi9cclxuICAgIFxyXG4gICAgICAgICAgICBfYWRkRmlsZTogZnVuY3Rpb24oIGZpbGUgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmaWxlID0gbWUuX3dyYXBGaWxlKCBmaWxlICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOS4jei/h+exu+Wei+WIpOaWreWFgeiuuOS4jeWFgeiuuO+8jOWFiOa0vumAgSBgYmVmb3JlRmlsZVF1ZXVlZGBcclxuICAgICAgICAgICAgICAgIGlmICggIW1lLm93bmVyLnRyaWdnZXIoICdiZWZvcmVGaWxlUXVldWVkJywgZmlsZSApICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g57G75Z6L5LiN5Yy56YWN77yM5YiZ5rS+6YCB6ZSZ6K+v5LqL5Lu277yM5bm26L+U5Zue44CCXHJcbiAgICAgICAgICAgICAgICBpZiAoICFtZS5hY2NlcHRGaWxlKCBmaWxlICkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUub3duZXIudHJpZ2dlciggJ2Vycm9yJywgJ1FfVFlQRV9ERU5JRUQnLCBmaWxlICk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBtZS5xdWV1ZS5hcHBlbmQoIGZpbGUgKTtcclxuICAgICAgICAgICAgICAgIG1lLm93bmVyLnRyaWdnZXIoICdmaWxlUXVldWVkJywgZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbGU7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgZ2V0RmlsZTogZnVuY3Rpb24oIGZpbGVJZCApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnF1ZXVlLmdldEZpbGUoIGZpbGVJZCApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAZXZlbnQgZmlsZXNRdWV1ZWRcclxuICAgICAgICAgICAgICogQHBhcmFtIHtGaWxlfSBmaWxlcyDmlbDnu4TvvIzlhoXlrrnkuLrljp/lp4tGaWxlKGxpYi9GaWxl77yJ5a+56LGh44CCXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDlvZPkuIDmibnmlofku7bmt7vliqDov5vpmJ/liJfku6XlkI7op6blj5HjgIJcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtCb29sZWFufSBbYXV0bz1mYWxzZV1cclxuICAgICAgICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zXHJcbiAgICAgICAgICAgICAqIEBmb3IgVXBsb2FkZXJcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOiuvue9ruS4uiB0cnVlIOWQju+8jOS4jemcgOimgeaJi+WKqOiwg+eUqOS4iuS8oO+8jOacieaWh+S7tumAieaLqeWNs+W8gOWni+S4iuS8oOOAglxyXG4gICAgICAgICAgICAgKiBcclxuICAgICAgICAgICAgICovXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEBtZXRob2QgYWRkRmlsZXNcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgYWRkRmlsZXMoIGZpbGUgKSA9PiB1bmRlZmluZWRcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgYWRkRmlsZXMoIFtmaWxlMSwgZmlsZTIgLi4uXSApID0+IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgKiBAcGFyYW0ge0FycmF5IG9mIEZpbGUgb3IgRmlsZX0gW2ZpbGVzXSBGaWxlcyDlr7nosaEg5pWw57uEXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDmt7vliqDmlofku7bliLDpmJ/liJdcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGFkZEZpbGU6IGZ1bmN0aW9uKCBmaWxlcyApIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggIWZpbGVzLmxlbmd0aCApIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlcyA9IFsgZmlsZXMgXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZmlsZXMgPSAkLm1hcCggZmlsZXMsIGZ1bmN0aW9uKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZS5fYWRkRmlsZSggZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcdFx0XHRcclxuICAgIFx0XHRcdGlmICggZmlsZXMubGVuZ3RoICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgbWUub3duZXIudHJpZ2dlciggJ2ZpbGVzUXVldWVkJywgZmlsZXMgKTtcclxuICAgIFxyXG4gICAgXHRcdFx0XHRpZiAoIG1lLm9wdGlvbnMuYXV0byApIHtcclxuICAgIFx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgXHRcdFx0XHRcdFx0bWUucmVxdWVzdCgnc3RhcnQtdXBsb2FkJyk7XHJcbiAgICBcdFx0XHRcdFx0fSwgMjAgKTtcclxuICAgIFx0XHRcdFx0fVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGdldFN0YXRzOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRzO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAZXZlbnQgZmlsZURlcXVldWVkXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSB7RmlsZX0gZmlsZSBGaWxl5a+56LGhXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDlvZPmlofku7booqvnp7vpmaTpmJ/liJflkI7op6blj5HjgIJcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICBcclxuICAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIHJlbW92ZUZpbGVcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgcmVtb3ZlRmlsZSggZmlsZSApID0+IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciByZW1vdmVGaWxlKCBpZCApID0+IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciByZW1vdmVGaWxlKCBmaWxlLCB0cnVlICkgPT4gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIHJlbW92ZUZpbGUoIGlkLCB0cnVlICkgPT4gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSB7RmlsZXxpZH0gZmlsZSBGaWxl5a+56LGh5oiW6L+ZRmlsZeWvueixoeeahGlkXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDnp7vpmaTmn5DkuIDmlofku7YsIOm7mOiupOWPquS8muagh+iusOaWh+S7tueKtuaAgeS4uuW3suWPlua2iO+8jOWmguaenOesrOS6jOS4quWPguaVsOS4uiBgdHJ1ZWAg5YiZ5Lya5LuOIHF1ZXVlIOS4reenu+mZpOOAglxyXG4gICAgICAgICAgICAgKiBAZm9yICBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKiBAZXhhbXBsZVxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAkbGkub24oJ2NsaWNrJywgJy5yZW1vdmUtdGhpcycsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgKiAgICAgdXBsb2FkZXIucmVtb3ZlRmlsZSggZmlsZSApO1xyXG4gICAgICAgICAgICAgKiB9KVxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgcmVtb3ZlRmlsZTogZnVuY3Rpb24oIGZpbGUsIHJlbW92ZSApIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZpbGUgPSBmaWxlLmlkID8gZmlsZSA6IG1lLnF1ZXVlLmdldEZpbGUoIGZpbGUgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXF1ZXN0KCAnY2FuY2VsLWZpbGUnLCBmaWxlICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggcmVtb3ZlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXVldWUucmVtb3ZlRmlsZSggZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIGdldEZpbGVzXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIGdldEZpbGVzKCkgPT4gQXJyYXlcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgZ2V0RmlsZXMoIHN0YXR1czEsIHN0YXR1czIsIHN0YXR1cy4uLiApID0+IEFycmF5XHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDov5Tlm57mjIflrprnirbmgIHnmoTmlofku7bpm4blkIjvvIzkuI3kvKDlj4LmlbDlsIbov5Tlm57miYDmnInnirbmgIHnmoTmlofku7bjgIJcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICogQGV4YW1wbGVcclxuICAgICAgICAgICAgICogY29uc29sZS5sb2coIHVwbG9hZGVyLmdldEZpbGVzKCkgKTsgICAgLy8gPT4gYWxsIGZpbGVzXHJcbiAgICAgICAgICAgICAqIGNvbnNvbGUubG9nKCB1cGxvYWRlci5nZXRGaWxlcygnZXJyb3InKSApICAgIC8vID0+IGFsbCBlcnJvciBmaWxlcy5cclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGdldEZpbGVzOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnF1ZXVlLmdldEZpbGVzLmFwcGx5KCB0aGlzLnF1ZXVlLCBhcmd1bWVudHMgKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBmZXRjaEZpbGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVldWUuZmV0Y2guYXBwbHkoIHRoaXMucXVldWUsIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIHJldHJ5XHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIHJldHJ5KCkgPT4gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIHJldHJ5KCBmaWxlICkgPT4gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDph43or5XkuIrkvKDvvIzph43or5XmjIflrprmlofku7bvvIzmiJbogIXku47lh7rplJnnmoTmlofku7blvIDlp4vph43mlrDkuIrkvKDjgIJcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICogQGV4YW1wbGVcclxuICAgICAgICAgICAgICogZnVuY3Rpb24gcmV0cnkoKSB7XHJcbiAgICAgICAgICAgICAqICAgICB1cGxvYWRlci5yZXRyeSgpO1xyXG4gICAgICAgICAgICAgKiB9XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICByZXRyeTogZnVuY3Rpb24oIGZpbGUsIG5vRm9yY2VTdGFydCApIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZSA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZXMsIGksIGxlbjtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUgPSBmaWxlLmlkID8gZmlsZSA6IG1lLnF1ZXVlLmdldEZpbGUoIGZpbGUgKTtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlLnNldFN0YXR1cyggU3RhdHVzLlFVRVVFRCApO1xyXG4gICAgICAgICAgICAgICAgICAgIG5vRm9yY2VTdGFydCB8fCBtZS5yZXF1ZXN0KCdzdGFydC11cGxvYWQnKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZpbGVzID0gbWUucXVldWUuZ2V0RmlsZXMoIFN0YXR1cy5FUlJPUiApO1xyXG4gICAgICAgICAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICBsZW4gPSBmaWxlcy5sZW5ndGg7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZvciAoIDsgaSA8IGxlbjsgaSsrICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUgPSBmaWxlc1sgaSBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUuc2V0U3RhdHVzKCBTdGF0dXMuUVVFVUVEICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIG1lLnJlcXVlc3QoJ3N0YXJ0LXVwbG9hZCcpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIHNvcnRcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgc29ydCggZm4gKSA9PiB1bmRlZmluZWRcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOaOkuW6j+mYn+WIl+S4reeahOaWh+S7tu+8jOWcqOS4iuS8oOS5i+WJjeiwg+aVtOWPr+S7peaOp+WItuS4iuS8oOmhuuW6j+OAglxyXG4gICAgICAgICAgICAgKiBAZm9yICBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgc29ydEZpbGVzOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnF1ZXVlLnNvcnQuYXBwbHkoIHRoaXMucXVldWUsIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAZXZlbnQgcmVzZXRcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOW9kyB1cGxvYWRlciDooqvph43nva7nmoTml7blgJnop6blj5HjgIJcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEBtZXRob2QgcmVzZXRcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgcmVzZXQoKSA9PiB1bmRlZmluZWRcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOmHjee9rnVwbG9hZGVy44CC55uu5YmN5Y+q6YeN572u5LqG6Zif5YiX44CCXHJcbiAgICAgICAgICAgICAqIEBmb3IgIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqIEBleGFtcGxlXHJcbiAgICAgICAgICAgICAqIHVwbG9hZGVyLnJlc2V0KCk7XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm93bmVyLnRyaWdnZXIoJ3Jlc2V0Jyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnF1ZXVlID0gbmV3IFF1ZXVlKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRzID0gdGhpcy5xdWV1ZS5zdGF0cztcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXIgJiYgdGhpcy5wbGFjZWhvbGRlci5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcg5re75Yqg6I635Y+WUnVudGltZeebuOWFs+S/oeaBr+eahOaWueazleOAglxyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ3dpZGdldHMvcnVudGltZScsW1xyXG4gICAgICAgICd1cGxvYWRlcicsXHJcbiAgICAgICAgJ3J1bnRpbWUvcnVudGltZScsXHJcbiAgICAgICAgJ3dpZGdldHMvd2lkZ2V0J1xyXG4gICAgXSwgZnVuY3Rpb24oIFVwbG9hZGVyLCBSdW50aW1lICkge1xyXG4gICAgXHJcbiAgICAgICAgVXBsb2FkZXIuc3VwcG9ydCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUnVudGltZS5oYXNSdW50aW1lLmFwcGx5KCBSdW50aW1lLCBhcmd1bWVudHMgKTtcclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQHByb3BlcnR5IHtPYmplY3R9IFtydW50aW1lT3JkZXI9aHRtbDUsZmxhc2hdXHJcbiAgICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zXHJcbiAgICAgICAgICogQGZvciBVcGxvYWRlclxyXG4gICAgICAgICAqIEBkZXNjcmlwdGlvbiDmjIflrprov5DooYzml7blkK/liqjpobrluo/jgILpu5jorqTkvJrmg7PlsJ3or5UgaHRtbDUg5piv5ZCm5pSv5oyB77yM5aaC5p6c5pSv5oyB5YiZ5L2/55SoIGh0bWw1LCDlkKbliJnliJnkvb/nlKggZmxhc2guXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiDlj6/ku6XlsIbmraTlgLzorr7nva7miJAgYGZsYXNoYO+8jOadpeW8uuWItuS9v+eUqCBmbGFzaCDov5DooYzml7bjgIJcclxuICAgICAgICAgKi9cclxuICAgIFxyXG4gICAgICAgIHJldHVybiBVcGxvYWRlci5yZWdpc3Rlcih7XHJcbiAgICAgICAgICAgIG5hbWU6ICdydW50aW1lJyxcclxuICAgIFxyXG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGlmICggIXRoaXMucHJlZGljdFJ1bnRpbWVUeXBlKCkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ1J1bnRpbWUgRXJyb3InKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog6aKE5rWLVXBsb2FkZXLlsIbph4fnlKjlk6rkuKpgUnVudGltZWBcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgcHJlZGljdFJ1bnRpbWVUeXBlKCkgPT4gU3RyaW5nXHJcbiAgICAgICAgICAgICAqIEBtZXRob2QgcHJlZGljdFJ1bnRpbWVUeXBlXHJcbiAgICAgICAgICAgICAqIEBmb3IgIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBwcmVkaWN0UnVudGltZVR5cGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG9yZGVycyA9IHRoaXMub3B0aW9ucy5ydW50aW1lT3JkZXIgfHwgUnVudGltZS5vcmRlcnMsXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHRoaXMudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICBpLCBsZW47XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggIXR5cGUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3JkZXJzID0gb3JkZXJzLnNwbGl0KCAvXFxzKixcXHMqL2cgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwLCBsZW4gPSBvcmRlcnMubGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggUnVudGltZS5oYXNSdW50aW1lKCBvcmRlcnNbIGkgXSApICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZSA9IG9yZGVyc1sgaSBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiB0eXBlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogQGZpbGVPdmVydmlldyBUcmFuc3BvcnRcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdsaWIvdHJhbnNwb3J0JyxbXHJcbiAgICAgICAgJ2Jhc2UnLFxyXG4gICAgICAgICdydW50aW1lL2NsaWVudCcsXHJcbiAgICAgICAgJ21lZGlhdG9yJ1xyXG4gICAgXSwgZnVuY3Rpb24oIEJhc2UsIFJ1bnRpbWVDbGllbnQsIE1lZGlhdG9yICkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQ7XHJcbiAgICBcclxuICAgICAgICBmdW5jdGlvbiBUcmFuc3BvcnQoIG9wdHMgKSB7XHJcbiAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7XHJcbiAgICBcclxuICAgICAgICAgICAgb3B0cyA9IG1lLm9wdGlvbnMgPSAkLmV4dGVuZCggdHJ1ZSwge30sIFRyYW5zcG9ydC5vcHRpb25zLCBvcHRzIHx8IHt9ICk7XHJcbiAgICAgICAgICAgIFJ1bnRpbWVDbGllbnQuY2FsbCggdGhpcywgJ1RyYW5zcG9ydCcgKTtcclxuICAgIFxyXG4gICAgICAgICAgICB0aGlzLl9ibG9iID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5fZm9ybURhdGEgPSBvcHRzLmZvcm1EYXRhIHx8IHt9O1xyXG4gICAgICAgICAgICB0aGlzLl9oZWFkZXJzID0gb3B0cy5oZWFkZXJzIHx8IHt9O1xyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMub24oICdwcm9ncmVzcycsIHRoaXMuX3RpbWVvdXQgKTtcclxuICAgICAgICAgICAgdGhpcy5vbiggJ2xvYWQgZXJyb3InLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIG1lLnRyaWdnZXIoICdwcm9ncmVzcycsIDEgKTtcclxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCggbWUuX3RpbWVyICk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIFRyYW5zcG9ydC5vcHRpb25zID0ge1xyXG4gICAgICAgICAgICBzZXJ2ZXI6ICcnLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgIFxyXG4gICAgICAgICAgICAvLyDot6jln5/ml7bvvIzmmK/lkKblhYHorrjmkLrluKZjb29raWUsIOWPquaciWh0bWw1IHJ1bnRpbWXmiY3mnInmlYhcclxuICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiBmYWxzZSxcclxuICAgICAgICAgICAgZmlsZVZhbDogJ2ZpbGUnLFxyXG4gICAgICAgICAgICB0aW1lb3V0OiAyICogNjAgKiAxMDAwLCAgICAvLyAy5YiG6ZKfXHJcbiAgICAgICAgICAgIGZvcm1EYXRhOiB7fSxcclxuICAgICAgICAgICAgaGVhZGVyczoge30sXHJcbiAgICAgICAgICAgIHNlbmRBc0JpbmFyeTogZmFsc2VcclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgJC5leHRlbmQoIFRyYW5zcG9ydC5wcm90b3R5cGUsIHtcclxuICAgIFxyXG4gICAgICAgICAgICAvLyDmt7vliqBCbG9iLCDlj6rog73mt7vliqDkuIDmrKHvvIzmnIDlkI7kuIDmrKHmnInmlYjjgIJcclxuICAgICAgICAgICAgYXBwZW5kQmxvYjogZnVuY3Rpb24oIGtleSwgYmxvYiwgZmlsZW5hbWUgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIG9wdHMgPSBtZS5vcHRpb25zO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIG1lLmdldFJ1aWQoKSApIHtcclxuICAgICAgICAgICAgICAgICAgICBtZS5kaXNjb25uZWN0UnVudGltZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDov57mjqXliLBibG9i5b2S5bGe55qE5ZCM5LiA5LiqcnVudGltZS5cclxuICAgICAgICAgICAgICAgIG1lLmNvbm5lY3RSdW50aW1lKCBibG9iLnJ1aWQsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lLmV4ZWMoJ2luaXQnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBtZS5fYmxvYiA9IGJsb2I7XHJcbiAgICAgICAgICAgICAgICBvcHRzLmZpbGVWYWwgPSBrZXkgfHwgb3B0cy5maWxlVmFsO1xyXG4gICAgICAgICAgICAgICAgb3B0cy5maWxlbmFtZSA9IGZpbGVuYW1lIHx8IG9wdHMuZmlsZW5hbWU7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLy8g5re75Yqg5YW25LuW5a2X5q61XHJcbiAgICAgICAgICAgIGFwcGVuZDogZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIHR5cGVvZiBrZXkgPT09ICdvYmplY3QnICkge1xyXG4gICAgICAgICAgICAgICAgICAgICQuZXh0ZW5kKCB0aGlzLl9mb3JtRGF0YSwga2V5ICk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2Zvcm1EYXRhWyBrZXkgXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIHNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCB0eXBlb2Yga2V5ID09PSAnb2JqZWN0JyApIHtcclxuICAgICAgICAgICAgICAgICAgICAkLmV4dGVuZCggdGhpcy5faGVhZGVycywga2V5ICk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2hlYWRlcnNbIGtleSBdID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgc2VuZDogZnVuY3Rpb24oIG1ldGhvZCApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXhlYyggJ3NlbmQnLCBtZXRob2QgKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3RpbWVvdXQoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBhYm9ydDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoIHRoaXMuX3RpbWVyICk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5leGVjKCdhYm9ydCcpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCdkZXN0cm95Jyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9mZigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5leGVjKCdkZXN0cm95Jyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2Nvbm5lY3RSdW50aW1lKCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgZ2V0UmVzcG9uc2U6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhlYygnZ2V0UmVzcG9uc2UnKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBnZXRSZXNwb25zZUFzSnNvbjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5leGVjKCdnZXRSZXNwb25zZUFzSnNvbicpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGdldFN0YXR1czogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5leGVjKCdnZXRTdGF0dXMnKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBfdGltZW91dDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gbWUub3B0aW9ucy50aW1lb3V0O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoICFkdXJhdGlvbiApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCggbWUuX3RpbWVyICk7XHJcbiAgICAgICAgICAgICAgICBtZS5fdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lLmFib3J0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUudHJpZ2dlciggJ2Vycm9yJywgJ3RpbWVvdXQnICk7XHJcbiAgICAgICAgICAgICAgICB9LCBkdXJhdGlvbiApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgIC8vIOiuqVRyYW5zcG9ydOWFt+Wkh+S6i+S7tuWKn+iDveOAglxyXG4gICAgICAgIE1lZGlhdG9yLmluc3RhbGxUbyggVHJhbnNwb3J0LnByb3RvdHlwZSApO1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIFRyYW5zcG9ydDtcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IOi0n+i0o+aWh+S7tuS4iuS8oOebuOWFs+OAglxyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ3dpZGdldHMvdXBsb2FkJyxbXHJcbiAgICAgICAgJ2Jhc2UnLFxyXG4gICAgICAgICd1cGxvYWRlcicsXHJcbiAgICAgICAgJ2ZpbGUnLFxyXG4gICAgICAgICdsaWIvdHJhbnNwb3J0JyxcclxuICAgICAgICAnd2lkZ2V0cy93aWRnZXQnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgVXBsb2FkZXIsIFdVRmlsZSwgVHJhbnNwb3J0ICkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQsXHJcbiAgICAgICAgICAgIGlzUHJvbWlzZSA9IEJhc2UuaXNQcm9taXNlLFxyXG4gICAgICAgICAgICBTdGF0dXMgPSBXVUZpbGUuU3RhdHVzO1xyXG4gICAgXHJcbiAgICAgICAgLy8g5re75Yqg6buY6K6k6YWN572u6aG5XHJcbiAgICAgICAgJC5leHRlbmQoIFVwbG9hZGVyLm9wdGlvbnMsIHtcclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtwcmVwYXJlTmV4dEZpbGU9ZmFsc2VdXHJcbiAgICAgICAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9uc1xyXG4gICAgICAgICAgICAgKiBAZm9yIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDmmK/lkKblhYHorrjlnKjmlofku7bkvKDovpPml7bmj5DliY3miorkuIvkuIDkuKrmlofku7blh4blpIflpb3jgIJcclxuICAgICAgICAgICAgICog5a+55LqO5LiA5Liq5paH5Lu255qE5YeG5aSH5bel5L2c5q+U6L6D6ICX5pe277yM5q+U5aaC5Zu+54mH5Y6L57yp77yMbWQ15bqP5YiX5YyW44CCXHJcbiAgICAgICAgICAgICAqIOWmguaenOiDveaPkOWJjeWcqOW9k+WJjeaWh+S7tuS8oOi+k+acn+WkhOeQhu+8jOWPr+S7peiKguecgeaAu+S9k+iAl+aXtuOAglxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgcHJlcGFyZU5leHRGaWxlOiBmYWxzZSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtCb29sZWFufSBbY2h1bmtlZD1mYWxzZV1cclxuICAgICAgICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zXHJcbiAgICAgICAgICAgICAqIEBmb3IgVXBsb2FkZXJcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOaYr+WQpuimgeWIhueJh+WkhOeQhuWkp+aWh+S7tuS4iuS8oOOAglxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgY2h1bmtlZDogZmFsc2UsXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gW2NodW5rU2l6ZT01MjQyODgwXVxyXG4gICAgICAgICAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnNcclxuICAgICAgICAgICAgICogQGZvciBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24g5aaC5p6c6KaB5YiG54mH77yM5YiG5aSa5aSn5LiA54mH77yfIOm7mOiupOWkp+Wwj+S4ujVNLlxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgY2h1bmtTaXplOiA1ICogMTAyNCAqIDEwMjQsXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gW2NodW5rUmV0cnk9Ml1cclxuICAgICAgICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zXHJcbiAgICAgICAgICAgICAqIEBmb3IgVXBsb2FkZXJcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOWmguaenOafkOS4quWIhueJh+eUseS6jue9kee7nOmXrumimOWHuumUme+8jOWFgeiuuOiHquWKqOmHjeS8oOWkmuWwkeasoe+8n1xyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgY2h1bmtSZXRyeTogMixcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtCb29sZWFufSBbdGhyZWFkcz0zXVxyXG4gICAgICAgICAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnNcclxuICAgICAgICAgICAgICogQGZvciBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24g5LiK5Lyg5bm25Y+R5pWw44CC5YWB6K645ZCM5pe25pyA5aSn5LiK5Lyg6L+b56iL5pWw44CCXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICB0aHJlYWRzOiAzLFxyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBbZm9ybURhdGE9e31dXHJcbiAgICAgICAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9uc1xyXG4gICAgICAgICAgICAgKiBAZm9yIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDmlofku7bkuIrkvKDor7fmsYLnmoTlj4LmlbDooajvvIzmr4/mrKHlj5HpgIHpg73kvJrlj5HpgIHmraTlr7nosaHkuK3nmoTlj4LmlbDjgIJcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGZvcm1EYXRhOiB7fVxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAcHJvcGVydHkge09iamVjdH0gW2ZpbGVWYWw9J2ZpbGUnXVxyXG4gICAgICAgICAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnNcclxuICAgICAgICAgICAgICogQGZvciBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24g6K6+572u5paH5Lu25LiK5Lyg5Z+f55qEbmFtZeOAglxyXG4gICAgICAgICAgICAgKi9cclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQHByb3BlcnR5IHtPYmplY3R9IFtzZW5kQXNCaW5hcnk9ZmFsc2VdXHJcbiAgICAgICAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9uc1xyXG4gICAgICAgICAgICAgKiBAZm9yIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDmmK/lkKblt7Lkuozov5vliLbnmoTmtYHnmoTmlrnlvI/lj5HpgIHmlofku7bvvIzov5nmoLfmlbTkuKrkuIrkvKDlhoXlrrlgcGhwOi8vaW5wdXRg6YO95Li65paH5Lu25YaF5a6577yMXHJcbiAgICAgICAgICAgICAqIOWFtuS7luWPguaVsOWcqCRfR0VU5pWw57uE5Lit44CCXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgLy8g6LSf6LSj5bCG5paH5Lu25YiH54mH44CCXHJcbiAgICAgICAgZnVuY3Rpb24gQ3V0ZUZpbGUoIGZpbGUsIGNodW5rU2l6ZSApIHtcclxuICAgICAgICAgICAgdmFyIHBlbmRpbmcgPSBbXSxcclxuICAgICAgICAgICAgICAgIGJsb2IgPSBmaWxlLnNvdXJjZSxcclxuICAgICAgICAgICAgICAgIHRvdGFsID0gYmxvYi5zaXplLFxyXG4gICAgICAgICAgICAgICAgY2h1bmtzID0gY2h1bmtTaXplID8gTWF0aC5jZWlsKCB0b3RhbCAvIGNodW5rU2l6ZSApIDogMSxcclxuICAgICAgICAgICAgICAgIHN0YXJ0ID0gMCxcclxuICAgICAgICAgICAgICAgIGluZGV4ID0gMCxcclxuICAgICAgICAgICAgICAgIGxlbiwgYXBpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGFwaSA9IHtcclxuICAgICAgICAgICAgICAgIGZpbGU6IGZpbGUsXHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGhhczogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICEhcGVuZGluZy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBzaGlmdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBlbmRpbmcuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHVuc2hpZnQ6IGZ1bmN0aW9uKCBibG9jayApIHtcclxuICAgICAgICAgICAgICAgICAgICBwZW5kaW5nLnVuc2hpZnQoIGJsb2NrICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAgICAgd2hpbGUgKCBpbmRleCA8IGNodW5rcyApIHtcclxuICAgICAgICAgICAgICAgIGxlbiA9IE1hdGgubWluKCBjaHVua1NpemUsIHRvdGFsIC0gc3RhcnQgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcGVuZGluZy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICBmaWxlOiBmaWxlLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBzdGFydCxcclxuICAgICAgICAgICAgICAgICAgICBlbmQ6IGNodW5rU2l6ZSA/IChzdGFydCArIGxlbikgOiB0b3RhbCxcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWwsXHJcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtzOiBjaHVua3MsXHJcbiAgICAgICAgICAgICAgICAgICAgY2h1bms6IGluZGV4KyssXHJcbiAgICAgICAgICAgICAgICAgICAgY3V0ZWQ6IGFwaVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBzdGFydCArPSBsZW47XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICBmaWxlLmJsb2NrcyA9IHBlbmRpbmcuY29uY2F0KCk7XHJcbiAgICAgICAgICAgIGZpbGUucmVtYW5pbmcgPSBwZW5kaW5nLmxlbmd0aDtcclxuICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gYXBpO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIFVwbG9hZGVyLnJlZ2lzdGVyKHtcclxuICAgICAgICAgICAgbmFtZTogJ3VwbG9hZCcsXHJcbiAgICBcclxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3duZXIgPSB0aGlzLm93bmVyLFxyXG4gICAgICAgICAgICAgICAgICAgIG1lID0gdGhpcztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5ydW5pbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MgPSBmYWxzZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgb3duZXJcclxuICAgICAgICAgICAgICAgICAgICAub24oICdzdGFydFVwbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5wcm9ncmVzcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAub24oICd1cGxvYWRGaW5pc2hlZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5wcm9ncmVzcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDorrDlvZXlvZPliY3mraPlnKjkvKDnmoTmlbDmja7vvIzot590aHJlYWRz55u45YWzXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvb2wgPSBbXTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g57yT5a2Y5YiG5aW954mH55qE5paH5Lu244CCXHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWNrID0gW107XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOe8k+WtmOWNs+WwhuS4iuS8oOeahOaWh+S7tuOAglxyXG4gICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nID0gW107XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOi3n+i4qui/mOacieWkmuWwkeWIhueJh+WcqOS4iuS8oOS4reS9huaYr+ayoeacieWujOaIkOS4iuS8oOOAglxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1hbmluZyA9IDA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9fdGljayA9IEJhc2UuYmluZEZuKCB0aGlzLl90aWNrLCB0aGlzICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOmUgOavgeS4iuS8oOebuOWFs+eahOWxnuaAp+OAglxyXG4gICAgICAgICAgICAgICAgb3duZXIub24oICd1cGxvYWRDb21wbGV0ZScsIGZ1bmN0aW9uKCBmaWxlICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5oqK5YW25LuW5Z2X5Y+W5raI5LqG44CCXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZS5ibG9ja3MgJiYgJC5lYWNoKCBmaWxlLmJsb2NrcywgZnVuY3Rpb24oIF8sIHYgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHYudHJhbnNwb3J0ICYmICh2LnRyYW5zcG9ydC5hYm9ydCgpLCB2LnRyYW5zcG9ydC5kZXN0cm95KCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdi50cmFuc3BvcnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgZmlsZS5ibG9ja3M7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGZpbGUucmVtYW5pbmc7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3QoICdzdG9wLXVwbG9hZCcsIHRydWUgKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucnVuaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvb2wgPSBbXTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1hbmluZyA9IDA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl90cmlnZ2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9wcm9taXNlID0gbnVsbDtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQGV2ZW50IHN0YXJ0VXBsb2FkXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDlvZPlvIDlp4vkuIrkvKDmtYHnqIvml7bop6blj5HjgIJcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIOW8gOWni+S4iuS8oOOAguatpOaWueazleWPr+S7peS7juWIneWni+eKtuaAgeiwg+eUqOW8gOWni+S4iuS8oOa1geeoi++8jOS5n+WPr+S7peS7juaaguWBnOeKtuaAgeiwg+eUqO+8jOe7p+e7reS4iuS8oOa1geeoi+OAglxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiDlj6/ku6XmjIflrprlvIDlp4vmn5DkuIDkuKrmlofku7bjgIJcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgdXBsb2FkKCkgPT4gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIHVwbG9hZCggZmlsZSB8IGZpbGVJZCkgPT4gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAqIEBtZXRob2QgdXBsb2FkXHJcbiAgICAgICAgICAgICAqIEBmb3IgIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBzdGFydFVwbG9hZDogZnVuY3Rpb24oZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g56e75Ye6aW52YWxpZOeahOaWh+S7tlxyXG4gICAgICAgICAgICAgICAgJC5lYWNoKCBtZS5yZXF1ZXN0KCAnZ2V0LWZpbGVzJywgU3RhdHVzLklOVkFMSUQgKSwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUucmVxdWVzdCggJ3JlbW92ZS1maWxlJywgdGhpcyApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOWmguaenOaMh+WumuS6huW8gOWni+afkOS4quaWh+S7tu+8jOWImeWPquW8gOWni+aMh+WumueahOaWh+S7tuOAglxyXG4gICAgICAgICAgICAgICAgaWYgKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUgPSBmaWxlLmlkID8gZmlsZSA6IG1lLnJlcXVlc3QoICdnZXQtZmlsZScsIGZpbGUgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLmdldFN0YXR1cygpID09PSBTdGF0dXMuSU5URVJSVVBUKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuc2V0U3RhdHVzKCBTdGF0dXMuUVVFVUVEICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKCBtZS5wb29sLCBmdW5jdGlvbiggXywgdiApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5LmL5YmN5pqC5YGc6L+H44CCXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodi5maWxlICE9PSBmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LnRyYW5zcG9ydCAmJiB2LnRyYW5zcG9ydC5zZW5kKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnNldFN0YXR1cyggU3RhdHVzLlBST0dSRVNTICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZS5nZXRTdGF0dXMoKSAhPT0gU3RhdHVzLlBST0dSRVNTKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuc2V0U3RhdHVzKCBTdGF0dXMuUVVFVUVEICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goIG1lLnJlcXVlc3QoICdnZXQtZmlsZXMnLCBbIFN0YXR1cy5JTklURUQgXSApLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoIFN0YXR1cy5RVUVVRUQgKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCBtZS5ydW5pbmcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEJhc2UubmV4dFRpY2soIG1lLl9fdGljayApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBtZS5ydW5pbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpbGVzID0gW107XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOWmguaenOacieaaguWBnOeahO+8jOWImee7reS8oFxyXG4gICAgICAgICAgICAgICAgZmlsZSB8fCAkLmVhY2goIG1lLnBvb2wsIGZ1bmN0aW9uKCBfLCB2ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmaWxlID0gdi5maWxlO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBmaWxlLmdldFN0YXR1cygpID09PSBTdGF0dXMuSU5URVJSVVBUICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5fdHJpZ2dlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlcy5wdXNoKGZpbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2LnRyYW5zcG9ydCAmJiB2LnRyYW5zcG9ydC5zZW5kKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICQuZWFjaChmaWxlcywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0dXMoIFN0YXR1cy5QUk9HUkVTUyApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZpbGUgfHwgJC5lYWNoKCBtZS5yZXF1ZXN0KCAnZ2V0LWZpbGVzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgU3RhdHVzLklOVEVSUlVQVCApLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXR1cyggU3RhdHVzLlBST0dSRVNTICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbWUuX3RyaWdnZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIEJhc2UubmV4dFRpY2soIG1lLl9fdGljayApO1xyXG4gICAgICAgICAgICAgICAgbWUub3duZXIudHJpZ2dlcignc3RhcnRVcGxvYWQnKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQGV2ZW50IHN0b3BVcGxvYWRcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOW9k+W8gOWni+S4iuS8oOa1geeoi+aaguWBnOaXtuinpuWPkeOAglxyXG4gICAgICAgICAgICAgKiBAZm9yICBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKi9cclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5pqC5YGc5LiK5Lyg44CC56ys5LiA5Liq5Y+C5pWw5Li65piv5ZCm5Lit5pat5LiK5Lyg5b2T5YmN5q2j5Zyo5LiK5Lyg55qE5paH5Lu244CCXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIOWmguaenOesrOS4gOS4quWPguaVsOaYr+aWh+S7tu+8jOWImeWPquaaguWBnOaMh+WumuaWh+S7tuOAglxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciBzdG9wKCkgPT4gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIHN0b3AoIHRydWUgKSA9PiB1bmRlZmluZWRcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgc3RvcCggZmlsZSApID0+IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgKiBAbWV0aG9kIHN0b3BcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHN0b3BVcGxvYWQ6IGZ1bmN0aW9uKCBmaWxlLCBpbnRlcnJ1cHQgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIGJsb2NrO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsZSA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGludGVycnVwdCA9IGZpbGU7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggbWUucnVuaW5nID09PSBmYWxzZSApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOWmguaenOWPquaYr+aaguWBnOafkOS4quaWh+S7tuOAglxyXG4gICAgICAgICAgICAgICAgaWYgKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUgPSBmaWxlLmlkID8gZmlsZSA6IG1lLnJlcXVlc3QoICdnZXQtZmlsZScsIGZpbGUgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggZmlsZS5nZXRTdGF0dXMoKSAhPT0gU3RhdHVzLlBST0dSRVNTICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLmdldFN0YXR1cygpICE9PSBTdGF0dXMuUVVFVUVEICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZS5zZXRTdGF0dXMoIFN0YXR1cy5JTlRFUlJVUFQgKTtcclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKCBtZS5wb29sLCBmdW5jdGlvbiggXywgdiApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlj6ogYWJvcnQg5oyH5a6a55qE5paH5Lu244CCXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2LmZpbGUgPT09IGZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrID0gdjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgYmxvY2sudHJhbnNwb3J0ICYmIGJsb2NrLnRyYW5zcG9ydC5hYm9ydCgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGludGVycnVwdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5fcHV0YmFjayhibG9jayk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLl9wb3BCbG9jayhibG9jayk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEJhc2UubmV4dFRpY2soIG1lLl9fdGljayApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBtZS5ydW5pbmcgPSBmYWxzZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5q2j5Zyo5YeG5aSH5Lit55qE5paH5Lu244CCXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcHJvbWlzZSAmJiB0aGlzLl9wcm9taXNlLmZpbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9taXNlLmZpbGUuc2V0U3RhdHVzKCBTdGF0dXMuSU5URVJSVVBUICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGludGVycnVwdCAmJiAkLmVhY2goIG1lLnBvb2wsIGZ1bmN0aW9uKCBfLCB2ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHYudHJhbnNwb3J0ICYmIHYudHJhbnNwb3J0LmFib3J0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdi5maWxlLnNldFN0YXR1cyggU3RhdHVzLklOVEVSUlVQVCApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIG1lLm93bmVyLnRyaWdnZXIoJ3N0b3BVcGxvYWQnKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQG1ldGhvZCBjYW5jZWxGaWxlXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIGNhbmNlbEZpbGUoIGZpbGUgKSA9PiB1bmRlZmluZWRcclxuICAgICAgICAgICAgICogQGdyYW1tYXIgY2FuY2VsRmlsZSggaWQgKSA9PiB1bmRlZmluZWRcclxuICAgICAgICAgICAgICogQHBhcmFtIHtGaWxlfGlkfSBmaWxlIEZpbGXlr7nosaHmiJbov5lGaWxl5a+56LGh55qEaWRcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOagh+iusOaWh+S7tueKtuaAgeS4uuW3suWPlua2iCwg5ZCM5pe25bCG5Lit5pat5paH5Lu25Lyg6L6T44CCXHJcbiAgICAgICAgICAgICAqIEBmb3IgIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqIEBleGFtcGxlXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICRsaS5vbignY2xpY2snLCAnLnJlbW92ZS10aGlzJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAqICAgICB1cGxvYWRlci5jYW5jZWxGaWxlKCBmaWxlICk7XHJcbiAgICAgICAgICAgICAqIH0pXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBjYW5jZWxGaWxlOiBmdW5jdGlvbiggZmlsZSApIHtcclxuICAgICAgICAgICAgICAgIGZpbGUgPSBmaWxlLmlkID8gZmlsZSA6IHRoaXMucmVxdWVzdCggJ2dldC1maWxlJywgZmlsZSApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpzmraPlnKjkuIrkvKDjgIJcclxuICAgICAgICAgICAgICAgIGZpbGUuYmxvY2tzICYmICQuZWFjaCggZmlsZS5ibG9ja3MsIGZ1bmN0aW9uKCBfLCB2ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfdHIgPSB2LnRyYW5zcG9ydDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggX3RyICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdHIuYWJvcnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3RyLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHYudHJhbnNwb3J0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmaWxlLnNldFN0YXR1cyggU3RhdHVzLkNBTkNFTExFRCApO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vd25lci50cmlnZ2VyKCAnZmlsZURlcXVldWVkJywgZmlsZSApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiDliKTmlq1gVXBsYW9kZWBy5piv5ZCm5q2j5Zyo5LiK5Lyg5Lit44CCXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIGlzSW5Qcm9ncmVzcygpID0+IEJvb2xlYW5cclxuICAgICAgICAgICAgICogQG1ldGhvZCBpc0luUHJvZ3Jlc3NcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGlzSW5Qcm9ncmVzczogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gISF0aGlzLnByb2dyZXNzO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIF9nZXRTdGF0czogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdnZXQtc3RhdHMnKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog5o6J6L+H5LiA5Liq5paH5Lu25LiK5Lyg77yM55u05o6l5qCH6K6w5oyH5a6a5paH5Lu25Li65bey5LiK5Lyg54q25oCB44CCXHJcbiAgICAgICAgICAgICAqIEBncmFtbWFyIHNraXBGaWxlKCBmaWxlICkgPT4gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAqIEBtZXRob2Qgc2tpcEZpbGVcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIHNraXBGaWxlOiBmdW5jdGlvbiggZmlsZSwgc3RhdHVzICkge1xyXG4gICAgICAgICAgICAgICAgZmlsZSA9IGZpbGUuaWQgPyBmaWxlIDogdGhpcy5yZXF1ZXN0KCAnZ2V0LWZpbGUnLCBmaWxlICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZpbGUuc2V0U3RhdHVzKCBzdGF0dXMgfHwgU3RhdHVzLkNPTVBMRVRFICk7XHJcbiAgICAgICAgICAgICAgICBmaWxlLnNraXBwZWQgPSB0cnVlO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpzmraPlnKjkuIrkvKDjgIJcclxuICAgICAgICAgICAgICAgIGZpbGUuYmxvY2tzICYmICQuZWFjaCggZmlsZS5ibG9ja3MsIGZ1bmN0aW9uKCBfLCB2ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfdHIgPSB2LnRyYW5zcG9ydDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggX3RyICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdHIuYWJvcnQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3RyLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHYudHJhbnNwb3J0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLm93bmVyLnRyaWdnZXIoICd1cGxvYWRTa2lwJywgZmlsZSApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAZXZlbnQgdXBsb2FkRmluaXNoZWRcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOW9k+aJgOacieaWh+S7tuS4iuS8oOe7k+adn+aXtuinpuWPkeOAglxyXG4gICAgICAgICAgICAgKiBAZm9yICBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgX3RpY2s6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBvcHRzID0gbWUub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgICAgICBmbiwgdmFsO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDkuIrkuIDkuKpwcm9taXNl6L+Y5rKh5pyJ57uT5p2f77yM5YiZ562J5b6F5a6M5oiQ5ZCO5YaN5omn6KGM44CCXHJcbiAgICAgICAgICAgICAgICBpZiAoIG1lLl9wcm9taXNlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZS5fcHJvbWlzZS5hbHdheXMoIG1lLl9fdGljayApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDov5jmnInkvY3nva7vvIzkuJTov5jmnInmlofku7bopoHlpITnkIbnmoTor53jgIJcclxuICAgICAgICAgICAgICAgIGlmICggbWUucG9vbC5sZW5ndGggPCBvcHRzLnRocmVhZHMgJiYgKHZhbCA9IG1lLl9uZXh0QmxvY2soKSkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUuX3RyaWdnZWQgPSBmYWxzZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGZuID0gZnVuY3Rpb24oIHZhbCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWUuX3Byb21pc2UgPSBudWxsO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOacieWPr+iDveaYr3JlamVjdOi/h+adpeeahO+8jOaJgOS7peimgeajgOa1i3ZhbOeahOexu+Wei+OAglxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWwgJiYgdmFsLmZpbGUgJiYgbWUuX3N0YXJ0U2VuZCggdmFsICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEJhc2UubmV4dFRpY2soIG1lLl9fdGljayApO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBtZS5fcHJvbWlzZSA9IGlzUHJvbWlzZSggdmFsICkgPyB2YWwuYWx3YXlzKCBmbiApIDogZm4oIHZhbCApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDmsqHmnInopoHkuIrkvKDnmoTkuobvvIzkuJTmsqHmnInmraPlnKjkvKDovpPnmoTkuobjgIJcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoICFtZS5yZW1hbmluZyAmJiAhbWUuX2dldFN0YXRzKCkubnVtT2ZRdWV1ZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICFtZS5fZ2V0U3RhdHMoKS5udW1vZkludGVycnVwdCApIHtcclxuICAgICAgICAgICAgICAgICAgICBtZS5ydW5pbmcgPSBmYWxzZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIG1lLl90cmlnZ2VkIHx8IEJhc2UubmV4dFRpY2soZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLm93bmVyLnRyaWdnZXIoJ3VwbG9hZEZpbmlzaGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUuX3RyaWdnZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIF9wdXRiYWNrOiBmdW5jdGlvbihibG9jaykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGlkeDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgYmxvY2suY3V0ZWQudW5zaGlmdChibG9jayk7XHJcbiAgICAgICAgICAgICAgICBpZHggPSB0aGlzLnN0YWNrLmluZGV4T2YoYmxvY2suY3V0ZWQpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIX5pZHgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YWNrLnVuc2hpZnQoYmxvY2suY3V0ZWQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIF9nZXRTdGFjazogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaSA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgYWN0O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoIChhY3QgPSB0aGlzLnN0YWNrWyBpKysgXSkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBhY3QuaGFzKCkgJiYgYWN0LmZpbGUuZ2V0U3RhdHVzKCkgPT09IFN0YXR1cy5QUk9HUkVTUyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFjdDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFhY3QuaGFzKCkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdC5maWxlLmdldFN0YXR1cygpICE9PSBTdGF0dXMuUFJPR1JFU1MgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdC5maWxlLmdldFN0YXR1cygpICE9PSBTdGF0dXMuSU5URVJSVVBUICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOaKiuW3sue7j+WkhOeQhuWujOS6hueahO+8jOaIluiAhe+8jOeKtuaAgeS4uumdniBwcm9ncmVzc++8iOS4iuS8oOS4re+8ieOAgVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpbnRlcnVwdO+8iOaaguWBnOS4re+8iSDnmoTnp7vpmaTjgIJcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGFjay5zcGxpY2UoIC0taSwgMSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgX25leHRCbG9jazogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIG9wdHMgPSBtZS5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIGFjdCwgbmV4dCwgZG9uZSwgcHJlcGFyaW5nO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpzlvZPliY3mlofku7bov5jmnInmsqHmnInpnIDopoHkvKDovpPnmoTvvIzliJnnm7TmjqXov5Tlm57liankuIvnmoTjgIJcclxuICAgICAgICAgICAgICAgIGlmICggKGFjdCA9IHRoaXMuX2dldFN0YWNrKCkpICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5piv5ZCm5o+Q5YmN5YeG5aSH5LiL5LiA5Liq5paH5Lu2XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBvcHRzLnByZXBhcmVOZXh0RmlsZSAmJiAhbWUucGVuZGluZy5sZW5ndGggKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLl9wcmVwYXJlTmV4dEZpbGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0LnNoaWZ0KCk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOWQpuWIme+8jOWmguaenOato+WcqOi/kOihjO+8jOWImeWHhuWkh+S4i+S4gOS4quaWh+S7tu+8jOW5tuetieW+heWujOaIkOWQjui/lOWbnuS4i+S4quWIhueJh+OAglxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggbWUucnVuaW5nICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5aaC5p6c57yT5a2Y5Lit5pyJ77yM5YiZ55u05o6l5Zyo57yT5a2Y5Lit5Y+W77yM5rKh5pyJ5YiZ5Y67cXVldWXkuK3lj5bjgIJcclxuICAgICAgICAgICAgICAgICAgICBpZiAoICFtZS5wZW5kaW5nLmxlbmd0aCAmJiBtZS5fZ2V0U3RhdHMoKS5udW1PZlF1ZXVlICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5fcHJlcGFyZU5leHRGaWxlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dCA9IG1lLnBlbmRpbmcuc2hpZnQoKTtcclxuICAgICAgICAgICAgICAgICAgICBkb25lID0gZnVuY3Rpb24oIGZpbGUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIWZpbGUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdCA9IEN1dGVGaWxlKCBmaWxlLCBvcHRzLmNodW5rZWQgPyBvcHRzLmNodW5rU2l6ZSA6IDAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWUuc3RhY2sucHVzaChhY3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0LnNoaWZ0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOaWh+S7tuWPr+iDvei/mOWcqHByZXBhcmXkuK3vvIzkuZ/mnInlj6/og73lt7Lnu4/lrozlhajlh4blpIflpb3kuobjgIJcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIGlzUHJvbWlzZSggbmV4dCkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZXBhcmluZyA9IG5leHQuZmlsZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCA9IG5leHRbIG5leHQucGlwZSA/ICdwaXBlJyA6ICd0aGVuJyBdKCBkb25lICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQuZmlsZSA9IHByZXBhcmluZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5leHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRvbmUoIG5leHQgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAZXZlbnQgdXBsb2FkU3RhcnRcclxuICAgICAgICAgICAgICogQHBhcmFtIHtGaWxlfSBmaWxlIEZpbGXlr7nosaFcclxuICAgICAgICAgICAgICogQGRlc2NyaXB0aW9uIOafkOS4quaWh+S7tuW8gOWni+S4iuS8oOWJjeinpuWPke+8jOS4gOS4quaWh+S7tuWPquS8muinpuWPkeS4gOasoeOAglxyXG4gICAgICAgICAgICAgKiBAZm9yICBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgX3ByZXBhcmVOZXh0RmlsZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUgPSBtZS5yZXF1ZXN0KCdmZXRjaC1maWxlJyksXHJcbiAgICAgICAgICAgICAgICAgICAgcGVuZGluZyA9IG1lLnBlbmRpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UgPSBtZS5yZXF1ZXN0KCAnYmVmb3JlLXNlbmQtZmlsZScsIGZpbGUsIGZ1bmN0aW9uKCkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOacieWPr+iDveaWh+S7tuiiq3NraXDmjonkuobjgILmlofku7booqtza2lw5o6J5ZCO77yM54q25oCB5Z2R5a6a5LiN5pivUXVldWVkLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGZpbGUuZ2V0U3RhdHVzKCkgPT09IFN0YXR1cy5QUk9HUkVTUyB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5nZXRTdGF0dXMoKSA9PT0gU3RhdHVzLklOVEVSUlVQVCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWxlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lLl9maW5pc2hGaWxlKCBmaWxlICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBtZS5vd25lci50cmlnZ2VyKCAndXBsb2FkU3RhcnQnLCBmaWxlICk7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZS5zZXRTdGF0dXMoIFN0YXR1cy5QUk9HUkVTUyApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5maWxlID0gZmlsZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWmguaenOi/mOWcqHBlbmRpbmfkuK3vvIzliJnmm7/mjaLmiJDmlofku7bmnKzouqvjgIJcclxuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLmRvbmUoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSAkLmluQXJyYXkoIHByb21pc2UsIHBlbmRpbmcgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB+aWR4ICYmIHBlbmRpbmcuc3BsaWNlKCBpZHgsIDEsIGZpbGUgKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGJlZmVvcmUtc2VuZC1maWxl55qE6ZKp5a2Q5bCx5pyJ6ZSZ6K+v5Y+R55Sf44CCXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS5mYWlsKGZ1bmN0aW9uKCByZWFzb24gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuc2V0U3RhdHVzKCBTdGF0dXMuRVJST1IsIHJlYXNvbiApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5vd25lci50cmlnZ2VyKCAndXBsb2FkRXJyb3InLCBmaWxlLCByZWFzb24gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWUub3duZXIudHJpZ2dlciggJ3VwbG9hZENvbXBsZXRlJywgZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcGVuZGluZy5wdXNoKCBwcm9taXNlICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLy8g6K6p5Ye65L2N572u5LqG77yM5Y+v5Lul6K6p5YW25LuW5YiG54mH5byA5aeL5LiK5LygXHJcbiAgICAgICAgICAgIF9wb3BCbG9jazogZnVuY3Rpb24oIGJsb2NrICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGlkeCA9ICQuaW5BcnJheSggYmxvY2ssIHRoaXMucG9vbCApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBvb2wuc3BsaWNlKCBpZHgsIDEgKTtcclxuICAgICAgICAgICAgICAgIGJsb2NrLmZpbGUucmVtYW5pbmctLTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVtYW5pbmctLTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvLyDlvIDlp4vkuIrkvKDvvIzlj6/ku6Xooqvmjonov4fjgILlpoLmnpxwcm9taXNl6KKrcmVqZWN05LqG77yM5YiZ6KGo56S66Lez6L+H5q2k5YiG54mH44CCXHJcbiAgICAgICAgICAgIF9zdGFydFNlbmQ6IGZ1bmN0aW9uKCBibG9jayApIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZSA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZSA9IGJsb2NrLmZpbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5pyJ5Y+v6IO95ZyoIGJlZm9yZS1zZW5kLWZpbGUg55qEIHByb21pc2Ug5pyf6Ze05pS55Y+Y5LqG5paH5Lu254q25oCB44CCXHJcbiAgICAgICAgICAgICAgICAvLyDlpoLvvJrmmoLlgZzvvIzlj5bmtohcclxuICAgICAgICAgICAgICAgIC8vIOaIkeS7rOS4jeiDveS4reaWrSBwcm9taXNlLCDkvYbmmK/lj6/ku6XlnKggcHJvbWlzZSDlrozlkI7vvIzkuI3lgZrkuIrkvKDmk43kvZzjgIJcclxuICAgICAgICAgICAgICAgIGlmICggZmlsZS5nZXRTdGF0dXMoKSAhPT0gU3RhdHVzLlBST0dSRVNTICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5aaC5p6c5piv5Lit5pat77yM5YiZ6L+Y6ZyA6KaB5pS+5Zue5Y6744CCXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUuZ2V0U3RhdHVzKCkgPT09IFN0YXR1cy5JTlRFUlJVUFQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWUuX3B1dGJhY2soYmxvY2spO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbWUucG9vbC5wdXNoKCBibG9jayApO1xyXG4gICAgICAgICAgICAgICAgbWUucmVtYW5pbmcrKztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5aaC5p6c5rKh5pyJ5YiG54mH77yM5YiZ55u05o6l5L2/55So5Y6f5aeL55qE44CCXHJcbiAgICAgICAgICAgICAgICAvLyDkuI3kvJrkuKLlpLFjb250ZW50LXR5cGXkv6Hmga/jgIJcclxuICAgICAgICAgICAgICAgIGJsb2NrLmJsb2IgPSBibG9jay5jaHVua3MgPT09IDEgPyBmaWxlLnNvdXJjZSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuc291cmNlLnNsaWNlKCBibG9jay5zdGFydCwgYmxvY2suZW5kICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIGhvb2ssIOavj+S4quWIhueJh+WPkemAgeS5i+WJjeWPr+iDveimgeWBmuS6m+W8guatpeeahOS6i+aDheOAglxyXG4gICAgICAgICAgICAgICAgcHJvbWlzZSA9IG1lLnJlcXVlc3QoICdiZWZvcmUtc2VuZCcsIGJsb2NrLCBmdW5jdGlvbigpIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOacieWPr+iDveaWh+S7tuW3sue7j+S4iuS8oOWHuumUmeS6hu+8jOaJgOS7peS4jemcgOimgeWGjeS8oOi+k+S6huOAglxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggZmlsZS5nZXRTdGF0dXMoKSA9PT0gU3RhdHVzLlBST0dSRVNTICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5fZG9TZW5kKCBibG9jayApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLl9wb3BCbG9jayggYmxvY2sgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgQmFzZS5uZXh0VGljayggbWUuX190aWNrICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOWmguaenOS4umZhaWzkuobvvIzliJnot7Pov4fmraTliIbniYfjgIJcclxuICAgICAgICAgICAgICAgIHByb21pc2UuZmFpbChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIGZpbGUucmVtYW5pbmcgPT09IDEgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLl9maW5pc2hGaWxlKCBmaWxlICkuYWx3YXlzKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2sucGVyY2VudGFnZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZS5fcG9wQmxvY2soIGJsb2NrICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZS5vd25lci50cmlnZ2VyKCAndXBsb2FkQ29tcGxldGUnLCBmaWxlICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYXNlLm5leHRUaWNrKCBtZS5fX3RpY2sgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2sucGVyY2VudGFnZSA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLnVwZGF0ZUZpbGVQcm9ncmVzcyggZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5fcG9wQmxvY2soIGJsb2NrICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEJhc2UubmV4dFRpY2soIG1lLl9fdGljayApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEBldmVudCB1cGxvYWRCZWZvcmVTZW5kXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3RcclxuICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEg6buY6K6k55qE5LiK5Lyg5Y+C5pWw77yM5Y+v5Lul5omp5bGV5q2k5a+56LGh5p2l5o6n5Yi25LiK5Lyg5Y+C5pWw44CCXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBoZWFkZXJzIOWPr+S7peaJqeWxleatpOWvueixoeadpeaOp+WItuS4iuS8oOWktOmDqOOAglxyXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24g5b2T5p+Q5Liq5paH5Lu255qE5YiG5Z2X5Zyo5Y+R6YCB5YmN6Kem5Y+R77yM5Li76KaB55So5p2l6K+i6Zeu5piv5ZCm6KaB5re75Yqg6ZmE5bim5Y+C5pWw77yM5aSn5paH5Lu25Zyo5byA6LW35YiG54mH5LiK5Lyg55qE5YmN5o+Q5LiL5q2k5LqL5Lu25Y+v6IO95Lya6Kem5Y+R5aSa5qyh44CCXHJcbiAgICAgICAgICAgICAqIEBmb3IgIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAZXZlbnQgdXBsb2FkQWNjZXB0XHJcbiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3RcclxuICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHJldCDmnI3liqHnq6/nmoTov5Tlm57mlbDmja7vvIxqc29u5qC85byP77yM5aaC5p6c5pyN5Yqh56uv5LiN5pivanNvbuagvOW8j++8jOS7jnJldC5fcmF35Lit5Y+W5pWw5o2u77yM6Ieq6KGM6Kej5p6Q44CCXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDlvZPmn5DkuKrmlofku7bkuIrkvKDliLDmnI3liqHnq6/lk43lupTlkI7vvIzkvJrmtL7pgIHmraTkuovku7bmnaXor6Lpl67mnI3liqHnq6/lk43lupTmmK/lkKbmnInmlYjjgILlpoLmnpzmraTkuovku7ZoYW5kbGVy6L+U5Zue5YC85Li6YGZhbHNlYCwg5YiZ5q2k5paH5Lu25bCG5rS+6YCBYHNlcnZlcmDnsbvlnovnmoRgdXBsb2FkRXJyb3Jg5LqL5Lu244CCXHJcbiAgICAgICAgICAgICAqIEBmb3IgIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAZXZlbnQgdXBsb2FkUHJvZ3Jlc3NcclxuICAgICAgICAgICAgICogQHBhcmFtIHtGaWxlfSBmaWxlIEZpbGXlr7nosaFcclxuICAgICAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHBlcmNlbnRhZ2Ug5LiK5Lyg6L+b5bqmXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDkuIrkvKDov4fnqIvkuK3op6blj5HvvIzmkLrluKbkuIrkvKDov5vluqbjgIJcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICBcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQGV2ZW50IHVwbG9hZEVycm9yXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSB7RmlsZX0gZmlsZSBGaWxl5a+56LGhXHJcbiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSByZWFzb24g5Ye66ZSZ55qEY29kZVxyXG4gICAgICAgICAgICAgKiBAZGVzY3JpcHRpb24g5b2T5paH5Lu25LiK5Lyg5Ye66ZSZ5pe26Kem5Y+R44CCXHJcbiAgICAgICAgICAgICAqIEBmb3IgIFVwbG9hZGVyXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBAZXZlbnQgdXBsb2FkU3VjY2Vzc1xyXG4gICAgICAgICAgICAgKiBAcGFyYW0ge0ZpbGV9IGZpbGUgRmlsZeWvueixoVxyXG4gICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2Ug5pyN5Yqh56uv6L+U5Zue55qE5pWw5o2uXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDlvZPmlofku7bkuIrkvKDmiJDlip/ml7bop6blj5HjgIJcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICBcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqIEBldmVudCB1cGxvYWRDb21wbGV0ZVxyXG4gICAgICAgICAgICAgKiBAcGFyYW0ge0ZpbGV9IFtmaWxlXSBGaWxl5a+56LGhXHJcbiAgICAgICAgICAgICAqIEBkZXNjcmlwdGlvbiDkuI3nrqHmiJDlip/miJbogIXlpLHotKXvvIzmlofku7bkuIrkvKDlrozmiJDml7bop6blj5HjgIJcclxuICAgICAgICAgICAgICogQGZvciAgVXBsb2FkZXJcclxuICAgICAgICAgICAgICovXHJcbiAgICBcclxuICAgICAgICAgICAgLy8g5YGa5LiK5Lyg5pON5L2c44CCXHJcbiAgICAgICAgICAgIF9kb1NlbmQ6IGZ1bmN0aW9uKCBibG9jayApIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZSA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICAgICAgb3duZXIgPSBtZS5vd25lcixcclxuICAgICAgICAgICAgICAgICAgICBvcHRzID0gbWUub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgICAgICBmaWxlID0gYmxvY2suZmlsZSxcclxuICAgICAgICAgICAgICAgICAgICB0ciA9IG5ldyBUcmFuc3BvcnQoIG9wdHMgKSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gJC5leHRlbmQoe30sIG9wdHMuZm9ybURhdGEgKSxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzID0gJC5leHRlbmQoe30sIG9wdHMuaGVhZGVycyApLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3RBY2NlcHQsIHJldDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgYmxvY2sudHJhbnNwb3J0ID0gdHI7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHRyLm9uKCAnZGVzdHJveScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBibG9jay50cmFuc3BvcnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUuX3BvcEJsb2NrKCBibG9jayApO1xyXG4gICAgICAgICAgICAgICAgICAgIEJhc2UubmV4dFRpY2soIG1lLl9fdGljayApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOW5v+aSreS4iuS8oOi/m+W6puOAguS7peaWh+S7tuS4uuWNleS9jeOAglxyXG4gICAgICAgICAgICAgICAgdHIub24oICdwcm9ncmVzcycsIGZ1bmN0aW9uKCBwZXJjZW50YWdlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJsb2NrLnBlcmNlbnRhZ2UgPSBwZXJjZW50YWdlO1xyXG4gICAgICAgICAgICAgICAgICAgIG1lLnVwZGF0ZUZpbGVQcm9ncmVzcyggZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOeUqOadpeivoumXru+8jOaYr+WQpui/lOWbnueahOe7k+aenOaYr+aciemUmeivr+eahOOAglxyXG4gICAgICAgICAgICAgICAgcmVxdWVzdEFjY2VwdCA9IGZ1bmN0aW9uKCByZWplY3QgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZuO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0ID0gdHIuZ2V0UmVzcG9uc2VBc0pzb24oKSB8fCB7fTtcclxuICAgICAgICAgICAgICAgICAgICByZXQuX3JhdyA9IHRyLmdldFJlc3BvbnNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm4gPSBmdW5jdGlvbiggdmFsdWUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyDmnI3liqHnq6/lk43lupTkuobvvIzkuI3ku6PooajmiJDlip/kuobvvIzor6Lpl67mmK/lkKblk43lupTmraPnoa7jgIJcclxuICAgICAgICAgICAgICAgICAgICBpZiAoICFvd25lci50cmlnZ2VyKCAndXBsb2FkQWNjZXB0JywgYmxvY2ssIHJldCwgZm4gKSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0ID0gcmVqZWN0IHx8ICdzZXJ2ZXInO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWplY3Q7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDlsJ3or5Xph43or5XvvIznhLblkI7lub/mkq3mlofku7bkuIrkvKDlh7rplJnjgIJcclxuICAgICAgICAgICAgICAgIHRyLm9uKCAnZXJyb3InLCBmdW5jdGlvbiggdHlwZSwgZmxhZyApIHtcclxuICAgICAgICAgICAgICAgICAgICBibG9jay5yZXRyaWVkID0gYmxvY2sucmV0cmllZCB8fCAwO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g6Ieq5Yqo6YeN6K+VXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBibG9jay5jaHVua3MgPiAxICYmIH4naHR0cCxhYm9ydCcuaW5kZXhPZiggdHlwZSApICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jay5yZXRyaWVkIDwgb3B0cy5jaHVua1JldHJ5ICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrLnJldHJpZWQrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHIuc2VuZCgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBodHRwIHN0YXR1cyA1MDAgfiA2MDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhZmxhZyAmJiB0eXBlID09PSAnc2VydmVyJyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSByZXF1ZXN0QWNjZXB0KCB0eXBlICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnNldFN0YXR1cyggU3RhdHVzLkVSUk9SLCB0eXBlICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyLnRyaWdnZXIoICd1cGxvYWRFcnJvcicsIGZpbGUsIHR5cGUgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3duZXIudHJpZ2dlciggJ3VwbG9hZENvbXBsZXRlJywgZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDkuIrkvKDmiJDlip9cclxuICAgICAgICAgICAgICAgIHRyLm9uKCAnbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZWFzb247XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzpnZ7pooTmnJ/vvIzovazlkJHkuIrkvKDlh7rplJnjgIJcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIChyZWFzb24gPSByZXF1ZXN0QWNjZXB0KCkpICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ci50cmlnZ2VyKCAnZXJyb3InLCByZWFzb24sIHRydWUgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOWFqOmDqOS4iuS8oOWujOaIkOOAglxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggZmlsZS5yZW1hbmluZyA9PT0gMSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWUuX2ZpbmlzaEZpbGUoIGZpbGUsIHJldCApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g6YWN572u6buY6K6k55qE5LiK5Lyg5a2X5q6144CCXHJcbiAgICAgICAgICAgICAgICBkYXRhID0gJC5leHRlbmQoIGRhdGEsIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogZmlsZS5pZCxcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBmaWxlLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogZmlsZS50eXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZERhdGU6IGZpbGUubGFzdE1vZGlmaWVkRGF0ZSxcclxuICAgICAgICAgICAgICAgICAgICBzaXplOiBmaWxlLnNpemVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBibG9jay5jaHVua3MgPiAxICYmICQuZXh0ZW5kKCBkYXRhLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtzOiBibG9jay5jaHVua3MsXHJcbiAgICAgICAgICAgICAgICAgICAgY2h1bms6IGJsb2NrLmNodW5rXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5Zyo5Y+R6YCB5LmL6Ze05Y+v5Lul5re75Yqg5a2X5q615LuA5LmI55qE44CC44CC44CCXHJcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpzpu5jorqTnmoTlrZfmrrXkuI3lpJ/kvb/nlKjvvIzlj6/ku6XpgJrov4fnm5HlkKzmraTkuovku7bmnaXmianlsZVcclxuICAgICAgICAgICAgICAgIG93bmVyLnRyaWdnZXIoICd1cGxvYWRCZWZvcmVTZW5kJywgYmxvY2ssIGRhdGEsIGhlYWRlcnMgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5byA5aeL5Y+R6YCB44CCXHJcbiAgICAgICAgICAgICAgICB0ci5hcHBlbmRCbG9iKCBvcHRzLmZpbGVWYWwsIGJsb2NrLmJsb2IsIGZpbGUubmFtZSApO1xyXG4gICAgICAgICAgICAgICAgdHIuYXBwZW5kKCBkYXRhICk7XHJcbiAgICAgICAgICAgICAgICB0ci5zZXRSZXF1ZXN0SGVhZGVyKCBoZWFkZXJzICk7XHJcbiAgICAgICAgICAgICAgICB0ci5zZW5kKCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLy8g5a6M5oiQ5LiK5Lyg44CCXHJcbiAgICAgICAgICAgIF9maW5pc2hGaWxlOiBmdW5jdGlvbiggZmlsZSwgcmV0LCBoZHMgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3duZXIgPSB0aGlzLm93bmVyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3duZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlcXVlc3QoICdhZnRlci1zZW5kLWZpbGUnLCBhcmd1bWVudHMsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5zZXRTdGF0dXMoIFN0YXR1cy5DT01QTEVURSApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3duZXIudHJpZ2dlciggJ3VwbG9hZFN1Y2Nlc3MnLCBmaWxlLCByZXQsIGhkcyApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmFpbChmdW5jdGlvbiggcmVhc29uICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzlpJbpg6jlt7Lnu4/moIforrDkuLppbnZhbGlk5LuA5LmI55qE77yM5LiN5YaN5pS554q25oCB44CCXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGZpbGUuZ2V0U3RhdHVzKCkgPT09IFN0YXR1cy5QUk9HUkVTUyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnNldFN0YXR1cyggU3RhdHVzLkVSUk9SLCByZWFzb24gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3duZXIudHJpZ2dlciggJ3VwbG9hZEVycm9yJywgZmlsZSwgcmVhc29uICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hbHdheXMoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvd25lci50cmlnZ2VyKCAndXBsb2FkQ29tcGxldGUnLCBmaWxlICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIHVwZGF0ZUZpbGVQcm9ncmVzczogZnVuY3Rpb24oZmlsZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRvdGFsUGVyY2VudCA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkZWQgPSAwO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIWZpbGUuYmxvY2tzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAkLmVhY2goIGZpbGUuYmxvY2tzLCBmdW5jdGlvbiggXywgdiApIHtcclxuICAgICAgICAgICAgICAgICAgICB1cGxvYWRlZCArPSAodi5wZXJjZW50YWdlIHx8IDApICogKHYuZW5kIC0gdi5zdGFydCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgdG90YWxQZXJjZW50ID0gdXBsb2FkZWQgLyBmaWxlLnNpemU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm93bmVyLnRyaWdnZXIoICd1cGxvYWRQcm9ncmVzcycsIGZpbGUsIHRvdGFsUGVyY2VudCB8fCAwICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICogQGZpbGVPdmVydmlldyDlkITnp43pqozor4HvvIzljIXmi6zmlofku7bmgLvlpKflsI/mmK/lkKbotoXlh7rjgIHljZXmlofku7bmmK/lkKbotoXlh7rlkozmlofku7bmmK/lkKbph43lpI3jgIJcclxuICAgICAqL1xyXG4gICAgXHJcbiAgICBkZWZpbmUoJ3dpZGdldHMvdmFsaWRhdG9yJyxbXHJcbiAgICAgICAgJ2Jhc2UnLFxyXG4gICAgICAgICd1cGxvYWRlcicsXHJcbiAgICAgICAgJ2ZpbGUnLFxyXG4gICAgICAgICd3aWRnZXRzL3dpZGdldCdcclxuICAgIF0sIGZ1bmN0aW9uKCBCYXNlLCBVcGxvYWRlciwgV1VGaWxlICkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQsXHJcbiAgICAgICAgICAgIHZhbGlkYXRvcnMgPSB7fSxcclxuICAgICAgICAgICAgYXBpO1xyXG4gICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQGV2ZW50IGVycm9yXHJcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUg6ZSZ6K+v57G75Z6L44CCXHJcbiAgICAgICAgICogQGRlc2NyaXB0aW9uIOW9k3ZhbGlkYXRl5LiN6YCa6L+H5pe277yM5Lya5Lul5rS+6YCB6ZSZ6K+v5LqL5Lu255qE5b2i5byP6YCa55+l6LCD55So6ICF44CC6YCa6L+HYHVwbG9hZC5vbignZXJyb3InLCBoYW5kbGVyKWDlj6/ku6XmjZXojrfliLDmraTnsbvplJnor6/vvIznm67liY3mnInku6XkuIvplJnor6/kvJrlnKjnibnlrprnmoTmg4XlhrXkuIvmtL7pgIHplJnmnaXjgIJcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqICogYFFfRVhDRUVEX05VTV9MSU1JVGAg5Zyo6K6+572u5LqGYGZpbGVOdW1MaW1pdGDkuJTlsJ3or5Xnu5lgdXBsb2FkZXJg5re75Yqg55qE5paH5Lu25pWw6YeP6LaF5Ye66L+Z5Liq5YC85pe25rS+6YCB44CCXHJcbiAgICAgICAgICogKiBgUV9FWENFRURfU0laRV9MSU1JVGAg5Zyo6K6+572u5LqGYFFfRVhDRUVEX1NJWkVfTElNSVRg5LiU5bCd6K+V57uZYHVwbG9hZGVyYOa3u+WKoOeahOaWh+S7tuaAu+Wkp+Wwj+i2heWHuui/meS4quWAvOaXtua0vumAgeOAglxyXG4gICAgICAgICAqICogYFFfVFlQRV9ERU5JRURgIOW9k+aWh+S7tuexu+Wei+S4jea7oei2s+aXtuinpuWPkeOAguOAglxyXG4gICAgICAgICAqIEBmb3IgIFVwbG9hZGVyXHJcbiAgICAgICAgICovXHJcbiAgICBcclxuICAgICAgICAvLyDmmrTpnLLnu5nlpJbpnaLnmoRhcGlcclxuICAgICAgICBhcGkgPSB7XHJcbiAgICBcclxuICAgICAgICAgICAgLy8g5re75Yqg6aqM6K+B5ZmoXHJcbiAgICAgICAgICAgIGFkZFZhbGlkYXRvcjogZnVuY3Rpb24oIHR5cGUsIGNiICkge1xyXG4gICAgICAgICAgICAgICAgdmFsaWRhdG9yc1sgdHlwZSBdID0gY2I7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLy8g56e76Zmk6aqM6K+B5ZmoXHJcbiAgICAgICAgICAgIHJlbW92ZVZhbGlkYXRvcjogZnVuY3Rpb24oIHR5cGUgKSB7XHJcbiAgICAgICAgICAgICAgICBkZWxldGUgdmFsaWRhdG9yc1sgdHlwZSBdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIC8vIOWcqFVwbG9hZGVy5Yid5aeL5YyW55qE5pe25YCZ5ZCv5YqoVmFsaWRhdG9yc+eahOWIneWni+WMllxyXG4gICAgICAgIFVwbG9hZGVyLnJlZ2lzdGVyKHtcclxuICAgICAgICAgICAgbmFtZTogJ3ZhbGlkYXRvcicsXHJcbiAgICBcclxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzO1xyXG4gICAgICAgICAgICAgICAgQmFzZS5uZXh0VGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goIHZhbGlkYXRvcnMsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGwoIG1lLm93bmVyICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQHByb3BlcnR5IHtpbnR9IFtmaWxlTnVtTGltaXQ9dW5kZWZpbmVkXVxyXG4gICAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9uc1xyXG4gICAgICAgICAqIEBmb3IgVXBsb2FkZXJcclxuICAgICAgICAgKiBAZGVzY3JpcHRpb24g6aqM6K+B5paH5Lu25oC75pWw6YePLCDotoXlh7rliJnkuI3lhYHorrjliqDlhaXpmJ/liJfjgIJcclxuICAgICAgICAgKi9cclxuICAgICAgICBhcGkuYWRkVmFsaWRhdG9yKCAnZmlsZU51bUxpbWl0JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciB1cGxvYWRlciA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBvcHRzID0gdXBsb2FkZXIub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgIGNvdW50ID0gMCxcclxuICAgICAgICAgICAgICAgIG1heCA9IHBhcnNlSW50KCBvcHRzLmZpbGVOdW1MaW1pdCwgMTAgKSxcclxuICAgICAgICAgICAgICAgIGZsYWcgPSB0cnVlO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGlmICggIW1heCApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIHVwbG9hZGVyLm9uKCAnYmVmb3JlRmlsZVF1ZXVlZCcsIGZ1bmN0aW9uKCBmaWxlICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIGNvdW50ID49IG1heCAmJiBmbGFnICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoICdlcnJvcicsICdRX0VYQ0VFRF9OVU1fTElNSVQnLCBtYXgsIGZpbGUgKTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9LCAxICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb3VudCA+PSBtYXggPyBmYWxzZSA6IHRydWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHVwbG9hZGVyLm9uKCAnZmlsZVF1ZXVlZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgY291bnQrKztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgdXBsb2FkZXIub24oICdmaWxlRGVxdWV1ZWQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGNvdW50LS07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHVwbG9hZGVyLm9uKCAncmVzZXQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGNvdW50ID0gMDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBwcm9wZXJ0eSB7aW50fSBbZmlsZVNpemVMaW1pdD11bmRlZmluZWRdXHJcbiAgICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zXHJcbiAgICAgICAgICogQGZvciBVcGxvYWRlclxyXG4gICAgICAgICAqIEBkZXNjcmlwdGlvbiDpqozor4Hmlofku7bmgLvlpKflsI/mmK/lkKbotoXlh7rpmZDliLYsIOi2heWHuuWImeS4jeWFgeiuuOWKoOWFpemYn+WIl+OAglxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGFwaS5hZGRWYWxpZGF0b3IoICdmaWxlU2l6ZUxpbWl0JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciB1cGxvYWRlciA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICBvcHRzID0gdXBsb2FkZXIub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgIGNvdW50ID0gMCxcclxuICAgICAgICAgICAgICAgIG1heCA9IHBhcnNlSW50KCBvcHRzLmZpbGVTaXplTGltaXQsIDEwICksXHJcbiAgICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgIFxyXG4gICAgICAgICAgICBpZiAoICFtYXggKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICB1cGxvYWRlci5vbiggJ2JlZm9yZUZpbGVRdWV1ZWQnLCBmdW5jdGlvbiggZmlsZSApIHtcclxuICAgICAgICAgICAgICAgIHZhciBpbnZhbGlkID0gY291bnQgKyBmaWxlLnNpemUgPiBtYXg7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggaW52YWxpZCAmJiBmbGFnICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZsYWcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoICdlcnJvcicsICdRX0VYQ0VFRF9TSVpFX0xJTUlUJywgbWF4LCBmaWxlICk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmxhZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgMSApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW52YWxpZCA/IGZhbHNlIDogdHJ1ZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgdXBsb2FkZXIub24oICdmaWxlUXVldWVkJywgZnVuY3Rpb24oIGZpbGUgKSB7XHJcbiAgICAgICAgICAgICAgICBjb3VudCArPSBmaWxlLnNpemU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHVwbG9hZGVyLm9uKCAnZmlsZURlcXVldWVkJywgZnVuY3Rpb24oIGZpbGUgKSB7XHJcbiAgICAgICAgICAgICAgICBjb3VudCAtPSBmaWxlLnNpemU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHVwbG9hZGVyLm9uKCAncmVzZXQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGNvdW50ID0gMDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBAcHJvcGVydHkge2ludH0gW2ZpbGVTaW5nbGVTaXplTGltaXQ9dW5kZWZpbmVkXVxyXG4gICAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9uc1xyXG4gICAgICAgICAqIEBmb3IgVXBsb2FkZXJcclxuICAgICAgICAgKiBAZGVzY3JpcHRpb24g6aqM6K+B5Y2V5Liq5paH5Lu25aSn5bCP5piv5ZCm6LaF5Ye66ZmQ5Yi2LCDotoXlh7rliJnkuI3lhYHorrjliqDlhaXpmJ/liJfjgIJcclxuICAgICAgICAgKi9cclxuICAgICAgICBhcGkuYWRkVmFsaWRhdG9yKCAnZmlsZVNpbmdsZVNpemVMaW1pdCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgdXBsb2FkZXIgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgb3B0cyA9IHVwbG9hZGVyLm9wdGlvbnMsXHJcbiAgICAgICAgICAgICAgICBtYXggPSBvcHRzLmZpbGVTaW5nbGVTaXplTGltaXQ7XHJcbiAgICBcclxuICAgICAgICAgICAgaWYgKCAhbWF4ICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgdXBsb2FkZXIub24oICdiZWZvcmVGaWxlUXVldWVkJywgZnVuY3Rpb24oIGZpbGUgKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggZmlsZS5zaXplID4gbWF4ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbGUuc2V0U3RhdHVzKCBXVUZpbGUuU3RhdHVzLklOVkFMSUQsICdleGNlZWRfc2l6ZScgKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoICdlcnJvcicsICdGX0VYQ0VFRF9TSVpFJywgbWF4LCBmaWxlICk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtkdXBsaWNhdGU9dW5kZWZpbmVkXVxyXG4gICAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9uc1xyXG4gICAgICAgICAqIEBmb3IgVXBsb2FkZXJcclxuICAgICAgICAgKiBAZGVzY3JpcHRpb24g5Y676YeN77yMIOagueaNruaWh+S7tuWQjeWtl+OAgeaWh+S7tuWkp+Wwj+WSjOacgOWQjuS/ruaUueaXtumXtOadpeeUn+aIkGhhc2ggS2V5LlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIGFwaS5hZGRWYWxpZGF0b3IoICdkdXBsaWNhdGUnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIHVwbG9hZGVyID0gdGhpcyxcclxuICAgICAgICAgICAgICAgIG9wdHMgPSB1cGxvYWRlci5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgbWFwcGluZyA9IHt9O1xyXG4gICAgXHJcbiAgICAgICAgICAgIGlmICggb3B0cy5kdXBsaWNhdGUgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICBmdW5jdGlvbiBoYXNoU3RyaW5nKCBzdHIgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGFzaCA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgaSA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgbGVuID0gc3RyLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgICAgICBfY2hhcjtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZm9yICggOyBpIDwgbGVuOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2NoYXIgPSBzdHIuY2hhckNvZGVBdCggaSApO1xyXG4gICAgICAgICAgICAgICAgICAgIGhhc2ggPSBfY2hhciArIChoYXNoIDw8IDYpICsgKGhhc2ggPDwgMTYpIC0gaGFzaDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhc2g7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICB1cGxvYWRlci5vbiggJ2JlZm9yZUZpbGVRdWV1ZWQnLCBmdW5jdGlvbiggZmlsZSApIHtcclxuICAgICAgICAgICAgICAgIHZhciBoYXNoID0gZmlsZS5fX2hhc2ggfHwgKGZpbGUuX19oYXNoID0gaGFzaFN0cmluZyggZmlsZS5uYW1lICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5zaXplICsgZmlsZS5sYXN0TW9kaWZpZWREYXRlICkpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDlt7Lnu4/ph43lpI3kuoZcclxuICAgICAgICAgICAgICAgIGlmICggbWFwcGluZ1sgaGFzaCBdICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlciggJ2Vycm9yJywgJ0ZfRFVQTElDQVRFJywgZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgdXBsb2FkZXIub24oICdmaWxlUXVldWVkJywgZnVuY3Rpb24oIGZpbGUgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGFzaCA9IGZpbGUuX19oYXNoO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBoYXNoICYmIChtYXBwaW5nWyBoYXNoIF0gPSB0cnVlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgdXBsb2FkZXIub24oICdmaWxlRGVxdWV1ZWQnLCBmdW5jdGlvbiggZmlsZSApIHtcclxuICAgICAgICAgICAgICAgIHZhciBoYXNoID0gZmlsZS5fX2hhc2g7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGhhc2ggJiYgKGRlbGV0ZSBtYXBwaW5nWyBoYXNoIF0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICB1cGxvYWRlci5vbiggJ3Jlc2V0JywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBtYXBwaW5nID0ge307XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIGFwaTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcgTWQ1XHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgnbGliL21kNScsW1xyXG4gICAgICAgICdydW50aW1lL2NsaWVudCcsXHJcbiAgICAgICAgJ21lZGlhdG9yJ1xyXG4gICAgXSwgZnVuY3Rpb24oIFJ1bnRpbWVDbGllbnQsIE1lZGlhdG9yICkge1xyXG4gICAgXHJcbiAgICAgICAgZnVuY3Rpb24gTWQ1KCkge1xyXG4gICAgICAgICAgICBSdW50aW1lQ2xpZW50LmNhbGwoIHRoaXMsICdNZDUnICk7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgLy8g6K6pIE1kNSDlhbflpIfkuovku7blip/og73jgIJcclxuICAgICAgICBNZWRpYXRvci5pbnN0YWxsVG8oIE1kNS5wcm90b3R5cGUgKTtcclxuICAgIFxyXG4gICAgICAgIE1kNS5wcm90b3R5cGUubG9hZEZyb21CbG9iID0gZnVuY3Rpb24oIGJsb2IgKSB7XHJcbiAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7XHJcbiAgICBcclxuICAgICAgICAgICAgaWYgKCBtZS5nZXRSdWlkKCkgKSB7XHJcbiAgICAgICAgICAgICAgICBtZS5kaXNjb25uZWN0UnVudGltZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgLy8g6L+e5o6l5YiwYmxvYuW9kuWxnueahOWQjOS4gOS4qnJ1bnRpbWUuXHJcbiAgICAgICAgICAgIG1lLmNvbm5lY3RSdW50aW1lKCBibG9iLnJ1aWQsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgbWUuZXhlYygnaW5pdCcpO1xyXG4gICAgICAgICAgICAgICAgbWUuZXhlYyggJ2xvYWRGcm9tQmxvYicsIGJsb2IgKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIE1kNS5wcm90b3R5cGUuZ2V0UmVzdWx0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmV4ZWMoJ2dldFJlc3VsdCcpO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gTWQ1O1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcg5Zu+54mH5pON5L2cLCDotJ/otKPpooTop4jlm77niYflkozkuIrkvKDliY3ljovnvKnlm77niYdcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCd3aWRnZXRzL21kNScsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAndXBsb2FkZXInLFxyXG4gICAgICAgICdsaWIvbWQ1JyxcclxuICAgICAgICAnbGliL2Jsb2InLFxyXG4gICAgICAgICd3aWRnZXRzL3dpZGdldCdcclxuICAgIF0sIGZ1bmN0aW9uKCBCYXNlLCBVcGxvYWRlciwgTWQ1LCBCbG9iICkge1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIFVwbG9hZGVyLnJlZ2lzdGVyKHtcclxuICAgICAgICAgICAgbmFtZTogJ21kNScsXHJcbiAgICBcclxuICAgIFxyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICog6K6h566X5paH5Lu2IG1kNSDlgLzvvIzov5Tlm57kuIDkuKogcHJvbWlzZSDlr7nosaHvvIzlj6/ku6Xnm5HlkKwgcHJvZ3Jlc3Mg6L+b5bqm44CCXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqIEBtZXRob2QgbWQ1RmlsZVxyXG4gICAgICAgICAgICAgKiBAZ3JhbW1hciBtZDVGaWxlKCBmaWxlWywgc3RhcnRbLCBlbmRdXSApID0+IHByb21pc2VcclxuICAgICAgICAgICAgICogQGZvciBVcGxvYWRlclxyXG4gICAgICAgICAgICAgKiBAZXhhbXBsZVxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiB1cGxvYWRlci5vbiggJ2ZpbGVRdWV1ZWQnLCBmdW5jdGlvbiggZmlsZSApIHtcclxuICAgICAgICAgICAgICogICAgIHZhciAkbGkgPSAuLi47XHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICAgICB1cGxvYWRlci5tZDVGaWxlKCBmaWxlIClcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogICAgICAgICAvLyDlj4rml7bmmL7npLrov5vluqZcclxuICAgICAgICAgICAgICogICAgICAgICAucHJvZ3Jlc3MoZnVuY3Rpb24ocGVyY2VudGFnZSkge1xyXG4gICAgICAgICAgICAgKiAgICAgICAgICAgICBjb25zb2xlLmxvZygnUGVyY2VudGFnZTonLCBwZXJjZW50YWdlKTtcclxuICAgICAgICAgICAgICogICAgICAgICB9KVxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAgICAgICAgIC8vIOWujOaIkFxyXG4gICAgICAgICAgICAgKiAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHZhbCkge1xyXG4gICAgICAgICAgICAgKiAgICAgICAgICAgICBjb25zb2xlLmxvZygnbWQ1IHJlc3VsdDonLCB2YWwpO1xyXG4gICAgICAgICAgICAgKiAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiB9KTtcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIG1kNUZpbGU6IGZ1bmN0aW9uKCBmaWxlLCBzdGFydCwgZW5kICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1kNSA9IG5ldyBNZDUoKSxcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZCA9IEJhc2UuRGVmZXJyZWQoKSxcclxuICAgICAgICAgICAgICAgICAgICBibG9iID0gKGZpbGUgaW5zdGFuY2VvZiBCbG9iKSA/IGZpbGUgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlcXVlc3QoICdnZXQtZmlsZScsIGZpbGUgKS5zb3VyY2U7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIG1kNS5vbiggJ3Byb2dyZXNzIGxvYWQnLCBmdW5jdGlvbiggZSApIHtcclxuICAgICAgICAgICAgICAgICAgICBlID0gZSB8fCB7fTtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5ub3RpZnkoIGUudG90YWwgPyBlLmxvYWRlZCAvIGUudG90YWwgOiAxICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbWQ1Lm9uKCAnY29tcGxldGUnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCBtZDUuZ2V0UmVzdWx0KCkgKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBtZDUub24oICdlcnJvcicsIGZ1bmN0aW9uKCByZWFzb24gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCByZWFzb24gKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAxICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gc3RhcnQgfHwgMDtcclxuICAgICAgICAgICAgICAgICAgICBlbmQgPSBlbmQgfHwgMDtcclxuICAgICAgICAgICAgICAgICAgICBzdGFydCA8IDAgJiYgKHN0YXJ0ID0gYmxvYi5zaXplICsgc3RhcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVuZCA8IDAgJiYgKGVuZCA9IGJsb2Iuc2l6ZSArIGVuZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZW5kID0gTWF0aC5taW4oIGVuZCwgYmxvYi5zaXplICk7XHJcbiAgICAgICAgICAgICAgICAgICAgYmxvYiA9IGJsb2Iuc2xpY2UoIHN0YXJ0LCBlbmQgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbWQ1LmxvYWRGcm9tQmxvYiggYmxvYiApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogQGZpbGVPdmVydmlldyBSdW50aW1l566h55CG5Zmo77yM6LSf6LSjUnVudGltZeeahOmAieaLqSwg6L+e5o6lXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgncnVudGltZS9jb21wYmFzZScsW10sZnVuY3Rpb24oKSB7XHJcbiAgICBcclxuICAgICAgICBmdW5jdGlvbiBDb21wQmFzZSggb3duZXIsIHJ1bnRpbWUgKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgdGhpcy5vd25lciA9IG93bmVyO1xyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBvd25lci5vcHRpb25zO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0UnVudGltZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJ1bnRpbWU7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAgICAgdGhpcy5nZXRSdWlkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcnVudGltZS51aWQ7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gb3duZXIudHJpZ2dlci5hcHBseSggb3duZXIsIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIHJldHVybiBDb21wQmFzZTtcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IEh0bWw1UnVudGltZVxyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ3J1bnRpbWUvaHRtbDUvcnVudGltZScsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAncnVudGltZS9ydW50aW1lJyxcclxuICAgICAgICAncnVudGltZS9jb21wYmFzZSdcclxuICAgIF0sIGZ1bmN0aW9uKCBCYXNlLCBSdW50aW1lLCBDb21wQmFzZSApIHtcclxuICAgIFxyXG4gICAgICAgIHZhciB0eXBlID0gJ2h0bWw1JyxcclxuICAgICAgICAgICAgY29tcG9uZW50cyA9IHt9O1xyXG4gICAgXHJcbiAgICAgICAgZnVuY3Rpb24gSHRtbDVSdW50aW1lKCkge1xyXG4gICAgICAgICAgICB2YXIgcG9vbCA9IHt9LFxyXG4gICAgICAgICAgICAgICAgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgZGVzdHJveSA9IHRoaXMuZGVzdHJveTtcclxuICAgIFxyXG4gICAgICAgICAgICBSdW50aW1lLmFwcGx5KCBtZSwgYXJndW1lbnRzICk7XHJcbiAgICAgICAgICAgIG1lLnR5cGUgPSB0eXBlO1xyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAgICAgLy8g6L+Z5Liq5pa55rOV55qE6LCD55So6ICF77yM5a6e6ZmF5LiK5pivUnVudGltZUNsaWVudFxyXG4gICAgICAgICAgICBtZS5leGVjID0gZnVuY3Rpb24oIGNvbXAsIGZuLyosIGFyZ3MuLi4qLykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNsaWVudCA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICAgICAgdWlkID0gY2xpZW50LnVpZCxcclxuICAgICAgICAgICAgICAgICAgICBhcmdzID0gQmFzZS5zbGljZSggYXJndW1lbnRzLCAyICksXHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2U7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggY29tcG9uZW50c1sgY29tcCBdICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlID0gcG9vbFsgdWlkIF0gPSBwb29sWyB1aWQgXSB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IGNvbXBvbmVudHNbIGNvbXAgXSggY2xpZW50LCBtZSApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBpbnN0YW5jZVsgZm4gXSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlWyBmbiBdLmFwcGx5KCBpbnN0YW5jZSwgYXJncyApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICBtZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBAdG9kbyDliKDpmaTmsaDlrZDkuK3nmoTmiYDmnInlrp7kvotcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZXN0cm95ICYmIGRlc3Ryb3kuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIEJhc2UuaW5oZXJpdHMoIFJ1bnRpbWUsIHtcclxuICAgICAgICAgICAgY29uc3RydWN0b3I6IEh0bWw1UnVudGltZSxcclxuICAgIFxyXG4gICAgICAgICAgICAvLyDkuI3pnIDopoHov57mjqXlhbbku5bnqIvluo/vvIznm7TmjqXmiafooYxjYWxsYmFja1xyXG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtZSA9IHRoaXM7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lLnRyaWdnZXIoJ3JlYWR5Jyk7XHJcbiAgICAgICAgICAgICAgICB9LCAxICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgLy8g5rOo5YaMQ29tcG9uZW50c1xyXG4gICAgICAgIEh0bWw1UnVudGltZS5yZWdpc3RlciA9IGZ1bmN0aW9uKCBuYW1lLCBjb21wb25lbnQgKSB7XHJcbiAgICAgICAgICAgIHZhciBrbGFzcyA9IGNvbXBvbmVudHNbIG5hbWUgXSA9IEJhc2UuaW5oZXJpdHMoIENvbXBCYXNlLCBjb21wb25lbnQgKTtcclxuICAgICAgICAgICAgcmV0dXJuIGtsYXNzO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAvLyDms6jlhoxodG1sNei/kOihjOaXtuOAglxyXG4gICAgICAgIC8vIOWPquacieWcqOaUr+aMgeeahOWJjeaPkOS4i+azqOWGjOOAglxyXG4gICAgICAgIGlmICggd2luZG93LkJsb2IgJiYgd2luZG93LkZpbGVSZWFkZXIgJiYgd2luZG93LkRhdGFWaWV3ICkge1xyXG4gICAgICAgICAgICBSdW50aW1lLmFkZFJ1bnRpbWUoIHR5cGUsIEh0bWw1UnVudGltZSApO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIHJldHVybiBIdG1sNVJ1bnRpbWU7XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogQGZpbGVPdmVydmlldyBCbG9iIEh0bWzlrp7njrBcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdydW50aW1lL2h0bWw1L2Jsb2InLFtcclxuICAgICAgICAncnVudGltZS9odG1sNS9ydW50aW1lJyxcclxuICAgICAgICAnbGliL2Jsb2InXHJcbiAgICBdLCBmdW5jdGlvbiggSHRtbDVSdW50aW1lLCBCbG9iICkge1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIEh0bWw1UnVudGltZS5yZWdpc3RlciggJ0Jsb2InLCB7XHJcbiAgICAgICAgICAgIHNsaWNlOiBmdW5jdGlvbiggc3RhcnQsIGVuZCApIHtcclxuICAgICAgICAgICAgICAgIHZhciBibG9iID0gdGhpcy5vd25lci5zb3VyY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgc2xpY2UgPSBibG9iLnNsaWNlIHx8IGJsb2Iud2Via2l0U2xpY2UgfHwgYmxvYi5tb3pTbGljZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgYmxvYiA9IHNsaWNlLmNhbGwoIGJsb2IsIHN0YXJ0LCBlbmQgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCbG9iKCB0aGlzLmdldFJ1aWQoKSwgYmxvYiApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogQGZpbGVPdmVydmlldyBGaWxlUGFzdGVcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdydW50aW1lL2h0bWw1L2RuZCcsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAncnVudGltZS9odG1sNS9ydW50aW1lJyxcclxuICAgICAgICAnbGliL2ZpbGUnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgSHRtbDVSdW50aW1lLCBGaWxlICkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQsXHJcbiAgICAgICAgICAgIHByZWZpeCA9ICd3ZWJ1cGxvYWRlci1kbmQtJztcclxuICAgIFxyXG4gICAgICAgIHJldHVybiBIdG1sNVJ1bnRpbWUucmVnaXN0ZXIoICdEcmFnQW5kRHJvcCcsIHtcclxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IHRoaXMuZWxlbSA9IHRoaXMub3B0aW9ucy5jb250YWluZXI7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ0VudGVySGFuZGxlciA9IEJhc2UuYmluZEZuKCB0aGlzLl9kcmFnRW50ZXJIYW5kbGVyLCB0aGlzICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdPdmVySGFuZGxlciA9IEJhc2UuYmluZEZuKCB0aGlzLl9kcmFnT3ZlckhhbmRsZXIsIHRoaXMgKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ0xlYXZlSGFuZGxlciA9IEJhc2UuYmluZEZuKCB0aGlzLl9kcmFnTGVhdmVIYW5kbGVyLCB0aGlzICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyb3BIYW5kbGVyID0gQmFzZS5iaW5kRm4oIHRoaXMuX2Ryb3BIYW5kbGVyLCB0aGlzICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRuZE92ZXIgPSBmYWxzZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZWxlbS5vbiggJ2RyYWdlbnRlcicsIHRoaXMuZHJhZ0VudGVySGFuZGxlciApO1xyXG4gICAgICAgICAgICAgICAgZWxlbS5vbiggJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3ZlckhhbmRsZXIgKTtcclxuICAgICAgICAgICAgICAgIGVsZW0ub24oICdkcmFnbGVhdmUnLCB0aGlzLmRyYWdMZWF2ZUhhbmRsZXIgKTtcclxuICAgICAgICAgICAgICAgIGVsZW0ub24oICdkcm9wJywgdGhpcy5kcm9wSGFuZGxlciApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIHRoaXMub3B0aW9ucy5kaXNhYmxlR2xvYmFsRG5kICkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoIGRvY3VtZW50ICkub24oICdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXJIYW5kbGVyICk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCggZG9jdW1lbnQgKS5vbiggJ2Ryb3AnLCB0aGlzLmRyb3BIYW5kbGVyICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgX2RyYWdFbnRlckhhbmRsZXI6IGZ1bmN0aW9uKCBlICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBkZW5pZWQgPSBtZS5fZGVuaWVkIHx8IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBlID0gZS5vcmlnaW5hbEV2ZW50IHx8IGU7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggIW1lLmRuZE92ZXIgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUuZG5kT3ZlciA9IHRydWU7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyDms6jmhI/lj6rmnIkgY2hyb21lIOaUr+aMgeOAglxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zID0gZS5kYXRhVHJhbnNmZXIuaXRlbXM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIGl0ZW1zICYmIGl0ZW1zLmxlbmd0aCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWUuX2RlbmllZCA9IGRlbmllZCA9ICFtZS50cmlnZ2VyKCAnYWNjZXB0JywgaXRlbXMgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBtZS5lbGVtLmFkZENsYXNzKCBwcmVmaXggKyAnb3ZlcicgKTtcclxuICAgICAgICAgICAgICAgICAgICBtZS5lbGVtWyBkZW5pZWQgPyAnYWRkQ2xhc3MnIDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZW1vdmVDbGFzcycgXSggcHJlZml4ICsgJ2RlbmllZCcgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9IGRlbmllZCA/ICdub25lJyA6ICdjb3B5JztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIF9kcmFnT3ZlckhhbmRsZXI6IGZ1bmN0aW9uKCBlICkge1xyXG4gICAgICAgICAgICAgICAgLy8g5Y+q5aSE55CG5qGG5YaF55qE44CCXHJcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50RWxlbSA9IHRoaXMuZWxlbS5wYXJlbnQoKS5nZXQoIDAgKTtcclxuICAgICAgICAgICAgICAgIGlmICggcGFyZW50RWxlbSAmJiAhJC5jb250YWlucyggcGFyZW50RWxlbSwgZS5jdXJyZW50VGFyZ2V0ICkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoIHRoaXMuX2xlYXZlVGltZXIgKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2RyYWdFbnRlckhhbmRsZXIuY2FsbCggdGhpcywgZSApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgX2RyYWdMZWF2ZUhhbmRsZXI6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBoYW5kbGVyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWUuZG5kT3ZlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIG1lLmVsZW0ucmVtb3ZlQ2xhc3MoIHByZWZpeCArICdvdmVyICcgKyBwcmVmaXggKyAnZGVuaWVkJyApO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KCBtZS5fbGVhdmVUaW1lciApO1xyXG4gICAgICAgICAgICAgICAgbWUuX2xlYXZlVGltZXIgPSBzZXRUaW1lb3V0KCBoYW5kbGVyLCAxMDAgKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBfZHJvcEhhbmRsZXI6IGZ1bmN0aW9uKCBlICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBydWlkID0gbWUuZ2V0UnVpZCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudEVsZW0gPSBtZS5lbGVtLnBhcmVudCgpLmdldCggMCApLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUcmFuc2ZlciwgZGF0YTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5Y+q5aSE55CG5qGG5YaF55qE44CCXHJcbiAgICAgICAgICAgICAgICBpZiAoIHBhcmVudEVsZW0gJiYgISQuY29udGFpbnMoIHBhcmVudEVsZW0sIGUuY3VycmVudFRhcmdldCApICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZSA9IGUub3JpZ2luYWxFdmVudCB8fCBlO1xyXG4gICAgICAgICAgICAgICAgZGF0YVRyYW5zZmVyID0gZS5kYXRhVHJhbnNmZXI7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOWmguaenOaYr+mhtemdouWGheaLluaLve+8jOi/mOS4jeiDveWkhOeQhu+8jOS4jemYu+atouS6i+S7tuOAglxyXG4gICAgICAgICAgICAgICAgLy8g5q2k5aSEIGllMTEg5LiL5Lya5oql5Y+C5pWw6ZSZ6K+v77yMXHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhVHJhbnNmZXIuZ2V0RGF0YSgndGV4dC9odG1sJyk7XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoKCBlcnIgKSB7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIG1lLmRuZE92ZXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIG1lLmVsZW0ucmVtb3ZlQ2xhc3MoIHByZWZpeCArICdvdmVyJyApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIGRhdGEgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBtZS5fZ2V0VGFuc2ZlckZpbGVzKCBkYXRhVHJhbnNmZXIsIGZ1bmN0aW9uKCByZXN1bHRzICkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1lLnRyaWdnZXIoICdkcm9wJywgJC5tYXAoIHJlc3VsdHMsIGZ1bmN0aW9uKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpbGUoIHJ1aWQsIGZpbGUgKTtcclxuICAgICAgICAgICAgICAgICAgICB9KSApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvLyDlpoLmnpzkvKDlhaUgY2FsbGJhY2sg5YiZ5Y675p+l55yL5paH5Lu25aS577yM5ZCm5YiZ5Y+q566h5b2T5YmN5paH5Lu25aS544CCXHJcbiAgICAgICAgICAgIF9nZXRUYW5zZmVyRmlsZXM6IGZ1bmN0aW9uKCBkYXRhVHJhbnNmZXIsIGNhbGxiYWNrICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdHMgID0gW10sXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZXMgPSBbXSxcclxuICAgICAgICAgICAgICAgICAgICBpdGVtcywgZmlsZXMsIGZpbGUsIGl0ZW0sIGksIGxlbiwgY2FuQWNjZXNzRm9sZGVyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpdGVtcyA9IGRhdGFUcmFuc2Zlci5pdGVtcztcclxuICAgICAgICAgICAgICAgIGZpbGVzID0gZGF0YVRyYW5zZmVyLmZpbGVzO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBjYW5BY2Nlc3NGb2xkZXIgPSAhIShpdGVtcyAmJiBpdGVtc1sgMCBdLndlYmtpdEdldEFzRW50cnkpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmb3IgKCBpID0gMCwgbGVuID0gZmlsZXMubGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlsZSA9IGZpbGVzWyBpIF07XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IGl0ZW1zICYmIGl0ZW1zWyBpIF07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIGNhbkFjY2Vzc0ZvbGRlciAmJiBpdGVtLndlYmtpdEdldEFzRW50cnkoKS5pc0RpcmVjdG9yeSApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKCB0aGlzLl90cmF2ZXJzZURpcmVjdG9yeVRyZWUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS53ZWJraXRHZXRBc0VudHJ5KCksIHJlc3VsdHMgKSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaCggZmlsZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgQmFzZS53aGVuLmFwcGx5KCBCYXNlLCBwcm9taXNlcyApLmRvbmUoZnVuY3Rpb24oKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAoICFyZXN1bHRzLmxlbmd0aCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCByZXN1bHRzICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBfdHJhdmVyc2VEaXJlY3RvcnlUcmVlOiBmdW5jdGlvbiggZW50cnksIHJlc3VsdHMgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSBCYXNlLkRlZmVycmVkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgbWUgPSB0aGlzO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIGVudHJ5LmlzRmlsZSApIHtcclxuICAgICAgICAgICAgICAgICAgICBlbnRyeS5maWxlKGZ1bmN0aW9uKCBmaWxlICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goIGZpbGUgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggZW50cnkuaXNEaXJlY3RvcnkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50cnkuY3JlYXRlUmVhZGVyKCkucmVhZEVudHJpZXMoZnVuY3Rpb24oIGVudHJpZXMgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZW4gPSBlbnRyaWVzLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2VzID0gW10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnIgPSBbXSwgICAgLy8g5Li65LqG5L+d6K+B6aG65bqP44CCXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgbGVuOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKCBtZS5fdHJhdmVyc2VEaXJlY3RvcnlUcmVlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyaWVzWyBpIF0sIGFyciApICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBCYXNlLndoZW4uYXBwbHkoIEJhc2UsIHByb21pc2VzICkudGhlbihmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaC5hcHBseSggcmVzdWx0cywgYXJyICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGRlZmVycmVkLnJlamVjdCApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW0gPSB0aGlzLmVsZW07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOi/mOayoSBpbml0IOWwseiwg+eUqCBkZXN0cm95XHJcbiAgICAgICAgICAgICAgICBpZiAoIWVsZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGVsZW0ub2ZmKCAnZHJhZ2VudGVyJywgdGhpcy5kcmFnRW50ZXJIYW5kbGVyICk7XHJcbiAgICAgICAgICAgICAgICBlbGVtLm9mZiggJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3ZlckhhbmRsZXIgKTtcclxuICAgICAgICAgICAgICAgIGVsZW0ub2ZmKCAnZHJhZ2xlYXZlJywgdGhpcy5kcmFnTGVhdmVIYW5kbGVyICk7XHJcbiAgICAgICAgICAgICAgICBlbGVtLm9mZiggJ2Ryb3AnLCB0aGlzLmRyb3BIYW5kbGVyICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggdGhpcy5vcHRpb25zLmRpc2FibGVHbG9iYWxEbmQgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJCggZG9jdW1lbnQgKS5vZmYoICdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXJIYW5kbGVyICk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCggZG9jdW1lbnQgKS5vZmYoICdkcm9wJywgdGhpcy5kcm9wSGFuZGxlciApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IEZpbGVQYXN0ZVxyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ3J1bnRpbWUvaHRtbDUvZmlsZXBhc3RlJyxbXHJcbiAgICAgICAgJ2Jhc2UnLFxyXG4gICAgICAgICdydW50aW1lL2h0bWw1L3J1bnRpbWUnLFxyXG4gICAgICAgICdsaWIvZmlsZSdcclxuICAgIF0sIGZ1bmN0aW9uKCBCYXNlLCBIdG1sNVJ1bnRpbWUsIEZpbGUgKSB7XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gSHRtbDVSdW50aW1lLnJlZ2lzdGVyKCAnRmlsZVBhc3RlJywge1xyXG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBvcHRzID0gdGhpcy5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIGVsZW0gPSB0aGlzLmVsZW0gPSBvcHRzLmNvbnRhaW5lcixcclxuICAgICAgICAgICAgICAgICAgICBhY2NlcHQgPSAnLionLFxyXG4gICAgICAgICAgICAgICAgICAgIGFyciwgaSwgbGVuLCBpdGVtO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBhY2NldHDnmoRtaW1lVHlwZXPkuK3nlJ/miJDljLnphY3mraPliJnjgIJcclxuICAgICAgICAgICAgICAgIGlmICggb3B0cy5hY2NlcHQgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyID0gW107XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKCBpID0gMCwgbGVuID0gb3B0cy5hY2NlcHQubGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBvcHRzLmFjY2VwdFsgaSBdLm1pbWVUeXBlcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSAmJiBhcnIucHVzaCggaXRlbSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggYXJyLmxlbmd0aCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXB0ID0gYXJyLmpvaW4oJywnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXB0ID0gYWNjZXB0LnJlcGxhY2UoIC8sL2csICd8JyApLnJlcGxhY2UoIC9cXCovZywgJy4qJyApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuYWNjZXB0ID0gYWNjZXB0ID0gbmV3IFJlZ0V4cCggYWNjZXB0LCAnaScgKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGVyID0gQmFzZS5iaW5kRm4oIHRoaXMuX3Bhc3RlSGFuZGVyLCB0aGlzICk7XHJcbiAgICAgICAgICAgICAgICBlbGVtLm9uKCAncGFzdGUnLCB0aGlzLmhhbmRlciApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIF9wYXN0ZUhhbmRlcjogZnVuY3Rpb24oIGUgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWxsb3dlZCA9IFtdLFxyXG4gICAgICAgICAgICAgICAgICAgIHJ1aWQgPSB0aGlzLmdldFJ1aWQoKSxcclxuICAgICAgICAgICAgICAgICAgICBpdGVtcywgaXRlbSwgYmxvYiwgaSwgbGVuO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBlID0gZS5vcmlnaW5hbEV2ZW50IHx8IGU7XHJcbiAgICAgICAgICAgICAgICBpdGVtcyA9IGUuY2xpcGJvYXJkRGF0YS5pdGVtcztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZm9yICggaSA9IDAsIGxlbiA9IGl0ZW1zLmxlbmd0aDsgaSA8IGxlbjsgaSsrICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0gPSBpdGVtc1sgaSBdO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBpdGVtLmtpbmQgIT09ICdmaWxlJyB8fCAhKGJsb2IgPSBpdGVtLmdldEFzRmlsZSgpKSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgYWxsb3dlZC5wdXNoKCBuZXcgRmlsZSggcnVpZCwgYmxvYiApICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggYWxsb3dlZC5sZW5ndGggKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5LiN6Zi75q2i6Z2e5paH5Lu257KY6LS077yI5paH5a2X57KY6LS077yJ55qE5LqL5Lu25YaS5rOhXHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCAncGFzdGUnLCBhbGxvd2VkICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW0ub2ZmKCAncGFzdGUnLCB0aGlzLmhhbmRlciApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IEZpbGVQaWNrZXJcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdydW50aW1lL2h0bWw1L2ZpbGVwaWNrZXInLFtcclxuICAgICAgICAnYmFzZScsXHJcbiAgICAgICAgJ3J1bnRpbWUvaHRtbDUvcnVudGltZSdcclxuICAgIF0sIGZ1bmN0aW9uKCBCYXNlLCBIdG1sNVJ1bnRpbWUgKSB7XHJcbiAgICBcclxuICAgICAgICB2YXIgJCA9IEJhc2UuJDtcclxuICAgIFxyXG4gICAgICAgIHJldHVybiBIdG1sNVJ1bnRpbWUucmVnaXN0ZXIoICdGaWxlUGlja2VyJywge1xyXG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLmdldFJ1bnRpbWUoKS5nZXRDb250YWluZXIoKSxcclxuICAgICAgICAgICAgICAgICAgICBtZSA9IHRoaXMsXHJcbiAgICAgICAgICAgICAgICAgICAgb3duZXIgPSBtZS5vd25lcixcclxuICAgICAgICAgICAgICAgICAgICBvcHRzID0gbWUub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgICAgICBsYWJlbCA9IHRoaXMubGFiZWwgPSAkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpICksXHJcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSAgdGhpcy5pbnB1dCA9ICQoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JykgKSxcclxuICAgICAgICAgICAgICAgICAgICBhcnIsIGksIGxlbiwgbW91c2VIYW5kbGVyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKCAndHlwZScsICdmaWxlJyApO1xyXG4gICAgICAgICAgICAgICAgaW5wdXQuYXR0ciggJ2NhcHR1cmUnLCAnY2FtZXJhJyk7XHJcbiAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKCAnbmFtZScsIG9wdHMubmFtZSApO1xyXG4gICAgICAgICAgICAgICAgaW5wdXQuYWRkQ2xhc3MoJ3dlYnVwbG9hZGVyLWVsZW1lbnQtaW52aXNpYmxlJyk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGxhYmVsLm9uKCAnY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQudHJpZ2dlcignY2xpY2snKTtcclxuICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIG93bmVyLnRyaWdnZXIoJ2RpYWxvZ29wZW4nKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBsYWJlbC5jc3Moe1xyXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICcxMDAlJyxcclxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxMDAlJyxcclxuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnYmxvY2snLFxyXG4gICAgICAgICAgICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLFxyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6ICcjZmZmZmZmJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggb3B0cy5tdWx0aXBsZSApIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnB1dC5hdHRyKCAnbXVsdGlwbGUnLCAnbXVsdGlwbGUnICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIEB0b2RvIEZpcmVmb3jkuI3mlK/mjIHljZXni6zmjIflrprlkI7nvIBcclxuICAgICAgICAgICAgICAgIGlmICggb3B0cy5hY2NlcHQgJiYgb3B0cy5hY2NlcHQubGVuZ3RoID4gMCApIHtcclxuICAgICAgICAgICAgICAgICAgICBhcnIgPSBbXTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwLCBsZW4gPSBvcHRzLmFjY2VwdC5sZW5ndGg7IGkgPCBsZW47IGkrKyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyLnB1c2goIG9wdHMuYWNjZXB0WyBpIF0ubWltZVR5cGVzICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQuYXR0ciggJ2FjY2VwdCcsIGFyci5qb2luKCcsJykgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZCggaW5wdXQgKTtcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmQoIGxhYmVsICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIG1vdXNlSGFuZGxlciA9IGZ1bmN0aW9uKCBlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIG93bmVyLnRyaWdnZXIoIGUudHlwZSApO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaW5wdXQub24oICdjaGFuZ2UnLCBmdW5jdGlvbiggZSApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZm4gPSBhcmd1bWVudHMuY2FsbGVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9uZTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIG1lLmZpbGVzID0gZS50YXJnZXQuZmlsZXM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyByZXNldCBpbnB1dFxyXG4gICAgICAgICAgICAgICAgICAgIGNsb25lID0gdGhpcy5jbG9uZU5vZGUoIHRydWUgKTtcclxuICAgICAgICAgICAgICAgICAgICBjbG9uZS52YWx1ZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZCggY2xvbmUsIHRoaXMgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0Lm9mZigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0ID0gJCggY2xvbmUgKS5vbiggJ2NoYW5nZScsIGZuIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbiggJ21vdXNlZW50ZXIgbW91c2VsZWF2ZScsIG1vdXNlSGFuZGxlciApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgb3duZXIudHJpZ2dlcignY2hhbmdlJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbGFiZWwub24oICdtb3VzZWVudGVyIG1vdXNlbGVhdmUnLCBtb3VzZUhhbmRsZXIgKTtcclxuICAgIFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAgICAgZ2V0RmlsZXM6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmlsZXM7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlucHV0Lm9mZigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sYWJlbC5vZmYoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICogVGVybXM6XHJcbiAgICAgKlxyXG4gICAgICogVWludDhBcnJheSwgRmlsZVJlYWRlciwgQmxvYkJ1aWxkZXIsIGF0b2IsIEFycmF5QnVmZmVyXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IEltYWdl5o6n5Lu2XHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgncnVudGltZS9odG1sNS91dGlsJyxbXHJcbiAgICAgICAgJ2Jhc2UnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSApIHtcclxuICAgIFxyXG4gICAgICAgIHZhciB1cmxBUEkgPSB3aW5kb3cuY3JlYXRlT2JqZWN0VVJMICYmIHdpbmRvdyB8fFxyXG4gICAgICAgICAgICAgICAgd2luZG93LlVSTCAmJiBVUkwucmV2b2tlT2JqZWN0VVJMICYmIFVSTCB8fFxyXG4gICAgICAgICAgICAgICAgd2luZG93LndlYmtpdFVSTCxcclxuICAgICAgICAgICAgY3JlYXRlT2JqZWN0VVJMID0gQmFzZS5ub29wLFxyXG4gICAgICAgICAgICByZXZva2VPYmplY3RVUkwgPSBjcmVhdGVPYmplY3RVUkw7XHJcbiAgICBcclxuICAgICAgICBpZiAoIHVybEFQSSApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAvLyDmm7TlronlhajnmoTmlrnlvI/osIPnlKjvvIzmr5TlpoJhbmRyb2lk6YeM6Z2i5bCx6IO95oqKY29udGV4dOaUueaIkOWFtuS7lueahOWvueixoeOAglxyXG4gICAgICAgICAgICBjcmVhdGVPYmplY3RVUkwgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB1cmxBUEkuY3JlYXRlT2JqZWN0VVJMLmFwcGx5KCB1cmxBUEksIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgIHJldm9rZU9iamVjdFVSTCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVybEFQSS5yZXZva2VPYmplY3RVUkwuYXBwbHkoIHVybEFQSSwgYXJndW1lbnRzICk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgY3JlYXRlT2JqZWN0VVJMOiBjcmVhdGVPYmplY3RVUkwsXHJcbiAgICAgICAgICAgIHJldm9rZU9iamVjdFVSTDogcmV2b2tlT2JqZWN0VVJMLFxyXG4gICAgXHJcbiAgICAgICAgICAgIGRhdGFVUkwyQmxvYjogZnVuY3Rpb24oIGRhdGFVUkkgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYnl0ZVN0ciwgaW50QXJyYXksIGFiLCBpLCBtaW1ldHlwZSwgcGFydHM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHBhcnRzID0gZGF0YVVSSS5zcGxpdCgnLCcpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIH5wYXJ0c1sgMCBdLmluZGV4T2YoJ2Jhc2U2NCcpICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ5dGVTdHIgPSBhdG9iKCBwYXJ0c1sgMSBdICk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ5dGVTdHIgPSBkZWNvZGVVUklDb21wb25lbnQoIHBhcnRzWyAxIF0gKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgYWIgPSBuZXcgQXJyYXlCdWZmZXIoIGJ5dGVTdHIubGVuZ3RoICk7XHJcbiAgICAgICAgICAgICAgICBpbnRBcnJheSA9IG5ldyBVaW50OEFycmF5KCBhYiApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmb3IgKCBpID0gMDsgaSA8IGJ5dGVTdHIubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50QXJyYXlbIGkgXSA9IGJ5dGVTdHIuY2hhckNvZGVBdCggaSApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBtaW1ldHlwZSA9IHBhcnRzWyAwIF0uc3BsaXQoJzonKVsgMSBdLnNwbGl0KCc7JylbIDAgXTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXJyYXlCdWZmZXJUb0Jsb2IoIGFiLCBtaW1ldHlwZSApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGRhdGFVUkwyQXJyYXlCdWZmZXI6IGZ1bmN0aW9uKCBkYXRhVVJJICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJ5dGVTdHIsIGludEFycmF5LCBpLCBwYXJ0cztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcGFydHMgPSBkYXRhVVJJLnNwbGl0KCcsJyk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggfnBhcnRzWyAwIF0uaW5kZXhPZignYmFzZTY0JykgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnl0ZVN0ciA9IGF0b2IoIHBhcnRzWyAxIF0gKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnl0ZVN0ciA9IGRlY29kZVVSSUNvbXBvbmVudCggcGFydHNbIDEgXSApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpbnRBcnJheSA9IG5ldyBVaW50OEFycmF5KCBieXRlU3RyLmxlbmd0aCApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmb3IgKCBpID0gMDsgaSA8IGJ5dGVTdHIubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW50QXJyYXlbIGkgXSA9IGJ5dGVTdHIuY2hhckNvZGVBdCggaSApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW50QXJyYXkuYnVmZmVyO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGFycmF5QnVmZmVyVG9CbG9iOiBmdW5jdGlvbiggYnVmZmVyLCB0eXBlICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJ1aWxkZXIgPSB3aW5kb3cuQmxvYkJ1aWxkZXIgfHwgd2luZG93LldlYktpdEJsb2JCdWlsZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgIGJiO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBhbmRyb2lk5LiN5pSv5oyB55u05o6lbmV3IEJsb2IsIOWPquiDveWAn+WKqWJsb2JidWlsZGVyLlxyXG4gICAgICAgICAgICAgICAgaWYgKCBidWlsZGVyICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJiID0gbmV3IGJ1aWxkZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBiYi5hcHBlbmQoIGJ1ZmZlciApO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBiYi5nZXRCbG9iKCB0eXBlICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQmxvYihbIGJ1ZmZlciBdLCB0eXBlID8geyB0eXBlOiB0eXBlIH0gOiB7fSApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOaKveWHuuadpeS4u+imgeaYr+S4uuS6huino+WGs2FuZHJvaWTkuIvpnaJjYW52YXMudG9EYXRhVXJs5LiN5pSv5oyBanBlZy5cclxuICAgICAgICAgICAgLy8g5L2g5b6X5Yiw55qE57uT5p6c5pivcG5nLlxyXG4gICAgICAgICAgICBjYW52YXNUb0RhdGFVcmw6IGZ1bmN0aW9uKCBjYW52YXMsIHR5cGUsIHF1YWxpdHkgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTCggdHlwZSwgcXVhbGl0eSAvIDEwMCApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIGltYWdlbWVhdOS8muWkjeWGmei/meS4quaWueazle+8jOWmguaenOeUqOaIt+mAieaLqeWKoOi9vemCo+S4quaWh+S7tuS6hueahOivneOAglxyXG4gICAgICAgICAgICBwYXJzZU1ldGE6IGZ1bmN0aW9uKCBibG9iLCBjYWxsYmFjayApIHtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCBmYWxzZSwge30pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIGltYWdlbWVhdOS8muWkjeWGmei/meS4quaWueazle+8jOWmguaenOeUqOaIt+mAieaLqeWKoOi9vemCo+S4quaWh+S7tuS6hueahOivneOAglxyXG4gICAgICAgICAgICB1cGRhdGVJbWFnZUhlYWQ6IGZ1bmN0aW9uKCBkYXRhICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIFRlcm1zOlxyXG4gICAgICpcclxuICAgICAqIFVpbnQ4QXJyYXksIEZpbGVSZWFkZXIsIEJsb2JCdWlsZGVyLCBhdG9iLCBBcnJheUJ1ZmZlclxyXG4gICAgICogQGZpbGVPdmVydmlldyBJbWFnZeaOp+S7tlxyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ3J1bnRpbWUvaHRtbDUvaW1hZ2VtZXRhJyxbXHJcbiAgICAgICAgJ3J1bnRpbWUvaHRtbDUvdXRpbCdcclxuICAgIF0sIGZ1bmN0aW9uKCBVdGlsICkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyIGFwaTtcclxuICAgIFxyXG4gICAgICAgIGFwaSA9IHtcclxuICAgICAgICAgICAgcGFyc2Vyczoge1xyXG4gICAgICAgICAgICAgICAgMHhmZmUxOiBbXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIG1heE1ldGFEYXRhU2l6ZTogMjYyMTQ0LFxyXG4gICAgXHJcbiAgICAgICAgICAgIHBhcnNlOiBmdW5jdGlvbiggYmxvYiwgY2IgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIGZyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZnIub25sb2FkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2IoIGZhbHNlLCBtZS5fcGFyc2UoIHRoaXMucmVzdWx0ICkgKTtcclxuICAgICAgICAgICAgICAgICAgICBmciA9IGZyLm9ubG9hZCA9IGZyLm9uZXJyb3IgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZnIub25lcnJvciA9IGZ1bmN0aW9uKCBlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNiKCBlLm1lc3NhZ2UgKTtcclxuICAgICAgICAgICAgICAgICAgICBmciA9IGZyLm9ubG9hZCA9IGZyLm9uZXJyb3IgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgYmxvYiA9IGJsb2Iuc2xpY2UoIDAsIG1lLm1heE1ldGFEYXRhU2l6ZSApO1xyXG4gICAgICAgICAgICAgICAgZnIucmVhZEFzQXJyYXlCdWZmZXIoIGJsb2IuZ2V0U291cmNlKCkgKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBfcGFyc2U6IGZ1bmN0aW9uKCBidWZmZXIsIG5vUGFyc2UgKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIGJ1ZmZlci5ieXRlTGVuZ3RoIDwgNiApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhdmlldyA9IG5ldyBEYXRhVmlldyggYnVmZmVyICksXHJcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gMixcclxuICAgICAgICAgICAgICAgICAgICBtYXhPZmZzZXQgPSBkYXRhdmlldy5ieXRlTGVuZ3RoIC0gNCxcclxuICAgICAgICAgICAgICAgICAgICBoZWFkTGVuZ3RoID0gb2Zmc2V0LFxyXG4gICAgICAgICAgICAgICAgICAgIHJldCA9IHt9LFxyXG4gICAgICAgICAgICAgICAgICAgIG1hcmtlckJ5dGVzLCBtYXJrZXJMZW5ndGgsIHBhcnNlcnMsIGk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggZGF0YXZpZXcuZ2V0VWludDE2KCAwICkgPT09IDB4ZmZkOCApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICggb2Zmc2V0IDwgbWF4T2Zmc2V0ICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXJrZXJCeXRlcyA9IGRhdGF2aWV3LmdldFVpbnQxNiggb2Zmc2V0ICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBtYXJrZXJCeXRlcyA+PSAweGZmZTAgJiYgbWFya2VyQnl0ZXMgPD0gMHhmZmVmIHx8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya2VyQnl0ZXMgPT09IDB4ZmZmZSApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya2VyTGVuZ3RoID0gZGF0YXZpZXcuZ2V0VWludDE2KCBvZmZzZXQgKyAyICkgKyAyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG9mZnNldCArIG1hcmtlckxlbmd0aCA+IGRhdGF2aWV3LmJ5dGVMZW5ndGggKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlcnMgPSBhcGkucGFyc2Vyc1sgbWFya2VyQnl0ZXMgXTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhbm9QYXJzZSAmJiBwYXJzZXJzICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgcGFyc2Vycy5sZW5ndGg7IGkgKz0gMSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2Vyc1sgaSBdLmNhbGwoIGFwaSwgZGF0YXZpZXcsIG9mZnNldCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJrZXJMZW5ndGgsIHJldCApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ICs9IG1hcmtlckxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRMZW5ndGggPSBvZmZzZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggaGVhZExlbmd0aCA+IDYgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggYnVmZmVyLnNsaWNlICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0LmltYWdlSGVhZCA9IGJ1ZmZlci5zbGljZSggMiwgaGVhZExlbmd0aCApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gV29ya2Fyb3VuZCBmb3IgSUUxMCwgd2hpY2ggZG9lcyBub3QgeWV0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdXBwb3J0IEFycmF5QnVmZmVyLnNsaWNlOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0LmltYWdlSGVhZCA9IG5ldyBVaW50OEFycmF5KCBidWZmZXIgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc3ViYXJyYXkoIDIsIGhlYWRMZW5ndGggKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICB1cGRhdGVJbWFnZUhlYWQ6IGZ1bmN0aW9uKCBidWZmZXIsIGhlYWQgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX3BhcnNlKCBidWZmZXIsIHRydWUgKSxcclxuICAgICAgICAgICAgICAgICAgICBidWYxLCBidWYyLCBib2R5b2Zmc2V0O1xyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGJvZHlvZmZzZXQgPSAyO1xyXG4gICAgICAgICAgICAgICAgaWYgKCBkYXRhLmltYWdlSGVhZCApIHtcclxuICAgICAgICAgICAgICAgICAgICBib2R5b2Zmc2V0ID0gMiArIGRhdGEuaW1hZ2VIZWFkLmJ5dGVMZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggYnVmZmVyLnNsaWNlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ1ZjIgPSBidWZmZXIuc2xpY2UoIGJvZHlvZmZzZXQgKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVmMiA9IG5ldyBVaW50OEFycmF5KCBidWZmZXIgKS5zdWJhcnJheSggYm9keW9mZnNldCApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBidWYxID0gbmV3IFVpbnQ4QXJyYXkoIGhlYWQuYnl0ZUxlbmd0aCArIDIgKyBidWYyLmJ5dGVMZW5ndGggKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgYnVmMVsgMCBdID0gMHhGRjtcclxuICAgICAgICAgICAgICAgIGJ1ZjFbIDEgXSA9IDB4RDg7XHJcbiAgICAgICAgICAgICAgICBidWYxLnNldCggbmV3IFVpbnQ4QXJyYXkoIGhlYWQgKSwgMiApO1xyXG4gICAgICAgICAgICAgICAgYnVmMS5zZXQoIG5ldyBVaW50OEFycmF5KCBidWYyICksIGhlYWQuYnl0ZUxlbmd0aCArIDIgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ1ZjEuYnVmZmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIFV0aWwucGFyc2VNZXRhID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhcGkucGFyc2UuYXBwbHkoIGFwaSwgYXJndW1lbnRzICk7XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIFV0aWwudXBkYXRlSW1hZ2VIZWFkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhcGkudXBkYXRlSW1hZ2VIZWFkLmFwcGx5KCBhcGksIGFyZ3VtZW50cyApO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gYXBpO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIOS7o+eggeadpeiHquS6ju+8mmh0dHBzOi8vZ2l0aHViLmNvbS9ibHVlaW1wL0phdmFTY3JpcHQtTG9hZC1JbWFnZVxyXG4gICAgICog5pqC5pe26aG555uu5Lit5Y+q55So5LqGb3JpZW50YXRpb24uXHJcbiAgICAgKlxyXG4gICAgICog5Y676Zmk5LqGIEV4aWYgU3ViIElGRCBQb2ludGVyLCBHUFMgSW5mbyBJRkQgUG9pbnRlciwgRXhpZiBUaHVtYm5haWwuXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IEVYSUbop6PmnpBcclxuICAgICAqL1xyXG4gICAgXHJcbiAgICAvLyBTYW1wbGVcclxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgLy8gTWFrZSA6IEFwcGxlXHJcbiAgICAvLyBNb2RlbCA6IGlQaG9uZSA0U1xyXG4gICAgLy8gT3JpZW50YXRpb24gOiAxXHJcbiAgICAvLyBYUmVzb2x1dGlvbiA6IDcyIFs3Mi8xXVxyXG4gICAgLy8gWVJlc29sdXRpb24gOiA3MiBbNzIvMV1cclxuICAgIC8vIFJlc29sdXRpb25Vbml0IDogMlxyXG4gICAgLy8gU29mdHdhcmUgOiBRdWlja1RpbWUgNy43LjFcclxuICAgIC8vIERhdGVUaW1lIDogMjAxMzowOTowMSAyMjo1Mzo1NVxyXG4gICAgLy8gRXhpZklGRFBvaW50ZXIgOiAxOTBcclxuICAgIC8vIEV4cG9zdXJlVGltZSA6IDAuMDU4ODIzNTI5NDExNzY0NzA1IFsxLzE3XVxyXG4gICAgLy8gRk51bWJlciA6IDIuNCBbMTIvNV1cclxuICAgIC8vIEV4cG9zdXJlUHJvZ3JhbSA6IE5vcm1hbCBwcm9ncmFtXHJcbiAgICAvLyBJU09TcGVlZFJhdGluZ3MgOiA4MDBcclxuICAgIC8vIEV4aWZWZXJzaW9uIDogMDIyMFxyXG4gICAgLy8gRGF0ZVRpbWVPcmlnaW5hbCA6IDIwMTM6MDk6MDEgMjI6NTI6NTFcclxuICAgIC8vIERhdGVUaW1lRGlnaXRpemVkIDogMjAxMzowOTowMSAyMjo1Mjo1MVxyXG4gICAgLy8gQ29tcG9uZW50c0NvbmZpZ3VyYXRpb24gOiBZQ2JDclxyXG4gICAgLy8gU2h1dHRlclNwZWVkVmFsdWUgOiA0LjA1ODg5MzUxNTc2NDQyNlxyXG4gICAgLy8gQXBlcnR1cmVWYWx1ZSA6IDIuNTI2MDY4ODIxNjg5MjU5NyBbNDg0NS8xOTE4XVxyXG4gICAgLy8gQnJpZ2h0bmVzc1ZhbHVlIDogLTAuMzEyNjY4NjYwMTk5ODM5NVxyXG4gICAgLy8gTWV0ZXJpbmdNb2RlIDogUGF0dGVyblxyXG4gICAgLy8gRmxhc2ggOiBGbGFzaCBkaWQgbm90IGZpcmUsIGNvbXB1bHNvcnkgZmxhc2ggbW9kZVxyXG4gICAgLy8gRm9jYWxMZW5ndGggOiA0LjI4IFsxMDcvMjVdXHJcbiAgICAvLyBTdWJqZWN0QXJlYSA6IFs0IHZhbHVlc11cclxuICAgIC8vIEZsYXNocGl4VmVyc2lvbiA6IDAxMDBcclxuICAgIC8vIENvbG9yU3BhY2UgOiAxXHJcbiAgICAvLyBQaXhlbFhEaW1lbnNpb24gOiAyNDQ4XHJcbiAgICAvLyBQaXhlbFlEaW1lbnNpb24gOiAzMjY0XHJcbiAgICAvLyBTZW5zaW5nTWV0aG9kIDogT25lLWNoaXAgY29sb3IgYXJlYSBzZW5zb3JcclxuICAgIC8vIEV4cG9zdXJlTW9kZSA6IDBcclxuICAgIC8vIFdoaXRlQmFsYW5jZSA6IEF1dG8gd2hpdGUgYmFsYW5jZVxyXG4gICAgLy8gRm9jYWxMZW5ndGhJbjM1bW1GaWxtIDogMzVcclxuICAgIC8vIFNjZW5lQ2FwdHVyZVR5cGUgOiBTdGFuZGFyZFxyXG4gICAgZGVmaW5lKCdydW50aW1lL2h0bWw1L2ltYWdlbWV0YS9leGlmJyxbXHJcbiAgICAgICAgJ2Jhc2UnLFxyXG4gICAgICAgICdydW50aW1lL2h0bWw1L2ltYWdlbWV0YSdcclxuICAgIF0sIGZ1bmN0aW9uKCBCYXNlLCBJbWFnZU1ldGEgKSB7XHJcbiAgICBcclxuICAgICAgICB2YXIgRVhJRiA9IHt9O1xyXG4gICAgXHJcbiAgICAgICAgRVhJRi5FeGlmTWFwID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICBFWElGLkV4aWZNYXAucHJvdG90eXBlLm1hcCA9IHtcclxuICAgICAgICAgICAgJ09yaWVudGF0aW9uJzogMHgwMTEyXHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIEVYSUYuRXhpZk1hcC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24oIGlkICkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpc1sgaWQgXSB8fCB0aGlzWyB0aGlzLm1hcFsgaWQgXSBdO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICBFWElGLmV4aWZUYWdUeXBlcyA9IHtcclxuICAgICAgICAgICAgLy8gYnl0ZSwgOC1iaXQgdW5zaWduZWQgaW50OlxyXG4gICAgICAgICAgICAxOiB7XHJcbiAgICAgICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24oIGRhdGFWaWV3LCBkYXRhT2Zmc2V0ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhVmlldy5nZXRVaW50OCggZGF0YU9mZnNldCApO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6IDFcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICAvLyBhc2NpaSwgOC1iaXQgYnl0ZTpcclxuICAgICAgICAgICAgMjoge1xyXG4gICAgICAgICAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uKCBkYXRhVmlldywgZGF0YU9mZnNldCApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSggZGF0YVZpZXcuZ2V0VWludDgoIGRhdGFPZmZzZXQgKSApO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6IDEsXHJcbiAgICAgICAgICAgICAgICBhc2NpaTogdHJ1ZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIHNob3J0LCAxNiBiaXQgaW50OlxyXG4gICAgICAgICAgICAzOiB7XHJcbiAgICAgICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24oIGRhdGFWaWV3LCBkYXRhT2Zmc2V0LCBsaXR0bGVFbmRpYW4gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFWaWV3LmdldFVpbnQxNiggZGF0YU9mZnNldCwgbGl0dGxlRW5kaWFuICk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogMlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIGxvbmcsIDMyIGJpdCBpbnQ6XHJcbiAgICAgICAgICAgIDQ6IHtcclxuICAgICAgICAgICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiggZGF0YVZpZXcsIGRhdGFPZmZzZXQsIGxpdHRsZUVuZGlhbiApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0VWludDMyKCBkYXRhT2Zmc2V0LCBsaXR0bGVFbmRpYW4gKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiA0XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLy8gcmF0aW9uYWwgPSB0d28gbG9uZyB2YWx1ZXMsXHJcbiAgICAgICAgICAgIC8vIGZpcnN0IGlzIG51bWVyYXRvciwgc2Vjb25kIGlzIGRlbm9taW5hdG9yOlxyXG4gICAgICAgICAgICA1OiB7XHJcbiAgICAgICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24oIGRhdGFWaWV3LCBkYXRhT2Zmc2V0LCBsaXR0bGVFbmRpYW4gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFWaWV3LmdldFVpbnQzMiggZGF0YU9mZnNldCwgbGl0dGxlRW5kaWFuICkgL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhVmlldy5nZXRVaW50MzIoIGRhdGFPZmZzZXQgKyA0LCBsaXR0bGVFbmRpYW4gKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiA4XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLy8gc2xvbmcsIDMyIGJpdCBzaWduZWQgaW50OlxyXG4gICAgICAgICAgICA5OiB7XHJcbiAgICAgICAgICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24oIGRhdGFWaWV3LCBkYXRhT2Zmc2V0LCBsaXR0bGVFbmRpYW4gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFWaWV3LmdldEludDMyKCBkYXRhT2Zmc2V0LCBsaXR0bGVFbmRpYW4gKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiA0XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLy8gc3JhdGlvbmFsLCB0d28gc2xvbmdzLCBmaXJzdCBpcyBudW1lcmF0b3IsIHNlY29uZCBpcyBkZW5vbWluYXRvcjpcclxuICAgICAgICAgICAgMTA6IHtcclxuICAgICAgICAgICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiggZGF0YVZpZXcsIGRhdGFPZmZzZXQsIGxpdHRsZUVuZGlhbiApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0SW50MzIoIGRhdGFPZmZzZXQsIGxpdHRsZUVuZGlhbiApIC9cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVZpZXcuZ2V0SW50MzIoIGRhdGFPZmZzZXQgKyA0LCBsaXR0bGVFbmRpYW4gKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiA4XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgLy8gdW5kZWZpbmVkLCA4LWJpdCBieXRlLCB2YWx1ZSBkZXBlbmRpbmcgb24gZmllbGQ6XHJcbiAgICAgICAgRVhJRi5leGlmVGFnVHlwZXNbIDcgXSA9IEVYSUYuZXhpZlRhZ1R5cGVzWyAxIF07XHJcbiAgICBcclxuICAgICAgICBFWElGLmdldEV4aWZWYWx1ZSA9IGZ1bmN0aW9uKCBkYXRhVmlldywgdGlmZk9mZnNldCwgb2Zmc2V0LCB0eXBlLCBsZW5ndGgsXHJcbiAgICAgICAgICAgICAgICBsaXR0bGVFbmRpYW4gKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgdmFyIHRhZ1R5cGUgPSBFWElGLmV4aWZUYWdUeXBlc1sgdHlwZSBdLFxyXG4gICAgICAgICAgICAgICAgdGFnU2l6ZSwgZGF0YU9mZnNldCwgdmFsdWVzLCBpLCBzdHIsIGM7XHJcbiAgICBcclxuICAgICAgICAgICAgaWYgKCAhdGFnVHlwZSApIHtcclxuICAgICAgICAgICAgICAgIEJhc2UubG9nKCdJbnZhbGlkIEV4aWYgZGF0YTogSW52YWxpZCB0YWcgdHlwZS4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIHRhZ1NpemUgPSB0YWdUeXBlLnNpemUgKiBsZW5ndGg7XHJcbiAgICBcclxuICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIGlmIHRoZSB2YWx1ZSBpcyBjb250YWluZWQgaW4gdGhlIGRhdGFPZmZzZXQgYnl0ZXMsXHJcbiAgICAgICAgICAgIC8vIG9yIGlmIHRoZSB2YWx1ZSBhdCB0aGUgZGF0YU9mZnNldCBpcyBhIHBvaW50ZXIgdG8gdGhlIGFjdHVhbCBkYXRhOlxyXG4gICAgICAgICAgICBkYXRhT2Zmc2V0ID0gdGFnU2l6ZSA+IDQgPyB0aWZmT2Zmc2V0ICsgZGF0YVZpZXcuZ2V0VWludDMyKCBvZmZzZXQgKyA4LFxyXG4gICAgICAgICAgICAgICAgICAgIGxpdHRsZUVuZGlhbiApIDogKG9mZnNldCArIDgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGlmICggZGF0YU9mZnNldCArIHRhZ1NpemUgPiBkYXRhVmlldy5ieXRlTGVuZ3RoICkge1xyXG4gICAgICAgICAgICAgICAgQmFzZS5sb2coJ0ludmFsaWQgRXhpZiBkYXRhOiBJbnZhbGlkIGRhdGEgb2Zmc2V0LicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgaWYgKCBsZW5ndGggPT09IDEgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFnVHlwZS5nZXRWYWx1ZSggZGF0YVZpZXcsIGRhdGFPZmZzZXQsIGxpdHRsZUVuZGlhbiApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgdmFsdWVzID0gW107XHJcbiAgICBcclxuICAgICAgICAgICAgZm9yICggaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSApIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlc1sgaSBdID0gdGFnVHlwZS5nZXRWYWx1ZSggZGF0YVZpZXcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFPZmZzZXQgKyBpICogdGFnVHlwZS5zaXplLCBsaXR0bGVFbmRpYW4gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIGlmICggdGFnVHlwZS5hc2NpaSApIHtcclxuICAgICAgICAgICAgICAgIHN0ciA9ICcnO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBDb25jYXRlbmF0ZSB0aGUgY2hhcnM6XHJcbiAgICAgICAgICAgICAgICBmb3IgKCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkgKz0gMSApIHtcclxuICAgICAgICAgICAgICAgICAgICBjID0gdmFsdWVzWyBpIF07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgdGhlIHRlcm1pbmF0aW5nIE5VTEwgYnl0ZShzKTpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIGMgPT09ICdcXHUwMDAwJyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHN0ciArPSBjO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZXM7XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIEVYSUYucGFyc2VFeGlmVGFnID0gZnVuY3Rpb24oIGRhdGFWaWV3LCB0aWZmT2Zmc2V0LCBvZmZzZXQsIGxpdHRsZUVuZGlhbixcclxuICAgICAgICAgICAgICAgIGRhdGEgKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgdmFyIHRhZyA9IGRhdGFWaWV3LmdldFVpbnQxNiggb2Zmc2V0LCBsaXR0bGVFbmRpYW4gKTtcclxuICAgICAgICAgICAgZGF0YS5leGlmWyB0YWcgXSA9IEVYSUYuZ2V0RXhpZlZhbHVlKCBkYXRhVmlldywgdGlmZk9mZnNldCwgb2Zmc2V0LFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFWaWV3LmdldFVpbnQxNiggb2Zmc2V0ICsgMiwgbGl0dGxlRW5kaWFuICksICAgIC8vIHRhZyB0eXBlXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YVZpZXcuZ2V0VWludDMyKCBvZmZzZXQgKyA0LCBsaXR0bGVFbmRpYW4gKSwgICAgLy8gdGFnIGxlbmd0aFxyXG4gICAgICAgICAgICAgICAgICAgIGxpdHRsZUVuZGlhbiApO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICBFWElGLnBhcnNlRXhpZlRhZ3MgPSBmdW5jdGlvbiggZGF0YVZpZXcsIHRpZmZPZmZzZXQsIGRpck9mZnNldCxcclxuICAgICAgICAgICAgICAgIGxpdHRsZUVuZGlhbiwgZGF0YSApIHtcclxuICAgIFxyXG4gICAgICAgICAgICB2YXIgdGFnc051bWJlciwgZGlyRW5kT2Zmc2V0LCBpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGlmICggZGlyT2Zmc2V0ICsgNiA+IGRhdGFWaWV3LmJ5dGVMZW5ndGggKSB7XHJcbiAgICAgICAgICAgICAgICBCYXNlLmxvZygnSW52YWxpZCBFeGlmIGRhdGE6IEludmFsaWQgZGlyZWN0b3J5IG9mZnNldC4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIHRhZ3NOdW1iZXIgPSBkYXRhVmlldy5nZXRVaW50MTYoIGRpck9mZnNldCwgbGl0dGxlRW5kaWFuICk7XHJcbiAgICAgICAgICAgIGRpckVuZE9mZnNldCA9IGRpck9mZnNldCArIDIgKyAxMiAqIHRhZ3NOdW1iZXI7XHJcbiAgICBcclxuICAgICAgICAgICAgaWYgKCBkaXJFbmRPZmZzZXQgKyA0ID4gZGF0YVZpZXcuYnl0ZUxlbmd0aCApIHtcclxuICAgICAgICAgICAgICAgIEJhc2UubG9nKCdJbnZhbGlkIEV4aWYgZGF0YTogSW52YWxpZCBkaXJlY3Rvcnkgc2l6ZS4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgdGFnc051bWJlcjsgaSArPSAxICkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJzZUV4aWZUYWcoIGRhdGFWaWV3LCB0aWZmT2Zmc2V0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJPZmZzZXQgKyAyICsgMTIgKiBpLCAgICAvLyB0YWcgb2Zmc2V0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpdHRsZUVuZGlhbiwgZGF0YSApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBvZmZzZXQgdG8gdGhlIG5leHQgZGlyZWN0b3J5OlxyXG4gICAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0VWludDMyKCBkaXJFbmRPZmZzZXQsIGxpdHRsZUVuZGlhbiApO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAvLyBFWElGLmdldEV4aWZUaHVtYm5haWwgPSBmdW5jdGlvbihkYXRhVmlldywgb2Zmc2V0LCBsZW5ndGgpIHtcclxuICAgICAgICAvLyAgICAgdmFyIGhleERhdGEsXHJcbiAgICAgICAgLy8gICAgICAgICBpLFxyXG4gICAgICAgIC8vICAgICAgICAgYjtcclxuICAgICAgICAvLyAgICAgaWYgKCFsZW5ndGggfHwgb2Zmc2V0ICsgbGVuZ3RoID4gZGF0YVZpZXcuYnl0ZUxlbmd0aCkge1xyXG4gICAgICAgIC8vICAgICAgICAgQmFzZS5sb2coJ0ludmFsaWQgRXhpZiBkYXRhOiBJbnZhbGlkIHRodW1ibmFpbCBkYXRhLicpO1xyXG4gICAgICAgIC8vICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIC8vICAgICB9XHJcbiAgICAgICAgLy8gICAgIGhleERhdGEgPSBbXTtcclxuICAgICAgICAvLyAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICAgICAgLy8gICAgICAgICBiID0gZGF0YVZpZXcuZ2V0VWludDgob2Zmc2V0ICsgaSk7XHJcbiAgICAgICAgLy8gICAgICAgICBoZXhEYXRhLnB1c2goKGIgPCAxNiA/ICcwJyA6ICcnKSArIGIudG9TdHJpbmcoMTYpKTtcclxuICAgICAgICAvLyAgICAgfVxyXG4gICAgICAgIC8vICAgICByZXR1cm4gJ2RhdGE6aW1hZ2UvanBlZywlJyArIGhleERhdGEuam9pbignJScpO1xyXG4gICAgICAgIC8vIH07XHJcbiAgICBcclxuICAgICAgICBFWElGLnBhcnNlRXhpZkRhdGEgPSBmdW5jdGlvbiggZGF0YVZpZXcsIG9mZnNldCwgbGVuZ3RoLCBkYXRhICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgIHZhciB0aWZmT2Zmc2V0ID0gb2Zmc2V0ICsgMTAsXHJcbiAgICAgICAgICAgICAgICBsaXR0bGVFbmRpYW4sIGRpck9mZnNldDtcclxuICAgIFxyXG4gICAgICAgICAgICAvLyBDaGVjayBmb3IgdGhlIEFTQ0lJIGNvZGUgZm9yIFwiRXhpZlwiICgweDQ1Nzg2OTY2KTpcclxuICAgICAgICAgICAgaWYgKCBkYXRhVmlldy5nZXRVaW50MzIoIG9mZnNldCArIDQgKSAhPT0gMHg0NTc4Njk2NiApIHtcclxuICAgICAgICAgICAgICAgIC8vIE5vIEV4aWYgZGF0YSwgbWlnaHQgYmUgWE1QIGRhdGEgaW5zdGVhZFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICggdGlmZk9mZnNldCArIDggPiBkYXRhVmlldy5ieXRlTGVuZ3RoICkge1xyXG4gICAgICAgICAgICAgICAgQmFzZS5sb2coJ0ludmFsaWQgRXhpZiBkYXRhOiBJbnZhbGlkIHNlZ21lbnQgc2l6ZS4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIENoZWNrIGZvciB0aGUgdHdvIG51bGwgYnl0ZXM6XHJcbiAgICAgICAgICAgIGlmICggZGF0YVZpZXcuZ2V0VWludDE2KCBvZmZzZXQgKyA4ICkgIT09IDB4MDAwMCApIHtcclxuICAgICAgICAgICAgICAgIEJhc2UubG9nKCdJbnZhbGlkIEV4aWYgZGF0YTogTWlzc2luZyBieXRlIGFsaWdubWVudCBvZmZzZXQuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAvLyBDaGVjayB0aGUgYnl0ZSBhbGlnbm1lbnQ6XHJcbiAgICAgICAgICAgIHN3aXRjaCAoIGRhdGFWaWV3LmdldFVpbnQxNiggdGlmZk9mZnNldCApICkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAweDQ5NDk6XHJcbiAgICAgICAgICAgICAgICAgICAgbGl0dGxlRW5kaWFuID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgY2FzZSAweDRENEQ6XHJcbiAgICAgICAgICAgICAgICAgICAgbGl0dGxlRW5kaWFuID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgQmFzZS5sb2coJ0ludmFsaWQgRXhpZiBkYXRhOiBJbnZhbGlkIGJ5dGUgYWxpZ25tZW50IG1hcmtlci4nKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAvLyBDaGVjayBmb3IgdGhlIFRJRkYgdGFnIG1hcmtlciAoMHgwMDJBKTpcclxuICAgICAgICAgICAgaWYgKCBkYXRhVmlldy5nZXRVaW50MTYoIHRpZmZPZmZzZXQgKyAyLCBsaXR0bGVFbmRpYW4gKSAhPT0gMHgwMDJBICkge1xyXG4gICAgICAgICAgICAgICAgQmFzZS5sb2coJ0ludmFsaWQgRXhpZiBkYXRhOiBNaXNzaW5nIFRJRkYgbWFya2VyLicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgLy8gUmV0cmlldmUgdGhlIGRpcmVjdG9yeSBvZmZzZXQgYnl0ZXMsIHVzdWFsbHkgMHgwMDAwMDAwOCBvciA4IGRlY2ltYWw6XHJcbiAgICAgICAgICAgIGRpck9mZnNldCA9IGRhdGFWaWV3LmdldFVpbnQzMiggdGlmZk9mZnNldCArIDQsIGxpdHRsZUVuZGlhbiApO1xyXG4gICAgICAgICAgICAvLyBDcmVhdGUgdGhlIGV4aWYgb2JqZWN0IHRvIHN0b3JlIHRoZSB0YWdzOlxyXG4gICAgICAgICAgICBkYXRhLmV4aWYgPSBuZXcgRVhJRi5FeGlmTWFwKCk7XHJcbiAgICAgICAgICAgIC8vIFBhcnNlIHRoZSB0YWdzIG9mIHRoZSBtYWluIGltYWdlIGRpcmVjdG9yeSBhbmQgcmV0cmlldmUgdGhlXHJcbiAgICAgICAgICAgIC8vIG9mZnNldCB0byB0aGUgbmV4dCBkaXJlY3RvcnksIHVzdWFsbHkgdGhlIHRodW1ibmFpbCBkaXJlY3Rvcnk6XHJcbiAgICAgICAgICAgIGRpck9mZnNldCA9IEVYSUYucGFyc2VFeGlmVGFncyggZGF0YVZpZXcsIHRpZmZPZmZzZXQsXHJcbiAgICAgICAgICAgICAgICAgICAgdGlmZk9mZnNldCArIGRpck9mZnNldCwgbGl0dGxlRW5kaWFuLCBkYXRhICk7XHJcbiAgICBcclxuICAgICAgICAgICAgLy8g5bCd6K+V6K+75Y+W57yp55Wl5Zu+XHJcbiAgICAgICAgICAgIC8vIGlmICggZGlyT2Zmc2V0ICkge1xyXG4gICAgICAgICAgICAvLyAgICAgdGh1bWJuYWlsRGF0YSA9IHtleGlmOiB7fX07XHJcbiAgICAgICAgICAgIC8vICAgICBkaXJPZmZzZXQgPSBFWElGLnBhcnNlRXhpZlRhZ3MoXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgZGF0YVZpZXcsXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgdGlmZk9mZnNldCxcclxuICAgICAgICAgICAgLy8gICAgICAgICB0aWZmT2Zmc2V0ICsgZGlyT2Zmc2V0LFxyXG4gICAgICAgICAgICAvLyAgICAgICAgIGxpdHRsZUVuZGlhbixcclxuICAgICAgICAgICAgLy8gICAgICAgICB0aHVtYm5haWxEYXRhXHJcbiAgICAgICAgICAgIC8vICAgICApO1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8vICAgICAvLyBDaGVjayBmb3IgSlBFRyBUaHVtYm5haWwgb2Zmc2V0OlxyXG4gICAgICAgICAgICAvLyAgICAgaWYgKHRodW1ibmFpbERhdGEuZXhpZlsweDAyMDFdKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgZGF0YS5leGlmLlRodW1ibmFpbCA9IEVYSUYuZ2V0RXhpZlRodW1ibmFpbChcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgZGF0YVZpZXcsXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgIHRpZmZPZmZzZXQgKyB0aHVtYm5haWxEYXRhLmV4aWZbMHgwMjAxXSxcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICAgdGh1bWJuYWlsRGF0YS5leGlmWzB4MDIwMl0gLy8gVGh1bWJuYWlsIGRhdGEgbGVuZ3RoXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgKTtcclxuICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICBJbWFnZU1ldGEucGFyc2Vyc1sgMHhmZmUxIF0ucHVzaCggRVhJRi5wYXJzZUV4aWZEYXRhICk7XHJcbiAgICAgICAgcmV0dXJuIEVYSUY7XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICog6L+Z5Liq5pa55byP5oCn6IO95LiN6KGM77yM5L2G5piv5Y+v5Lul6Kej5YazYW5kcm9pZOmHjOmdoueahHRvRGF0YVVybOeahGJ1Z1xyXG4gICAgICogYW5kcm9pZOmHjOmdonRvRGF0YVVybCgnaW1hZ2UvanBlZ2UnKeW+l+WIsOeahOe7k+aenOWNtOaYr3BuZy5cclxuICAgICAqXHJcbiAgICAgKiDmiYDku6Xov5nph4zmsqHovpnvvIzlj6rog73lgJ/liqnov5nkuKrlt6XlhbdcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcganBlZyBlbmNvZGVyXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgncnVudGltZS9odG1sNS9qcGVnZW5jb2RlcicsW10sIGZ1bmN0aW9uKCByZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUgKSB7XHJcbiAgICBcclxuICAgICAgICAvKlxyXG4gICAgICAgICAgQ29weXJpZ2h0IChjKSAyMDA4LCBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZFxyXG4gICAgICAgICAgQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICAgIFxyXG4gICAgICAgICAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0XHJcbiAgICAgICAgICBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlXHJcbiAgICAgICAgICBtZXQ6XHJcbiAgICBcclxuICAgICAgICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLFxyXG4gICAgICAgICAgICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxyXG4gICAgXHJcbiAgICAgICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0XHJcbiAgICAgICAgICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGVcclxuICAgICAgICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cclxuICAgIFxyXG4gICAgICAgICAgKiBOZWl0aGVyIHRoZSBuYW1lIG9mIEFkb2JlIFN5c3RlbXMgSW5jb3Jwb3JhdGVkIG5vciB0aGUgbmFtZXMgb2YgaXRzXHJcbiAgICAgICAgICAgIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tXHJcbiAgICAgICAgICAgIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXHJcbiAgICBcclxuICAgICAgICAgIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBU1xyXG4gICAgICAgICAgSVNcIiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTyxcclxuICAgICAgICAgIFRIRSBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVJcclxuICAgICAgICAgIFBVUlBPU0UgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgT1dORVIgT1JcclxuICAgICAgICAgIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLFxyXG4gICAgICAgICAgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLFxyXG4gICAgICAgICAgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SXHJcbiAgICAgICAgICBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GXHJcbiAgICAgICAgICBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElOR1xyXG4gICAgICAgICAgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTXHJcbiAgICAgICAgICBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cclxuICAgICAgICAqL1xyXG4gICAgICAgIC8qXHJcbiAgICAgICAgSlBFRyBlbmNvZGVyIHBvcnRlZCB0byBKYXZhU2NyaXB0IGFuZCBvcHRpbWl6ZWQgYnkgQW5kcmVhcyBSaXR0ZXIsIHd3dy5ieXRlc3Ryb20uZXUsIDExLzIwMDlcclxuICAgIFxyXG4gICAgICAgIEJhc2ljIEdVSSBibG9ja2luZyBqcGVnIGVuY29kZXJcclxuICAgICAgICAqL1xyXG4gICAgXHJcbiAgICAgICAgZnVuY3Rpb24gSlBFR0VuY29kZXIocXVhbGl0eSkge1xyXG4gICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICB2YXIgZnJvdW5kID0gTWF0aC5yb3VuZDtcclxuICAgICAgICAgICAgdmFyIGZmbG9vciA9IE1hdGguZmxvb3I7XHJcbiAgICAgICAgICAgIHZhciBZVGFibGUgPSBuZXcgQXJyYXkoNjQpO1xyXG4gICAgICAgICAgICB2YXIgVVZUYWJsZSA9IG5ldyBBcnJheSg2NCk7XHJcbiAgICAgICAgICAgIHZhciBmZHRibF9ZID0gbmV3IEFycmF5KDY0KTtcclxuICAgICAgICAgICAgdmFyIGZkdGJsX1VWID0gbmV3IEFycmF5KDY0KTtcclxuICAgICAgICAgICAgdmFyIFlEQ19IVDtcclxuICAgICAgICAgICAgdmFyIFVWRENfSFQ7XHJcbiAgICAgICAgICAgIHZhciBZQUNfSFQ7XHJcbiAgICAgICAgICAgIHZhciBVVkFDX0hUO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHZhciBiaXRjb2RlID0gbmV3IEFycmF5KDY1NTM1KTtcclxuICAgICAgICAgICAgdmFyIGNhdGVnb3J5ID0gbmV3IEFycmF5KDY1NTM1KTtcclxuICAgICAgICAgICAgdmFyIG91dHB1dGZEQ1RRdWFudCA9IG5ldyBBcnJheSg2NCk7XHJcbiAgICAgICAgICAgIHZhciBEVSA9IG5ldyBBcnJheSg2NCk7XHJcbiAgICAgICAgICAgIHZhciBieXRlb3V0ID0gW107XHJcbiAgICAgICAgICAgIHZhciBieXRlbmV3ID0gMDtcclxuICAgICAgICAgICAgdmFyIGJ5dGVwb3MgPSA3O1xyXG4gICAgXHJcbiAgICAgICAgICAgIHZhciBZRFUgPSBuZXcgQXJyYXkoNjQpO1xyXG4gICAgICAgICAgICB2YXIgVURVID0gbmV3IEFycmF5KDY0KTtcclxuICAgICAgICAgICAgdmFyIFZEVSA9IG5ldyBBcnJheSg2NCk7XHJcbiAgICAgICAgICAgIHZhciBjbHQgPSBuZXcgQXJyYXkoMjU2KTtcclxuICAgICAgICAgICAgdmFyIFJHQl9ZVVZfVEFCTEUgPSBuZXcgQXJyYXkoMjA0OCk7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50UXVhbGl0eTtcclxuICAgIFxyXG4gICAgICAgICAgICB2YXIgWmlnWmFnID0gW1xyXG4gICAgICAgICAgICAgICAgICAgICAwLCAxLCA1LCA2LDE0LDE1LDI3LDI4LFxyXG4gICAgICAgICAgICAgICAgICAgICAyLCA0LCA3LDEzLDE2LDI2LDI5LDQyLFxyXG4gICAgICAgICAgICAgICAgICAgICAzLCA4LDEyLDE3LDI1LDMwLDQxLDQzLFxyXG4gICAgICAgICAgICAgICAgICAgICA5LDExLDE4LDI0LDMxLDQwLDQ0LDUzLFxyXG4gICAgICAgICAgICAgICAgICAgIDEwLDE5LDIzLDMyLDM5LDQ1LDUyLDU0LFxyXG4gICAgICAgICAgICAgICAgICAgIDIwLDIyLDMzLDM4LDQ2LDUxLDU1LDYwLFxyXG4gICAgICAgICAgICAgICAgICAgIDIxLDM0LDM3LDQ3LDUwLDU2LDU5LDYxLFxyXG4gICAgICAgICAgICAgICAgICAgIDM1LDM2LDQ4LDQ5LDU3LDU4LDYyLDYzXHJcbiAgICAgICAgICAgICAgICBdO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHZhciBzdGRfZGNfbHVtaW5hbmNlX25yY29kZXMgPSBbMCwwLDEsNSwxLDEsMSwxLDEsMSwwLDAsMCwwLDAsMCwwXTtcclxuICAgICAgICAgICAgdmFyIHN0ZF9kY19sdW1pbmFuY2VfdmFsdWVzID0gWzAsMSwyLDMsNCw1LDYsNyw4LDksMTAsMTFdO1xyXG4gICAgICAgICAgICB2YXIgc3RkX2FjX2x1bWluYW5jZV9ucmNvZGVzID0gWzAsMCwyLDEsMywzLDIsNCwzLDUsNSw0LDQsMCwwLDEsMHg3ZF07XHJcbiAgICAgICAgICAgIHZhciBzdGRfYWNfbHVtaW5hbmNlX3ZhbHVlcyA9IFtcclxuICAgICAgICAgICAgICAgICAgICAweDAxLDB4MDIsMHgwMywweDAwLDB4MDQsMHgxMSwweDA1LDB4MTIsXHJcbiAgICAgICAgICAgICAgICAgICAgMHgyMSwweDMxLDB4NDEsMHgwNiwweDEzLDB4NTEsMHg2MSwweDA3LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4MjIsMHg3MSwweDE0LDB4MzIsMHg4MSwweDkxLDB4YTEsMHgwOCxcclxuICAgICAgICAgICAgICAgICAgICAweDIzLDB4NDIsMHhiMSwweGMxLDB4MTUsMHg1MiwweGQxLDB4ZjAsXHJcbiAgICAgICAgICAgICAgICAgICAgMHgyNCwweDMzLDB4NjIsMHg3MiwweDgyLDB4MDksMHgwYSwweDE2LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4MTcsMHgxOCwweDE5LDB4MWEsMHgyNSwweDI2LDB4MjcsMHgyOCxcclxuICAgICAgICAgICAgICAgICAgICAweDI5LDB4MmEsMHgzNCwweDM1LDB4MzYsMHgzNywweDM4LDB4MzksXHJcbiAgICAgICAgICAgICAgICAgICAgMHgzYSwweDQzLDB4NDQsMHg0NSwweDQ2LDB4NDcsMHg0OCwweDQ5LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4NGEsMHg1MywweDU0LDB4NTUsMHg1NiwweDU3LDB4NTgsMHg1OSxcclxuICAgICAgICAgICAgICAgICAgICAweDVhLDB4NjMsMHg2NCwweDY1LDB4NjYsMHg2NywweDY4LDB4NjksXHJcbiAgICAgICAgICAgICAgICAgICAgMHg2YSwweDczLDB4NzQsMHg3NSwweDc2LDB4NzcsMHg3OCwweDc5LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4N2EsMHg4MywweDg0LDB4ODUsMHg4NiwweDg3LDB4ODgsMHg4OSxcclxuICAgICAgICAgICAgICAgICAgICAweDhhLDB4OTIsMHg5MywweDk0LDB4OTUsMHg5NiwweDk3LDB4OTgsXHJcbiAgICAgICAgICAgICAgICAgICAgMHg5OSwweDlhLDB4YTIsMHhhMywweGE0LDB4YTUsMHhhNiwweGE3LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4YTgsMHhhOSwweGFhLDB4YjIsMHhiMywweGI0LDB4YjUsMHhiNixcclxuICAgICAgICAgICAgICAgICAgICAweGI3LDB4YjgsMHhiOSwweGJhLDB4YzIsMHhjMywweGM0LDB4YzUsXHJcbiAgICAgICAgICAgICAgICAgICAgMHhjNiwweGM3LDB4YzgsMHhjOSwweGNhLDB4ZDIsMHhkMywweGQ0LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4ZDUsMHhkNiwweGQ3LDB4ZDgsMHhkOSwweGRhLDB4ZTEsMHhlMixcclxuICAgICAgICAgICAgICAgICAgICAweGUzLDB4ZTQsMHhlNSwweGU2LDB4ZTcsMHhlOCwweGU5LDB4ZWEsXHJcbiAgICAgICAgICAgICAgICAgICAgMHhmMSwweGYyLDB4ZjMsMHhmNCwweGY1LDB4ZjYsMHhmNywweGY4LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4ZjksMHhmYVxyXG4gICAgICAgICAgICAgICAgXTtcclxuICAgIFxyXG4gICAgICAgICAgICB2YXIgc3RkX2RjX2Nocm9taW5hbmNlX25yY29kZXMgPSBbMCwwLDMsMSwxLDEsMSwxLDEsMSwxLDEsMCwwLDAsMCwwXTtcclxuICAgICAgICAgICAgdmFyIHN0ZF9kY19jaHJvbWluYW5jZV92YWx1ZXMgPSBbMCwxLDIsMyw0LDUsNiw3LDgsOSwxMCwxMV07XHJcbiAgICAgICAgICAgIHZhciBzdGRfYWNfY2hyb21pbmFuY2VfbnJjb2RlcyA9IFswLDAsMiwxLDIsNCw0LDMsNCw3LDUsNCw0LDAsMSwyLDB4NzddO1xyXG4gICAgICAgICAgICB2YXIgc3RkX2FjX2Nocm9taW5hbmNlX3ZhbHVlcyA9IFtcclxuICAgICAgICAgICAgICAgICAgICAweDAwLDB4MDEsMHgwMiwweDAzLDB4MTEsMHgwNCwweDA1LDB4MjEsXHJcbiAgICAgICAgICAgICAgICAgICAgMHgzMSwweDA2LDB4MTIsMHg0MSwweDUxLDB4MDcsMHg2MSwweDcxLFxyXG4gICAgICAgICAgICAgICAgICAgIDB4MTMsMHgyMiwweDMyLDB4ODEsMHgwOCwweDE0LDB4NDIsMHg5MSxcclxuICAgICAgICAgICAgICAgICAgICAweGExLDB4YjEsMHhjMSwweDA5LDB4MjMsMHgzMywweDUyLDB4ZjAsXHJcbiAgICAgICAgICAgICAgICAgICAgMHgxNSwweDYyLDB4NzIsMHhkMSwweDBhLDB4MTYsMHgyNCwweDM0LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4ZTEsMHgyNSwweGYxLDB4MTcsMHgxOCwweDE5LDB4MWEsMHgyNixcclxuICAgICAgICAgICAgICAgICAgICAweDI3LDB4MjgsMHgyOSwweDJhLDB4MzUsMHgzNiwweDM3LDB4MzgsXHJcbiAgICAgICAgICAgICAgICAgICAgMHgzOSwweDNhLDB4NDMsMHg0NCwweDQ1LDB4NDYsMHg0NywweDQ4LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4NDksMHg0YSwweDUzLDB4NTQsMHg1NSwweDU2LDB4NTcsMHg1OCxcclxuICAgICAgICAgICAgICAgICAgICAweDU5LDB4NWEsMHg2MywweDY0LDB4NjUsMHg2NiwweDY3LDB4NjgsXHJcbiAgICAgICAgICAgICAgICAgICAgMHg2OSwweDZhLDB4NzMsMHg3NCwweDc1LDB4NzYsMHg3NywweDc4LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4NzksMHg3YSwweDgyLDB4ODMsMHg4NCwweDg1LDB4ODYsMHg4NyxcclxuICAgICAgICAgICAgICAgICAgICAweDg4LDB4ODksMHg4YSwweDkyLDB4OTMsMHg5NCwweDk1LDB4OTYsXHJcbiAgICAgICAgICAgICAgICAgICAgMHg5NywweDk4LDB4OTksMHg5YSwweGEyLDB4YTMsMHhhNCwweGE1LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4YTYsMHhhNywweGE4LDB4YTksMHhhYSwweGIyLDB4YjMsMHhiNCxcclxuICAgICAgICAgICAgICAgICAgICAweGI1LDB4YjYsMHhiNywweGI4LDB4YjksMHhiYSwweGMyLDB4YzMsXHJcbiAgICAgICAgICAgICAgICAgICAgMHhjNCwweGM1LDB4YzYsMHhjNywweGM4LDB4YzksMHhjYSwweGQyLFxyXG4gICAgICAgICAgICAgICAgICAgIDB4ZDMsMHhkNCwweGQ1LDB4ZDYsMHhkNywweGQ4LDB4ZDksMHhkYSxcclxuICAgICAgICAgICAgICAgICAgICAweGUyLDB4ZTMsMHhlNCwweGU1LDB4ZTYsMHhlNywweGU4LDB4ZTksXHJcbiAgICAgICAgICAgICAgICAgICAgMHhlYSwweGYyLDB4ZjMsMHhmNCwweGY1LDB4ZjYsMHhmNywweGY4LFxyXG4gICAgICAgICAgICAgICAgICAgIDB4ZjksMHhmYVxyXG4gICAgICAgICAgICAgICAgXTtcclxuICAgIFxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpbml0UXVhbnRUYWJsZXMoc2Ype1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBZUVQgPSBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDE2LCAxMSwgMTAsIDE2LCAyNCwgNDAsIDUxLCA2MSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgMTIsIDEyLCAxNCwgMTksIDI2LCA1OCwgNjAsIDU1LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAxNCwgMTMsIDE2LCAyNCwgNDAsIDU3LCA2OSwgNTYsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDE0LCAxNywgMjIsIDI5LCA1MSwgODcsIDgwLCA2MixcclxuICAgICAgICAgICAgICAgICAgICAgICAgMTgsIDIyLCAzNywgNTYsIDY4LDEwOSwxMDMsIDc3LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAyNCwgMzUsIDU1LCA2NCwgODEsMTA0LDExMywgOTIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDQ5LCA2NCwgNzgsIDg3LDEwMywxMjEsMTIwLDEwMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgNzIsIDkyLCA5NSwgOTgsMTEyLDEwMCwxMDMsIDk5XHJcbiAgICAgICAgICAgICAgICAgICAgXTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjQ7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IGZmbG9vcigoWVFUW2ldKnNmKzUwKS8xMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodCA8IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHQgPiAyNTUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQgPSAyNTU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgWVRhYmxlW1ppZ1phZ1tpXV0gPSB0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgVVZRVCA9IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAgMTcsIDE4LCAyNCwgNDcsIDk5LCA5OSwgOTksIDk5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAxOCwgMjEsIDI2LCA2NiwgOTksIDk5LCA5OSwgOTksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDI0LCAyNiwgNTYsIDk5LCA5OSwgOTksIDk5LCA5OSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgNDcsIDY2LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTlcclxuICAgICAgICAgICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgNjQ7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdSA9IGZmbG9vcigoVVZRVFtqXSpzZis1MCkvMTAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUgPCAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1ID4gMjU1KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1ID0gMjU1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFVWVGFibGVbWmlnWmFnW2pdXSA9IHU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhYXNmID0gW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAxLjAsIDEuMzg3MDM5ODQ1LCAxLjMwNjU2Mjk2NSwgMS4xNzU4NzU2MDIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDEuMCwgMC43ODU2OTQ5NTgsIDAuNTQxMTk2MTAwLCAwLjI3NTg5OTM3OVxyXG4gICAgICAgICAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGsgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IDg7IHJvdysrKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgODsgY29sKyspXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZkdGJsX1lba10gID0gKDEuMCAvIChZVGFibGUgW1ppZ1phZ1trXV0gKiBhYXNmW3Jvd10gKiBhYXNmW2NvbF0gKiA4LjApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZkdGJsX1VWW2tdID0gKDEuMCAvIChVVlRhYmxlW1ppZ1phZ1trXV0gKiBhYXNmW3Jvd10gKiBhYXNmW2NvbF0gKiA4LjApKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGsrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gY29tcHV0ZUh1ZmZtYW5UYmwobnJjb2Rlcywgc3RkX3RhYmxlKXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29kZXZhbHVlID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcG9zX2luX3RhYmxlID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgSFQgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMTsgayA8PSAxNjsgaysrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAxOyBqIDw9IG5yY29kZXNba107IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgSFRbc3RkX3RhYmxlW3Bvc19pbl90YWJsZV1dID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIVFtzdGRfdGFibGVbcG9zX2luX3RhYmxlXV1bMF0gPSBjb2RldmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIVFtzdGRfdGFibGVbcG9zX2luX3RhYmxlXV1bMV0gPSBrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zX2luX3RhYmxlKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RldmFsdWUrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RldmFsdWUqPTI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBIVDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5pdEh1ZmZtYW5UYmwoKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFlEQ19IVCA9IGNvbXB1dGVIdWZmbWFuVGJsKHN0ZF9kY19sdW1pbmFuY2VfbnJjb2RlcyxzdGRfZGNfbHVtaW5hbmNlX3ZhbHVlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgVVZEQ19IVCA9IGNvbXB1dGVIdWZmbWFuVGJsKHN0ZF9kY19jaHJvbWluYW5jZV9ucmNvZGVzLHN0ZF9kY19jaHJvbWluYW5jZV92YWx1ZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIFlBQ19IVCA9IGNvbXB1dGVIdWZmbWFuVGJsKHN0ZF9hY19sdW1pbmFuY2VfbnJjb2RlcyxzdGRfYWNfbHVtaW5hbmNlX3ZhbHVlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgVVZBQ19IVCA9IGNvbXB1dGVIdWZmbWFuVGJsKHN0ZF9hY19jaHJvbWluYW5jZV9ucmNvZGVzLHN0ZF9hY19jaHJvbWluYW5jZV92YWx1ZXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpbml0Q2F0ZWdvcnlOdW1iZXIoKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBucmxvd2VyID0gMTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbnJ1cHBlciA9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgY2F0ID0gMTsgY2F0IDw9IDE1OyBjYXQrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL1Bvc2l0aXZlIG51bWJlcnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbnIgPSBucmxvd2VyOyBucjxucnVwcGVyOyBucisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeVszMjc2Nytucl0gPSBjYXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRjb2RlWzMyNzY3K25yXSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYml0Y29kZVszMjc2Nytucl1bMV0gPSBjYXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRjb2RlWzMyNzY3K25yXVswXSA9IG5yO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vTmVnYXRpdmUgbnVtYmVyc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBucm5lZyA9LShucnVwcGVyLTEpOyBucm5lZzw9LW5ybG93ZXI7IG5ybmVnKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5WzMyNzY3K25ybmVnXSA9IGNhdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdGNvZGVbMzI3NjcrbnJuZWddID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRjb2RlWzMyNzY3K25ybmVnXVsxXSA9IGNhdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdGNvZGVbMzI3NjcrbnJuZWddWzBdID0gbnJ1cHBlci0xK25ybmVnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ybG93ZXIgPDw9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ydXBwZXIgPDw9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpbml0UkdCWVVWVGFibGUoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IDI1NjtpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUkdCX1lVVl9UQUJMRVtpXSAgICAgICAgICAgID0gIDE5NTk1ICogaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUkdCX1lVVl9UQUJMRVsoaSsgMjU2KT4+MF0gID0gIDM4NDcwICogaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUkdCX1lVVl9UQUJMRVsoaSsgNTEyKT4+MF0gID0gICA3NDcxICogaSArIDB4ODAwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUkdCX1lVVl9UQUJMRVsoaSsgNzY4KT4+MF0gID0gLTExMDU5ICogaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUkdCX1lVVl9UQUJMRVsoaSsxMDI0KT4+MF0gID0gLTIxNzA5ICogaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgUkdCX1lVVl9UQUJMRVsoaSsxMjgwKT4+MF0gID0gIDMyNzY4ICogaSArIDB4ODA3RkZGO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBSR0JfWVVWX1RBQkxFWyhpKzE1MzYpPj4wXSAgPSAtMjc0MzkgKiBpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBSR0JfWVVWX1RBQkxFWyhpKzE3OTIpPj4wXSAgPSAtIDUzMjkgKiBpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gSU8gZnVuY3Rpb25zXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiB3cml0ZUJpdHMoYnMpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gYnNbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvc3ZhbCA9IGJzWzFdLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBwb3N2YWwgPj0gMCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlICYgKDEgPDwgcG9zdmFsKSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVuZXcgfD0gKDEgPDwgYnl0ZXBvcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zdmFsLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVwb3MtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ5dGVwb3MgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnl0ZW5ldyA9PSAweEZGKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKDB4RkYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZShieXRlbmV3KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVwb3M9NztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVuZXc9MDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gd3JpdGVCeXRlKHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGJ5dGVvdXQucHVzaChjbHRbdmFsdWVdKTsgLy8gd3JpdGUgY2hhciBkaXJlY3RseSBpbnN0ZWFkIG9mIGNvbnZlcnRpbmcgbGF0ZXJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gd3JpdGVXb3JkKHZhbHVlKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgodmFsdWU+PjgpJjB4RkYpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgodmFsdWUgICApJjB4RkYpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBEQ1QgJiBxdWFudGl6YXRpb24gY29yZVxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gZkRDVFF1YW50KGRhdGEsIGZkdGJsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkMCwgZDEsIGQyLCBkMywgZDQsIGQ1LCBkNiwgZDc7XHJcbiAgICAgICAgICAgICAgICAgICAgLyogUGFzcyAxOiBwcm9jZXNzIHJvd3MuICovXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGFPZmY9MDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgSTggPSA4O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBJNjQgPSA2NDtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDsgaTxJODsgKytpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZDAgPSBkYXRhW2RhdGFPZmZdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkMSA9IGRhdGFbZGF0YU9mZisxXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZDIgPSBkYXRhW2RhdGFPZmYrMl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQzID0gZGF0YVtkYXRhT2ZmKzNdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkNCA9IGRhdGFbZGF0YU9mZis0XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZDUgPSBkYXRhW2RhdGFPZmYrNV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQ2ID0gZGF0YVtkYXRhT2ZmKzZdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkNyA9IGRhdGFbZGF0YU9mZis3XTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wMCA9IGQwICsgZDc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXA3ID0gZDAgLSBkNztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcDEgPSBkMSArIGQ2O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wNiA9IGQxIC0gZDY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAyID0gZDIgKyBkNTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcDUgPSBkMiAtIGQ1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wMyA9IGQzICsgZDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXA0ID0gZDMgLSBkNDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvKiBFdmVuIHBhcnQgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcDEwID0gdG1wMCArIHRtcDM7ICAgIC8qIHBoYXNlIDIgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcDEzID0gdG1wMCAtIHRtcDM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAxMSA9IHRtcDEgKyB0bXAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wMTIgPSB0bXAxIC0gdG1wMjtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2RhdGFPZmZdID0gdG1wMTAgKyB0bXAxMTsgLyogcGhhc2UgMyAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2RhdGFPZmYrNF0gPSB0bXAxMCAtIHRtcDExO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB6MSA9ICh0bXAxMiArIHRtcDEzKSAqIDAuNzA3MTA2NzgxOyAvKiBjNCAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2RhdGFPZmYrMl0gPSB0bXAxMyArIHoxOyAvKiBwaGFzZSA1ICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbZGF0YU9mZis2XSA9IHRtcDEzIC0gejE7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgLyogT2RkIHBhcnQgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wMTAgPSB0bXA0ICsgdG1wNTsgLyogcGhhc2UgMiAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAxMSA9IHRtcDUgKyB0bXA2O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAxMiA9IHRtcDYgKyB0bXA3O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qIFRoZSByb3RhdG9yIGlzIG1vZGlmaWVkIGZyb20gZmlnIDQtOCB0byBhdm9pZCBleHRyYSBuZWdhdGlvbnMuICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB6NSA9ICh0bXAxMCAtIHRtcDEyKSAqIDAuMzgyNjgzNDMzOyAvKiBjNiAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgejIgPSAwLjU0MTE5NjEwMCAqIHRtcDEwICsgejU7IC8qIGMyLWM2ICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB6NCA9IDEuMzA2NTYyOTY1ICogdG1wMTIgKyB6NTsgLyogYzIrYzYgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHozID0gdG1wMTEgKiAwLjcwNzEwNjc4MTsgLyogYzQgKi9cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgejExID0gdG1wNyArIHozOyAgICAvKiBwaGFzZSA1ICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB6MTMgPSB0bXA3IC0gejM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtkYXRhT2ZmKzVdID0gejEzICsgejI7IC8qIHBoYXNlIDYgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtkYXRhT2ZmKzNdID0gejEzIC0gejI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbZGF0YU9mZisxXSA9IHoxMSArIHo0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2RhdGFPZmYrN10gPSB6MTEgLSB6NDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhT2ZmICs9IDg7IC8qIGFkdmFuY2UgcG9pbnRlciB0byBuZXh0IHJvdyAqL1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8qIFBhc3MgMjogcHJvY2VzcyBjb2x1bW5zLiAqL1xyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFPZmYgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAoaT0wOyBpPEk4OyArK2kpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkMCA9IGRhdGFbZGF0YU9mZl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQxID0gZGF0YVtkYXRhT2ZmICsgOF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQyID0gZGF0YVtkYXRhT2ZmICsgMTZdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkMyA9IGRhdGFbZGF0YU9mZiArIDI0XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZDQgPSBkYXRhW2RhdGFPZmYgKyAzMl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGQ1ID0gZGF0YVtkYXRhT2ZmICsgNDBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkNiA9IGRhdGFbZGF0YU9mZiArIDQ4XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZDcgPSBkYXRhW2RhdGFPZmYgKyA1Nl07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcDBwMiA9IGQwICsgZDc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXA3cDIgPSBkMCAtIGQ3O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wMXAyID0gZDEgKyBkNjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcDZwMiA9IGQxIC0gZDY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAycDIgPSBkMiArIGQ1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wNXAyID0gZDIgLSBkNTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcDNwMiA9IGQzICsgZDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXA0cDIgPSBkMyAtIGQ0O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qIEV2ZW4gcGFydCAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wMTBwMiA9IHRtcDBwMiArIHRtcDNwMjsgIC8qIHBoYXNlIDIgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRtcDEzcDIgPSB0bXAwcDIgLSB0bXAzcDI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0bXAxMXAyID0gdG1wMXAyICsgdG1wMnAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG1wMTJwMiA9IHRtcDFwMiAtIHRtcDJwMjtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2RhdGFPZmZdID0gdG1wMTBwMiArIHRtcDExcDI7IC8qIHBoYXNlIDMgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtkYXRhT2ZmKzMyXSA9IHRtcDEwcDIgLSB0bXAxMXAyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB6MXAyID0gKHRtcDEycDIgKyB0bXAxM3AyKSAqIDAuNzA3MTA2NzgxOyAvKiBjNCAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2RhdGFPZmYrMTZdID0gdG1wMTNwMiArIHoxcDI7IC8qIHBoYXNlIDUgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtkYXRhT2ZmKzQ4XSA9IHRtcDEzcDIgLSB6MXAyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qIE9kZCBwYXJ0ICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcDEwcDIgPSB0bXA0cDIgKyB0bXA1cDI7IC8qIHBoYXNlIDIgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wMTFwMiA9IHRtcDVwMiArIHRtcDZwMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wMTJwMiA9IHRtcDZwMiArIHRtcDdwMjtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvKiBUaGUgcm90YXRvciBpcyBtb2RpZmllZCBmcm9tIGZpZyA0LTggdG8gYXZvaWQgZXh0cmEgbmVnYXRpb25zLiAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgejVwMiA9ICh0bXAxMHAyIC0gdG1wMTJwMikgKiAwLjM4MjY4MzQzMzsgLyogYzYgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHoycDIgPSAwLjU0MTE5NjEwMCAqIHRtcDEwcDIgKyB6NXAyOyAvKiBjMi1jNiAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgejRwMiA9IDEuMzA2NTYyOTY1ICogdG1wMTJwMiArIHo1cDI7IC8qIGMyK2M2ICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB6M3AyID0gdG1wMTFwMiAqIDAuNzA3MTA2NzgxOyAvKiBjNCAqL1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB6MTFwMiA9IHRtcDdwMiArIHozcDI7ICAvKiBwaGFzZSA1ICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB6MTNwMiA9IHRtcDdwMiAtIHozcDI7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtkYXRhT2ZmKzQwXSA9IHoxM3AyICsgejJwMjsgLyogcGhhc2UgNiAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2RhdGFPZmYrMjRdID0gejEzcDIgLSB6MnAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2RhdGFPZmYrIDhdID0gejExcDIgKyB6NHAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2RhdGFPZmYrNTZdID0gejExcDIgLSB6NHAyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFPZmYrKzsgLyogYWR2YW5jZSBwb2ludGVyIHRvIG5leHQgY29sdW1uICovXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gUXVhbnRpemUvZGVzY2FsZSB0aGUgY29lZmZpY2llbnRzXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZEQ1RRdWFudDtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGk9MDsgaTxJNjQ7ICsraSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IHRoZSBxdWFudGl6YXRpb24gYW5kIHNjYWxpbmcgZmFjdG9yICYgUm91bmQgdG8gbmVhcmVzdCBpbnRlZ2VyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZEQ1RRdWFudCA9IGRhdGFbaV0qZmR0YmxbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dGZEQ1RRdWFudFtpXSA9IChmRENUUXVhbnQgPiAwLjApID8gKChmRENUUXVhbnQgKyAwLjUpfDApIDogKChmRENUUXVhbnQgLSAwLjUpfDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL291dHB1dGZEQ1RRdWFudFtpXSA9IGZyb3VuZChmRENUUXVhbnQpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXRmRENUUXVhbnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHdyaXRlQVBQMCgpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVXb3JkKDB4RkZFMCk7IC8vIG1hcmtlclxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlV29yZCgxNik7IC8vIGxlbmd0aFxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgweDRBKTsgLy8gSlxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgweDQ2KTsgLy8gRlxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgweDQ5KTsgLy8gSVxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgweDQ2KTsgLy8gRlxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgwKTsgLy8gPSBcIkpGSUZcIiwnXFwwJ1xyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgxKTsgLy8gdmVyc2lvbmhpXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKDEpOyAvLyB2ZXJzaW9ubG9cclxuICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoMCk7IC8vIHh5dW5pdHNcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZVdvcmQoMSk7IC8vIHhkZW5zaXR5XHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVXb3JkKDEpOyAvLyB5ZGVuc2l0eVxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgwKTsgLy8gdGh1bWJud2lkdGhcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoMCk7IC8vIHRodW1ibmhlaWdodFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiB3cml0ZVNPRjAod2lkdGgsIGhlaWdodClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZVdvcmQoMHhGRkMwKTsgLy8gbWFya2VyXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVXb3JkKDE3KTsgICAvLyBsZW5ndGgsIHRydWVjb2xvciBZVVYgSlBHXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKDgpOyAgICAvLyBwcmVjaXNpb25cclxuICAgICAgICAgICAgICAgICAgICB3cml0ZVdvcmQoaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZVdvcmQod2lkdGgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgzKTsgICAgLy8gbnJvZmNvbXBvbmVudHNcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoMSk7ICAgIC8vIElkWVxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgweDExKTsgLy8gSFZZXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKDApOyAgICAvLyBRVFlcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoMik7ICAgIC8vIElkVVxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgweDExKTsgLy8gSFZVXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKDEpOyAgICAvLyBRVFVcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoMyk7ICAgIC8vIElkVlxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgweDExKTsgLy8gSFZWXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKDEpOyAgICAvLyBRVFZcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gd3JpdGVEUVQoKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlV29yZCgweEZGREIpOyAvLyBtYXJrZXJcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZVdvcmQoMTMyKTsgICAgLy8gbGVuZ3RoXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGk9MDsgaTw2NDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZShZVGFibGVbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaj0wOyBqPDY0OyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKFVWVGFibGVbal0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gd3JpdGVESFQoKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlV29yZCgweEZGQzQpOyAvLyBtYXJrZXJcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZVdvcmQoMHgwMUEyKTsgLy8gbGVuZ3RoXHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoMCk7IC8vIEhUWURDaW5mb1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGk9MDsgaTwxNjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZShzdGRfZGNfbHVtaW5hbmNlX25yY29kZXNbaSsxXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGo9MDsgajw9MTE7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoc3RkX2RjX2x1bWluYW5jZV92YWx1ZXNbal0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgweDEwKTsgLy8gSFRZQUNpbmZvXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaz0wOyBrPDE2OyBrKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKHN0ZF9hY19sdW1pbmFuY2VfbnJjb2Rlc1trKzFdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbD0wOyBsPD0xNjE7IGwrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoc3RkX2FjX2x1bWluYW5jZV92YWx1ZXNbbF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgxKTsgLy8gSFRVRENpbmZvXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbT0wOyBtPDE2OyBtKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKHN0ZF9kY19jaHJvbWluYW5jZV9ucmNvZGVzW20rMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBuPTA7IG48PTExOyBuKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKHN0ZF9kY19jaHJvbWluYW5jZV92YWx1ZXNbbl0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgweDExKTsgLy8gSFRVQUNpbmZvXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbz0wOyBvPDE2OyBvKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKHN0ZF9hY19jaHJvbWluYW5jZV9ucmNvZGVzW28rMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBwPTA7IHA8PTE2MTsgcCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZShzdGRfYWNfY2hyb21pbmFuY2VfdmFsdWVzW3BdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHdyaXRlU09TKClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZVdvcmQoMHhGRkRBKTsgLy8gbWFya2VyXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVXb3JkKDEyKTsgLy8gbGVuZ3RoXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKDMpOyAvLyBucm9mY29tcG9uZW50c1xyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgxKTsgLy8gSWRZXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKDApOyAvLyBIVFlcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoMik7IC8vIElkVVxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgweDExKTsgLy8gSFRVXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKDMpOyAvLyBJZFZcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoMHgxMSk7IC8vIEhUVlxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlQnl0ZSgwKTsgLy8gU3NcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZUJ5dGUoMHgzZik7IC8vIFNlXHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVCeXRlKDApOyAvLyBCZlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzRFUoQ0RVLCBmZHRibCwgREMsIEhUREMsIEhUQUMpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBFT0IgPSBIVEFDWzB4MDBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBNMTZ6ZXJvZXMgPSBIVEFDWzB4RjBdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3M7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIEkxNiA9IDE2O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBJNjMgPSA2MztcclxuICAgICAgICAgICAgICAgICAgICB2YXIgSTY0ID0gNjQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIERVX0RDVCA9IGZEQ1RRdWFudChDRFUsIGZkdGJsKTtcclxuICAgICAgICAgICAgICAgICAgICAvL1ppZ1phZyByZW9yZGVyXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaj0wO2o8STY0Oysraikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBEVVtaaWdaYWdbal1dPURVX0RDVFtqXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIERpZmYgPSBEVVswXSAtIERDOyBEQyA9IERVWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vRW5jb2RlIERDXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKERpZmY9PTApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVCaXRzKEhURENbMF0pOyAvLyBEaWZmIG1pZ2h0IGJlIDBcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3MgPSAzMjc2NytEaWZmO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZUJpdHMoSFREQ1tjYXRlZ29yeVtwb3NdXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlQml0cyhiaXRjb2RlW3Bvc10pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvL0VuY29kZSBBQ3NcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kMHBvcyA9IDYzOyAvLyB3YXMgY29uc3QuLi4gd2hpY2ggaXMgY3JhenlcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKDsgKGVuZDBwb3M+MCkmJihEVVtlbmQwcG9zXT09MCk7IGVuZDBwb3MtLSkge307XHJcbiAgICAgICAgICAgICAgICAgICAgLy9lbmQwcG9zID0gZmlyc3QgZWxlbWVudCBpbiByZXZlcnNlIG9yZGVyICE9MFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggZW5kMHBvcyA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlQml0cyhFT0IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gREM7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpID0gMTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbG5nO1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICggaSA8PSBlbmQwcG9zICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnRwb3MgPSBpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgKERVW2ldPT0wKSAmJiAoaTw9ZW5kMHBvcyk7ICsraSkge31cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5yemVyb2VzID0gaS1zdGFydHBvcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBucnplcm9lcyA+PSBJMTYgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsbmcgPSBucnplcm9lcz4+NDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIG5ybWFya2VyPTE7IG5ybWFya2VyIDw9IGxuZzsgKytucm1hcmtlcilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZUJpdHMoTTE2emVyb2VzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5yemVyb2VzID0gbnJ6ZXJvZXMmMHhGO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcyA9IDMyNzY3K0RVW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZUJpdHMoSFRBQ1sobnJ6ZXJvZXM8PDQpK2NhdGVnb3J5W3Bvc11dKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVCaXRzKGJpdGNvZGVbcG9zXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBlbmQwcG9zICE9IEk2MyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVCaXRzKEVPQik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBEQztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gaW5pdENoYXJMb29rdXBUYWJsZSgpe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzZmNjID0gU3RyaW5nLmZyb21DaGFyQ29kZTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGk9MDsgaSA8IDI1NjsgaSsrKXsgLy8vLy8gQUNIVFVORyAvLyAyNTVcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2x0W2ldID0gc2ZjYyhpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuZW5jb2RlID0gZnVuY3Rpb24oaW1hZ2UscXVhbGl0eSkgLy8gaW1hZ2UgZGF0YSBvYmplY3RcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyB2YXIgdGltZV9zdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYocXVhbGl0eSkgc2V0UXVhbGl0eShxdWFsaXR5KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYWxpemUgYml0IHdyaXRlclxyXG4gICAgICAgICAgICAgICAgICAgIGJ5dGVvdXQgPSBuZXcgQXJyYXkoKTtcclxuICAgICAgICAgICAgICAgICAgICBieXRlbmV3PTA7XHJcbiAgICAgICAgICAgICAgICAgICAgYnl0ZXBvcz03O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIEpQRUcgaGVhZGVyc1xyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlV29yZCgweEZGRDgpOyAvLyBTT0lcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZUFQUDAoKTtcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZURRVCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlU09GMChpbWFnZS53aWR0aCxpbWFnZS5oZWlnaHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlREhUKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVTT1MoKTtcclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRW5jb2RlIDh4OCBtYWNyb2Jsb2Nrc1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBEQ1k9MDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgRENVPTA7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIERDVj0wO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgYnl0ZW5ldz0wO1xyXG4gICAgICAgICAgICAgICAgICAgIGJ5dGVwb3M9NztcclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbmNvZGUuZGlzcGxheU5hbWUgPSBcIl9lbmNvZGVfXCI7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW1hZ2VEYXRhID0gaW1hZ2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBpbWFnZS53aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHF1YWRXaWR0aCA9IHdpZHRoKjQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRyaXBsZVdpZHRoID0gd2lkdGgqMztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4LCB5ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgciwgZywgYjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnQscCwgY29sLHJvdyxwb3M7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUoeSA8IGhlaWdodCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSh4IDwgcXVhZFdpZHRoKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBxdWFkV2lkdGggKiB5ICsgeDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHN0YXJ0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2wgPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm93ID0gMDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IocG9zPTA7IHBvcyA8IDY0OyBwb3MrKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cgPSBwb3MgPj4gMzsvLyAvOFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sID0gKCBwb3MgJiA3ICkgKiA0OyAvLyAlOFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcCA9IHN0YXJ0ICsgKCByb3cgKiBxdWFkV2lkdGggKSArIGNvbDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoeStyb3cgPj0gaGVpZ2h0KXsgLy8gcGFkZGluZyBib3R0b21cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwLT0gKHF1YWRXaWR0aCooeSsxK3Jvdy1oZWlnaHQpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoeCtjb2wgPj0gcXVhZFdpZHRoKXsgLy8gcGFkZGluZyByaWdodFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAtPSAoKHgrY29sKSAtIHF1YWRXaWR0aCArNClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgciA9IGltYWdlRGF0YVsgcCsrIF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gaW1hZ2VEYXRhWyBwKysgXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBpbWFnZURhdGFbIHArKyBdO1xyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIC8vIGNhbGN1bGF0ZSBZVVYgdmFsdWVzIGR5bmFtaWNhbGx5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBZRFVbcG9zXT0oKCggMC4yOTkwMCkqcisoIDAuNTg3MDApKmcrKCAwLjExNDAwKSpiKSktMTI4OyAvLy0weDgwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVRFVbcG9zXT0oKCgtMC4xNjg3NCkqcisoLTAuMzMxMjYpKmcrKCAwLjUwMDAwKSpiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWRFVbcG9zXT0oKCggMC41MDAwMCkqcisoLTAuNDE4NjkpKmcrKC0wLjA4MTMxKSpiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2UgbG9va3VwIHRhYmxlIChzbGlnaHRseSBmYXN0ZXIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBZRFVbcG9zXSA9ICgoUkdCX1lVVl9UQUJMRVtyXSAgICAgICAgICAgICArIFJHQl9ZVVZfVEFCTEVbKGcgKyAgMjU2KT4+MF0gKyBSR0JfWVVWX1RBQkxFWyhiICsgIDUxMik+PjBdKSA+PiAxNiktMTI4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVURVW3Bvc10gPSAoKFJHQl9ZVVZfVEFCTEVbKHIgKyAgNzY4KT4+MF0gKyBSR0JfWVVWX1RBQkxFWyhnICsgMTAyNCk+PjBdICsgUkdCX1lVVl9UQUJMRVsoYiArIDEyODApPj4wXSkgPj4gMTYpLTEyODtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZEVVtwb3NdID0gKChSR0JfWVVWX1RBQkxFWyhyICsgMTI4MCk+PjBdICsgUkdCX1lVVl9UQUJMRVsoZyArIDE1MzYpPj4wXSArIFJHQl9ZVVZfVEFCTEVbKGIgKyAxNzkyKT4+MF0pID4+IDE2KS0xMjg7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIERDWSA9IHByb2Nlc3NEVShZRFUsIGZkdGJsX1ksIERDWSwgWURDX0hULCBZQUNfSFQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBEQ1UgPSBwcm9jZXNzRFUoVURVLCBmZHRibF9VViwgRENVLCBVVkRDX0hULCBVVkFDX0hUKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRENWID0gcHJvY2Vzc0RVKFZEVSwgZmR0YmxfVVYsIERDViwgVVZEQ19IVCwgVVZBQ19IVCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHgrPTMyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHkrPTg7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBEbyB0aGUgYml0IGFsaWdubWVudCBvZiB0aGUgRU9JIG1hcmtlclxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggYnl0ZXBvcyA+PSAwICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmlsbGJpdHMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbGJpdHNbMV0gPSBieXRlcG9zKzE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxiaXRzWzBdID0gKDE8PChieXRlcG9zKzEpKS0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3cml0ZUJpdHMoZmlsbGJpdHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHdyaXRlV29yZCgweEZGRDkpOyAvL0VPSVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGpwZWdEYXRhVXJpID0gJ2RhdGE6aW1hZ2UvanBlZztiYXNlNjQsJyArIGJ0b2EoYnl0ZW91dC5qb2luKCcnKSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBieXRlb3V0ID0gW107XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAvLyBiZW5jaG1hcmtpbmdcclxuICAgICAgICAgICAgICAgICAgICAvLyB2YXIgZHVyYXRpb24gPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRpbWVfc3RhcnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ0VuY29kaW5nIHRpbWU6ICcrIGN1cnJlbnRRdWFsaXR5ICsgJ21zJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBqcGVnRGF0YVVyaVxyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0UXVhbGl0eShxdWFsaXR5KXtcclxuICAgICAgICAgICAgICAgIGlmIChxdWFsaXR5IDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBxdWFsaXR5ID0gMTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChxdWFsaXR5ID4gMTAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcXVhbGl0eSA9IDEwMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYoY3VycmVudFF1YWxpdHkgPT0gcXVhbGl0eSkgcmV0dXJuIC8vIGRvbid0IHJlY2FsYyBpZiB1bmNoYW5nZWRcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgdmFyIHNmID0gMDtcclxuICAgICAgICAgICAgICAgIGlmIChxdWFsaXR5IDwgNTApIHtcclxuICAgICAgICAgICAgICAgICAgICBzZiA9IE1hdGguZmxvb3IoNTAwMCAvIHF1YWxpdHkpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZiA9IE1hdGguZmxvb3IoMjAwIC0gcXVhbGl0eSoyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaW5pdFF1YW50VGFibGVzKHNmKTtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRRdWFsaXR5ID0gcXVhbGl0eTtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdRdWFsaXR5IHNldCB0bzogJytxdWFsaXR5ICsnJScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgZnVuY3Rpb24gaW5pdCgpe1xyXG4gICAgICAgICAgICAgICAgLy8gdmFyIHRpbWVfc3RhcnQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgIGlmKCFxdWFsaXR5KSBxdWFsaXR5ID0gNTA7XHJcbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGFibGVzXHJcbiAgICAgICAgICAgICAgICBpbml0Q2hhckxvb2t1cFRhYmxlKClcclxuICAgICAgICAgICAgICAgIGluaXRIdWZmbWFuVGJsKCk7XHJcbiAgICAgICAgICAgICAgICBpbml0Q2F0ZWdvcnlOdW1iZXIoKTtcclxuICAgICAgICAgICAgICAgIGluaXRSR0JZVVZUYWJsZSgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBzZXRRdWFsaXR5KHF1YWxpdHkpO1xyXG4gICAgICAgICAgICAgICAgLy8gdmFyIGR1cmF0aW9uID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aW1lX3N0YXJ0O1xyXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ0luaXRpYWxpemF0aW9uICcrIGR1cmF0aW9uICsgJ21zJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICBcclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgSlBFR0VuY29kZXIuZW5jb2RlID0gZnVuY3Rpb24oIGRhdGEsIHF1YWxpdHkgKSB7XHJcbiAgICAgICAgICAgIHZhciBlbmNvZGVyID0gbmV3IEpQRUdFbmNvZGVyKCBxdWFsaXR5ICk7XHJcbiAgICBcclxuICAgICAgICAgICAgcmV0dXJuIGVuY29kZXIuZW5jb2RlKCBkYXRhICk7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIEpQRUdFbmNvZGVyO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcgRml4IGFuZHJvaWQgY2FudmFzLnRvRGF0YVVybCBidWcuXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgncnVudGltZS9odG1sNS9hbmRyb2lkcGF0Y2gnLFtcclxuICAgICAgICAncnVudGltZS9odG1sNS91dGlsJyxcclxuICAgICAgICAncnVudGltZS9odG1sNS9qcGVnZW5jb2RlcicsXHJcbiAgICAgICAgJ2Jhc2UnXHJcbiAgICBdLCBmdW5jdGlvbiggVXRpbCwgZW5jb2RlciwgQmFzZSApIHtcclxuICAgICAgICB2YXIgb3JpZ2luID0gVXRpbC5jYW52YXNUb0RhdGFVcmwsXHJcbiAgICAgICAgICAgIHN1cHBvcnRKcGVnO1xyXG4gICAgXHJcbiAgICAgICAgVXRpbC5jYW52YXNUb0RhdGFVcmwgPSBmdW5jdGlvbiggY2FudmFzLCB0eXBlLCBxdWFsaXR5ICkge1xyXG4gICAgICAgICAgICB2YXIgY3R4LCB3LCBoLCBmcmFnZW1lbnQsIHBhcnRzO1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOmdnmFuZHJvaWTmiYvmnLrnm7TmjqXot7Pov4fjgIJcclxuICAgICAgICAgICAgaWYgKCAhQmFzZS5vcy5hbmRyb2lkICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbi5hcHBseSggbnVsbCwgYXJndW1lbnRzICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAvLyDmo4DmtYvmmK/lkKZjYW52YXPmlK/mjIFqcGVn5a+85Ye677yM5qC55o2u5pWw5o2u5qC85byP5p2l5Yik5pat44CCXHJcbiAgICAgICAgICAgIC8vIEpQRUcg5YmN5Lik5L2N5YiG5Yir5piv77yaMjU1LCAyMTZcclxuICAgICAgICAgICAgaWYgKCB0eXBlID09PSAnaW1hZ2UvanBlZycgJiYgdHlwZW9mIHN1cHBvcnRKcGVnID09PSAndW5kZWZpbmVkJyApIHtcclxuICAgICAgICAgICAgICAgIGZyYWdlbWVudCA9IG9yaWdpbi5hcHBseSggbnVsbCwgYXJndW1lbnRzICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHBhcnRzID0gZnJhZ2VtZW50LnNwbGl0KCcsJyk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggfnBhcnRzWyAwIF0uaW5kZXhPZignYmFzZTY0JykgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJhZ2VtZW50ID0gYXRvYiggcGFydHNbIDEgXSApO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmcmFnZW1lbnQgPSBkZWNvZGVVUklDb21wb25lbnQoIHBhcnRzWyAxIF0gKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgZnJhZ2VtZW50ID0gZnJhZ2VtZW50LnN1YnN0cmluZyggMCwgMiApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBzdXBwb3J0SnBlZyA9IGZyYWdlbWVudC5jaGFyQ29kZUF0KCAwICkgPT09IDI1NSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmcmFnZW1lbnQuY2hhckNvZGVBdCggMSApID09PSAyMTY7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAvLyDlj6rmnInlnKhhbmRyb2lk546v5aKD5LiL5omN5L+u5aSNXHJcbiAgICAgICAgICAgIGlmICggdHlwZSA9PT0gJ2ltYWdlL2pwZWcnICYmICFzdXBwb3J0SnBlZyApIHtcclxuICAgICAgICAgICAgICAgIHcgPSBjYW52YXMud2lkdGg7XHJcbiAgICAgICAgICAgICAgICBoID0gY2FudmFzLmhlaWdodDtcclxuICAgICAgICAgICAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZW5jb2Rlci5lbmNvZGUoIGN0eC5nZXRJbWFnZURhdGEoIDAsIDAsIHcsIGggKSwgcXVhbGl0eSApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbi5hcHBseSggbnVsbCwgYXJndW1lbnRzICk7XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IEltYWdlXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgncnVudGltZS9odG1sNS9pbWFnZScsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAncnVudGltZS9odG1sNS9ydW50aW1lJyxcclxuICAgICAgICAncnVudGltZS9odG1sNS91dGlsJ1xyXG4gICAgXSwgZnVuY3Rpb24oIEJhc2UsIEh0bWw1UnVudGltZSwgVXRpbCApIHtcclxuICAgIFxyXG4gICAgICAgIHZhciBCTEFOSyA9ICdkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUFEL0FDd0FBQUFBQVFBQkFBQUNBRHMlM0QnO1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIEh0bWw1UnVudGltZS5yZWdpc3RlciggJ0ltYWdlJywge1xyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIGZsYWc6IOagh+iusOaYr+WQpuiiq+S/ruaUuei/h+OAglxyXG4gICAgICAgICAgICBtb2RpZmllZDogZmFsc2UsXHJcbiAgICBcclxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIGltZyA9IG5ldyBJbWFnZSgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBtZS5faW5mbyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogbWUudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHRcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy9kZWJ1Z2dlcjtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOivu+WPlm1ldGHkv6Hmga/jgIJcclxuICAgICAgICAgICAgICAgICAgICBpZiAoICFtZS5fbWV0YXMgJiYgJ2ltYWdlL2pwZWcnID09PSBtZS50eXBlICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsLnBhcnNlTWV0YSggbWUuX2Jsb2IsIGZ1bmN0aW9uKCBlcnJvciwgcmV0ICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWUuX21ldGFzID0gcmV0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWUub3duZXIudHJpZ2dlcignbG9hZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5vd25lci50cmlnZ2VyKCdsb2FkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICBtZS5vd25lci50cmlnZ2VyKCdlcnJvcicpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbWUuX2ltZyA9IGltZztcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBsb2FkRnJvbUJsb2I6IGZ1bmN0aW9uKCBibG9iICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBpbWcgPSBtZS5faW1nO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBtZS5fYmxvYiA9IGJsb2I7XHJcbiAgICAgICAgICAgICAgICBtZS50eXBlID0gYmxvYi50eXBlO1xyXG4gICAgICAgICAgICAgICAgaW1nLnNyYyA9IFV0aWwuY3JlYXRlT2JqZWN0VVJMKCBibG9iLmdldFNvdXJjZSgpICk7XHJcbiAgICAgICAgICAgICAgICBtZS5vd25lci5vbmNlKCAnbG9hZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWwucmV2b2tlT2JqZWN0VVJMKCBpbWcuc3JjICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICByZXNpemU6IGZ1bmN0aW9uKCB3aWR0aCwgaGVpZ2h0ICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhbnZhcyA9IHRoaXMuX2NhbnZhcyB8fFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAodGhpcy5fY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJykpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXNpemUoIHRoaXMuX2ltZywgY2FudmFzLCB3aWR0aCwgaGVpZ2h0ICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ibG9iID0gbnVsbDsgICAgLy8g5rKh55So5LqG77yM5Y+v5Lul5Yig5o6J5LqG44CCXHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vZGlmaWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMub3duZXIudHJpZ2dlciggJ2NvbXBsZXRlJywgJ3Jlc2l6ZScgKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBjcm9wOiBmdW5jdGlvbiggeCwgeSwgdywgaCwgcyApIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdnMgPSB0aGlzLl9jYW52YXMgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuX2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpKSxcclxuICAgICAgICAgICAgICAgICAgICBvcHRzID0gdGhpcy5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIGltZyA9IHRoaXMuX2ltZyxcclxuICAgICAgICAgICAgICAgICAgICBpdyA9IGltZy5uYXR1cmFsV2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgaWggPSBpbWcubmF0dXJhbEhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICBvcmllbnRhdGlvbiA9IHRoaXMuZ2V0T3JpZW50YXRpb24oKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcyA9IHMgfHwgMTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gdG9kbyDop6PlhrMgb3JpZW50YXRpb24g55qE6Zeu6aKY44CCXHJcbiAgICAgICAgICAgICAgICAvLyB2YWx1ZXMgdGhhdCByZXF1aXJlIDkwIGRlZ3JlZSByb3RhdGlvblxyXG4gICAgICAgICAgICAgICAgLy8gaWYgKCB+WyA1LCA2LCA3LCA4IF0uaW5kZXhPZiggb3JpZW50YXRpb24gKSApIHtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gICAgIHN3aXRjaCAoIG9yaWVudGF0aW9uICkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICBjYXNlIDY6XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICB0bXAgPSB4O1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgeCA9IHk7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICB5ID0gaXcgKiBzIC0gdG1wIC0gdztcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKGloICogcywgdG1wLCB3KVxyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyAgICAgKHcgXj0gaCwgaCBePSB3LCB3IF49IGgpO1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBjdnMud2lkdGggPSB3O1xyXG4gICAgICAgICAgICAgICAgY3ZzLmhlaWdodCA9IGg7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIG9wdHMucHJlc2VydmVIZWFkZXJzIHx8IHRoaXMuX3JvdGF0ZTJPcmllbnRhaW9uKCBjdnMsIG9yaWVudGF0aW9uICk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJJbWFnZVRvQ2FudmFzKCBjdnMsIGltZywgLXgsIC15LCBpdyAqIHMsIGloICogcyApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ibG9iID0gbnVsbDsgICAgLy8g5rKh55So5LqG77yM5Y+v5Lul5Yig5o6J5LqG44CCXHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vZGlmaWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMub3duZXIudHJpZ2dlciggJ2NvbXBsZXRlJywgJ2Nyb3AnICk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgZ2V0QXNCbG9iOiBmdW5jdGlvbiggdHlwZSApIHtcclxuICAgICAgICAgICAgICAgIHZhciBibG9iID0gdGhpcy5fYmxvYixcclxuICAgICAgICAgICAgICAgICAgICBvcHRzID0gdGhpcy5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIGNhbnZhcztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgdHlwZSA9IHR5cGUgfHwgdGhpcy50eXBlO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBibG9i6ZyA6KaB6YeN5paw55Sf5oiQ44CCXHJcbiAgICAgICAgICAgICAgICBpZiAoIHRoaXMubW9kaWZpZWQgfHwgdGhpcy50eXBlICE9PSB0eXBlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbnZhcyA9IHRoaXMuX2NhbnZhcztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggdHlwZSA9PT0gJ2ltYWdlL2pwZWcnICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2IgPSBVdGlsLmNhbnZhc1RvRGF0YVVybCggY2FudmFzLCB0eXBlLCBvcHRzLnF1YWxpdHkgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIG9wdHMucHJlc2VydmVIZWFkZXJzICYmIHRoaXMuX21ldGFzICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fbWV0YXMuaW1hZ2VIZWFkICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9iID0gVXRpbC5kYXRhVVJMMkFycmF5QnVmZmVyKCBibG9iICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9iID0gVXRpbC51cGRhdGVJbWFnZUhlYWQoIGJsb2IsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX21ldGFzLmltYWdlSGVhZCApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvYiA9IFV0aWwuYXJyYXlCdWZmZXJUb0Jsb2IoIGJsb2IsIHR5cGUgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBibG9iO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmxvYiA9IFV0aWwuY2FudmFzVG9EYXRhVXJsKCBjYW52YXMsIHR5cGUgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBibG9iID0gVXRpbC5kYXRhVVJMMkJsb2IoIGJsb2IgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGJsb2I7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgZ2V0QXNEYXRhVXJsOiBmdW5jdGlvbiggdHlwZSApIHtcclxuICAgICAgICAgICAgICAgIHZhciBvcHRzID0gdGhpcy5vcHRpb25zO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0eXBlID0gdHlwZSB8fCB0aGlzLnR5cGU7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggdHlwZSA9PT0gJ2ltYWdlL2pwZWcnICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBVdGlsLmNhbnZhc1RvRGF0YVVybCggdGhpcy5fY2FudmFzLCB0eXBlLCBvcHRzLnF1YWxpdHkgKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhbnZhcy50b0RhdGFVUkwoIHR5cGUgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBnZXRPcmllbnRhdGlvbjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWV0YXMgJiYgdGhpcy5fbWV0YXMuZXhpZiAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tZXRhcy5leGlmLmdldCgnT3JpZW50YXRpb24nKSB8fCAxO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGluZm86IGZ1bmN0aW9uKCB2YWwgKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIHNldHRlclxyXG4gICAgICAgICAgICAgICAgaWYgKCB2YWwgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5mbyA9IHZhbDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gZ2V0dGVyXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faW5mbztcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBtZXRhOiBmdW5jdGlvbiggdmFsICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBzZXR0ZXJcclxuICAgICAgICAgICAgICAgIGlmICggdmFsICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX21ldGFzID0gdmFsO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBnZXR0ZXJcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9tZXRhcztcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjYW52YXMgPSB0aGlzLl9jYW52YXM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pbWcub25sb2FkID0gbnVsbDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCBjYW52YXMgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FudmFzLmdldENvbnRleHQoJzJkJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jbGVhclJlY3QoIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCApO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IGNhbnZhcy5oZWlnaHQgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhcyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOmHiuaUvuWGheWtmOOAgumdnuW4uOmHjeimge+8jOWQpuWImemHiuaUvuS4jeS6hmltYWdl55qE5YaF5a2Y44CCXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pbWcuc3JjID0gQkxBTks7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9pbWcgPSB0aGlzLl9ibG9iID0gbnVsbDtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBfcmVzaXplOiBmdW5jdGlvbiggaW1nLCBjdnMsIHdpZHRoLCBoZWlnaHQgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3B0cyA9IHRoaXMub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgICAgICBuYXR1cmFsV2lkdGggPSBpbWcud2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgbmF0dXJhbEhlaWdodCA9IGltZy5oZWlnaHQsXHJcbiAgICAgICAgICAgICAgICAgICAgb3JpZW50YXRpb24gPSB0aGlzLmdldE9yaWVudGF0aW9uKCksXHJcbiAgICAgICAgICAgICAgICAgICAgc2NhbGUsIHcsIGgsIHgsIHk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIHZhbHVlcyB0aGF0IHJlcXVpcmUgOTAgZGVncmVlIHJvdGF0aW9uXHJcbiAgICAgICAgICAgICAgICBpZiAoIH5bIDUsIDYsIDcsIDggXS5pbmRleE9mKCBvcmllbnRhdGlvbiApICkge1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5Lqk5o2id2lkdGgsIGhlaWdodOeahOWAvOOAglxyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoIF49IGhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQgXj0gd2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGggXj0gaGVpZ2h0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBzY2FsZSA9IE1hdGhbIG9wdHMuY3JvcCA/ICdtYXgnIDogJ21pbicgXSggd2lkdGggLyBuYXR1cmFsV2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCAvIG5hdHVyYWxIZWlnaHQgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8g5LiN5YWB6K645pS+5aSn44CCXHJcbiAgICAgICAgICAgICAgICBvcHRzLmFsbG93TWFnbmlmeSB8fCAoc2NhbGUgPSBNYXRoLm1pbiggMSwgc2NhbGUgKSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHcgPSBuYXR1cmFsV2lkdGggKiBzY2FsZTtcclxuICAgICAgICAgICAgICAgIGggPSBuYXR1cmFsSGVpZ2h0ICogc2NhbGU7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggb3B0cy5jcm9wICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGN2cy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgICAgICAgICAgICAgIGN2cy5oZWlnaHQgPSBoZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGN2cy53aWR0aCA9IHc7XHJcbiAgICAgICAgICAgICAgICAgICAgY3ZzLmhlaWdodCA9IGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHggPSAoY3ZzLndpZHRoIC0gdykgLyAyO1xyXG4gICAgICAgICAgICAgICAgeSA9IChjdnMuaGVpZ2h0IC0gaCkgLyAyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBvcHRzLnByZXNlcnZlSGVhZGVycyB8fCB0aGlzLl9yb3RhdGUyT3JpZW50YWlvbiggY3ZzLCBvcmllbnRhdGlvbiApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJJbWFnZVRvQ2FudmFzKCBjdnMsIGltZywgeCwgeSwgdywgaCApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIF9yb3RhdGUyT3JpZW50YWlvbjogZnVuY3Rpb24oIGNhbnZhcywgb3JpZW50YXRpb24gKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgd2lkdGggPSBjYW52YXMud2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gY2FudmFzLmhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgc3dpdGNoICggb3JpZW50YXRpb24gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA1OlxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgNjpcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDc6XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA4OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSBoZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSB3aWR0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoIG9yaWVudGF0aW9uICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjogICAgLy8gaG9yaXpvbnRhbCBmbGlwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoIHdpZHRoLCAwICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zY2FsZSggLTEsIDEgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6ICAgIC8vIDE4MCByb3RhdGUgbGVmdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKCB3aWR0aCwgaGVpZ2h0ICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoIE1hdGguUEkgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDQ6ICAgIC8vIHZlcnRpY2FsIGZsaXBcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSggMCwgaGVpZ2h0ICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zY2FsZSggMSwgLTEgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIDU6ICAgIC8vIHZlcnRpY2FsIGZsaXAgKyA5MCByb3RhdGUgcmlnaHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZSggMC41ICogTWF0aC5QSSApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc2NhbGUoIDEsIC0xICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA2OiAgICAvLyA5MCByb3RhdGUgcmlnaHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZSggMC41ICogTWF0aC5QSSApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKCAwLCAtaGVpZ2h0ICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA3OiAgICAvLyBob3Jpem9udGFsIGZsaXAgKyA5MCByb3RhdGUgcmlnaHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZSggMC41ICogTWF0aC5QSSApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKCB3aWR0aCwgLWhlaWdodCApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHguc2NhbGUoIC0xLCAxICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSA4OiAgICAvLyA5MCByb3RhdGUgbGVmdFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgucm90YXRlKCAtMC41ICogTWF0aC5QSSApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKCAtd2lkdGgsIDAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3N0b21pdGEvaW9zLWltYWdlZmlsZS1tZWdhcGl4ZWwvXHJcbiAgICAgICAgICAgIC8vIGJsb2IvbWFzdGVyL3NyYy9tZWdhcGl4LWltYWdlLmpzXHJcbiAgICAgICAgICAgIF9yZW5kZXJJbWFnZVRvQ2FudmFzOiAoZnVuY3Rpb24oKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIOWmguaenOS4jeaYr2lvcywg5LiN6ZyA6KaB6L+Z5LmI5aSN5p2C77yBXHJcbiAgICAgICAgICAgICAgICBpZiAoICFCYXNlLm9zLmlvcyApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oIGNhbnZhcyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBCYXNlLnNsaWNlKCBhcmd1bWVudHMsIDEgKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UuYXBwbHkoIGN0eCwgYXJncyApO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgICAgICogRGV0ZWN0aW5nIHZlcnRpY2FsIHNxdWFzaCBpbiBsb2FkZWQgaW1hZ2UuXHJcbiAgICAgICAgICAgICAgICAgKiBGaXhlcyBhIGJ1ZyB3aGljaCBzcXVhc2ggaW1hZ2UgdmVydGljYWxseSB3aGlsZSBkcmF3aW5nIGludG9cclxuICAgICAgICAgICAgICAgICAqIGNhbnZhcyBmb3Igc29tZSBpbWFnZXMuXHJcbiAgICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGRldGVjdFZlcnRpY2FsU3F1YXNoKCBpbWcsIGl3LCBpaCApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzeSA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV5ID0gaWgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHB5ID0gaWgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEsIGFscGhhLCByYXRpbztcclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgY2FudmFzLndpZHRoID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaWg7XHJcbiAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSggaW1nLCAwLCAwICk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoIDAsIDAsIDEsIGloICkuZGF0YTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNlYXJjaCBpbWFnZSBlZGdlIHBpeGVsIHBvc2l0aW9uIGluIGNhc2VcclxuICAgICAgICAgICAgICAgICAgICAvLyBpdCBpcyBzcXVhc2hlZCB2ZXJ0aWNhbGx5LlxyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICggcHkgPiBzeSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGEgPSBkYXRhWyAocHkgLSAxKSAqIDQgKyAzIF07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBhbHBoYSA9PT0gMCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV5ID0gcHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeSA9IHB5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHkgPSAoZXkgKyBzeSkgPj4gMTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICByYXRpbyA9IChweSAvIGloKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHJhdGlvID09PSAwKSA/IDEgOiByYXRpbztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gZml4IGllNyBidWdcclxuICAgICAgICAgICAgICAgIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTE5MjkwOTkvXHJcbiAgICAgICAgICAgICAgICAvLyBodG1sNS1jYW52YXMtZHJhd2ltYWdlLXJhdGlvLWJ1Zy1pb3NcclxuICAgICAgICAgICAgICAgIGlmICggQmFzZS5vcy5pb3MgPj0gNyApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oIGNhbnZhcywgaW1nLCB4LCB5LCB3LCBoICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXcgPSBpbWcubmF0dXJhbFdpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWggPSBpbWcubmF0dXJhbEhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnRTcXVhc2hSYXRpbyA9IGRldGVjdFZlcnRpY2FsU3F1YXNoKCBpbWcsIGl3LCBpaCApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKS5kcmF3SW1hZ2UoIGltZywgMCwgMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdyAqIHZlcnRTcXVhc2hSYXRpbywgaWggKiB2ZXJ0U3F1YXNoUmF0aW8sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeCwgeSwgdywgaCApO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgICAgICogRGV0ZWN0IHN1YnNhbXBsaW5nIGluIGxvYWRlZCBpbWFnZS5cclxuICAgICAgICAgICAgICAgICAqIEluIGlPUywgbGFyZ2VyIGltYWdlcyB0aGFuIDJNIHBpeGVscyBtYXkgYmVcclxuICAgICAgICAgICAgICAgICAqIHN1YnNhbXBsZWQgaW4gcmVuZGVyaW5nLlxyXG4gICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkZXRlY3RTdWJzYW1wbGluZyggaW1nICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpdyA9IGltZy5uYXR1cmFsV2lkdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGloID0gaW1nLm5hdHVyYWxIZWlnaHQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcywgY3R4O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gc3Vic2FtcGxpbmcgbWF5IGhhcHBlbiBvdmVybWVnYXBpeGVsIGltYWdlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCBpdyAqIGloID4gMTAyNCAqIDEwMjQgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSBjYW52YXMuaGVpZ2h0ID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoIGltZywgLWl3ICsgMSwgMCApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN1YnNhbXBsZWQgaW1hZ2UgYmVjb21lcyBoYWxmIHNtYWxsZXIgaW4gcmVuZGVyaW5nIHNpemUuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGFscGhhIGNoYW5uZWwgdmFsdWUgdG8gY29uZmlybSBpbWFnZSBpcyBjb3ZlcmluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlZGdlIHBpeGVsIG9yIG5vdC4gaWYgYWxwaGEgdmFsdWUgaXMgMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpbWFnZSBpcyBub3QgY292ZXJpbmcsIGhlbmNlIHN1YnNhbXBsZWQuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHguZ2V0SW1hZ2VEYXRhKCAwLCAwLCAxLCAxICkuZGF0YVsgMyBdID09PSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCBjYW52YXMsIGltZywgeCwgeSwgd2lkdGgsIGhlaWdodCApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaXcgPSBpbWcubmF0dXJhbFdpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpaCA9IGltZy5uYXR1cmFsSGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2FtcGxlZCA9IGRldGVjdFN1YnNhbXBsaW5nKCBpbWcgKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZG9TcXVhc2ggPSB0aGlzLnR5cGUgPT09ICdpbWFnZS9qcGVnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZCA9IDEwMjQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN5ID0gMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHkgPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0bXBDYW52YXMsIHRtcEN0eCwgdmVydFNxdWFzaFJhdGlvLCBkdywgZGgsIHN4LCBkeDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggc3Vic2FtcGxlZCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXcgLz0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWggLz0gMjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRtcENhbnZhcy53aWR0aCA9IHRtcENhbnZhcy5oZWlnaHQgPSBkO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdG1wQ3R4ID0gdG1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmVydFNxdWFzaFJhdGlvID0gZG9TcXVhc2ggP1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ZWN0VmVydGljYWxTcXVhc2goIGltZywgaXcsIGloICkgOiAxO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZHcgPSBNYXRoLmNlaWwoIGQgKiB3aWR0aCAvIGl3ICk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGggPSBNYXRoLmNlaWwoIGQgKiBoZWlnaHQgLyBpaCAvIHZlcnRTcXVhc2hSYXRpbyApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBzeSA8IGloICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzeCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGR4ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCBzeCA8IGl3ICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wQ3R4LmNsZWFyUmVjdCggMCwgMCwgZCwgZCApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wQ3R4LmRyYXdJbWFnZSggaW1nLCAtc3gsIC1zeSApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSggdG1wQ2FudmFzLCAwLCAwLCBkLCBkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4ICsgZHgsIHkgKyBkeSwgZHcsIGRoICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeCArPSBkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHggKz0gZHc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3kgKz0gZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHkgKz0gZGg7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdG1wQ2FudmFzID0gdG1wQ3R4ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pKClcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcgVHJhbnNwb3J0XHJcbiAgICAgKiBAdG9kbyDmlK/mjIFjaHVua2Vk5Lyg6L6T77yM5LyY5Yq/77yaXHJcbiAgICAgKiDlj6/ku6XlsIblpKfmlofku7bliIbmiJDlsI/lnZfvvIzmjKjkuKrkvKDovpPvvIzlj6/ku6Xmj5Dpq5jlpKfmlofku7bmiJDlip/njofvvIzlvZPlpLHotKXnmoTml7blgJnvvIzkuZ/lj6rpnIDopoHph43kvKDpgqPlsI/pg6jliIbvvIxcclxuICAgICAqIOiAjOS4jemcgOimgemHjeWktOWGjeS8oOS4gOasoeOAguWPpuWkluaWreeCuee7reS8oOS5n+mcgOimgeeUqGNodW5rZWTmlrnlvI/jgIJcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdydW50aW1lL2h0bWw1L3RyYW5zcG9ydCcsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAncnVudGltZS9odG1sNS9ydW50aW1lJ1xyXG4gICAgXSwgZnVuY3Rpb24oIEJhc2UsIEh0bWw1UnVudGltZSApIHtcclxuICAgIFxyXG4gICAgICAgIHZhciBub29wID0gQmFzZS5ub29wLFxyXG4gICAgICAgICAgICAkID0gQmFzZS4kO1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIEh0bWw1UnVudGltZS5yZWdpc3RlciggJ1RyYW5zcG9ydCcsIHtcclxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSAwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVzcG9uc2UgPSBudWxsO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIHNlbmQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG93bmVyID0gdGhpcy5vd25lcixcclxuICAgICAgICAgICAgICAgICAgICBvcHRzID0gdGhpcy5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIHhociA9IHRoaXMuX2luaXRBamF4KCksXHJcbiAgICAgICAgICAgICAgICAgICAgYmxvYiA9IG93bmVyLl9ibG9iLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlcnZlciA9IG9wdHMuc2VydmVyLFxyXG4gICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLCBiaW5hcnksIGZyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBpZiAoIG9wdHMuc2VuZEFzQmluYXJ5ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlcnZlciArPSAoL1xcPy8udGVzdCggc2VydmVyICkgPyAnJicgOiAnPycpICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQucGFyYW0oIG93bmVyLl9mb3JtRGF0YSApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgYmluYXJ5ID0gYmxvYi5nZXRTb3VyY2UoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goIG93bmVyLl9mb3JtRGF0YSwgZnVuY3Rpb24oIGssIHYgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCggaywgdiApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCBvcHRzLmZpbGVWYWwsIGJsb2IuZ2V0U291cmNlKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRzLmZpbGVuYW1lIHx8IG93bmVyLl9mb3JtRGF0YS5uYW1lIHx8ICcnICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggb3B0cy53aXRoQ3JlZGVudGlhbHMgJiYgJ3dpdGhDcmVkZW50aWFscycgaW4geGhyICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHhoci5vcGVuKCBvcHRzLm1ldGhvZCwgc2VydmVyLCB0cnVlICk7XHJcbiAgICAgICAgICAgICAgICAgICAgeGhyLndpdGhDcmVkZW50aWFscyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHhoci5vcGVuKCBvcHRzLm1ldGhvZCwgc2VydmVyICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuX3NldFJlcXVlc3RIZWFkZXIoIHhociwgb3B0cy5oZWFkZXJzICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggYmluYXJ5ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOW8uuWItuiuvue9ruaIkCBjb250ZW50LXR5cGUg5Li65paH5Lu25rWB44CCXHJcbiAgICAgICAgICAgICAgICAgICAgeGhyLm92ZXJyaWRlTWltZVR5cGUgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhoci5vdmVycmlkZU1pbWVUeXBlKCdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGFuZHJvaWTnm7TmjqXlj5HpgIFibG9i5Lya5a+86Ie05pyN5Yqh56uv5o6l5pS25Yiw55qE5piv56m65paH5Lu244CCXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYnVn6K+m5oOF44CCXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9hbmRyb2lkL2lzc3Vlcy9kZXRhaWw/aWQ9Mzk4ODJcclxuICAgICAgICAgICAgICAgICAgICAvLyDmiYDku6XlhYjnlKhmaWxlUmVhZGVy6K+75Y+W5Ye65p2l5YaN6YCa6L+HYXJyYXlidWZmZXLnmoTmlrnlvI/lj5HpgIHjgIJcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIEJhc2Uub3MuYW5kcm9pZCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNlbmQoIHRoaXMucmVzdWx0ICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmciA9IGZyLm9ubG9hZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnIucmVhZEFzQXJyYXlCdWZmZXIoIGJpbmFyeSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHhoci5zZW5kKCBiaW5hcnkgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHhoci5zZW5kKCBmb3JtRGF0YSApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGdldFJlc3BvbnNlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXNwb25zZTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBnZXRSZXNwb25zZUFzSnNvbjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFyc2VKc29uKCB0aGlzLl9yZXNwb25zZSApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGdldFN0YXR1czogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RhdHVzO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGFib3J0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciB4aHIgPSB0aGlzLl94aHI7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggeGhyICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHhoci51cGxvYWQub25wcm9ncmVzcyA9IG5vb3A7XHJcbiAgICAgICAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG5vb3A7XHJcbiAgICAgICAgICAgICAgICAgICAgeGhyLmFib3J0KCk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl94aHIgPSB4aHIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hYm9ydCgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIF9pbml0QWpheDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIG9wdHMgPSB0aGlzLm9wdGlvbnM7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggb3B0cy53aXRoQ3JlZGVudGlhbHMgJiYgISgnd2l0aENyZWRlbnRpYWxzJyBpbiB4aHIpICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBYRG9tYWluUmVxdWVzdCAhPT0gJ3VuZGVmaW5lZCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeGhyID0gbmV3IFhEb21haW5SZXF1ZXN0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHhoci51cGxvYWQub25wcm9ncmVzcyA9IGZ1bmN0aW9uKCBlICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwZXJjZW50YWdlID0gMDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggZS5sZW5ndGhDb21wdXRhYmxlICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJjZW50YWdlID0gZS5sb2FkZWQgLyBlLnRvdGFsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZS50cmlnZ2VyKCAncHJvZ3Jlc3MnLCBwZXJjZW50YWdlICk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIHhoci5yZWFkeVN0YXRlICE9PSA0ICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0gbm9vcDtcclxuICAgICAgICAgICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gbm9vcDtcclxuICAgICAgICAgICAgICAgICAgICBtZS5feGhyID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBtZS5fc3RhdHVzID0geGhyLnN0YXR1cztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWUuX3Jlc3BvbnNlID0geGhyLnJlc3BvbnNlVGV4dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lLnRyaWdnZXIoJ2xvYWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCB4aHIuc3RhdHVzID49IDUwMCAmJiB4aHIuc3RhdHVzIDwgNjAwICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZS5fcmVzcG9uc2UgPSB4aHIucmVzcG9uc2VUZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWUudHJpZ2dlciggJ2Vycm9yJywgJ3NlcnZlcicgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtZS50cmlnZ2VyKCAnZXJyb3InLCBtZS5fc3RhdHVzID8gJ2h0dHAnIDogJ2Fib3J0JyApO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbWUuX3hociA9IHhocjtcclxuICAgICAgICAgICAgICAgIHJldHVybiB4aHI7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgX3NldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKCB4aHIsIGhlYWRlcnMgKSB7XHJcbiAgICAgICAgICAgICAgICAkLmVhY2goIGhlYWRlcnMsIGZ1bmN0aW9uKCBrZXksIHZhbCApIHtcclxuICAgICAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcigga2V5LCB2YWwgKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIF9wYXJzZUpzb246IGZ1bmN0aW9uKCBzdHIgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIganNvbjtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBqc29uID0gSlNPTi5wYXJzZSggc3RyICk7XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoICggZXggKSB7XHJcbiAgICAgICAgICAgICAgICAgICAganNvbiA9IHt9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4ganNvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcgIFRyYW5zcG9ydCBmbGFzaOWunueOsFxyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ3J1bnRpbWUvaHRtbDUvbWQ1JyxbXHJcbiAgICAgICAgJ3J1bnRpbWUvaHRtbDUvcnVudGltZSdcclxuICAgIF0sIGZ1bmN0aW9uKCBGbGFzaFJ1bnRpbWUgKSB7XHJcbiAgICBcclxuICAgICAgICAvKlxyXG4gICAgICAgICAqIEZhc3Rlc3QgbWQ1IGltcGxlbWVudGF0aW9uIGFyb3VuZCAoSktNIG1kNSlcclxuICAgICAgICAgKiBDcmVkaXRzOiBKb3NlcGggTXllcnNcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBzZWUgaHR0cDovL3d3dy5teWVyc2RhaWx5Lm9yZy9qb3NlcGgvamF2YXNjcmlwdC9tZDUtdGV4dC5odG1sXHJcbiAgICAgICAgICogQHNlZSBodHRwOi8vanNwZXJmLmNvbS9tZDUtc2hvb3RvdXQvN1xyXG4gICAgICAgICAqL1xyXG4gICAgXHJcbiAgICAgICAgLyogdGhpcyBmdW5jdGlvbiBpcyBtdWNoIGZhc3RlcixcclxuICAgICAgICAgIHNvIGlmIHBvc3NpYmxlIHdlIHVzZSBpdC4gU29tZSBJRXNcclxuICAgICAgICAgIGFyZSB0aGUgb25seSBvbmVzIEkga25vdyBvZiB0aGF0XHJcbiAgICAgICAgICBuZWVkIHRoZSBpZGlvdGljIHNlY29uZCBmdW5jdGlvbixcclxuICAgICAgICAgIGdlbmVyYXRlZCBieSBhbiBpZiBjbGF1c2UuICAqL1xyXG4gICAgICAgIHZhciBhZGQzMiA9IGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAoYSArIGIpICYgMHhGRkZGRkZGRjtcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgY21uID0gZnVuY3Rpb24gKHEsIGEsIGIsIHgsIHMsIHQpIHtcclxuICAgICAgICAgICAgYSA9IGFkZDMyKGFkZDMyKGEsIHEpLCBhZGQzMih4LCB0KSk7XHJcbiAgICAgICAgICAgIHJldHVybiBhZGQzMigoYSA8PCBzKSB8IChhID4+PiAoMzIgLSBzKSksIGIpO1xyXG4gICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICBmZiA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCB4LCBzLCB0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjbW4oKGIgJiBjKSB8ICgofmIpICYgZCksIGEsIGIsIHgsIHMsIHQpO1xyXG4gICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICBnZyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCB4LCBzLCB0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjbW4oKGIgJiBkKSB8IChjICYgKH5kKSksIGEsIGIsIHgsIHMsIHQpO1xyXG4gICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICBoaCA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkLCB4LCBzLCB0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjbW4oYiBeIGMgXiBkLCBhLCBiLCB4LCBzLCB0KTtcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgaWkgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCwgeCwgcywgdCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY21uKGMgXiAoYiB8ICh+ZCkpLCBhLCBiLCB4LCBzLCB0KTtcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgbWQ1Y3ljbGUgPSBmdW5jdGlvbiAoeCwgaykge1xyXG4gICAgICAgICAgICB2YXIgYSA9IHhbMF0sXHJcbiAgICAgICAgICAgICAgICBiID0geFsxXSxcclxuICAgICAgICAgICAgICAgIGMgPSB4WzJdLFxyXG4gICAgICAgICAgICAgICAgZCA9IHhbM107XHJcbiAgICBcclxuICAgICAgICAgICAgYSA9IGZmKGEsIGIsIGMsIGQsIGtbMF0sIDcsIC02ODA4NzY5MzYpO1xyXG4gICAgICAgICAgICBkID0gZmYoZCwgYSwgYiwgYywga1sxXSwgMTIsIC0zODk1NjQ1ODYpO1xyXG4gICAgICAgICAgICBjID0gZmYoYywgZCwgYSwgYiwga1syXSwgMTcsIDYwNjEwNTgxOSk7XHJcbiAgICAgICAgICAgIGIgPSBmZihiLCBjLCBkLCBhLCBrWzNdLCAyMiwgLTEwNDQ1MjUzMzApO1xyXG4gICAgICAgICAgICBhID0gZmYoYSwgYiwgYywgZCwga1s0XSwgNywgLTE3NjQxODg5Nyk7XHJcbiAgICAgICAgICAgIGQgPSBmZihkLCBhLCBiLCBjLCBrWzVdLCAxMiwgMTIwMDA4MDQyNik7XHJcbiAgICAgICAgICAgIGMgPSBmZihjLCBkLCBhLCBiLCBrWzZdLCAxNywgLTE0NzMyMzEzNDEpO1xyXG4gICAgICAgICAgICBiID0gZmYoYiwgYywgZCwgYSwga1s3XSwgMjIsIC00NTcwNTk4Myk7XHJcbiAgICAgICAgICAgIGEgPSBmZihhLCBiLCBjLCBkLCBrWzhdLCA3LCAxNzcwMDM1NDE2KTtcclxuICAgICAgICAgICAgZCA9IGZmKGQsIGEsIGIsIGMsIGtbOV0sIDEyLCAtMTk1ODQxNDQxNyk7XHJcbiAgICAgICAgICAgIGMgPSBmZihjLCBkLCBhLCBiLCBrWzEwXSwgMTcsIC00MjA2Myk7XHJcbiAgICAgICAgICAgIGIgPSBmZihiLCBjLCBkLCBhLCBrWzExXSwgMjIsIC0xOTkwNDA0MTYyKTtcclxuICAgICAgICAgICAgYSA9IGZmKGEsIGIsIGMsIGQsIGtbMTJdLCA3LCAxODA0NjAzNjgyKTtcclxuICAgICAgICAgICAgZCA9IGZmKGQsIGEsIGIsIGMsIGtbMTNdLCAxMiwgLTQwMzQxMTAxKTtcclxuICAgICAgICAgICAgYyA9IGZmKGMsIGQsIGEsIGIsIGtbMTRdLCAxNywgLTE1MDIwMDIyOTApO1xyXG4gICAgICAgICAgICBiID0gZmYoYiwgYywgZCwgYSwga1sxNV0sIDIyLCAxMjM2NTM1MzI5KTtcclxuICAgIFxyXG4gICAgICAgICAgICBhID0gZ2coYSwgYiwgYywgZCwga1sxXSwgNSwgLTE2NTc5NjUxMCk7XHJcbiAgICAgICAgICAgIGQgPSBnZyhkLCBhLCBiLCBjLCBrWzZdLCA5LCAtMTA2OTUwMTYzMik7XHJcbiAgICAgICAgICAgIGMgPSBnZyhjLCBkLCBhLCBiLCBrWzExXSwgMTQsIDY0MzcxNzcxMyk7XHJcbiAgICAgICAgICAgIGIgPSBnZyhiLCBjLCBkLCBhLCBrWzBdLCAyMCwgLTM3Mzg5NzMwMik7XHJcbiAgICAgICAgICAgIGEgPSBnZyhhLCBiLCBjLCBkLCBrWzVdLCA1LCAtNzAxNTU4NjkxKTtcclxuICAgICAgICAgICAgZCA9IGdnKGQsIGEsIGIsIGMsIGtbMTBdLCA5LCAzODAxNjA4Myk7XHJcbiAgICAgICAgICAgIGMgPSBnZyhjLCBkLCBhLCBiLCBrWzE1XSwgMTQsIC02NjA0NzgzMzUpO1xyXG4gICAgICAgICAgICBiID0gZ2coYiwgYywgZCwgYSwga1s0XSwgMjAsIC00MDU1Mzc4NDgpO1xyXG4gICAgICAgICAgICBhID0gZ2coYSwgYiwgYywgZCwga1s5XSwgNSwgNTY4NDQ2NDM4KTtcclxuICAgICAgICAgICAgZCA9IGdnKGQsIGEsIGIsIGMsIGtbMTRdLCA5LCAtMTAxOTgwMzY5MCk7XHJcbiAgICAgICAgICAgIGMgPSBnZyhjLCBkLCBhLCBiLCBrWzNdLCAxNCwgLTE4NzM2Mzk2MSk7XHJcbiAgICAgICAgICAgIGIgPSBnZyhiLCBjLCBkLCBhLCBrWzhdLCAyMCwgMTE2MzUzMTUwMSk7XHJcbiAgICAgICAgICAgIGEgPSBnZyhhLCBiLCBjLCBkLCBrWzEzXSwgNSwgLTE0NDQ2ODE0NjcpO1xyXG4gICAgICAgICAgICBkID0gZ2coZCwgYSwgYiwgYywga1syXSwgOSwgLTUxNDAzNzg0KTtcclxuICAgICAgICAgICAgYyA9IGdnKGMsIGQsIGEsIGIsIGtbN10sIDE0LCAxNzM1MzI4NDczKTtcclxuICAgICAgICAgICAgYiA9IGdnKGIsIGMsIGQsIGEsIGtbMTJdLCAyMCwgLTE5MjY2MDc3MzQpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGEgPSBoaChhLCBiLCBjLCBkLCBrWzVdLCA0LCAtMzc4NTU4KTtcclxuICAgICAgICAgICAgZCA9IGhoKGQsIGEsIGIsIGMsIGtbOF0sIDExLCAtMjAyMjU3NDQ2Myk7XHJcbiAgICAgICAgICAgIGMgPSBoaChjLCBkLCBhLCBiLCBrWzExXSwgMTYsIDE4MzkwMzA1NjIpO1xyXG4gICAgICAgICAgICBiID0gaGgoYiwgYywgZCwgYSwga1sxNF0sIDIzLCAtMzUzMDk1NTYpO1xyXG4gICAgICAgICAgICBhID0gaGgoYSwgYiwgYywgZCwga1sxXSwgNCwgLTE1MzA5OTIwNjApO1xyXG4gICAgICAgICAgICBkID0gaGgoZCwgYSwgYiwgYywga1s0XSwgMTEsIDEyNzI4OTMzNTMpO1xyXG4gICAgICAgICAgICBjID0gaGgoYywgZCwgYSwgYiwga1s3XSwgMTYsIC0xNTU0OTc2MzIpO1xyXG4gICAgICAgICAgICBiID0gaGgoYiwgYywgZCwgYSwga1sxMF0sIDIzLCAtMTA5NDczMDY0MCk7XHJcbiAgICAgICAgICAgIGEgPSBoaChhLCBiLCBjLCBkLCBrWzEzXSwgNCwgNjgxMjc5MTc0KTtcclxuICAgICAgICAgICAgZCA9IGhoKGQsIGEsIGIsIGMsIGtbMF0sIDExLCAtMzU4NTM3MjIyKTtcclxuICAgICAgICAgICAgYyA9IGhoKGMsIGQsIGEsIGIsIGtbM10sIDE2LCAtNzIyNTIxOTc5KTtcclxuICAgICAgICAgICAgYiA9IGhoKGIsIGMsIGQsIGEsIGtbNl0sIDIzLCA3NjAyOTE4OSk7XHJcbiAgICAgICAgICAgIGEgPSBoaChhLCBiLCBjLCBkLCBrWzldLCA0LCAtNjQwMzY0NDg3KTtcclxuICAgICAgICAgICAgZCA9IGhoKGQsIGEsIGIsIGMsIGtbMTJdLCAxMSwgLTQyMTgxNTgzNSk7XHJcbiAgICAgICAgICAgIGMgPSBoaChjLCBkLCBhLCBiLCBrWzE1XSwgMTYsIDUzMDc0MjUyMCk7XHJcbiAgICAgICAgICAgIGIgPSBoaChiLCBjLCBkLCBhLCBrWzJdLCAyMywgLTk5NTMzODY1MSk7XHJcbiAgICBcclxuICAgICAgICAgICAgYSA9IGlpKGEsIGIsIGMsIGQsIGtbMF0sIDYsIC0xOTg2MzA4NDQpO1xyXG4gICAgICAgICAgICBkID0gaWkoZCwgYSwgYiwgYywga1s3XSwgMTAsIDExMjY4OTE0MTUpO1xyXG4gICAgICAgICAgICBjID0gaWkoYywgZCwgYSwgYiwga1sxNF0sIDE1LCAtMTQxNjM1NDkwNSk7XHJcbiAgICAgICAgICAgIGIgPSBpaShiLCBjLCBkLCBhLCBrWzVdLCAyMSwgLTU3NDM0MDU1KTtcclxuICAgICAgICAgICAgYSA9IGlpKGEsIGIsIGMsIGQsIGtbMTJdLCA2LCAxNzAwNDg1NTcxKTtcclxuICAgICAgICAgICAgZCA9IGlpKGQsIGEsIGIsIGMsIGtbM10sIDEwLCAtMTg5NDk4NjYwNik7XHJcbiAgICAgICAgICAgIGMgPSBpaShjLCBkLCBhLCBiLCBrWzEwXSwgMTUsIC0xMDUxNTIzKTtcclxuICAgICAgICAgICAgYiA9IGlpKGIsIGMsIGQsIGEsIGtbMV0sIDIxLCAtMjA1NDkyMjc5OSk7XHJcbiAgICAgICAgICAgIGEgPSBpaShhLCBiLCBjLCBkLCBrWzhdLCA2LCAxODczMzEzMzU5KTtcclxuICAgICAgICAgICAgZCA9IGlpKGQsIGEsIGIsIGMsIGtbMTVdLCAxMCwgLTMwNjExNzQ0KTtcclxuICAgICAgICAgICAgYyA9IGlpKGMsIGQsIGEsIGIsIGtbNl0sIDE1LCAtMTU2MDE5ODM4MCk7XHJcbiAgICAgICAgICAgIGIgPSBpaShiLCBjLCBkLCBhLCBrWzEzXSwgMjEsIDEzMDkxNTE2NDkpO1xyXG4gICAgICAgICAgICBhID0gaWkoYSwgYiwgYywgZCwga1s0XSwgNiwgLTE0NTUyMzA3MCk7XHJcbiAgICAgICAgICAgIGQgPSBpaShkLCBhLCBiLCBjLCBrWzExXSwgMTAsIC0xMTIwMjEwMzc5KTtcclxuICAgICAgICAgICAgYyA9IGlpKGMsIGQsIGEsIGIsIGtbMl0sIDE1LCA3MTg3ODcyNTkpO1xyXG4gICAgICAgICAgICBiID0gaWkoYiwgYywgZCwgYSwga1s5XSwgMjEsIC0zNDM0ODU1NTEpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHhbMF0gPSBhZGQzMihhLCB4WzBdKTtcclxuICAgICAgICAgICAgeFsxXSA9IGFkZDMyKGIsIHhbMV0pO1xyXG4gICAgICAgICAgICB4WzJdID0gYWRkMzIoYywgeFsyXSk7XHJcbiAgICAgICAgICAgIHhbM10gPSBhZGQzMihkLCB4WzNdKTtcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgLyogdGhlcmUgbmVlZHMgdG8gYmUgc3VwcG9ydCBmb3IgVW5pY29kZSBoZXJlLFxyXG4gICAgICAgICAgICogdW5sZXNzIHdlIHByZXRlbmQgdGhhdCB3ZSBjYW4gcmVkZWZpbmUgdGhlIE1ELTVcclxuICAgICAgICAgICAqIGFsZ29yaXRobSBmb3IgbXVsdGktYnl0ZSBjaGFyYWN0ZXJzIChwZXJoYXBzXHJcbiAgICAgICAgICAgKiBieSBhZGRpbmcgZXZlcnkgZm91ciAxNi1iaXQgY2hhcmFjdGVycyBhbmRcclxuICAgICAgICAgICAqIHNob3J0ZW5pbmcgdGhlIHN1bSB0byAzMiBiaXRzKS4gT3RoZXJ3aXNlXHJcbiAgICAgICAgICAgKiBJIHN1Z2dlc3QgcGVyZm9ybWluZyBNRC01IGFzIGlmIGV2ZXJ5IGNoYXJhY3RlclxyXG4gICAgICAgICAgICogd2FzIHR3byBieXRlcy0tZS5nLiwgMDA0MCAwMDI1ID0gQCUtLWJ1dCB0aGVuXHJcbiAgICAgICAgICAgKiBob3cgd2lsbCBhbiBvcmRpbmFyeSBNRC01IHN1bSBiZSBtYXRjaGVkP1xyXG4gICAgICAgICAgICogVGhlcmUgaXMgbm8gd2F5IHRvIHN0YW5kYXJkaXplIHRleHQgdG8gc29tZXRoaW5nXHJcbiAgICAgICAgICAgKiBsaWtlIFVURi04IGJlZm9yZSB0cmFuc2Zvcm1hdGlvbjsgc3BlZWQgY29zdCBpc1xyXG4gICAgICAgICAgICogdXR0ZXJseSBwcm9oaWJpdGl2ZS4gVGhlIEphdmFTY3JpcHQgc3RhbmRhcmRcclxuICAgICAgICAgICAqIGl0c2VsZiBuZWVkcyB0byBsb29rIGF0IHRoaXM6IGl0IHNob3VsZCBzdGFydFxyXG4gICAgICAgICAgICogcHJvdmlkaW5nIGFjY2VzcyB0byBzdHJpbmdzIGFzIHByZWZvcm1lZCBVVEYtOFxyXG4gICAgICAgICAgICogOC1iaXQgdW5zaWduZWQgdmFsdWUgYXJyYXlzLlxyXG4gICAgICAgICAgICovXHJcbiAgICAgICAgbWQ1YmxrID0gZnVuY3Rpb24gKHMpIHtcclxuICAgICAgICAgICAgdmFyIG1kNWJsa3MgPSBbXSxcclxuICAgICAgICAgICAgICAgIGk7IC8qIEFuZHkgS2luZyBzYWlkIGRvIGl0IHRoaXMgd2F5LiAqL1xyXG4gICAgXHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA2NDsgaSArPSA0KSB7XHJcbiAgICAgICAgICAgICAgICBtZDVibGtzW2kgPj4gMl0gPSBzLmNoYXJDb2RlQXQoaSkgKyAocy5jaGFyQ29kZUF0KGkgKyAxKSA8PCA4KSArIChzLmNoYXJDb2RlQXQoaSArIDIpIDw8IDE2KSArIChzLmNoYXJDb2RlQXQoaSArIDMpIDw8IDI0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbWQ1YmxrcztcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgbWQ1YmxrX2FycmF5ID0gZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICAgICAgdmFyIG1kNWJsa3MgPSBbXSxcclxuICAgICAgICAgICAgICAgIGk7IC8qIEFuZHkgS2luZyBzYWlkIGRvIGl0IHRoaXMgd2F5LiAqL1xyXG4gICAgXHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA2NDsgaSArPSA0KSB7XHJcbiAgICAgICAgICAgICAgICBtZDVibGtzW2kgPj4gMl0gPSBhW2ldICsgKGFbaSArIDFdIDw8IDgpICsgKGFbaSArIDJdIDw8IDE2KSArIChhW2kgKyAzXSA8PCAyNCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG1kNWJsa3M7XHJcbiAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgIG1kNTEgPSBmdW5jdGlvbiAocykge1xyXG4gICAgICAgICAgICB2YXIgbiA9IHMubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgc3RhdGUgPSBbMTczMjU4NDE5MywgLTI3MTczMzg3OSwgLTE3MzI1ODQxOTQsIDI3MTczMzg3OF0sXHJcbiAgICAgICAgICAgICAgICBpLFxyXG4gICAgICAgICAgICAgICAgbGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgdGFpbCxcclxuICAgICAgICAgICAgICAgIHRtcCxcclxuICAgICAgICAgICAgICAgIGxvLFxyXG4gICAgICAgICAgICAgICAgaGk7XHJcbiAgICBcclxuICAgICAgICAgICAgZm9yIChpID0gNjQ7IGkgPD0gbjsgaSArPSA2NCkge1xyXG4gICAgICAgICAgICAgICAgbWQ1Y3ljbGUoc3RhdGUsIG1kNWJsayhzLnN1YnN0cmluZyhpIC0gNjQsIGkpKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcyA9IHMuc3Vic3RyaW5nKGkgLSA2NCk7XHJcbiAgICAgICAgICAgIGxlbmd0aCA9IHMubGVuZ3RoO1xyXG4gICAgICAgICAgICB0YWlsID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHtcclxuICAgICAgICAgICAgICAgIHRhaWxbaSA+PiAyXSB8PSBzLmNoYXJDb2RlQXQoaSkgPDwgKChpICUgNCkgPDwgMyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGFpbFtpID4+IDJdIHw9IDB4ODAgPDwgKChpICUgNCkgPDwgMyk7XHJcbiAgICAgICAgICAgIGlmIChpID4gNTUpIHtcclxuICAgICAgICAgICAgICAgIG1kNWN5Y2xlKHN0YXRlLCB0YWlsKTtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFpbFtpXSA9IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAvLyBCZXdhcmUgdGhhdCB0aGUgZmluYWwgbGVuZ3RoIG1pZ2h0IG5vdCBmaXQgaW4gMzIgYml0cyBzbyB3ZSB0YWtlIGNhcmUgb2YgdGhhdFxyXG4gICAgICAgICAgICB0bXAgPSBuICogODtcclxuICAgICAgICAgICAgdG1wID0gdG1wLnRvU3RyaW5nKDE2KS5tYXRjaCgvKC4qPykoLnswLDh9KSQvKTtcclxuICAgICAgICAgICAgbG8gPSBwYXJzZUludCh0bXBbMl0sIDE2KTtcclxuICAgICAgICAgICAgaGkgPSBwYXJzZUludCh0bXBbMV0sIDE2KSB8fCAwO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHRhaWxbMTRdID0gbG87XHJcbiAgICAgICAgICAgIHRhaWxbMTVdID0gaGk7XHJcbiAgICBcclxuICAgICAgICAgICAgbWQ1Y3ljbGUoc3RhdGUsIHRhaWwpO1xyXG4gICAgICAgICAgICByZXR1cm4gc3RhdGU7XHJcbiAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgIG1kNTFfYXJyYXkgPSBmdW5jdGlvbiAoYSkge1xyXG4gICAgICAgICAgICB2YXIgbiA9IGEubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgc3RhdGUgPSBbMTczMjU4NDE5MywgLTI3MTczMzg3OSwgLTE3MzI1ODQxOTQsIDI3MTczMzg3OF0sXHJcbiAgICAgICAgICAgICAgICBpLFxyXG4gICAgICAgICAgICAgICAgbGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgdGFpbCxcclxuICAgICAgICAgICAgICAgIHRtcCxcclxuICAgICAgICAgICAgICAgIGxvLFxyXG4gICAgICAgICAgICAgICAgaGk7XHJcbiAgICBcclxuICAgICAgICAgICAgZm9yIChpID0gNjQ7IGkgPD0gbjsgaSArPSA2NCkge1xyXG4gICAgICAgICAgICAgICAgbWQ1Y3ljbGUoc3RhdGUsIG1kNWJsa19hcnJheShhLnN1YmFycmF5KGkgLSA2NCwgaSkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIE5vdCBzdXJlIGlmIGl0IGlzIGEgYnVnLCBob3dldmVyIElFMTAgd2lsbCBhbHdheXMgcHJvZHVjZSBhIHN1YiBhcnJheSBvZiBsZW5ndGggMVxyXG4gICAgICAgICAgICAvLyBjb250YWluaW5nIHRoZSBsYXN0IGVsZW1lbnQgb2YgdGhlIHBhcmVudCBhcnJheSBpZiB0aGUgc3ViIGFycmF5IHNwZWNpZmllZCBzdGFydHNcclxuICAgICAgICAgICAgLy8gYmV5b25kIHRoZSBsZW5ndGggb2YgdGhlIHBhcmVudCBhcnJheSAtIHdlaXJkLlxyXG4gICAgICAgICAgICAvLyBodHRwczovL2Nvbm5lY3QubWljcm9zb2Z0LmNvbS9JRS9mZWVkYmFjay9kZXRhaWxzLzc3MTQ1Mi90eXBlZC1hcnJheS1zdWJhcnJheS1pc3N1ZVxyXG4gICAgICAgICAgICBhID0gKGkgLSA2NCkgPCBuID8gYS5zdWJhcnJheShpIC0gNjQpIDogbmV3IFVpbnQ4QXJyYXkoMCk7XHJcbiAgICBcclxuICAgICAgICAgICAgbGVuZ3RoID0gYS5sZW5ndGg7XHJcbiAgICAgICAgICAgIHRhaWwgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF07XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkge1xyXG4gICAgICAgICAgICAgICAgdGFpbFtpID4+IDJdIHw9IGFbaV0gPDwgKChpICUgNCkgPDwgMyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICB0YWlsW2kgPj4gMl0gfD0gMHg4MCA8PCAoKGkgJSA0KSA8PCAzKTtcclxuICAgICAgICAgICAgaWYgKGkgPiA1NSkge1xyXG4gICAgICAgICAgICAgICAgbWQ1Y3ljbGUoc3RhdGUsIHRhaWwpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDE2OyBpICs9IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0YWlsW2ldID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIEJld2FyZSB0aGF0IHRoZSBmaW5hbCBsZW5ndGggbWlnaHQgbm90IGZpdCBpbiAzMiBiaXRzIHNvIHdlIHRha2UgY2FyZSBvZiB0aGF0XHJcbiAgICAgICAgICAgIHRtcCA9IG4gKiA4O1xyXG4gICAgICAgICAgICB0bXAgPSB0bXAudG9TdHJpbmcoMTYpLm1hdGNoKC8oLio/KSguezAsOH0pJC8pO1xyXG4gICAgICAgICAgICBsbyA9IHBhcnNlSW50KHRtcFsyXSwgMTYpO1xyXG4gICAgICAgICAgICBoaSA9IHBhcnNlSW50KHRtcFsxXSwgMTYpIHx8IDA7XHJcbiAgICBcclxuICAgICAgICAgICAgdGFpbFsxNF0gPSBsbztcclxuICAgICAgICAgICAgdGFpbFsxNV0gPSBoaTtcclxuICAgIFxyXG4gICAgICAgICAgICBtZDVjeWNsZShzdGF0ZSwgdGFpbCk7XHJcbiAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xyXG4gICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICBoZXhfY2hyID0gWycwJywgJzEnLCAnMicsICczJywgJzQnLCAnNScsICc2JywgJzcnLCAnOCcsICc5JywgJ2EnLCAnYicsICdjJywgJ2QnLCAnZScsICdmJ10sXHJcbiAgICBcclxuICAgICAgICByaGV4ID0gZnVuY3Rpb24gKG4pIHtcclxuICAgICAgICAgICAgdmFyIHMgPSAnJyxcclxuICAgICAgICAgICAgICAgIGo7XHJcbiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCA0OyBqICs9IDEpIHtcclxuICAgICAgICAgICAgICAgIHMgKz0gaGV4X2NoclsobiA+PiAoaiAqIDggKyA0KSkgJiAweDBGXSArIGhleF9jaHJbKG4gPj4gKGogKiA4KSkgJiAweDBGXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcztcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgaGV4ID0gZnVuY3Rpb24gKHgpIHtcclxuICAgICAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB4Lmxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICB4W2ldID0gcmhleCh4W2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4geC5qb2luKCcnKTtcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgbWQ1ID0gZnVuY3Rpb24gKHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGhleChtZDUxKHMpKTtcclxuICAgICAgICB9LFxyXG4gICAgXHJcbiAgICBcclxuICAgIFxyXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFNwYXJrTUQ1IE9PUCBpbXBsZW1lbnRhdGlvbi5cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIFVzZSB0aGlzIGNsYXNzIHRvIHBlcmZvcm0gYW4gaW5jcmVtZW50YWwgbWQ1LCBvdGhlcndpc2UgdXNlIHRoZVxyXG4gICAgICAgICAqIHN0YXRpYyBtZXRob2RzIGluc3RlYWQuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgU3BhcmtNRDUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vIGNhbGwgcmVzZXQgdG8gaW5pdCB0aGUgaW5zdGFuY2VcclxuICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgIFxyXG4gICAgICAgIC8vIEluIHNvbWUgY2FzZXMgdGhlIGZhc3QgYWRkMzIgZnVuY3Rpb24gY2Fubm90IGJlIHVzZWQuLlxyXG4gICAgICAgIGlmIChtZDUoJ2hlbGxvJykgIT09ICc1ZDQxNDAyYWJjNGIyYTc2Yjk3MTlkOTExMDE3YzU5MicpIHtcclxuICAgICAgICAgICAgYWRkMzIgPSBmdW5jdGlvbiAoeCwgeSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxzdyA9ICh4ICYgMHhGRkZGKSArICh5ICYgMHhGRkZGKSxcclxuICAgICAgICAgICAgICAgICAgICBtc3cgPSAoeCA+PiAxNikgKyAoeSA+PiAxNikgKyAobHN3ID4+IDE2KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiAobXN3IDw8IDE2KSB8IChsc3cgJiAweEZGRkYpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQXBwZW5kcyBhIHN0cmluZy5cclxuICAgICAgICAgKiBBIGNvbnZlcnNpb24gd2lsbCBiZSBhcHBsaWVkIGlmIGFuIHV0Zjggc3RyaW5nIGlzIGRldGVjdGVkLlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGJlIGFwcGVuZGVkXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcmV0dXJuIHtTcGFya01ENX0gVGhlIGluc3RhbmNlIGl0c2VsZlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIFNwYXJrTUQ1LnByb3RvdHlwZS5hcHBlbmQgPSBmdW5jdGlvbiAoc3RyKSB7XHJcbiAgICAgICAgICAgIC8vIGNvbnZlcnRzIHRoZSBzdHJpbmcgdG8gdXRmOCBieXRlcyBpZiBuZWNlc3NhcnlcclxuICAgICAgICAgICAgaWYgKC9bXFx1MDA4MC1cXHVGRkZGXS8udGVzdChzdHIpKSB7XHJcbiAgICAgICAgICAgICAgICBzdHIgPSB1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoc3RyKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAvLyB0aGVuIGFwcGVuZCBhcyBiaW5hcnlcclxuICAgICAgICAgICAgdGhpcy5hcHBlbmRCaW5hcnkoc3RyKTtcclxuICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQXBwZW5kcyBhIGJpbmFyeSBzdHJpbmcuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gY29udGVudHMgVGhlIGJpbmFyeSBzdHJpbmcgdG8gYmUgYXBwZW5kZWRcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEByZXR1cm4ge1NwYXJrTUQ1fSBUaGUgaW5zdGFuY2UgaXRzZWxmXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgU3BhcmtNRDUucHJvdG90eXBlLmFwcGVuZEJpbmFyeSA9IGZ1bmN0aW9uIChjb250ZW50cykge1xyXG4gICAgICAgICAgICB0aGlzLl9idWZmICs9IGNvbnRlbnRzO1xyXG4gICAgICAgICAgICB0aGlzLl9sZW5ndGggKz0gY29udGVudHMubGVuZ3RoO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLl9idWZmLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgIGk7XHJcbiAgICBcclxuICAgICAgICAgICAgZm9yIChpID0gNjQ7IGkgPD0gbGVuZ3RoOyBpICs9IDY0KSB7XHJcbiAgICAgICAgICAgICAgICBtZDVjeWNsZSh0aGlzLl9zdGF0ZSwgbWQ1YmxrKHRoaXMuX2J1ZmYuc3Vic3RyaW5nKGkgLSA2NCwgaSkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuX2J1ZmYgPSB0aGlzLl9idWZmLnN1YnN0cihpIC0gNjQpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBGaW5pc2hlcyB0aGUgaW5jcmVtZW50YWwgY29tcHV0YXRpb24sIHJlc2V0aW5nIHRoZSBpbnRlcm5hbCBzdGF0ZSBhbmRcclxuICAgICAgICAgKiByZXR1cm5pbmcgdGhlIHJlc3VsdC5cclxuICAgICAgICAgKiBVc2UgdGhlIHJhdyBwYXJhbWV0ZXIgdG8gb2J0YWluIHRoZSByYXcgcmVzdWx0IGluc3RlYWQgb2YgdGhlIGhleCBvbmUuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHJhdyBUcnVlIHRvIGdldCB0aGUgcmF3IHJlc3VsdCwgZmFsc2UgdG8gZ2V0IHRoZSBoZXggcmVzdWx0XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd8QXJyYXl9IFRoZSByZXN1bHRcclxuICAgICAgICAgKi9cclxuICAgICAgICBTcGFya01ENS5wcm90b3R5cGUuZW5kID0gZnVuY3Rpb24gKHJhdykge1xyXG4gICAgICAgICAgICB2YXIgYnVmZiA9IHRoaXMuX2J1ZmYsXHJcbiAgICAgICAgICAgICAgICBsZW5ndGggPSBidWZmLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgIGksXHJcbiAgICAgICAgICAgICAgICB0YWlsID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdLFxyXG4gICAgICAgICAgICAgICAgcmV0O1xyXG4gICAgXHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkge1xyXG4gICAgICAgICAgICAgICAgdGFpbFtpID4+IDJdIHw9IGJ1ZmYuY2hhckNvZGVBdChpKSA8PCAoKGkgJSA0KSA8PCAzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuX2ZpbmlzaCh0YWlsLCBsZW5ndGgpO1xyXG4gICAgICAgICAgICByZXQgPSAhIXJhdyA/IHRoaXMuX3N0YXRlIDogaGV4KHRoaXMuX3N0YXRlKTtcclxuICAgIFxyXG4gICAgICAgICAgICB0aGlzLnJlc2V0KCk7XHJcbiAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRmluaXNoIHRoZSBmaW5hbCBjYWxjdWxhdGlvbiBiYXNlZCBvbiB0aGUgdGFpbC5cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9ICB0YWlsICAgVGhlIHRhaWwgKHdpbGwgYmUgbW9kaWZpZWQpXHJcbiAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IGxlbmd0aCBUaGUgbGVuZ3RoIG9mIHRoZSByZW1haW5pbmcgYnVmZmVyXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgU3BhcmtNRDUucHJvdG90eXBlLl9maW5pc2ggPSBmdW5jdGlvbiAodGFpbCwgbGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHZhciBpID0gbGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgdG1wLFxyXG4gICAgICAgICAgICAgICAgbG8sXHJcbiAgICAgICAgICAgICAgICBoaTtcclxuICAgIFxyXG4gICAgICAgICAgICB0YWlsW2kgPj4gMl0gfD0gMHg4MCA8PCAoKGkgJSA0KSA8PCAzKTtcclxuICAgICAgICAgICAgaWYgKGkgPiA1NSkge1xyXG4gICAgICAgICAgICAgICAgbWQ1Y3ljbGUodGhpcy5fc3RhdGUsIHRhaWwpO1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDE2OyBpICs9IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB0YWlsW2ldID0gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIERvIHRoZSBmaW5hbCBjb21wdXRhdGlvbiBiYXNlZCBvbiB0aGUgdGFpbCBhbmQgbGVuZ3RoXHJcbiAgICAgICAgICAgIC8vIEJld2FyZSB0aGF0IHRoZSBmaW5hbCBsZW5ndGggbWF5IG5vdCBmaXQgaW4gMzIgYml0cyBzbyB3ZSB0YWtlIGNhcmUgb2YgdGhhdFxyXG4gICAgICAgICAgICB0bXAgPSB0aGlzLl9sZW5ndGggKiA4O1xyXG4gICAgICAgICAgICB0bXAgPSB0bXAudG9TdHJpbmcoMTYpLm1hdGNoKC8oLio/KSguezAsOH0pJC8pO1xyXG4gICAgICAgICAgICBsbyA9IHBhcnNlSW50KHRtcFsyXSwgMTYpO1xyXG4gICAgICAgICAgICBoaSA9IHBhcnNlSW50KHRtcFsxXSwgMTYpIHx8IDA7XHJcbiAgICBcclxuICAgICAgICAgICAgdGFpbFsxNF0gPSBsbztcclxuICAgICAgICAgICAgdGFpbFsxNV0gPSBoaTtcclxuICAgICAgICAgICAgbWQ1Y3ljbGUodGhpcy5fc3RhdGUsIHRhaWwpO1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBSZXNldHMgdGhlIGludGVybmFsIHN0YXRlIG9mIHRoZSBjb21wdXRhdGlvbi5cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEByZXR1cm4ge1NwYXJrTUQ1fSBUaGUgaW5zdGFuY2UgaXRzZWxmXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgU3BhcmtNRDUucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0aGlzLl9idWZmID0gXCJcIjtcclxuICAgICAgICAgICAgdGhpcy5fbGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUgPSBbMTczMjU4NDE5MywgLTI3MTczMzg3OSwgLTE3MzI1ODQxOTQsIDI3MTczMzg3OF07XHJcbiAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFJlbGVhc2VzIG1lbW9yeSB1c2VkIGJ5IHRoZSBpbmNyZW1lbnRhbCBidWZmZXIgYW5kIG90aGVyIGFkaXRpb25hbFxyXG4gICAgICAgICAqIHJlc291cmNlcy4gSWYgeW91IHBsYW4gdG8gdXNlIHRoZSBpbnN0YW5jZSBhZ2FpbiwgdXNlIHJlc2V0IGluc3RlYWQuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgU3BhcmtNRDUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9zdGF0ZTtcclxuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2J1ZmY7XHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9sZW5ndGg7XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUGVyZm9ybXMgdGhlIG1kNSBoYXNoIG9uIGEgc3RyaW5nLlxyXG4gICAgICAgICAqIEEgY29udmVyc2lvbiB3aWxsIGJlIGFwcGxpZWQgaWYgdXRmOCBzdHJpbmcgaXMgZGV0ZWN0ZWQuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gIHN0ciBUaGUgc3RyaW5nXHJcbiAgICAgICAgICogQHBhcmFtIHtCb29sZWFufSByYXcgVHJ1ZSB0byBnZXQgdGhlIHJhdyByZXN1bHQsIGZhbHNlIHRvIGdldCB0aGUgaGV4IHJlc3VsdFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHJldHVybiB7U3RyaW5nfEFycmF5fSBUaGUgcmVzdWx0XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgU3BhcmtNRDUuaGFzaCA9IGZ1bmN0aW9uIChzdHIsIHJhdykge1xyXG4gICAgICAgICAgICAvLyBjb252ZXJ0cyB0aGUgc3RyaW5nIHRvIHV0ZjggYnl0ZXMgaWYgbmVjZXNzYXJ5XHJcbiAgICAgICAgICAgIGlmICgvW1xcdTAwODAtXFx1RkZGRl0vLnRlc3Qoc3RyKSkge1xyXG4gICAgICAgICAgICAgICAgc3RyID0gdW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHN0cikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgdmFyIGhhc2ggPSBtZDUxKHN0cik7XHJcbiAgICBcclxuICAgICAgICAgICAgcmV0dXJuICEhcmF3ID8gaGFzaCA6IGhleChoYXNoKTtcclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUGVyZm9ybXMgdGhlIG1kNSBoYXNoIG9uIGEgYmluYXJ5IHN0cmluZy5cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSAgY29udGVudCBUaGUgYmluYXJ5IHN0cmluZ1xyXG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gcmF3ICAgICBUcnVlIHRvIGdldCB0aGUgcmF3IHJlc3VsdCwgZmFsc2UgdG8gZ2V0IHRoZSBoZXggcmVzdWx0XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd8QXJyYXl9IFRoZSByZXN1bHRcclxuICAgICAgICAgKi9cclxuICAgICAgICBTcGFya01ENS5oYXNoQmluYXJ5ID0gZnVuY3Rpb24gKGNvbnRlbnQsIHJhdykge1xyXG4gICAgICAgICAgICB2YXIgaGFzaCA9IG1kNTEoY29udGVudCk7XHJcbiAgICBcclxuICAgICAgICAgICAgcmV0dXJuICEhcmF3ID8gaGFzaCA6IGhleChoYXNoKTtcclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogU3BhcmtNRDUgT09QIGltcGxlbWVudGF0aW9uIGZvciBhcnJheSBidWZmZXJzLlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogVXNlIHRoaXMgY2xhc3MgdG8gcGVyZm9ybSBhbiBpbmNyZW1lbnRhbCBtZDUgT05MWSBmb3IgYXJyYXkgYnVmZmVycy5cclxuICAgICAgICAgKi9cclxuICAgICAgICBTcGFya01ENS5BcnJheUJ1ZmZlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy8gY2FsbCByZXNldCB0byBpbml0IHRoZSBpbnN0YW5jZVxyXG4gICAgICAgICAgICB0aGlzLnJlc2V0KCk7XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEFwcGVuZHMgYW4gYXJyYXkgYnVmZmVyLlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHBhcmFtIHtBcnJheUJ1ZmZlcn0gYXJyIFRoZSBhcnJheSB0byBiZSBhcHBlbmRlZFxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHJldHVybiB7U3BhcmtNRDUuQXJyYXlCdWZmZXJ9IFRoZSBpbnN0YW5jZSBpdHNlbGZcclxuICAgICAgICAgKi9cclxuICAgICAgICBTcGFya01ENS5BcnJheUJ1ZmZlci5wcm90b3R5cGUuYXBwZW5kID0gZnVuY3Rpb24gKGFycikge1xyXG4gICAgICAgICAgICAvLyBUT0RPOiB3ZSBjb3VsZCBhdm9pZCB0aGUgY29uY2F0ZW5hdGlvbiBoZXJlIGJ1dCB0aGUgYWxnb3JpdGhtIHdvdWxkIGJlIG1vcmUgY29tcGxleFxyXG4gICAgICAgICAgICAvLyAgICAgICBpZiB5b3UgZmluZCB5b3Vyc2VsZiBuZWVkaW5nIGV4dHJhIHBlcmZvcm1hbmNlLCBwbGVhc2UgbWFrZSBhIFBSLlxyXG4gICAgICAgICAgICB2YXIgYnVmZiA9IHRoaXMuX2NvbmNhdEFycmF5QnVmZmVyKHRoaXMuX2J1ZmYsIGFyciksXHJcbiAgICAgICAgICAgICAgICBsZW5ndGggPSBidWZmLmxlbmd0aCxcclxuICAgICAgICAgICAgICAgIGk7XHJcbiAgICBcclxuICAgICAgICAgICAgdGhpcy5fbGVuZ3RoICs9IGFyci5ieXRlTGVuZ3RoO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGZvciAoaSA9IDY0OyBpIDw9IGxlbmd0aDsgaSArPSA2NCkge1xyXG4gICAgICAgICAgICAgICAgbWQ1Y3ljbGUodGhpcy5fc3RhdGUsIG1kNWJsa19hcnJheShidWZmLnN1YmFycmF5KGkgLSA2NCwgaSkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIEF2b2lkcyBJRTEwIHdlaXJkbmVzcyAoZG9jdW1lbnRlZCBhYm92ZSlcclxuICAgICAgICAgICAgdGhpcy5fYnVmZiA9IChpIC0gNjQpIDwgbGVuZ3RoID8gYnVmZi5zdWJhcnJheShpIC0gNjQpIDogbmV3IFVpbnQ4QXJyYXkoMCk7XHJcbiAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEZpbmlzaGVzIHRoZSBpbmNyZW1lbnRhbCBjb21wdXRhdGlvbiwgcmVzZXRpbmcgdGhlIGludGVybmFsIHN0YXRlIGFuZFxyXG4gICAgICAgICAqIHJldHVybmluZyB0aGUgcmVzdWx0LlxyXG4gICAgICAgICAqIFVzZSB0aGUgcmF3IHBhcmFtZXRlciB0byBvYnRhaW4gdGhlIHJhdyByZXN1bHQgaW5zdGVhZCBvZiB0aGUgaGV4IG9uZS5cclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gcmF3IFRydWUgdG8gZ2V0IHRoZSByYXcgcmVzdWx0LCBmYWxzZSB0byBnZXQgdGhlIGhleCByZXN1bHRcclxuICAgICAgICAgKlxyXG4gICAgICAgICAqIEByZXR1cm4ge1N0cmluZ3xBcnJheX0gVGhlIHJlc3VsdFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIFNwYXJrTUQ1LkFycmF5QnVmZmVyLnByb3RvdHlwZS5lbmQgPSBmdW5jdGlvbiAocmF3KSB7XHJcbiAgICAgICAgICAgIHZhciBidWZmID0gdGhpcy5fYnVmZixcclxuICAgICAgICAgICAgICAgIGxlbmd0aCA9IGJ1ZmYubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgdGFpbCA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXSxcclxuICAgICAgICAgICAgICAgIGksXHJcbiAgICAgICAgICAgICAgICByZXQ7XHJcbiAgICBcclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7XHJcbiAgICAgICAgICAgICAgICB0YWlsW2kgPj4gMl0gfD0gYnVmZltpXSA8PCAoKGkgJSA0KSA8PCAzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuX2ZpbmlzaCh0YWlsLCBsZW5ndGgpO1xyXG4gICAgICAgICAgICByZXQgPSAhIXJhdyA/IHRoaXMuX3N0YXRlIDogaGV4KHRoaXMuX3N0YXRlKTtcclxuICAgIFxyXG4gICAgICAgICAgICB0aGlzLnJlc2V0KCk7XHJcbiAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgU3BhcmtNRDUuQXJyYXlCdWZmZXIucHJvdG90eXBlLl9maW5pc2ggPSBTcGFya01ENS5wcm90b3R5cGUuX2ZpbmlzaDtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFJlc2V0cyB0aGUgaW50ZXJuYWwgc3RhdGUgb2YgdGhlIGNvbXB1dGF0aW9uLlxyXG4gICAgICAgICAqXHJcbiAgICAgICAgICogQHJldHVybiB7U3BhcmtNRDUuQXJyYXlCdWZmZXJ9IFRoZSBpbnN0YW5jZSBpdHNlbGZcclxuICAgICAgICAgKi9cclxuICAgICAgICBTcGFya01ENS5BcnJheUJ1ZmZlci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2J1ZmYgPSBuZXcgVWludDhBcnJheSgwKTtcclxuICAgICAgICAgICAgdGhpcy5fbGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgdGhpcy5fc3RhdGUgPSBbMTczMjU4NDE5MywgLTI3MTczMzg3OSwgLTE3MzI1ODQxOTQsIDI3MTczMzg3OF07XHJcbiAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFJlbGVhc2VzIG1lbW9yeSB1c2VkIGJ5IHRoZSBpbmNyZW1lbnRhbCBidWZmZXIgYW5kIG90aGVyIGFkaXRpb25hbFxyXG4gICAgICAgICAqIHJlc291cmNlcy4gSWYgeW91IHBsYW4gdG8gdXNlIHRoZSBpbnN0YW5jZSBhZ2FpbiwgdXNlIHJlc2V0IGluc3RlYWQuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgU3BhcmtNRDUuQXJyYXlCdWZmZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBTcGFya01ENS5wcm90b3R5cGUuZGVzdHJveTtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIENvbmNhdHMgdHdvIGFycmF5IGJ1ZmZlcnMsIHJldHVybmluZyBhIG5ldyBvbmUuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0gIHtBcnJheUJ1ZmZlcn0gZmlyc3QgIFRoZSBmaXJzdCBhcnJheSBidWZmZXJcclxuICAgICAgICAgKiBAcGFyYW0gIHtBcnJheUJ1ZmZlcn0gc2Vjb25kIFRoZSBzZWNvbmQgYXJyYXkgYnVmZmVyXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcmV0dXJuIHtBcnJheUJ1ZmZlcn0gVGhlIG5ldyBhcnJheSBidWZmZXJcclxuICAgICAgICAgKi9cclxuICAgICAgICBTcGFya01ENS5BcnJheUJ1ZmZlci5wcm90b3R5cGUuX2NvbmNhdEFycmF5QnVmZmVyID0gZnVuY3Rpb24gKGZpcnN0LCBzZWNvbmQpIHtcclxuICAgICAgICAgICAgdmFyIGZpcnN0TGVuZ3RoID0gZmlyc3QubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkoZmlyc3RMZW5ndGggKyBzZWNvbmQuYnl0ZUxlbmd0aCk7XHJcbiAgICBcclxuICAgICAgICAgICAgcmVzdWx0LnNldChmaXJzdCk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5zZXQobmV3IFVpbnQ4QXJyYXkoc2Vjb25kKSwgZmlyc3RMZW5ndGgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFBlcmZvcm1zIHRoZSBtZDUgaGFzaCBvbiBhbiBhcnJheSBidWZmZXIuXHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBhcnIgVGhlIGFycmF5IGJ1ZmZlclxyXG4gICAgICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gICAgIHJhdyBUcnVlIHRvIGdldCB0aGUgcmF3IHJlc3VsdCwgZmFsc2UgdG8gZ2V0IHRoZSBoZXggcmVzdWx0XHJcbiAgICAgICAgICpcclxuICAgICAgICAgKiBAcmV0dXJuIHtTdHJpbmd8QXJyYXl9IFRoZSByZXN1bHRcclxuICAgICAgICAgKi9cclxuICAgICAgICBTcGFya01ENS5BcnJheUJ1ZmZlci5oYXNoID0gZnVuY3Rpb24gKGFyciwgcmF3KSB7XHJcbiAgICAgICAgICAgIHZhciBoYXNoID0gbWQ1MV9hcnJheShuZXcgVWludDhBcnJheShhcnIpKTtcclxuICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gISFyYXcgPyBoYXNoIDogaGV4KGhhc2gpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIEZsYXNoUnVudGltZS5yZWdpc3RlciggJ01kNScsIHtcclxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nLlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGxvYWRGcm9tQmxvYjogZnVuY3Rpb24oIGZpbGUgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmxvYiA9IGZpbGUuZ2V0U291cmNlKCksXHJcbiAgICAgICAgICAgICAgICAgICAgY2h1bmtTaXplID0gMiAqIDEwMjQgKiAxMDI0LFxyXG4gICAgICAgICAgICAgICAgICAgIGNodW5rcyA9IE1hdGguY2VpbCggYmxvYi5zaXplIC8gY2h1bmtTaXplICksXHJcbiAgICAgICAgICAgICAgICAgICAgY2h1bmsgPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgIG93bmVyID0gdGhpcy5vd25lcixcclxuICAgICAgICAgICAgICAgICAgICBzcGFyayA9IG5ldyBTcGFya01ENS5BcnJheUJ1ZmZlcigpLFxyXG4gICAgICAgICAgICAgICAgICAgIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICBibG9iU2xpY2UgPSBibG9iLm1velNsaWNlIHx8IGJsb2Iud2Via2l0U2xpY2UgfHwgYmxvYi5zbGljZSxcclxuICAgICAgICAgICAgICAgICAgICBsb2FkTmV4dCwgZnI7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGZyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgbG9hZE5leHQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnQsIGVuZDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0ID0gY2h1bmsgKiBjaHVua1NpemU7XHJcbiAgICAgICAgICAgICAgICAgICAgZW5kID0gTWF0aC5taW4oIHN0YXJ0ICsgY2h1bmtTaXplLCBibG9iLnNpemUgKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGZyLm9ubG9hZCA9IGZ1bmN0aW9uKCBlICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGFyay5hcHBlbmQoIGUudGFyZ2V0LnJlc3VsdCApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvd25lci50cmlnZ2VyKCAncHJvZ3Jlc3MnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogZmlsZS5zaXplLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVkOiBlbmRcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGZyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmci5vbmxvYWRlbmQgPSBmci5vbmxvYWQgPSBudWxsO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggKytjaHVuayA8IGNodW5rcyApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoIGxvYWROZXh0LCAxICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3duZXIudHJpZ2dlcignbG9hZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lLnJlc3VsdCA9IHNwYXJrLmVuZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWROZXh0ID0gZmlsZSA9IGJsb2IgPSBzcGFyayA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3duZXIudHJpZ2dlcignY29tcGxldGUnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDUwICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZnIucmVhZEFzQXJyYXlCdWZmZXIoIGJsb2JTbGljZS5jYWxsKCBibG9iLCBzdGFydCwgZW5kICkgKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGxvYWROZXh0KCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgZ2V0UmVzdWx0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcgRmxhc2hSdW50aW1lXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgncnVudGltZS9mbGFzaC9ydW50aW1lJyxbXHJcbiAgICAgICAgJ2Jhc2UnLFxyXG4gICAgICAgICdydW50aW1lL3J1bnRpbWUnLFxyXG4gICAgICAgICdydW50aW1lL2NvbXBiYXNlJ1xyXG4gICAgXSwgZnVuY3Rpb24oIEJhc2UsIFJ1bnRpbWUsIENvbXBCYXNlICkge1xyXG4gICAgXHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQsXHJcbiAgICAgICAgICAgIHR5cGUgPSAnZmxhc2gnLFxyXG4gICAgICAgICAgICBjb21wb25lbnRzID0ge307XHJcbiAgICBcclxuICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEZsYXNoVmVyc2lvbigpIHtcclxuICAgICAgICAgICAgdmFyIHZlcnNpb247XHJcbiAgICBcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHZlcnNpb24gPSBuYXZpZ2F0b3IucGx1Z2luc1sgJ1Nob2Nrd2F2ZSBGbGFzaCcgXTtcclxuICAgICAgICAgICAgICAgIHZlcnNpb24gPSB2ZXJzaW9uLmRlc2NyaXB0aW9uO1xyXG4gICAgICAgICAgICB9IGNhdGNoICggZXggKSB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZlcnNpb24gPSBuZXcgQWN0aXZlWE9iamVjdCgnU2hvY2t3YXZlRmxhc2guU2hvY2t3YXZlRmxhc2gnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLkdldFZhcmlhYmxlKCckdmVyc2lvbicpO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoIGV4MiApIHtcclxuICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uID0gJzAuMCc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmVyc2lvbiA9IHZlcnNpb24ubWF0Y2goIC9cXGQrL2cgKTtcclxuICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoIHZlcnNpb25bIDAgXSArICcuJyArIHZlcnNpb25bIDEgXSwgMTAgKTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBmdW5jdGlvbiBGbGFzaFJ1bnRpbWUoKSB7XHJcbiAgICAgICAgICAgIHZhciBwb29sID0ge30sXHJcbiAgICAgICAgICAgICAgICBjbGllbnRzID0ge30sXHJcbiAgICAgICAgICAgICAgICBkZXN0cm95ID0gdGhpcy5kZXN0cm95LFxyXG4gICAgICAgICAgICAgICAgbWUgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAganNyZWNpdmVyID0gQmFzZS5ndWlkKCd3ZWJ1cGxvYWRlcl8nKTtcclxuICAgIFxyXG4gICAgICAgICAgICBSdW50aW1lLmFwcGx5KCBtZSwgYXJndW1lbnRzICk7XHJcbiAgICAgICAgICAgIG1lLnR5cGUgPSB0eXBlO1xyXG4gICAgXHJcbiAgICBcclxuICAgICAgICAgICAgLy8g6L+Z5Liq5pa55rOV55qE6LCD55So6ICF77yM5a6e6ZmF5LiK5pivUnVudGltZUNsaWVudFxyXG4gICAgICAgICAgICBtZS5leGVjID0gZnVuY3Rpb24oIGNvbXAsIGZuLyosIGFyZ3MuLi4qLyApIHtcclxuICAgICAgICAgICAgICAgIHZhciBjbGllbnQgPSB0aGlzLFxyXG4gICAgICAgICAgICAgICAgICAgIHVpZCA9IGNsaWVudC51aWQsXHJcbiAgICAgICAgICAgICAgICAgICAgYXJncyA9IEJhc2Uuc2xpY2UoIGFyZ3VtZW50cywgMiApLFxyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBjbGllbnRzWyB1aWQgXSA9IGNsaWVudDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCBjb21wb25lbnRzWyBjb21wIF0gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhcG9vbFsgdWlkIF0gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvb2xbIHVpZCBdID0gbmV3IGNvbXBvbmVudHNbIGNvbXAgXSggY2xpZW50LCBtZSApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlID0gcG9vbFsgdWlkIF07XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIGluc3RhbmNlWyBmbiBdICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5zdGFuY2VbIGZuIF0uYXBwbHkoIGluc3RhbmNlLCBhcmdzICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbWUuZmxhc2hFeGVjLmFwcGx5KCBjbGllbnQsIGFyZ3VtZW50cyApO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoIGV2dCwgb2JqICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHR5cGUgPSBldnQudHlwZSB8fCBldnQsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFydHMsIHVpZDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgcGFydHMgPSB0eXBlLnNwbGl0KCc6OicpO1xyXG4gICAgICAgICAgICAgICAgdWlkID0gcGFydHNbIDAgXTtcclxuICAgICAgICAgICAgICAgIHR5cGUgPSBwYXJ0c1sgMSBdO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZy5hcHBseSggY29uc29sZSwgYXJndW1lbnRzICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggdHlwZSA9PT0gJ1JlYWR5JyAmJiB1aWQgPT09IG1lLnVpZCApIHtcclxuICAgICAgICAgICAgICAgICAgICBtZS50cmlnZ2VyKCdyZWFkeScpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggY2xpZW50c1sgdWlkIF0gKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50c1sgdWlkIF0udHJpZ2dlciggdHlwZS50b0xvd2VyQ2FzZSgpLCBldnQsIG9iaiApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBCYXNlLmxvZyggZXZ0LCBvYmogKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIGZsYXNo55qE5o6l5Y+X5Zmo44CCXHJcbiAgICAgICAgICAgIHdpbmRvd1sganNyZWNpdmVyIF0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDkuLrkuobog73mjZXojrflvpfliLDjgIJcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlci5hcHBseSggbnVsbCwgYXJncyApO1xyXG4gICAgICAgICAgICAgICAgfSwgMSApO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuanNyZWNpdmVyID0ganNyZWNpdmVyO1xyXG4gICAgXHJcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgLy8gQHRvZG8g5Yig6Zmk5rGg5a2Q5Lit55qE5omA5pyJ5a6e5L6LXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVzdHJveSAmJiBkZXN0cm95LmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTtcclxuICAgICAgICAgICAgfTtcclxuICAgIFxyXG4gICAgICAgICAgICB0aGlzLmZsYXNoRXhlYyA9IGZ1bmN0aW9uKCBjb21wLCBmbiApIHtcclxuICAgICAgICAgICAgICAgIHZhciBmbGFzaCA9IG1lLmdldEZsYXNoKCksXHJcbiAgICAgICAgICAgICAgICAgICAgYXJncyA9IEJhc2Uuc2xpY2UoIGFyZ3VtZW50cywgMiApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmxhc2guZXhlYyggdGhpcy51aWQsIGNvbXAsIGZuLCBhcmdzICk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICAgICAgLy8gQHRvZG9cclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBCYXNlLmluaGVyaXRzKCBSdW50aW1lLCB7XHJcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yOiBGbGFzaFJ1bnRpbWUsXHJcbiAgICBcclxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdGhpcy5nZXRDb250YWluZXIoKSxcclxuICAgICAgICAgICAgICAgICAgICBvcHRzID0gdGhpcy5vcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIGh0bWw7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIC8vIGlmIG5vdCB0aGUgbWluaW1hbCBoZWlnaHQsIHNoaW1zIGFyZSBub3QgaW5pdGlhbGl6ZWRcclxuICAgICAgICAgICAgICAgIC8vIGluIG9sZGVyIGJyb3dzZXJzIChlLmcgRkYzLjYsIElFNiw3LDgsIFNhZmFyaSA0LjAsNS4wLCBldGMpXHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIuY3NzKHtcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcclxuICAgICAgICAgICAgICAgICAgICB0b3A6ICctOHB4JyxcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0OiAnLThweCcsXHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6ICc5cHgnLFxyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodDogJzlweCcsXHJcbiAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gaW5zZXJ0IGZsYXNoIG9iamVjdFxyXG4gICAgICAgICAgICAgICAgaHRtbCA9ICc8b2JqZWN0IGlkPVwiJyArIHRoaXMudWlkICsgJ1wiIHR5cGU9XCJhcHBsaWNhdGlvbi8nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3gtc2hvY2t3YXZlLWZsYXNoXCIgZGF0YT1cIicgKyAgb3B0cy5zd2YgKyAnXCIgJztcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKCBCYXNlLmJyb3dzZXIuaWUgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaHRtbCArPSAnY2xhc3NpZD1cImNsc2lkOmQyN2NkYjZlLWFlNmQtMTFjZi05NmI4LTQ0NDU1MzU0MDAwMFwiICc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGh0bWwgKz0gJ3dpZHRoPVwiMTAwJVwiIGhlaWdodD1cIjEwMCVcIiBzdHlsZT1cIm91dGxpbmU6MFwiPicgICtcclxuICAgICAgICAgICAgICAgICAgICAnPHBhcmFtIG5hbWU9XCJtb3ZpZVwiIHZhbHVlPVwiJyArIG9wdHMuc3dmICsgJ1wiIC8+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgJzxwYXJhbSBuYW1lPVwiZmxhc2h2YXJzXCIgdmFsdWU9XCJ1aWQ9JyArIHRoaXMudWlkICtcclxuICAgICAgICAgICAgICAgICAgICAnJmpzcmVjaXZlcj0nICsgdGhpcy5qc3JlY2l2ZXIgKyAnXCIgLz4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPHBhcmFtIG5hbWU9XCJ3bW9kZVwiIHZhbHVlPVwidHJhbnNwYXJlbnRcIiAvPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8cGFyYW0gbmFtZT1cImFsbG93c2NyaXB0YWNjZXNzXCIgdmFsdWU9XCJhbHdheXNcIiAvPicgK1xyXG4gICAgICAgICAgICAgICAgJzwvb2JqZWN0Pic7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5odG1sKCBodG1sICk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICBcclxuICAgICAgICAgICAgZ2V0Rmxhc2g6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCB0aGlzLl9mbGFzaCApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZmxhc2g7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuX2ZsYXNoID0gJCggJyMnICsgdGhpcy51aWQgKS5nZXQoIDAgKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mbGFzaDtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICBGbGFzaFJ1bnRpbWUucmVnaXN0ZXIgPSBmdW5jdGlvbiggbmFtZSwgY29tcG9uZW50ICkge1xyXG4gICAgICAgICAgICBjb21wb25lbnQgPSBjb21wb25lbnRzWyBuYW1lIF0gPSBCYXNlLmluaGVyaXRzKCBDb21wQmFzZSwgJC5leHRlbmQoe1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyBAdG9kbyBmaXggdGhpcyBsYXRlclxyXG4gICAgICAgICAgICAgICAgZmxhc2hFeGVjOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb3duZXIgPSB0aGlzLm93bmVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBydW50aW1lID0gdGhpcy5nZXRSdW50aW1lKCk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcnVudGltZS5mbGFzaEV4ZWMuYXBwbHkoIG93bmVyLCBhcmd1bWVudHMgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgY29tcG9uZW50ICkgKTtcclxuICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gY29tcG9uZW50O1xyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICBpZiAoIGdldEZsYXNoVmVyc2lvbigpID49IDExLjQgKSB7XHJcbiAgICAgICAgICAgIFJ1bnRpbWUuYWRkUnVudGltZSggdHlwZSwgRmxhc2hSdW50aW1lICk7XHJcbiAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIEZsYXNoUnVudGltZTtcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IEZpbGVQaWNrZXJcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdydW50aW1lL2ZsYXNoL2ZpbGVwaWNrZXInLFtcclxuICAgICAgICAnYmFzZScsXHJcbiAgICAgICAgJ3J1bnRpbWUvZmxhc2gvcnVudGltZSdcclxuICAgIF0sIGZ1bmN0aW9uKCBCYXNlLCBGbGFzaFJ1bnRpbWUgKSB7XHJcbiAgICAgICAgdmFyICQgPSBCYXNlLiQ7XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gRmxhc2hSdW50aW1lLnJlZ2lzdGVyKCAnRmlsZVBpY2tlcicsIHtcclxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oIG9wdHMgKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29weSA9ICQuZXh0ZW5kKHt9LCBvcHRzICksXHJcbiAgICAgICAgICAgICAgICAgICAgbGVuLCBpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAvLyDkv67lpI1GbGFzaOWGjeayoeacieiuvue9rnRpdGxl55qE5oOF5Ya15LiL5peg5rOV5by55Ye6Zmxhc2jmlofku7bpgInmi6nmoYbnmoRidWcuXHJcbiAgICAgICAgICAgICAgICBsZW4gPSBjb3B5LmFjY2VwdCAmJiBjb3B5LmFjY2VwdC5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBmb3IgKCAgaSA9IDA7IGkgPCBsZW47IGkrKyApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoICFjb3B5LmFjY2VwdFsgaSBdLnRpdGxlICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3B5LmFjY2VwdFsgaSBdLnRpdGxlID0gJ0ZpbGVzJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBjb3B5LmJ1dHRvbjtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBjb3B5LmlkO1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIGNvcHkuY29udGFpbmVyO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXNoRXhlYyggJ0ZpbGVQaWNrZXInLCAnaW5pdCcsIGNvcHkgKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZmxhc2hFeGVjKCAnRmlsZVBpY2tlcicsICdkZXN0cm95JyApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIC8qKlxyXG4gICAgICogQGZpbGVPdmVydmlldyDlm77niYfljovnvKlcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdydW50aW1lL2ZsYXNoL2ltYWdlJyxbXHJcbiAgICAgICAgJ3J1bnRpbWUvZmxhc2gvcnVudGltZSdcclxuICAgIF0sIGZ1bmN0aW9uKCBGbGFzaFJ1bnRpbWUgKSB7XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gRmxhc2hSdW50aW1lLnJlZ2lzdGVyKCAnSW1hZ2UnLCB7XHJcbiAgICAgICAgICAgIC8vIGluaXQ6IGZ1bmN0aW9uKCBvcHRpb25zICkge1xyXG4gICAgICAgICAgICAvLyAgICAgdmFyIG93bmVyID0gdGhpcy5vd25lcjtcclxuICAgIFxyXG4gICAgICAgICAgICAvLyAgICAgdGhpcy5mbGFzaEV4ZWMoICdJbWFnZScsICdpbml0Jywgb3B0aW9ucyApO1xyXG4gICAgICAgICAgICAvLyAgICAgb3duZXIub24oICdsb2FkJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgZGVidWdnZXI7XHJcbiAgICAgICAgICAgIC8vICAgICB9KTtcclxuICAgICAgICAgICAgLy8gfSxcclxuICAgIFxyXG4gICAgICAgICAgICBsb2FkRnJvbUJsb2I6IGZ1bmN0aW9uKCBibG9iICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG93bmVyID0gdGhpcy5vd25lcjtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgb3duZXIuaW5mbygpICYmIHRoaXMuZmxhc2hFeGVjKCAnSW1hZ2UnLCAnaW5mbycsIG93bmVyLmluZm8oKSApO1xyXG4gICAgICAgICAgICAgICAgb3duZXIubWV0YSgpICYmIHRoaXMuZmxhc2hFeGVjKCAnSW1hZ2UnLCAnbWV0YScsIG93bmVyLm1ldGEoKSApO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICB0aGlzLmZsYXNoRXhlYyggJ0ltYWdlJywgJ2xvYWRGcm9tQmxvYicsIGJsb2IudWlkICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3ICBUcmFuc3BvcnQgZmxhc2jlrp7njrBcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCdydW50aW1lL2ZsYXNoL3RyYW5zcG9ydCcsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAncnVudGltZS9mbGFzaC9ydW50aW1lJyxcclxuICAgICAgICAncnVudGltZS9jbGllbnQnXHJcbiAgICBdLCBmdW5jdGlvbiggQmFzZSwgRmxhc2hSdW50aW1lLCBSdW50aW1lQ2xpZW50ICkge1xyXG4gICAgICAgIHZhciAkID0gQmFzZS4kO1xyXG4gICAgXHJcbiAgICAgICAgcmV0dXJuIEZsYXNoUnVudGltZS5yZWdpc3RlciggJ1RyYW5zcG9ydCcsIHtcclxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0dXMgPSAwO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVzcG9uc2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVzcG9uc2VKc29uID0gbnVsbDtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBzZW5kOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBvd25lciA9IHRoaXMub3duZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgb3B0cyA9IHRoaXMub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgICAgICB4aHIgPSB0aGlzLl9pbml0QWpheCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIGJsb2IgPSBvd25lci5fYmxvYixcclxuICAgICAgICAgICAgICAgICAgICBzZXJ2ZXIgPSBvcHRzLnNlcnZlcixcclxuICAgICAgICAgICAgICAgICAgICBiaW5hcnk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHhoci5jb25uZWN0UnVudGltZSggYmxvYi5ydWlkICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggb3B0cy5zZW5kQXNCaW5hcnkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyICs9ICgvXFw/Ly50ZXN0KCBzZXJ2ZXIgKSA/ICcmJyA6ICc/JykgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5wYXJhbSggb3duZXIuX2Zvcm1EYXRhICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICBiaW5hcnkgPSBibG9iLnVpZDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKCBvd25lci5fZm9ybURhdGEsIGZ1bmN0aW9uKCBrLCB2ICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4aHIuZXhlYyggJ2FwcGVuZCcsIGssIHYgKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHhoci5leGVjKCAnYXBwZW5kQmxvYicsIG9wdHMuZmlsZVZhbCwgYmxvYi51aWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRzLmZpbGVuYW1lIHx8IG93bmVyLl9mb3JtRGF0YS5uYW1lIHx8ICcnICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMuX3NldFJlcXVlc3RIZWFkZXIoIHhociwgb3B0cy5oZWFkZXJzICk7XHJcbiAgICAgICAgICAgICAgICB4aHIuZXhlYyggJ3NlbmQnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBvcHRzLm1ldGhvZCxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IHNlcnZlcixcclxuICAgICAgICAgICAgICAgICAgICBmb3JjZVVSTFN0cmVhbTogb3B0cy5mb3JjZVVSTFN0cmVhbSxcclxuICAgICAgICAgICAgICAgICAgICBtaW1lVHlwZTogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSdcclxuICAgICAgICAgICAgICAgIH0sIGJpbmFyeSApO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGdldFN0YXR1czogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RhdHVzO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGdldFJlc3BvbnNlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXNwb25zZSB8fCAnJztcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBnZXRSZXNwb25zZUFzSnNvbjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcmVzcG9uc2VKc29uO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGFib3J0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciB4aHIgPSB0aGlzLl94aHI7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGlmICggeGhyICkge1xyXG4gICAgICAgICAgICAgICAgICAgIHhoci5leGVjKCdhYm9ydCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHhoci5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5feGhyID0geGhyID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWJvcnQoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgIFxyXG4gICAgICAgICAgICBfaW5pdEFqYXg6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lID0gdGhpcyxcclxuICAgICAgICAgICAgICAgICAgICB4aHIgPSBuZXcgUnVudGltZUNsaWVudCgnWE1MSHR0cFJlcXVlc3QnKTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgeGhyLm9uKCAndXBsb2FkcHJvZ3Jlc3MgcHJvZ3Jlc3MnLCBmdW5jdGlvbiggZSApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGVyY2VudCA9IGUubG9hZGVkIC8gZS50b3RhbDtcclxuICAgICAgICAgICAgICAgICAgICBwZXJjZW50ID0gTWF0aC5taW4oIDEsIE1hdGgubWF4KCAwLCBwZXJjZW50ICkgKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWUudHJpZ2dlciggJ3Byb2dyZXNzJywgcGVyY2VudCApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHhoci5vbiggJ2xvYWQnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0geGhyLmV4ZWMoJ2dldFN0YXR1cycpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkQm9keSA9IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnIgPSAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHhoci5vZmYoKTtcclxuICAgICAgICAgICAgICAgICAgICBtZS5feGhyID0gbnVsbDtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICggc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRCb2R5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBzdGF0dXMgPj0gNTAwICYmIHN0YXR1cyA8IDYwMCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhZEJvZHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnIgPSAnc2VydmVyJztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnIgPSAnaHR0cCc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCByZWFkQm9keSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWUuX3Jlc3BvbnNlID0geGhyLmV4ZWMoJ2dldFJlc3BvbnNlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lLl9yZXNwb25zZSA9IGRlY29kZVVSSUNvbXBvbmVudCggbWUuX3Jlc3BvbnNlICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmxhc2gg5aSE55CG5Y+v6IO95a2Y5ZyoIGJ1Zywg5rKh6L6Z5Y+q6IO96Z2gIGpzIOS6hlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgbWUuX3Jlc3BvbnNlSnNvbiA9IHhoci5leGVjKCdnZXRSZXNwb25zZUFzSnNvbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB9IGNhdGNoICggZXJyb3IgKSB7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgcCA9IGZ1bmN0aW9uKCBzICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LkpTT04gJiYgd2luZG93LkpTT04ucGFyc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uocyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGdW5jdGlvbigncmV0dXJuICcgKyBzKS5jYWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoICggZXJyICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWUuX3Jlc3BvbnNlSnNvbiAgPSBtZS5fcmVzcG9uc2UgPyBwKG1lLl9yZXNwb25zZSkgOiB7fTtcclxuICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgeGhyLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgICAgICB4aHIgPSBudWxsO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVyciA/IG1lLnRyaWdnZXIoICdlcnJvcicsIGVyciApIDogbWUudHJpZ2dlcignbG9hZCcpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHhoci5vbiggJ2Vycm9yJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeGhyLm9mZigpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1lLl94aHIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIG1lLnRyaWdnZXIoICdlcnJvcicsICdodHRwJyApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIG1lLl94aHIgPSB4aHI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4geGhyO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIF9zZXRSZXF1ZXN0SGVhZGVyOiBmdW5jdGlvbiggeGhyLCBoZWFkZXJzICkge1xyXG4gICAgICAgICAgICAgICAgJC5lYWNoKCBoZWFkZXJzLCBmdW5jdGlvbigga2V5LCB2YWwgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeGhyLmV4ZWMoICdzZXRSZXF1ZXN0SGVhZGVyJywga2V5LCB2YWwgKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBAZmlsZU92ZXJ2aWV3IEJsb2IgSHRtbOWunueOsFxyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ3J1bnRpbWUvZmxhc2gvYmxvYicsW1xyXG4gICAgICAgICdydW50aW1lL2ZsYXNoL3J1bnRpbWUnLFxyXG4gICAgICAgICdsaWIvYmxvYidcclxuICAgIF0sIGZ1bmN0aW9uKCBGbGFzaFJ1bnRpbWUsIEJsb2IgKSB7XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gRmxhc2hSdW50aW1lLnJlZ2lzdGVyKCAnQmxvYicsIHtcclxuICAgICAgICAgICAgc2xpY2U6IGZ1bmN0aW9uKCBzdGFydCwgZW5kICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJsb2IgPSB0aGlzLmZsYXNoRXhlYyggJ0Jsb2InLCAnc2xpY2UnLCBzdGFydCwgZW5kICk7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQmxvYiggdGhpcy5nZXRSdWlkKCksIGJsb2IgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcgIE1kNSBmbGFzaOWunueOsFxyXG4gICAgICovXHJcbiAgICBkZWZpbmUoJ3J1bnRpbWUvZmxhc2gvbWQ1JyxbXHJcbiAgICAgICAgJ3J1bnRpbWUvZmxhc2gvcnVudGltZSdcclxuICAgIF0sIGZ1bmN0aW9uKCBGbGFzaFJ1bnRpbWUgKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmV0dXJuIEZsYXNoUnVudGltZS5yZWdpc3RlciggJ01kNScsIHtcclxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nLlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgXHJcbiAgICAgICAgICAgIGxvYWRGcm9tQmxvYjogZnVuY3Rpb24oIGJsb2IgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mbGFzaEV4ZWMoICdNZDUnLCAnbG9hZEZyb21CbG9iJywgYmxvYi51aWQgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcg5a6M5YWo54mI5pys44CCXHJcbiAgICAgKi9cclxuICAgIGRlZmluZSgncHJlc2V0L2FsbCcsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgIFxyXG4gICAgICAgIC8vIHdpZGdldHNcclxuICAgICAgICAnd2lkZ2V0cy9maWxlZG5kJyxcclxuICAgICAgICAnd2lkZ2V0cy9maWxlcGFzdGUnLFxyXG4gICAgICAgICd3aWRnZXRzL2ZpbGVwaWNrZXInLFxyXG4gICAgICAgICd3aWRnZXRzL2ltYWdlJyxcclxuICAgICAgICAnd2lkZ2V0cy9xdWV1ZScsXHJcbiAgICAgICAgJ3dpZGdldHMvcnVudGltZScsXHJcbiAgICAgICAgJ3dpZGdldHMvdXBsb2FkJyxcclxuICAgICAgICAnd2lkZ2V0cy92YWxpZGF0b3InLFxyXG4gICAgICAgICd3aWRnZXRzL21kNScsXHJcbiAgICBcclxuICAgICAgICAvLyBydW50aW1lc1xyXG4gICAgICAgIC8vIGh0bWw1XHJcbiAgICAgICAgJ3J1bnRpbWUvaHRtbDUvYmxvYicsXHJcbiAgICAgICAgJ3J1bnRpbWUvaHRtbDUvZG5kJyxcclxuICAgICAgICAncnVudGltZS9odG1sNS9maWxlcGFzdGUnLFxyXG4gICAgICAgICdydW50aW1lL2h0bWw1L2ZpbGVwaWNrZXInLFxyXG4gICAgICAgICdydW50aW1lL2h0bWw1L2ltYWdlbWV0YS9leGlmJyxcclxuICAgICAgICAncnVudGltZS9odG1sNS9hbmRyb2lkcGF0Y2gnLFxyXG4gICAgICAgICdydW50aW1lL2h0bWw1L2ltYWdlJyxcclxuICAgICAgICAncnVudGltZS9odG1sNS90cmFuc3BvcnQnLFxyXG4gICAgICAgICdydW50aW1lL2h0bWw1L21kNScsXHJcbiAgICBcclxuICAgICAgICAvLyBmbGFzaFxyXG4gICAgICAgICdydW50aW1lL2ZsYXNoL2ZpbGVwaWNrZXInLFxyXG4gICAgICAgICdydW50aW1lL2ZsYXNoL2ltYWdlJyxcclxuICAgICAgICAncnVudGltZS9mbGFzaC90cmFuc3BvcnQnLFxyXG4gICAgICAgICdydW50aW1lL2ZsYXNoL2Jsb2InLFxyXG4gICAgICAgICdydW50aW1lL2ZsYXNoL21kNSdcclxuICAgIF0sIGZ1bmN0aW9uKCBCYXNlICkge1xyXG4gICAgICAgIHJldHVybiBCYXNlO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcg5pel5b+X57uE5Lu277yM5Li76KaB55So5p2l5pS26ZuG6ZSZ6K+v5L+h5oGv77yM5Y+v5Lul5biu5YqpIHdlYnVwbG9hZGVyIOabtOWlveeahOWumuS9jemXrumimOWSjOWPkeWxleOAglxyXG4gICAgICpcclxuICAgICAqIOWmguaenOaCqOS4jeaDs+imgeWQr+eUqOatpOWKn+iDve+8jOivt+WcqOaJk+WMheeahOaXtuWAmeWOu+aOiSBsb2cg5qih5Z2X44CCXHJcbiAgICAgKlxyXG4gICAgICog5oiW6ICF5Y+v5Lul5Zyo5Yid5aeL5YyW55qE5pe25YCZ6YCa6L+HIG9wdGlvbnMuZGlzYWJsZVdpZGdldHMg5bGe5oCn56aB55So44CCXHJcbiAgICAgKlxyXG4gICAgICog5aaC77yaXHJcbiAgICAgKiBXZWJVcGxvYWRlci5jcmVhdGUoe1xyXG4gICAgICogICAgIC4uLlxyXG4gICAgICpcclxuICAgICAqICAgICBkaXNhYmxlV2lkZ2V0czogJ2xvZycsXHJcbiAgICAgKlxyXG4gICAgICogICAgIC4uLlxyXG4gICAgICogfSlcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCd3aWRnZXRzL2xvZycsW1xyXG4gICAgICAgICdiYXNlJyxcclxuICAgICAgICAndXBsb2FkZXInLFxyXG4gICAgICAgICd3aWRnZXRzL3dpZGdldCdcclxuICAgIF0sIGZ1bmN0aW9uKCBCYXNlLCBVcGxvYWRlciApIHtcclxuICAgICAgICB2YXIgJCA9IEJhc2UuJCxcclxuICAgICAgICAgICAgbG9nVXJsID0gJyBodHRwOi8vc3RhdGljLnRpZWJhLmJhaWR1LmNvbS90Yi9wbXMvaW1nL3N0LmdpZj8/JyxcclxuICAgICAgICAgICAgcHJvZHVjdCA9IChsb2NhdGlvbi5ob3N0bmFtZSB8fCBsb2NhdGlvbi5ob3N0IHx8ICdwcm90ZWN0ZWQnKS50b0xvd2VyQ2FzZSgpLFxyXG4gICAgXHJcbiAgICAgICAgICAgIC8vIOWPqumSiOWvuSBiYWlkdSDlhoXpg6jkuqflk4HnlKjmiLflgZrnu5/orqHlip/og73jgIJcclxuICAgICAgICAgICAgZW5hYmxlID0gcHJvZHVjdCAmJiAvYmFpZHUvaS5leGVjKHByb2R1Y3QpLFxyXG4gICAgICAgICAgICBiYXNlO1xyXG4gICAgXHJcbiAgICAgICAgaWYgKCFlbmFibGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIGJhc2UgPSB7XHJcbiAgICAgICAgICAgIGR2OiAzLFxyXG4gICAgICAgICAgICBtYXN0ZXI6ICd3ZWJ1cGxvYWRlcicsXHJcbiAgICAgICAgICAgIG9ubGluZTogL3Rlc3QvLmV4ZWMocHJvZHVjdCkgPyAwIDogMSxcclxuICAgICAgICAgICAgbW9kdWxlOiAnJyxcclxuICAgICAgICAgICAgcHJvZHVjdDogcHJvZHVjdCxcclxuICAgICAgICAgICAgdHlwZTogMFxyXG4gICAgICAgIH07XHJcbiAgICBcclxuICAgICAgICBmdW5jdGlvbiBzZW5kKGRhdGEpIHtcclxuICAgICAgICAgICAgdmFyIG9iaiA9ICQuZXh0ZW5kKHt9LCBiYXNlLCBkYXRhKSxcclxuICAgICAgICAgICAgICAgIHVybCA9IGxvZ1VybC5yZXBsYWNlKC9eKC4qKVxcPy8sICckMScgKyAkLnBhcmFtKCBvYmogKSksXHJcbiAgICAgICAgICAgICAgICBpbWFnZSA9IG5ldyBJbWFnZSgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGltYWdlLnNyYyA9IHVybDtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICByZXR1cm4gVXBsb2FkZXIucmVnaXN0ZXIoe1xyXG4gICAgICAgICAgICBuYW1lOiAnbG9nJyxcclxuICAgIFxyXG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBvd25lciA9IHRoaXMub3duZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgY291bnQgPSAwLFxyXG4gICAgICAgICAgICAgICAgICAgIHNpemUgPSAwO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBvd25lclxyXG4gICAgICAgICAgICAgICAgICAgIC5vbignZXJyb3InLCBmdW5jdGlvbihjb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNfZXJyb3JfY29kZTogY29kZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbigndXBsb2FkRXJyb3InLCBmdW5jdGlvbihmaWxlLCByZWFzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VuZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY19lcnJvcl9jb2RlOiAnVVBMT0FEX0VSUk9SJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNfcmVhc29uOiAnJyArIHJlYXNvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbigndXBsb2FkQ29tcGxldGUnLCBmdW5jdGlvbihmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemUgKz0gZmlsZS5zaXplO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pLlxyXG4gICAgICAgICAgICAgICAgICAgIG9uKCd1cGxvYWRGaW5pc2hlZCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNfY291bnQ6IGNvdW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY19zaXplOiBzaXplXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudCA9IHNpemUgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICBzZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBjX3VzYWdlOiAxXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICAvKipcclxuICAgICAqIEBmaWxlT3ZlcnZpZXcgVXBsb2FkZXLkuIrkvKDnsbtcclxuICAgICAqL1xyXG4gICAgZGVmaW5lKCd3ZWJ1cGxvYWRlcicsW1xyXG4gICAgICAgICdwcmVzZXQvYWxsJyxcclxuICAgICAgICAnd2lkZ2V0cy9sb2cnXHJcbiAgICBdLCBmdW5jdGlvbiggcHJlc2V0ICkge1xyXG4gICAgICAgIHJldHVybiBwcmVzZXQ7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZXF1aXJlKCd3ZWJ1cGxvYWRlcicpO1xyXG59KTtcclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMvY29tcG9uZW50cy91cGxvYWQvd2VidXBsb2FkZXIuanNcbi8vIG1vZHVsZSBpZCA9IDhcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sInNvdXJjZVJvb3QiOiIifQ==");

/***/ },
/* 9 */
/***/ function(module, exports) {

	eval("module.exports = window.$;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJ3aW5kb3cuJFwiP2Y4ZDIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEiLCJmaWxlIjoiOS5qcyIsInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gd2luZG93LiQ7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gZXh0ZXJuYWwgXCJ3aW5kb3cuJFwiXG4vLyBtb2R1bGUgaWQgPSA5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJzb3VyY2VSb290IjoiIn0=");

/***/ }
/******/ ]);